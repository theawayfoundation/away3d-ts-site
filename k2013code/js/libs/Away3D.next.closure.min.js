'use strict';var away;(function(b){(function(b){var e=function(){function b(a){this.target=this.type=void 0;this.type=a}b.prototype.clone=function(){return new b(this.type)};b.COMPLETE="Event_Complete";b.OPEN="Event_Open";b.ENTER_FRAME="enterframe";b.EXIT_FRAME="exitframe";b.RESIZE="resize";b.CONTEXT3D_CREATE="context3DCreate";b.ERROR="error";b.CHANGE="change";return b}();b.Event=e})(b.events||(b.events={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function a(){this.listeners=[]}a.prototype.addEventListener=function(c,a,q){void 0===this.listeners[c]&&(this.listeners[c]=[]);if(-1===this.getEventListenerIndex(c,a,q)){var b=new d;b.listener=a;b.type=c;b.target=q;this.listeners[c].push(b)}};a.prototype.removeEventListener=function(c,a,q){a=this.getEventListenerIndex(c,a,q);-1!==a&&this.listeners[c].splice(a,1)};a.prototype.dispatchEvent=function(c){var a=this.listeners[c.type];if(void 0!==a){this.lFncLength=
a.length;c.target=this;for(var q,b=0,d=this.lFncLength;b<d;b++)q=a[b],q.listener.call(q.target,c)}};a.prototype.getEventListenerIndex=function(c,a,q){if(void 0!==this.listeners[c]){c=this.listeners[c];for(var b=c.length,d,l=0;l<b;l++)if(d=c[l],q==d.target&&a==d.listener)return l}return-1};a.prototype.hasEventListener=function(c,a,q){"undefined"===typeof a&&(a=null);"undefined"===typeof q&&(q=null);return null!=this.listeners&&null!=q?-1!==this.getEventListenerIndex(c,a,q):void 0!==this.listeners[c]?
0<this.listeners[c].length:!1};return a}();b.EventDispatcher=e;var d=function(){return function(){}}()})(b.events||(b.events={}))})(away||(away={}));var __extends=this.__extends||function(b,g){function e(){this.constructor=b}for(var d in g)g.hasOwnProperty(d)&&(b[d]=g[d]);e.prototype=g.prototype;b.prototype=new e};
(function(b){(function(g){var e=function(d){function a(c){d.call(this,c)}__extends(a,d);a.prototype.clone=function(){return new b.events.LightEvent(this.type)};a.CASTS_SHADOW_CHANGE="castsShadowChange";return a}(b.events.Event);g.LightEvent=e})(b.events||(b.events={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(a,c,k,q){"undefined"===typeof a&&(a=0);"undefined"===typeof c&&(c=0);"undefined"===typeof k&&(k=0);"undefined"===typeof q&&(q=0);this._x=a;this._y=c;this._z=k;this._index=q}Object.defineProperty(b.prototype,"index",{get:function(){return this._index},set:function(a){this._index=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"y",{get:function(){return this._y},set:function(a){this._y=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"z",{get:function(){return this._z},set:function(a){this._z=a},enumerable:!0,configurable:!0});b.prototype.clone=function(){return new b(this._x,this._y,this._z)};b.prototype.toString=function(){return this._x+","+this._y+","+this._z};return b}();b.Vertex=e})(b.base||(b.base={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(a,c){"undefined"===typeof a&&(a=0);"undefined"===typeof c&&(c=0);this._u=a;this._v=c}Object.defineProperty(b.prototype,"v",{get:function(){return this._v},set:function(a){this._v=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"u",{get:function(){return this._u},set:function(a){this._u=a},enumerable:!0,configurable:!0});b.prototype.clone=function(){return new b(this._u,this._v)};b.prototype.toString=function(){return this._u+
","+this._v};return b}();b.UV=e})(b.base||(b.base={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a,q){"undefined"===typeof a&&(a=null);"undefined"===typeof q&&(q=null);d.call(this,c);this._asset=a;this._prevName=q||(this._asset?this._asset.name:null)}__extends(a,d);Object.defineProperty(a.prototype,"asset",{get:function(){return this._asset},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"assetPrevName",{get:function(){return this._prevName},enumerable:!0,configurable:!0});a.prototype.clone=function(){return new b.events.AssetEvent(this.type,
this.asset,this.assetPrevName)};a.ASSET_COMPLETE="assetComplete";a.ENTITY_COMPLETE="entityComplete";a.SKYBOX_COMPLETE="skyboxComplete";a.CAMERA_COMPLETE="cameraComplete";a.MESH_COMPLETE="meshComplete";a.GEOMETRY_COMPLETE="geometryComplete";a.SKELETON_COMPLETE="skeletonComplete";a.SKELETON_POSE_COMPLETE="skeletonPoseComplete";a.CONTAINER_COMPLETE="containerComplete";a.TEXTURE_COMPLETE="textureComplete";a.TEXTURE_PROJECTOR_COMPLETE="textureProjectorComplete";a.MATERIAL_COMPLETE="materialComplete";a.ANIMATOR_COMPLETE=
"animatorComplete";a.ANIMATION_SET_COMPLETE="animationSetComplete";a.ANIMATION_STATE_COMPLETE="animationStateComplete";a.ANIMATION_NODE_COMPLETE="animationNodeComplete";a.STATE_TRANSITION_COMPLETE="stateTransitionComplete";a.SEGMENT_SET_COMPLETE="segmentSetComplete";a.LIGHT_COMPLETE="lightComplete";a.LIGHTPICKER_COMPLETE="lightPickerComplete";a.EFFECTMETHOD_COMPLETE="effectMethodComplete";a.SHADOWMAPMETHOD_COMPLETE="shadowMapMethodComplete";a.ASSET_RENAME="assetRename";a.ASSET_CONFLICT_RESOLVED="assetConflictResolved";
a.TEXTURE_SIZE_ERROR="textureSizeError";return a}(b.events.Event);g.AssetEvent=e})(b.events||(b.events={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c){"undefined"===typeof c&&(c=null);d.call(this);null==c&&(c="null");this._originalName=this._name=c;this.updateFullPath()}__extends(a,d);Object.defineProperty(a.prototype,"originalName",{get:function(){return this._originalName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"id",{get:function(){return this._id},set:function(c){this._id=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"assetType",{get:function(){return this._assetType},
set:function(c){this._assetType=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"name",{get:function(){return this._name},set:function(c){var a;a=this._name;this._name=c;null==this._name&&(this._name="null");this.updateFullPath();this.dispatchEvent(new b.events.AssetEvent(b.events.AssetEvent.ASSET_RENAME,this,a))},enumerable:!0,configurable:!0});a.prototype.dispose=function(){throw new b.errors.AbstractMethodError;};Object.defineProperty(a.prototype,"assetNamespace",{get:function(){return this._namespace},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"assetFullPath",{get:function(){return this._full_path},enumerable:!0,configurable:!0});a.prototype.assetPathEquals=function(c,a){return this._name==c&&(!a||this._namespace==a)};a.prototype.resetAssetPath=function(c,k,q){"undefined"===typeof k&&(k=null);"undefined"===typeof q&&(q=!0);this._name=c?c:"null";this._namespace=k?k:a.DEFAULT_NAMESPACE;q&&(this._originalName=this._name);this.updateFullPath()};a.prototype.updateFullPath=function(){this._full_path=
[this._namespace,this._name]};a.DEFAULT_NAMESPACE="default";return a}(b.events.EventDispatcher);g.NamedAssetBase=e})(b.library||(b.library={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(a,c,k,q){"undefined"===typeof a&&(a=0);"undefined"===typeof c&&(c=0);"undefined"===typeof k&&(k=0);"undefined"===typeof q&&(q=0);this.x=a;this.y=c;this.z=k;this.w=q}Object.defineProperty(b.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"lengthSquared",{get:function(){return this.x*this.x+this.y*this.y+this.z*this.z},enumerable:!0,
configurable:!0});b.prototype.add=function(a){return new b(this.x+a.x,this.y+a.y,this.z+a.z,this.w+a.w)};b.angleBetween=function(a,c){return Math.acos(a.dotProduct(c)/(a.length*c.length))};b.prototype.clone=function(){return new b(this.x,this.y,this.z,this.w)};b.prototype.copyFrom=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w};b.prototype.crossProduct=function(a){return new b(this.y*a.z-this.z*a.y,this.z*a.x-this.x*a.z,this.x*a.y-this.y*a.x,1)};b.prototype.decrementBy=function(a){this.x-=
a.x;this.y-=a.y;this.z-=a.z};b.distance=function(a,c){var k=a.x-c.x,b=a.y-c.y,d=a.z-c.z;return Math.sqrt(k*k+b*b+d*d)};b.prototype.dotProduct=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};b.prototype.equals=function(a,c){"undefined"===typeof c&&(c=!1);return this.x==a.x&&this.y==a.y&&this.z==a.z&&(!c||this.w==a.w)};b.prototype.incrementBy=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z};b.prototype.nearEquals=function(a,c,k){"undefined"===typeof k&&(k=!0);return Math.abs(this.x-a.x)<c&&Math.abs(this.y-
a.y)<c&&Math.abs(this.z-a.z)<c&&(!k||Math.abs(this.w-a.w)<c)};b.prototype.negate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z};b.prototype.normalize=function(){var a=1/this.length;if(0!=a)this.x*=a,this.y*=a,this.z*=a;else throw"Cannot divide by zero.";};b.prototype.project=function(){this.x/=this.w;this.y/=this.w;this.z/=this.w};b.prototype.scaleBy=function(a){this.x*=a;this.y*=a;this.z*=a};b.prototype.setTo=function(a,c,k){this.x=a;this.y=c;this.z=k};b.prototype.subtract=function(a){return new b(this.x-
a.x,this.y-a.y,this.z-a.z)};b.prototype.toString=function(){return"[Vector3D] (x:"+this.x+" ,y:"+this.y+", z"+this.z+", w:"+this.w+")"};b.X_AXIS=new b(1,0,0);b.Y_AXIS=new b(0,1,0);b.Z_AXIS=new b(0,0,1);return b}();b.Vector3D=e})(b.geom||(b.geom={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(a,c,k){"undefined"===typeof a&&(a="");"undefined"===typeof c&&(c=0);this._errorID=0;this._name=this._messsage="";this._messsage=a;this._name=name;this._errorID=c}Object.defineProperty(b.prototype,"message",{get:function(){return this._messsage},set:function(a){this._messsage=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"name",{get:function(){return this._name},set:function(a){this._name=a},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"errorID",{get:function(){return this._errorID},enumerable:!0,configurable:!0});return b}();b.Error=e})(b.errors||(b.errors={}))})(away||(away={}));(function(b){(function(b){var e=function(b){function a(c,a){"undefined"===typeof c&&(c=null);"undefined"===typeof a&&(a=0);b.call(this,c||"ArgumentError",a)}__extends(a,b);return a}(b.Error);b.ArgumentError=e})(b.errors||(b.errors={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(a){"undefined"===typeof a&&(a=null);this.rawData=null!=a&&16==a.length?a:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}d.prototype.append=function(a){var c=this.rawData[0],k=this.rawData[4],b=this.rawData[8],d=this.rawData[12],f=this.rawData[1],l=this.rawData[5],g=this.rawData[9],e=this.rawData[13],m=this.rawData[2],n=this.rawData[6],p=this.rawData[10],r=this.rawData[14],t=this.rawData[3],v=this.rawData[7],x=this.rawData[11],u=this.rawData[15],y=a.rawData[0],
z=a.rawData[4],B=a.rawData[8],A=a.rawData[12],C=a.rawData[1],E=a.rawData[5],D=a.rawData[9],F=a.rawData[13],J=a.rawData[2],G=a.rawData[6],H=a.rawData[10],I=a.rawData[14],K=a.rawData[3],L=a.rawData[7],M=a.rawData[11];a=a.rawData[15];this.rawData[0]=c*y+f*z+m*B+t*A;this.rawData[1]=c*C+f*E+m*D+t*F;this.rawData[2]=c*J+f*G+m*H+t*I;this.rawData[3]=c*K+f*L+m*M+t*a;this.rawData[4]=k*y+l*z+n*B+v*A;this.rawData[5]=k*C+l*E+n*D+v*F;this.rawData[6]=k*J+l*G+n*H+v*I;this.rawData[7]=k*K+l*L+n*M+v*a;this.rawData[8]=
b*y+g*z+p*B+x*A;this.rawData[9]=b*C+g*E+p*D+x*F;this.rawData[10]=b*J+g*G+p*H+x*I;this.rawData[11]=b*K+g*L+p*M+x*a;this.rawData[12]=d*y+e*z+r*B+u*A;this.rawData[13]=d*C+e*E+r*D+u*F;this.rawData[14]=d*J+e*G+r*H+u*I;this.rawData[15]=d*K+e*L+r*M+u*a};d.prototype.appendRotation=function(a,c){var k=d.getAxisRotation(c.x,c.y,c.z,a);this.append(k)};d.prototype.appendScale=function(a,c,k){this.append(new d([a,0,0,0,0,c,0,0,0,0,k,0,0,0,0,1]))};d.prototype.appendTranslation=function(a,c,k){this.rawData[12]+=
a;this.rawData[13]+=c;this.rawData[14]+=k};d.prototype.clone=function(){return new d(this.rawData.slice(0))};d.prototype.copyColumnFrom=function(a,c){switch(a){case 0:this.rawData[0]=c.x;this.rawData[1]=c.y;this.rawData[2]=c.z;this.rawData[3]=c.w;break;case 1:this.rawData[4]=c.x;this.rawData[5]=c.y;this.rawData[6]=c.z;this.rawData[7]=c.w;break;case 2:this.rawData[8]=c.x;this.rawData[9]=c.y;this.rawData[10]=c.z;this.rawData[11]=c.w;break;case 3:this.rawData[12]=c.x;this.rawData[13]=c.y;this.rawData[14]=
c.z;this.rawData[15]=c.w;break;default:throw new b.errors.ArgumentError("ArgumentError, Column "+a+" out of bounds [0, ..., 3]");}};d.prototype.copyColumnTo=function(a,c){switch(a){case 0:c.x=this.rawData[0];c.y=this.rawData[1];c.z=this.rawData[2];c.w=this.rawData[3];break;case 1:c.x=this.rawData[4];c.y=this.rawData[5];c.z=this.rawData[6];c.w=this.rawData[7];break;case 2:c.x=this.rawData[8];c.y=this.rawData[9];c.z=this.rawData[10];c.w=this.rawData[11];break;case 3:c.x=this.rawData[12];c.y=this.rawData[13];
c.z=this.rawData[14];c.w=this.rawData[15];break;default:throw new b.errors.ArgumentError("ArgumentError, Column "+a+" out of bounds [0, ..., 3]");}};d.prototype.copyFrom=function(a){for(var c=a.rawData.length,k=0;k<c;k++)this.rawData[k]=a.rawData[k]};d.prototype.copyRawDataFrom=function(a,c,k){"undefined"===typeof c&&(c=0);"undefined"===typeof k&&(k=!1);k&&this.transpose();for(var b=a.length-c,d=0;d<b;d++)this.rawData[d]=a[d+c];k&&this.transpose()};d.prototype.copyRawDataTo=function(a,c,k){"undefined"===
typeof c&&(c=0);"undefined"===typeof k&&(k=!1);k&&this.transpose();for(var b=this.rawData.length,d=0;d<b;d++)a[d+c]=this.rawData[d];k&&this.transpose()};d.prototype.copyRowFrom=function(a,c){switch(a){case 0:this.rawData[0]=c.x;this.rawData[4]=c.y;this.rawData[8]=c.z;this.rawData[12]=c.w;break;case 1:this.rawData[1]=c.x;this.rawData[5]=c.y;this.rawData[9]=c.z;this.rawData[13]=c.w;break;case 2:this.rawData[2]=c.x;this.rawData[6]=c.y;this.rawData[10]=c.z;this.rawData[14]=c.w;break;case 3:this.rawData[3]=
c.x;this.rawData[7]=c.y;this.rawData[11]=c.z;this.rawData[15]=c.w;break;default:throw new b.errors.ArgumentError("ArgumentError, Row "+a+" out of bounds [0, ..., 3]");}};d.prototype.copyRowTo=function(a,c){switch(a){case 0:c.x=this.rawData[0];c.y=this.rawData[4];c.z=this.rawData[8];c.w=this.rawData[12];break;case 1:c.x=this.rawData[1];c.y=this.rawData[5];c.z=this.rawData[9];c.w=this.rawData[13];break;case 2:c.x=this.rawData[2];c.y=this.rawData[6];c.z=this.rawData[10];c.w=this.rawData[14];break;case 3:c.x=
this.rawData[3];c.y=this.rawData[7];c.z=this.rawData[11];c.w=this.rawData[15];break;default:throw new b.errors.ArgumentError("ArgumentError, Row "+a+" out of bounds [0, ..., 3]");}};d.prototype.copyToMatrix3D=function(a){a.rawData=this.rawData.slice(0)};d.prototype.decompose=function(){var a=[],c=this.clone().rawData,k=new g.Vector3D(c[12],c[13],c[14]);c[12]=0;c[13]=0;c[14]=0;var b=new g.Vector3D;b.x=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);b.y=Math.sqrt(c[4]*c[4]+c[5]*c[5]+c[6]*c[6]);b.z=Math.sqrt(c[8]*
c[8]+c[9]*c[9]+c[10]*c[10]);0>c[0]*(c[5]*c[10]-c[6]*c[9])-c[1]*(c[4]*c[10]-c[6]*c[8])+c[2]*(c[4]*c[9]-c[5]*c[8])&&(b.z=-b.z);c[0]/=b.x;c[1]/=b.x;c[2]/=b.x;c[4]/=b.y;c[5]/=b.y;c[6]/=b.y;c[8]/=b.z;c[9]/=b.z;c[10]/=b.z;var d=new g.Vector3D;d.y=Math.asin(-c[2]);0<Math.cos(d.y)?(d.x=Math.atan2(c[6],c[10]),d.z=Math.atan2(c[1],c[0])):(d.z=0,d.x=Math.atan2(c[4],c[5]));a.push(k);a.push(d);a.push(b);return a};d.prototype.deltaTransformVector=function(a){var c=a.x,k=a.y;a=a.z;return new g.Vector3D(c*this.rawData[0]+
k*this.rawData[1]+a*this.rawData[2]+this.rawData[3],c*this.rawData[4]+k*this.rawData[5]+a*this.rawData[6]+this.rawData[7],c*this.rawData[8]+k*this.rawData[9]+a*this.rawData[10]+this.rawData[11],0)};d.prototype.identity=function(){this.rawData=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};d.interpolate=function(a,c,k){for(var b=new d,h=0;16>h;++h)b.rawData[h]=a.rawData[h]+(c.rawData[h]-a.rawData[h])*k;return b};d.prototype.interpolateTo=function(a,c){for(var k=0;16>k;++k)this.rawData[k]+=(a.rawData[k]-this.rawData[k])*
c};d.prototype.invert=function(){var a=this.determinant,c=1E-11<Math.abs(a);if(c){var a=1/a,k=this.rawData[0],b=this.rawData[4],d=this.rawData[8],f=this.rawData[12],l=this.rawData[1],g=this.rawData[5],e=this.rawData[9],m=this.rawData[13],n=this.rawData[2],p=this.rawData[6],r=this.rawData[10],t=this.rawData[14],v=this.rawData[3],x=this.rawData[7],u=this.rawData[11],y=this.rawData[15];this.rawData[0]=a*(g*(r*y-t*u)-e*(p*y-t*x)+m*(p*u-r*x));this.rawData[1]=-a*(l*(r*y-t*u)-e*(n*y-t*v)+m*(n*u-r*v));this.rawData[2]=
a*(l*(p*y-t*x)-g*(n*y-t*v)+m*(n*x-p*v));this.rawData[3]=-a*(l*(p*u-r*x)-g*(n*u-r*v)+e*(n*x-p*v));this.rawData[4]=-a*(b*(r*y-t*u)-d*(p*y-t*x)+f*(p*u-r*x));this.rawData[5]=a*(k*(r*y-t*u)-d*(n*y-t*v)+f*(n*u-r*v));this.rawData[6]=-a*(k*(p*y-t*x)-b*(n*y-t*v)+f*(n*x-p*v));this.rawData[7]=a*(k*(p*u-r*x)-b*(n*u-r*v)+d*(n*x-p*v));this.rawData[8]=a*(b*(e*y-m*u)-d*(g*y-m*x)+f*(g*u-e*x));this.rawData[9]=-a*(k*(e*y-m*u)-d*(l*y-m*v)+f*(l*u-e*v));this.rawData[10]=a*(k*(g*y-m*x)-b*(l*y-m*v)+f*(l*x-g*v));this.rawData[11]=
-a*(k*(g*u-e*x)-b*(l*u-e*v)+d*(l*x-g*v));this.rawData[12]=-a*(b*(e*t-m*r)-d*(g*t-m*p)+f*(g*r-e*p));this.rawData[13]=a*(k*(e*t-m*r)-d*(l*t-m*n)+f*(l*r-e*n));this.rawData[14]=-a*(k*(g*t-m*p)-b*(l*t-m*n)+f*(l*p-g*n));this.rawData[15]=a*(k*(g*r-e*p)-b*(l*r-e*n)+d*(l*p-g*n))}return c};d.prototype.prepend=function(a){var c=a.rawData[0],k=a.rawData[4],b=a.rawData[8],d=a.rawData[12],f=a.rawData[1],l=a.rawData[5],g=a.rawData[9],e=a.rawData[13],m=a.rawData[2],n=a.rawData[6],p=a.rawData[10],r=a.rawData[14],
t=a.rawData[3],v=a.rawData[7],x=a.rawData[11];a=a.rawData[15];var u=this.rawData[0],y=this.rawData[4],z=this.rawData[8],B=this.rawData[12],A=this.rawData[1],C=this.rawData[5],E=this.rawData[9],D=this.rawData[13],F=this.rawData[2],J=this.rawData[6],G=this.rawData[10],H=this.rawData[14],I=this.rawData[3],K=this.rawData[7],L=this.rawData[11],M=this.rawData[15];this.rawData[0]=c*u+f*y+m*z+t*B;this.rawData[1]=c*A+f*C+m*E+t*D;this.rawData[2]=c*F+f*J+m*G+t*H;this.rawData[3]=c*I+f*K+m*L+t*M;this.rawData[4]=
k*u+l*y+n*z+v*B;this.rawData[5]=k*A+l*C+n*E+v*D;this.rawData[6]=k*F+l*J+n*G+v*H;this.rawData[7]=k*I+l*K+n*L+v*M;this.rawData[8]=b*u+g*y+p*z+x*B;this.rawData[9]=b*A+g*C+p*E+x*D;this.rawData[10]=b*F+g*J+p*G+x*H;this.rawData[11]=b*I+g*K+p*L+x*M;this.rawData[12]=d*u+e*y+r*z+a*B;this.rawData[13]=d*A+e*C+r*E+a*D;this.rawData[14]=d*F+e*J+r*G+a*H;this.rawData[15]=d*I+e*K+r*L+a*M};d.prototype.prependRotation=function(a,c){var k=d.getAxisRotation(c.x,c.y,c.z,a);this.prepend(k)};d.prototype.prependScale=function(a,
c,k){this.prepend(new d([a,0,0,0,0,c,0,0,0,0,k,0,0,0,0,1]))};d.prototype.prependTranslation=function(a,c,k){var b=new d;b.position=new g.Vector3D(a,c,k);this.prepend(b)};d.prototype.recompose=function(a){if(3>a.length)return!1;this.identity();this.appendScale(a[2].x,a[2].y,a[2].z);var c;c=-a[1].x;this.append(new d([1,0,0,0,0,Math.cos(c),-Math.sin(c),0,0,Math.sin(c),Math.cos(c),0,0,0,0,0]));c=-a[1].y;this.append(new d([Math.cos(c),0,Math.sin(c),0,0,1,0,0,-Math.sin(c),0,Math.cos(c),0,0,0,0,0]));c=-a[1].z;
this.append(new d([Math.cos(c),-Math.sin(c),0,0,Math.sin(c),Math.cos(c),0,0,0,0,1,0,0,0,0,0]));this.position=a[0];this.rawData[15]=1;return!0};d.prototype.transformVector=function(a){var c=a.x,k=a.y;a=a.z;return new b.geom.Vector3D(c*this.rawData[0]+k*this.rawData[4]+a*this.rawData[8]+this.rawData[12],c*this.rawData[1]+k*this.rawData[5]+a*this.rawData[9]+this.rawData[13],c*this.rawData[2]+k*this.rawData[6]+a*this.rawData[10]+this.rawData[14],c*this.rawData[3]+k*this.rawData[7]+a*this.rawData[11]+
this.rawData[15])};d.prototype.transformVectors=function(a,c){for(var k=0,b=0,d=0,f=0;k+3<=a.length;)b=a[k],d=a[k+1],f=a[k+2],c[k]=b*this.rawData[0]+d*this.rawData[4]+f*this.rawData[8]+this.rawData[12],c[k+1]=b*this.rawData[1]+d*this.rawData[5]+f*this.rawData[9]+this.rawData[13],c[k+2]=b*this.rawData[2]+d*this.rawData[6]+f*this.rawData[10]+this.rawData[14],k+=3};d.prototype.transpose=function(){var a=this.rawData.slice(0);this.rawData[1]=a[4];this.rawData[2]=a[8];this.rawData[3]=a[12];this.rawData[4]=
a[1];this.rawData[6]=a[9];this.rawData[7]=a[13];this.rawData[8]=a[2];this.rawData[9]=a[6];this.rawData[11]=a[14];this.rawData[12]=a[3];this.rawData[13]=a[7];this.rawData[14]=a[11]};d.getAxisRotation=function(a,c,k,b){var h=new d;a=new g.Vector3D(a,c,k);b=-b*(Math.PI/180);k=Math.cos(b);b=Math.sin(b);c=1-k;h.rawData[0]=k+a.x*a.x*c;h.rawData[5]=k+a.y*a.y*c;h.rawData[10]=k+a.z*a.z*c;k=a.x*a.y*c;var f=a.z*b;h.rawData[4]=k+f;h.rawData[1]=k-f;k=a.x*a.z*c;f=a.y*b;h.rawData[8]=k-f;h.rawData[2]=k+f;k=a.y*a.z*
c;f=a.x*b;h.rawData[9]=k+f;h.rawData[6]=k-f;return h};Object.defineProperty(d.prototype,"determinant",{get:function(){return(this.rawData[0]*this.rawData[5]-this.rawData[4]*this.rawData[1])*(this.rawData[10]*this.rawData[15]-this.rawData[14]*this.rawData[11])-(this.rawData[0]*this.rawData[9]-this.rawData[8]*this.rawData[1])*(this.rawData[6]*this.rawData[15]-this.rawData[14]*this.rawData[7])+(this.rawData[0]*this.rawData[13]-this.rawData[12]*this.rawData[1])*(this.rawData[6]*this.rawData[11]-this.rawData[10]*
this.rawData[7])+(this.rawData[4]*this.rawData[9]-this.rawData[8]*this.rawData[5])*(this.rawData[2]*this.rawData[15]-this.rawData[14]*this.rawData[3])-(this.rawData[4]*this.rawData[13]-this.rawData[12]*this.rawData[5])*(this.rawData[2]*this.rawData[11]-this.rawData[10]*this.rawData[3])+(this.rawData[8]*this.rawData[13]-this.rawData[12]*this.rawData[9])*(this.rawData[2]*this.rawData[7]-this.rawData[6]*this.rawData[3])},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"position",{get:function(){return new g.Vector3D(this.rawData[12],
this.rawData[13],this.rawData[14])},set:function(a){this.rawData[12]=a.x;this.rawData[13]=a.y;this.rawData[14]=a.z},enumerable:!0,configurable:!0});return d}();g.Matrix3D=e})(b.geom||(b.geom={}))})(away||(away={}));(function(b){(function(b){var e=function(){function b(){}b.RADIANS_TO_DEGREES=180/Math.PI;b.DEGREES_TO_RADIANS=Math.PI/180;return b}();b.MathConsts=e})(b.math||(b.math={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(a,c,k,b){"undefined"===typeof a&&(a=0);"undefined"===typeof c&&(c=0);"undefined"===typeof k&&(k=0);"undefined"===typeof b&&(b=1);this.z=this.y=this.x=0;this.w=1;this.x=a;this.y=c;this.z=k;this.w=b}Object.defineProperty(d.prototype,"magnitude",{get:function(){return Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z)},enumerable:!0,configurable:!0});d.prototype.multiply=function(a,c){var k=a.w,b=a.x,d=a.y,f=a.z,l=c.w,g=c.x,e=c.y,
m=c.z;this.w=k*l-b*g-d*e-f*m;this.x=k*g+b*l+d*m-f*e;this.y=k*e-b*m+d*l+f*g;this.z=k*m+b*e-d*g+f*l};d.prototype.multiplyVector=function(a,c){"undefined"===typeof c&&(c=null);null===c&&(c=new d);var k=a.x,b=a.y,h=a.z;c.w=-this.x*k-this.y*b-this.z*h;c.x=this.w*k+this.y*h-this.z*b;c.y=this.w*b-this.x*h+this.z*k;c.z=this.w*h+this.x*b-this.y*k;return c};d.prototype.fromAxisAngle=function(a,c){var k=Math.sin(c/2),b=Math.cos(c/2);this.x=a.x*k;this.y=a.y*k;this.z=a.z*k;this.w=b;this.normalize()};d.prototype.slerp=
function(a,c,k){var b=a.w,d=a.x,f=a.y;a=a.z;var l=c.w,g=c.x,e=c.y;c=c.z;var m=b*l+d*g+f*e+a*c;0>m&&(m=-m,l=-l,g=-g,e=-e,c=-c);if(0.95>m){var n=Math.acos(m),p=1/Math.sin(n),m=Math.sin(n*(1-k))*p;k=Math.sin(n*k)*p;this.w=b*m+l*k;this.x=d*m+g*k;this.y=f*m+e*k;this.z=a*m+c*k}else this.w=b+k*(l-b),this.x=d+k*(g-d),this.y=f+k*(e-f),this.z=a+k*(c-a),b=1/Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z),this.w*=b,this.x*=b,this.y*=b,this.z*=b};d.prototype.lerp=function(a,c,k){var b=a.w,d=
a.x,f=a.y;a=a.z;var l=c.w,g=c.x,e=c.y;c=c.z;0>b*l+d*g+f*e+a*c&&(l=-l,g=-g,e=-e,c=-c);this.w=b+k*(l-b);this.x=d+k*(g-d);this.y=f+k*(e-f);this.z=a+k*(c-a);k=1/Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z);this.w*=k;this.x*=k;this.y*=k;this.z*=k};d.prototype.fromEulerAngles=function(a,c,k){a*=0.5;var b=0.5*c;c=0.5*k;k=Math.cos(a);a=Math.sin(a);var d=Math.cos(b),b=Math.sin(b),f=Math.cos(c);c=Math.sin(c);this.w=k*d*f+a*b*c;this.x=a*d*f-k*b*c;this.y=k*b*f+a*d*c;this.z=k*d*c-a*b*f};
d.prototype.toEulerAngles=function(a){"undefined"===typeof a&&(a=null);null===a&&(a=new b.geom.Vector3D);a.x=Math.atan2(2*(this.w*this.x+this.y*this.z),1-2*(this.x*this.x+this.y*this.y));a.y=Math.asin(2*(this.w*this.y-this.z*this.x));a.z=Math.atan2(2*(this.w*this.z+this.x*this.y),1-2*(this.y*this.y+this.z*this.z));return a};d.prototype.normalize=function(a){"undefined"===typeof a&&(a=1);a/=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);this.x*=a;this.y*=a;this.z*=a;this.w*=a};
d.prototype.toString=function(){return"{x:"+this.x+" y:"+this.y+" z:"+this.z+" w:"+this.w+"}"};d.prototype.toMatrix3D=function(a){"undefined"===typeof a&&(a=null);var c=b.math.Matrix3DUtils.RAW_DATA_CONTAINER,k=2*this.x*this.y,q=2*this.x*this.z,d=2*this.x*this.w,f=2*this.y*this.z,l=2*this.y*this.w,g=2*this.z*this.w,e=this.x*this.x,m=this.y*this.y,n=this.z*this.z,p=this.w*this.w;c[0]=e-m-n+p;c[4]=k-g;c[8]=q+l;c[12]=0;c[1]=k+g;c[5]=-e+m-n+p;c[9]=f-d;c[13]=0;c[2]=q-l;c[6]=f+d;c[10]=-e-m+n+p;c[14]=0;
c[3]=0;c[7]=0;c[11]=0;c[15]=1;if(!a)return new b.geom.Matrix3D(c);a.copyRawDataFrom(c);return a};d.prototype.fromMatrix=function(a){a=a.decompose()[1];this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w};d.prototype.toRawData=function(a,c){"undefined"===typeof c&&(c=!1);var k=2*this.x*this.y,b=2*this.x*this.z,d=2*this.x*this.w,f=2*this.y*this.z,l=2*this.y*this.w,g=2*this.z*this.w,e=this.x*this.x,m=this.y*this.y,n=this.z*this.z,p=this.w*this.w;a[0]=e-m-n+p;a[1]=k-g;a[2]=b+l;a[4]=k+g;a[5]=-e+m-n+p;a[6]=f-d;
a[8]=b-l;a[9]=f+d;a[10]=-e-m+n+p;a[3]=a[7]=a[11]=0;c||(a[12]=a[13]=a[14]=0,a[15]=1)};d.prototype.clone=function(){return new d(this.x,this.y,this.z,this.w)};d.prototype.rotatePoint=function(a,c){"undefined"===typeof c&&(c=null);var k,q,d,f;d=a.x;var l=a.y,g=a.z;null===c&&(c=new b.geom.Vector3D);f=-this.x*d-this.y*l-this.z*g;k=this.w*d+this.y*g-this.z*l;q=this.w*l-this.x*g+this.z*d;d=this.w*g+this.x*l-this.y*d;c.x=-f*this.x+k*this.w-q*this.z+d*this.y;c.y=-f*this.y+k*this.z+q*this.w-d*this.x;c.z=-f*
this.z-k*this.y+q*this.x+d*this.w;return c};d.prototype.copyFrom=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w};return d}();g.Quaternion=e})(b.math||(b.math={}))})(away||(away={}));(function(b){(function(b){var e=function(){function b(){}b.BACK=0;b.FRONT=1;b.IN=0;b.OUT=1;b.INTERSECT=2;return b}();b.PlaneClassification=e})(b.math||(b.math={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(a,c,k,b){"undefined"===typeof a&&(a=0);"undefined"===typeof c&&(c=0);"undefined"===typeof k&&(k=0);"undefined"===typeof b&&(b=0);this.a=a;this.b=c;this.c=k;this.d=b;this._iAlignment=0==a&&0==c?d.ALIGN_XY_AXIS:0==c&&0==k?d.ALIGN_YZ_AXIS:0==a&&0==k?d.ALIGN_XZ_AXIS:d.ALIGN_ANY}d.prototype.fromPoints=function(a,c,k){var b=c.x-a.x,h=c.y-a.y;c=c.z-a.z;var f=k.x-a.x,l=k.y-a.y;k=k.z-a.z;this.a=h*k-c*l;this.b=c*f-b*k;this.c=b*l-h*f;this.d=this.a*a.x+this.b*
a.y+this.c*a.z;this._iAlignment=0==this.a&&0==this.b?d.ALIGN_XY_AXIS:0==this.b&&0==this.c?d.ALIGN_YZ_AXIS:0==this.a&&0==this.c?d.ALIGN_XZ_AXIS:d.ALIGN_ANY};d.prototype.fromNormalAndPoint=function(a,c){this.a=a.x;this.b=a.y;this.c=a.z;this.d=this.a*c.x+this.b*c.y+this.c*c.z;this._iAlignment=0==this.a&&0==this.b?d.ALIGN_XY_AXIS:0==this.b&&0==this.c?d.ALIGN_YZ_AXIS:0==this.a&&0==this.c?d.ALIGN_XZ_AXIS:d.ALIGN_ANY};d.prototype.normalize=function(){var a=1/Math.sqrt(this.a*this.a+this.b*this.b+this.c*
this.c);this.a*=a;this.b*=a;this.c*=a;this.d*=a;return this};d.prototype.distance=function(a){return this._iAlignment==d.ALIGN_YZ_AXIS?this.a*a.x-this.d:this._iAlignment==d.ALIGN_XZ_AXIS?this.b*a.y-this.d:this._iAlignment==d.ALIGN_XY_AXIS?this.c*a.z-this.d:this.a*a.x+this.b*a.y+this.c*a.z-this.d};d.prototype.classifyPoint=function(a,c){"undefined"===typeof c&&(c=0.01);if(this.d!=this.d)return b.math.PlaneClassification.FRONT;var k;k=this._iAlignment==d.ALIGN_YZ_AXIS?this.a*a.x-this.d:this._iAlignment==
d.ALIGN_XZ_AXIS?this.b*a.y-this.d:this._iAlignment==d.ALIGN_XY_AXIS?this.c*a.z-this.d:this.a*a.x+this.b*a.y+this.c*a.z-this.d;return k<-c?b.math.PlaneClassification.BACK:k>c?b.math.PlaneClassification.FRONT:b.math.PlaneClassification.INTERSECT};d.prototype.toString=function(){return"Plane3D [a:"+this.a+", b:"+this.b+", c:"+this.c+", d:"+this.d+"]"};d.ALIGN_ANY=0;d.ALIGN_XY_AXIS=1;d.ALIGN_YZ_AXIS=2;d.ALIGN_XZ_AXIS=3;return d}();g.Plane3D=e})(b.math||(b.math={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(){}d.quaternion2matrix=function(a,c){"undefined"===typeof c&&(c=null);var k=a.x,q=a.y,d=a.z,f=a.w,l=k*k,g=k*q,e=k*d,k=k*f,m=q*q,n=q*d,q=q*f,p=d*d,d=d*f,f=b.math.Matrix3DUtils.RAW_DATA_CONTAINER;f[0]=1-2*(m+p);f[1]=2*(g+d);f[2]=2*(e-q);f[4]=2*(g-d);f[5]=1-2*(l+p);f[6]=2*(n+k);f[8]=2*(e+q);f[9]=2*(n-k);f[10]=1-2*(l+m);f[3]=f[7]=f[11]=f[12]=f[13]=f[14]=0;f[15]=1;return c?(c.copyRawDataFrom(f),c):new b.geom.Matrix3D(f)};d.getForward=function(a,c){"undefined"===
typeof c&&(c=null);null===c&&(c=new b.geom.Vector3D(0,0,0));a.copyColumnTo(2,c);c.normalize();return c};d.getUp=function(a,c){"undefined"===typeof c&&(c=null);null===c&&(c=new b.geom.Vector3D(0,0,0));a.copyColumnTo(1,c);c.normalize();return c};d.getRight=function(a,c){"undefined"===typeof c&&(c=null);null===c&&(c=new b.geom.Vector3D(0,0,0));a.copyColumnTo(0,c);c.normalize();return c};d.compare=function(a,c){var k=b.math.Matrix3DUtils.RAW_DATA_CONTAINER,q=c.rawData;a.copyRawDataTo(k);for(var d=0;16>
d;++d)if(k[d]!=q[d])return!1;return!0};d.lookAt=function(a,c,k,q){var d,f=b.math.Matrix3DUtils.RAW_DATA_CONTAINER;d=k.crossProduct(q);d.normalize();q=d.crossProduct(k);q.normalize();k=k.clone();k.normalize();f[0]=d.x;f[1]=q.x;f[2]=-k.x;f[3]=0;f[4]=d.y;f[5]=q.y;f[6]=-k.y;f[7]=0;f[8]=d.z;f[9]=q.z;f[10]=-k.z;f[11]=0;f[12]=-d.dotProduct(c);f[13]=-q.dotProduct(c);f[14]=k.dotProduct(c);f[15]=1;a.copyRawDataFrom(f)};d.reflection=function(a,c){"undefined"===typeof c&&(c=null);null===c&&(c=new b.geom.Matrix3D);
var k=a.a,q=a.b,d=a.c,f=a.d,l=b.math.Matrix3DUtils.RAW_DATA_CONTAINER,g=-2*k*q,e=-2*k*d,m=-2*q*d;l[0]=1-2*k*k;l[4]=g;l[8]=e;l[12]=-2*k*f;l[1]=g;l[5]=1-2*q*q;l[9]=m;l[13]=-2*q*f;l[2]=e;l[6]=m;l[10]=1-2*d*d;l[14]=-2*d*f;l[3]=0;l[7]=0;l[11]=0;l[15]=1;c.copyRawDataFrom(l);return c};d.RAW_DATA_CONTAINER=Array(16);d.CALCULATION_MATRIX=new b.geom.Matrix3D;return d}();g.Matrix3DUtils=e})(b.math||(b.math={}))})(away||(away={}));
(function(b){(function(b){var e=function(b){function a(c,a){b.call(this,c);this.object=a}__extends(a,b);a.VISIBLITY_UPDATED="visiblityUpdated";a.SCENETRANSFORM_CHANGED="scenetransformChanged";a.SCENE_CHANGED="sceneChanged";a.POSITION_CHANGED="positionChanged";a.ROTATION_CHANGED="rotationChanged";a.SCALE_CHANGED="scaleChanged";return a}(b.Event);b.Object3DEvent=e})(b.events||(b.events={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._smallestNumber=1E-22;this._scaleDirty=this._rotationDirty=this._positionDirty=this._transformDirty=!0;this._rotationZ=this._rotationY=this._rotationX=0;this._eulers=new b.geom.Vector3D;this._flipY=new b.geom.Matrix3D;this._zOffset=0;this._pTransform=new b.geom.Matrix3D;this._pScaleZ=this._pScaleY=this._pScaleX=1;this._z=this._y=this._x=0;this._pivotPoint=new b.geom.Vector3D;this._pivotZero=!0;this._pPos=new b.geom.Vector3D;
this._rot=new b.geom.Vector3D;this._sca=new b.geom.Vector3D;this._transformComponents=Array(3);this._transformComponents[0]=this._pPos;this._transformComponents[1]=this._rot;this._transformComponents[2]=this._sca;this._pTransform.identity();this._flipY.appendScale(1,-1,1)}__extends(a,d);a.prototype.invalidatePivot=function(){this._pivotZero=0==this._pivotPoint.x&&0==this._pivotPoint.y&&0==this._pivotPoint.z;this.iInvalidateTransform()};a.prototype.invalidatePosition=function(){this._positionDirty||
(this._positionDirty=!0,this.iInvalidateTransform(),this._listenToPositionChanged&&this.notifyPositionChanged())};a.prototype.notifyPositionChanged=function(){this._positionChanged||(this._positionChanged=new b.events.Object3DEvent(b.events.Object3DEvent.POSITION_CHANGED,this));this.dispatchEvent(this._positionChanged)};a.prototype.addEventListener=function(c,a,q){d.prototype.addEventListener.call(this,c,a,q);switch(c){case b.events.Object3DEvent.POSITION_CHANGED:this._listenToPositionChanged=!0;
break;case b.events.Object3DEvent.ROTATION_CHANGED:this._listenToRotationChanged=!0;break;case b.events.Object3DEvent.SCALE_CHANGED:this._listenToScaleChanged=!0}};a.prototype.removeEventListener=function(c,a,q){d.prototype.removeEventListener.call(this,c,a,q);if(!this.hasEventListener(c,a,q))switch(c){case b.events.Object3DEvent.POSITION_CHANGED:this._listenToPositionChanged=!1;break;case b.events.Object3DEvent.ROTATION_CHANGED:this._listenToRotationChanged=!1;break;case b.events.Object3DEvent.SCALE_CHANGED:this._listenToScaleChanged=
!1}};a.prototype.invalidateRotation=function(){this._rotationDirty||(this._rotationDirty=!0,this.iInvalidateTransform(),this._listenToRotationChanged&&this.notifyRotationChanged())};a.prototype.notifyRotationChanged=function(){this._rotationChanged||(this._rotationChanged=new b.events.Object3DEvent(b.events.Object3DEvent.ROTATION_CHANGED,this));this.dispatchEvent(this._rotationChanged)};a.prototype.invalidateScale=function(){this._scaleDirty||(this._scaleDirty=!0,this.iInvalidateTransform(),this._listenToScaleChanged&&
this.notifyScaleChanged())};a.prototype.notifyScaleChanged=function(){this._scaleChanged||(this._scaleChanged=new b.events.Object3DEvent(b.events.Object3DEvent.SCALE_CHANGED,this));this.dispatchEvent(this._scaleChanged)};Object.defineProperty(a.prototype,"x",{get:function(){return this._x},set:function(c){this._x!=c&&(this._x=c,this.invalidatePosition())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"y",{get:function(){return this._y},set:function(c){this._y!=c&&(this._y=c,this.invalidatePosition())},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"z",{get:function(){return this._z},set:function(c){this._z!=c&&(this._z=c,this.invalidatePosition())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"rotationX",{get:function(){return this._rotationX*b.math.MathConsts.RADIANS_TO_DEGREES},set:function(c){this.rotationX!=c&&(this._rotationX=c*b.math.MathConsts.DEGREES_TO_RADIANS,this.invalidateRotation())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"rotationY",{get:function(){return this._rotationY*b.math.MathConsts.RADIANS_TO_DEGREES},set:function(c){this.rotationY!=c&&(this._rotationY=c*b.math.MathConsts.DEGREES_TO_RADIANS,this.invalidateRotation())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"rotationZ",{get:function(){return this._rotationZ*b.math.MathConsts.RADIANS_TO_DEGREES},set:function(c){this.rotationZ!=c&&(this._rotationZ=c*b.math.MathConsts.DEGREES_TO_RADIANS,this.invalidateRotation())},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"scaleX",{get:function(){return this._pScaleX},set:function(c){this._pScaleX!=c&&(this._pScaleX=c,this.invalidateScale())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"scaleY",{get:function(){return this._pScaleY},set:function(c){this._pScaleY!=c&&(this._pScaleY=c,this.invalidateScale())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"scaleZ",{get:function(){return this._pScaleZ},set:function(c){this._pScaleZ!=c&&(this._pScaleZ=
c,this.invalidateScale())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"eulers",{get:function(){this._eulers.x=this._rotationX*b.math.MathConsts.RADIANS_TO_DEGREES;this._eulers.y=this._rotationY*b.math.MathConsts.RADIANS_TO_DEGREES;this._eulers.z=this._rotationZ*b.math.MathConsts.RADIANS_TO_DEGREES;return this._eulers},set:function(c){this._rotationX=c.x*b.math.MathConsts.DEGREES_TO_RADIANS;this._rotationY=c.y*b.math.MathConsts.DEGREES_TO_RADIANS;this._rotationZ=c.z*b.math.MathConsts.DEGREES_TO_RADIANS;
this.invalidateRotation()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"transform",{get:function(){this._transformDirty&&this.pUpdateTransform();return this._pTransform},set:function(c){if(!c.rawData[0]){var a=b.math.Matrix3DUtils.RAW_DATA_CONTAINER;c.copyRawDataTo(a);a[0]=this._smallestNumber;c.copyRawDataFrom(a)}c=c.decompose();a=c[0];if(this._x!=a.x||this._y!=a.y||this._z!=a.z)this._x=a.x,this._y=a.y,this._z=a.z,this.invalidatePosition();a=c[1];if(this._rotationX!=a.x||this._rotationY!=
a.y||this._rotationZ!=a.z)this._rotationX=a.x,this._rotationY=a.y,this._rotationZ=a.z,this.invalidateRotation();a=c[2];if(this._pScaleX!=a.x||this._pScaleY!=a.y||this._pScaleZ!=a.z)this._pScaleX=a.x,this._pScaleY=a.y,this._pScaleZ=a.z,this.invalidateScale()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"pivotPoint",{get:function(){return this._pivotPoint},set:function(c){this._pivotPoint=c.clone();this.invalidatePivot()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"position",{get:function(){this._pTransform.copyColumnTo(3,this._pPos);return this._pPos.clone()},set:function(c){this._x=c.x;this._y=c.y;this._z=c.z;this.invalidatePosition()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"forwardVector",{get:function(){return b.math.Matrix3DUtils.getForward(this.transform)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"rightVector",{get:function(){return b.math.Matrix3DUtils.getRight(this.transform)},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"upVector",{get:function(){return b.math.Matrix3DUtils.getUp(this.transform)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"backVector",{get:function(){var c=b.math.Matrix3DUtils.getForward(this.transform);c.negate();return c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"leftVector",{get:function(){var c=b.math.Matrix3DUtils.getRight(this.transform);c.negate();return c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"downVector",{get:function(){var c=b.math.Matrix3DUtils.getUp(this.transform);c.negate();return c},enumerable:!0,configurable:!0});a.prototype.scale=function(c){this._pScaleX*=c;this._pScaleY*=c;this._pScaleZ*=c;this.invalidateScale()};a.prototype.moveForward=function(c){this.translateLocal(b.geom.Vector3D.Z_AXIS,c)};a.prototype.moveBackward=function(c){this.translateLocal(b.geom.Vector3D.Z_AXIS,-c)};a.prototype.moveLeft=function(c){this.translateLocal(b.geom.Vector3D.X_AXIS,-c)};a.prototype.moveRight=
function(c){this.translateLocal(b.geom.Vector3D.X_AXIS,c)};a.prototype.moveUp=function(c){this.translateLocal(b.geom.Vector3D.Y_AXIS,c)};a.prototype.moveDown=function(c){this.translateLocal(b.geom.Vector3D.Y_AXIS,-c)};a.prototype.moveTo=function(c,a,b){if(this._x!=c||this._y!=a||this._z!=b)this._x=c,this._y=a,this._z=b,this.invalidatePosition()};a.prototype.movePivot=function(c,a,q){null==this._pivotPoint&&(this._pivotPoint=new b.geom.Vector3D);this._pivotPoint.x+=c;this._pivotPoint.y+=a;this._pivotPoint.z+=
q;this.invalidatePivot()};a.prototype.translate=function(c,a){var b=c.x,d=c.y,f=c.z,l=a/Math.sqrt(b*b+d*d+f*f);this._x+=b*l;this._y+=d*l;this._z+=f*l;this.invalidatePosition()};a.prototype.translateLocal=function(c,a){var b=c.x,d=c.y,f=c.z,l=a/Math.sqrt(b*b+d*d+f*f);this.transform.prependTranslation(b*l,d*l,f*l);this._pTransform.copyColumnTo(3,this._pPos);this._x=this._pPos.x;this._y=this._pPos.y;this._z=this._pPos.z;this.invalidatePosition()};a.prototype.pitch=function(c){this.rotate(b.geom.Vector3D.X_AXIS,
c)};a.prototype.yaw=function(c){this.rotate(b.geom.Vector3D.Y_AXIS,c)};a.prototype.roll=function(c){this.rotate(b.geom.Vector3D.Z_AXIS,c)};a.prototype.clone=function(){var c=new b.base.Object3D;c.pivotPoint=this.pivotPoint;c.transform=this.transform;c.name=name;return c};a.prototype.rotateTo=function(c,a,q){this._rotationX=c*b.math.MathConsts.DEGREES_TO_RADIANS;this._rotationY=a*b.math.MathConsts.DEGREES_TO_RADIANS;this._rotationZ=q*b.math.MathConsts.DEGREES_TO_RADIANS;this.invalidateRotation()};
a.prototype.rotate=function(c,a){this.transform.prependRotation(a,c);this.transform=this.transform};a.prototype.lookAt=function(c,a){"undefined"===typeof a&&(a=null);var q,d,f,l;null==a&&(a=b.geom.Vector3D.Y_AXIS);d=c.subtract(this.position);d.normalize();f=a.crossProduct(d);f.normalize();0.05>f.length&&(f=a.crossProduct(b.geom.Vector3D.Z_AXIS));q=d.crossProduct(f);l=b.math.Matrix3DUtils.RAW_DATA_CONTAINER;l[0]=this._pScaleX*f.x;l[1]=this._pScaleX*f.y;l[2]=this._pScaleX*f.z;l[3]=0;l[4]=this._pScaleY*
q.x;l[5]=this._pScaleY*q.y;l[6]=this._pScaleY*q.z;l[7]=0;l[8]=this._pScaleZ*d.x;l[9]=this._pScaleZ*d.y;l[10]=this._pScaleZ*d.z;l[11]=0;l[12]=this._x;l[13]=this._y;l[14]=this._z;l[15]=1;this._pTransform.copyRawDataFrom(l);this.transform=this.transform;0>d.z&&(this.rotationY=180-this.rotationY,this.rotationX-=180,this.rotationZ-=180)};a.prototype.dispose=function(){};a.prototype.disposeAsset=function(){this.dispose()};a.prototype.iInvalidateTransform=function(){this._transformDirty=!0};a.prototype.pUpdateTransform=
function(){this._pPos.x=this._x;this._pPos.y=this._y;this._pPos.z=this._z;this._rot.x=this._rotationX;this._rot.y=this._rotationY;this._rot.z=this._rotationZ;this._sca.x=this._pScaleX;this._sca.y=this._pScaleY;this._sca.z=this._pScaleZ;this._pTransform.recompose(this._transformComponents);this._pivotZero||(this._pTransform.prependTranslation(-this._pivotPoint.x,-this._pivotPoint.y,-this._pivotPoint.z),this._pTransform.appendTranslation(this._pivotPoint.x,this._pivotPoint.y,this._pivotPoint.z));this._scaleDirty=
this._rotationDirty=this._positionDirty=this._transformDirty=!1};Object.defineProperty(a.prototype,"zOffset",{get:function(){return this._zOffset},set:function(c){this._zOffset=c},enumerable:!0,configurable:!0});return a}(b.library.NamedAssetBase);g.Object3D=e})(b.base||(b.base={}))})(away||(away={}));
(function(b){(function(b){var e=function(b){function a(c,a){"undefined"===typeof c&&(c=null);"undefined"===typeof a&&(a=0);b.call(this,c||"An abstract method was called! Either an instance of an abstract class was created, or an abstract method was not overridden by the subclass.",a)}__extends(a,b);return a}(b.Error);b.AbstractMethodError=e})(b.errors||(b.errors={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(c,a){this.objectContainer3D=a;b.call(this,c)}__extends(a,b);Object.defineProperty(a.prototype,"target",{get:function(){return this.objectContainer3D},enumerable:!0,configurable:!0});a.ADDED_TO_SCENE="addedToScene";a.REMOVED_FROM_SCENE="removedFromScene";a.PARTITION_CHANGED="partitionChanged";return a}(b.events.Event);g.Scene3DEvent=e})(b.events||(b.events={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._partitions=[];this._iSceneGraphRoot=new b.containers.ObjectContainer3D;this._iSceneGraphRoot.scene=this;this._iSceneGraphRoot._iIsRoot=!0;this._iSceneGraphRoot.partition=new b.partition.Partition3D(new b.partition.NodeBase)}__extends(a,d);a.prototype.traversePartitions=function(c){var a=0,b=this._partitions.length;for(c.scene=this;a<b;)this._partitions[a++].traverse(c)};Object.defineProperty(a.prototype,"partition",{get:function(){return this._iSceneGraphRoot.partition},
set:function(c){this._iSceneGraphRoot.partition=c;this.dispatchEvent(new b.events.Scene3DEvent(b.events.Scene3DEvent.PARTITION_CHANGED,this._iSceneGraphRoot))},enumerable:!0,configurable:!0});a.prototype.contains=function(c){return this._iSceneGraphRoot.contains(c)};a.prototype.addChild=function(c){return this._iSceneGraphRoot.addChild(c)};a.prototype.removeChild=function(c){this._iSceneGraphRoot.removeChild(c)};a.prototype.removeChildAt=function(c){this._iSceneGraphRoot.removeChildAt(c)};a.prototype.getChildAt=
function(c){return this._iSceneGraphRoot.getChildAt(c)};Object.defineProperty(a.prototype,"numChildren",{get:function(){return this._iSceneGraphRoot.numChildren},enumerable:!0,configurable:!0});a.prototype.iRegisterEntity=function(c){var a=c.iGetImplicitPartition();this.iAddPartitionUnique(a);this.partition.iMarkForUpdate(c)};a.prototype.iUnregisterEntity=function(c){c.iGetImplicitPartition().iRemoveEntity(c)};a.prototype.iInvalidateEntityBounds=function(c){c.iGetImplicitPartition().iMarkForUpdate(c)};
a.prototype.iRegisterPartition=function(c){this.iAddPartitionUnique(c.iGetImplicitPartition())};a.prototype.iUnregisterPartition=function(c){c.iGetImplicitPartition().iRemoveEntity(c)};a.prototype.iAddPartitionUnique=function(c){-1==this._partitions.indexOf(c)&&this._partitions.push(c)};return a}(b.events.EventDispatcher);g.Scene3D=e})(b.containers||(b.containers={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(){}b.ADD="add";b.ALPHA="alpha";b.DARKEN="darken";b.DIFFERENCE="difference";b.ERASE="erase";b.HARDLIGHT="hardlight";b.INVERT="invert";b.LAYER="layer";b.LIGHTEN="lighten";b.MULTIPLY="multiply";b.NORMAL="normal";b.OVERLAY="overlay";b.SCREEN="screen";b.SHADER="shader";b.SUBTRACT="subtract";return b}();b.BlendMode=e})(b.display||(b.display={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(){}b.COLOR=16384;b.DEPTH=256;b.STENCIL=1024;b.ALL=b.COLOR|b.DEPTH|b.STENCIL;return b}();b.Context3DClearMask=e})(b.display3D||(b.display3D={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(a,c,k){this._gl=a;this._buffer=this._gl.createBuffer();this._numVertices=c;this._data32PerVertex=k}b.prototype.uploadFromArray=function(a,c,k){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._buffer);console.log("** WARNING upload not fully implemented, startVertex & numVertices not considered.");this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(a),this._gl.STATIC_DRAW)};Object.defineProperty(b.prototype,"numVertices",{get:function(){return this._numVertices},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"data32PerVertex",{get:function(){return this._data32PerVertex},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"glBuffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0});b.prototype.dispose=function(){this._gl.deleteBuffer(this._buffer)};return b}();b.VertexBuffer3D=e})(b.display3D||(b.display3D={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(a,c){this._gl=a;this._buffer=this._gl.createBuffer();this._numIndices=c}b.prototype.uploadFromArray=function(a,c,k){this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this._buffer);this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(a),this._gl.STATIC_DRAW)};b.prototype.dispose=function(){this._gl.deleteBuffer(this._buffer)};Object.defineProperty(b.prototype,"numIndices",{get:function(){return this._numIndices},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"glBuffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0});return b}();b.IndexBuffer3D=e})(b.display3D||(b.display3D={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(a){this._gl=a;this._program=this._gl.createProgram()}b.prototype.upload=function(a,c){this._vertexShader=this._gl.createShader(this._gl.VERTEX_SHADER);this._fragmentShader=this._gl.createShader(this._gl.FRAGMENT_SHADER);this._gl.shaderSource(this._vertexShader,a);this._gl.compileShader(this._vertexShader);if(!this._gl.getShaderParameter(this._vertexShader,this._gl.COMPILE_STATUS))return alert(this._gl.getShaderInfoLog(this._vertexShader)),null;
this._gl.shaderSource(this._fragmentShader,c);this._gl.compileShader(this._fragmentShader);if(!this._gl.getShaderParameter(this._fragmentShader,this._gl.COMPILE_STATUS))return alert(this._gl.getShaderInfoLog(this._fragmentShader)),null;this._gl.attachShader(this._program,this._vertexShader);this._gl.attachShader(this._program,this._fragmentShader);this._gl.linkProgram(this._program);this._gl.getProgramParameter(this._program,this._gl.LINK_STATUS)||alert("Could not link the program.")};b.prototype.dispose=
function(){this._gl.deleteProgram(this._program)};b.prototype.focusProgram=function(){this._gl.useProgram(this._program)};Object.defineProperty(b.prototype,"glProgram",{get:function(){return this._program},enumerable:!0,configurable:!0});return b}();b.Program3D=e})(b.display3D||(b.display3D={}))})(away||(away={}));(function(b){(function(b){var e=function(){return function(){this.mipfilter=this.filter=this.wrap=0}}();b.SamplerState=e})(b.display3D||(b.display3D={}))})(away||(away={}));
(function(b){(function(b){var e=function(){return function(b,a){"undefined"===typeof b&&(b=0);"undefined"===typeof a&&(a=0);this.x=b;this.y=a}}();b.Point=e})(b.geom||(b.geom={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(a,c,k,b){"undefined"===typeof a&&(a=0);"undefined"===typeof c&&(c=0);"undefined"===typeof k&&(k=0);"undefined"===typeof b&&(b=0);this.x=a;this.y=c;this.width=k;this.height=b}Object.defineProperty(d.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"top",{get:function(){return this.y},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"topLeft",{get:function(){return new b.geom.Point(this.x,this.y)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"bottomRight",{get:function(){return new b.geom.Point(this.x+this.width,this.y+this.height)},enumerable:!0,configurable:!0});d.prototype.clone=function(){return new d(this.x,this.y,this.width,
this.height)};return d}();g.Rectangle=e})(b.geom||(b.geom={}))})(away||(away={}));(function(b){(function(b){var e=function(){function b(){}b.BGRA="bgra";b.BGRA_PACKED="bgraPacked4444";b.BGR_PACKED="bgrPacked565";b.COMPRESSED="compressed";b.COMPRESSED_ALPHA="compressedAlpha";return b}();b.Context3DTextureFormat=e})(b.display3D||(b.display3D={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(a){this.textureType="";this._gl=a}b.prototype.dispose=function(){throw"Abstract method must be overridden.";};return b}();b.TextureBase=e})(b.display3D||(b.display3D={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(a,c,k,b,d,f){"undefined"===typeof a&&(a=1);"undefined"===typeof c&&(c=0);"undefined"===typeof k&&(k=0);"undefined"===typeof b&&(b=1);"undefined"===typeof d&&(d=0);"undefined"===typeof f&&(f=0);this.a=a;this.b=c;this.c=k;this.d=b;this.tx=d;this.ty=f}d.prototype.clone=function(){return new d(this.a,this.b,this.c,this.d,this.tx,this.ty)};d.prototype.concat=function(a){var c=this.a*a.a+this.b*a.c;this.b=this.a*a.b+this.b*a.d;this.a=c;c=this.c*a.a+
this.d*a.c;this.d=this.c*a.b+this.d*a.d;this.c=c;c=this.tx*a.a+this.ty*a.c+a.tx;this.ty=this.tx*a.b+this.ty*a.d+a.ty;this.tx=c};d.prototype.copyColumnFrom=function(a,c){if(2<a)throw"Column "+a+" out of bounds (2)";0==a?(this.a=c.x,this.c=c.y):1==a?(this.b=c.x,this.d=c.y):(this.tx=c.x,this.ty=c.y)};d.prototype.copyColumnTo=function(a,c){if(2<a)throw new b.errors.ArgumentError("ArgumentError, Column "+a+" out of bounds [0, ..., 2]");0==a?(c.x=this.a,c.y=this.c,c.z=0):1==a?(c.x=this.b,c.y=this.d,c.z=
0):(c.x=this.tx,c.y=this.ty,c.z=1)};d.prototype.copyFrom=function(a){this.a=a.a;this.b=a.b;this.c=a.c;this.d=a.d;this.tx=a.tx;this.ty=a.ty};d.prototype.copyRowFrom=function(a,c){if(2<a)throw new b.errors.ArgumentError("ArgumentError, Row "+a+" out of bounds [0, ..., 2]");0==a?(this.a=c.x,this.c=c.y):1==a?(this.b=c.x,this.d=c.y):(this.tx=c.x,this.ty=c.y)};d.prototype.copyRowTo=function(a,c){if(2<a)throw new b.errors.ArgumentError("ArgumentError, Row "+a+" out of bounds [0, ..., 2]");0==a?(c.x=this.a,
c.y=this.b,c.z=this.tx):1==a?(c.x=this.c,c.y=this.d,c.z=this.ty):c.setTo(0,0,1)};d.prototype.createBox=function(a,c,k,b,d){"undefined"===typeof k&&(k=0);"undefined"===typeof b&&(b=0);"undefined"===typeof d&&(d=0);this.a=a;this.d=c;this.b=k;this.tx=b;this.ty=d};d.prototype.createGradientBox=function(a,c,k,b,d){"undefined"===typeof k&&(k=0);"undefined"===typeof b&&(b=0);"undefined"===typeof d&&(d=0);this.a=a/1638.4;this.d=c/1638.4;if(0!=k){var f=Math.cos(k);k=Math.sin(k);this.b=k*this.d;this.c=-k*this.a;
this.a*=f;this.d*=f}else this.b=this.c=0;this.tx=b+a/2;this.ty=d+c/2};d.prototype.deltaTransformPoint=function(a){return new b.geom.Point(a.x*this.a+a.y*this.c,a.x*this.b+a.y*this.d)};d.prototype.identity=function(){this.a=1;this.c=this.b=0;this.d=1;this.ty=this.tx=0};d.prototype.invert=function(){var a=this.a*this.d-this.b*this.c;if(0==a)this.a=this.b=this.c=this.d=0,this.tx=-this.tx,this.ty=-this.ty;else{var a=1/a,c=this.d*a;this.d=this.a*a;this.a=c;this.b*=-a;this.c*=-a;a=-this.a*this.tx-this.c*
this.ty;this.ty=-this.b*this.tx-this.d*this.ty;this.tx=a}return this};d.prototype.mult=function(a){var c=new d;c.a=this.a*a.a+this.b*a.c;c.b=this.a*a.b+this.b*a.d;c.c=this.c*a.a+this.d*a.c;c.d=this.c*a.b+this.d*a.d;c.tx=this.tx*a.a+this.ty*a.c+a.tx;c.ty=this.tx*a.b+this.ty*a.d+a.ty;return c};d.prototype.rotate=function(a){var c=Math.cos(a);a=Math.sin(a);var k=this.a*c-this.b*a;this.b=this.a*a+this.b*c;this.a=k;k=this.c*c-this.d*a;this.d=this.c*a+this.d*c;this.c=k;k=this.tx*c-this.ty*a;this.ty=this.tx*
a+this.ty*c;this.tx=k};d.prototype.scale=function(a,c){this.a*=a;this.b*=c;this.c*=a;this.d*=c;this.tx*=a;this.ty*=c};d.prototype.setRotation=function(a,c){"undefined"===typeof c&&(c=1);this.a=Math.cos(a)*c;this.c=Math.sin(a)*c;this.b=-this.c;this.d=this.a};d.prototype.setTo=function(a,c,k,b,d,f){this.a=a;this.b=c;this.c=k;this.d=b;this.tx=d;this.ty=f};d.prototype.toString=function(){return"[Matrix] (a="+this.a+", b="+this.b+", c="+this.c+", d="+this.d+", tx="+this.tx+", ty="+this.ty+")"};d.prototype.transformPoint=
function(a){return new b.geom.Point(a.x*this.a+a.y*this.c+this.tx,a.x*this.b+a.y*this.d+this.ty)};d.prototype.translate=function(a,c){this.tx+=a;this.ty+=c};return d}();g.Matrix=e})(b.geom||(b.geom={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(a,c,k,q){"undefined"===typeof k&&(k=!0);"undefined"===typeof q&&(q=null);this._alpha=1;this._locked=!1;this._transparent=k;this._imageCanvas=document.createElement("canvas");this._imageCanvas.width=a;this._imageCanvas.height=c;this._context=this._imageCanvas.getContext("2d");this._rect=new b.geom.Rectangle(0,0,a,c);null!=q&&(this._alpha=this._transparent?b.utils.ColorUtils.float32ColorToARGB(q)[0]/255:1,this.fillRect(this._rect,q))}d.prototype.dispose=
function(){this._locked=this._transparent=this._rect=this._imageData=this._imageCanvas=this._context=null};d.prototype.lock=function(){this._locked=!0;this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height)};d.prototype.unlock=function(){this._locked=!1;this._imageData&&(this._context.putImageData(this._imageData,0,0),this._imageData=null)};d.prototype.getPixel=function(a,c){var k,b,d,f;f=4*(a+c*this._imageCanvas.width);this._locked&&this._imageData&&this._context.putImageData(this._imageData,
0,0);this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height);k=this._imageData.data[f+0];b=this._imageData.data[f+1];d=this._imageData.data[f+2];f=this._imageData.data[f+3];this._locked||(this._imageData=null);return f<<24|k<<16|b<<8|d};d.prototype.setPixel=function(a,c,k){k=b.utils.ColorUtils.float32ColorToARGB(k);this._locked||(this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height));this._imageData&&(a=4*(a+c*this._imageCanvas.width),this._imageData.data[a+
0]=k[1],this._imageData.data[a+1]=k[2],this._imageData.data[a+2]=k[3],this._imageData.data[a+3]=255);this._locked||(this._context.putImageData(this._imageData,0,0),this._imageData=null)};d.prototype.setPixel32=function(a,c,k){k=b.utils.ColorUtils.float32ColorToARGB(k);this._locked||(this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height));this._imageData&&(a=4*(a+c*this._imageCanvas.width),this._imageData.data[a+0]=k[1],this._imageData.data[a+1]=k[2],this._imageData.data[a+
2]=k[3],this._imageData.data[a+3]=k[0]);this._locked||(this._context.putImageData(this._imageData,0,0),this._imageData=null)};d.prototype.drawImage=function(a,c,k){this._locked?(this._imageData&&this._context.putImageData(this._imageData,0,0),this._drawImage(a,c,k),this._imageData&&(this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height))):this._drawImage(a,c,k)};d.prototype._drawImage=function(a,c,k){a instanceof b.display.BitmapData?this._context.drawImage(a.canvas,c.x,
c.y,c.width,c.height,k.x,k.y,k.width,k.height):a instanceof HTMLImageElement&&this._context.drawImage(a,c.x,c.y,c.width,c.height,k.x,k.y,k.width,k.height)};d.prototype.copyPixels=function(a,c,k){this._locked?(this._imageData&&this._context.putImageData(this._imageData,0,0),this._copyPixels(a,c,k),this._imageData&&(this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height))):this._copyPixels(a,c,k)};d.prototype._copyPixels=function(a,c,k){a instanceof b.display.BitmapData?this._context.drawImage(a.canvas,
c.x,c.y,c.width,c.height,k.x,k.y,k.width,k.height):a instanceof HTMLImageElement&&this._context.drawImage(a,c.x,c.y,c.width,c.height,k.x,k.y,k.width,k.height)};d.prototype.fillRect=function(a,c){this._locked?(this._imageData&&this._context.putImageData(this._imageData,0,0),this._context.fillStyle=this.hexToRGBACSS(c),this._context.fillRect(a.x,a.y,a.width,a.height),this._imageData&&(this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height))):(this._context.fillStyle=this.hexToRGBACSS(c),
this._context.fillRect(a.x,a.y,a.width,a.height))};d.prototype.draw=function(a,c){this._locked?(this._imageData&&this._context.putImageData(this._imageData,0,0),this._draw(a,c),this._imageData&&(this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height))):this._draw(a,c)};d.prototype._draw=function(a,c){a instanceof b.display.BitmapData?(this._context.save(),this._context.setTransform(c.a,c.b,c.c,c.d,c.tx,c.ty),this._context.drawImage(a.canvas,0,0),this._context.restore()):
a instanceof HTMLImageElement&&(this._context.save(),this._context.setTransform(c.a,c.b,c.c,c.d,c.tx,c.ty),this._context.drawImage(a,0,0),this._context.restore())};Object.defineProperty(d.prototype,"imageData",{get:function(){return this._context.getImageData(0,0,this._rect.width,this._rect.height)},set:function(a){this._context.putImageData(a,0,0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"width",{get:function(){return this._imageCanvas.width},set:function(a){this._rect.width=
a;this._imageCanvas.width=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"height",{get:function(){return this._imageCanvas.height},set:function(a){this._rect.height=a;this._imageCanvas.height=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"rect",{get:function(){return this._rect},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"canvas",{get:function(){return this._imageCanvas},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"context",{get:function(){return this._context},enumerable:!0,configurable:!0});d.prototype.hexToRGBACSS=function(a){a=b.utils.ColorUtils.float32ColorToARGB(a);return!1==this._transparent?(a[0]=1,"rgba("+a[1]+","+a[2]+","+a[3]+","+a[0]+")"):"rgba("+a[1]+","+a[2]+","+a[3]+","+a[0]/255+")"};return d}();g.BitmapData=e})(b.display||(b.display={}))})(away||(away={}));
(function(b){(function(b){var e=function(b){function a(c,a,q){b.call(this,c);this.textureType="texture2d";this._width=a;this._height=q;this._glTexture=this._gl.createTexture()}__extends(a,b);a.prototype.dispose=function(){this._gl.deleteTexture(this._glTexture)};Object.defineProperty(a.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0});a.prototype.uploadFromHTMLImageElement=
function(c,a){"undefined"===typeof a&&(a=0);this._gl.bindTexture(this._gl.TEXTURE_2D,this._glTexture);this._gl.texImage2D(this._gl.TEXTURE_2D,a,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,c);this._gl.bindTexture(this._gl.TEXTURE_2D,null)};a.prototype.uploadFromBitmapData=function(c,a){"undefined"===typeof a&&(a=0);this._gl.bindTexture(this._gl.TEXTURE_2D,this._glTexture);this._gl.texImage2D(this._gl.TEXTURE_2D,a,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,c.imageData);this._gl.bindTexture(this._gl.TEXTURE_2D,
null)};Object.defineProperty(a.prototype,"glTexture",{get:function(){return this._glTexture},enumerable:!0,configurable:!0});return a}(b.TextureBase);b.Texture=e})(b.display3D||(b.display3D={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(c,a){b.call(this,c);this.textureType="textureCube";this._size=a;this._textures=[];for(var q=0;6>q;++q)this._textures[q]=this._gl.createTexture()}__extends(a,b);a.prototype.dispose=function(){for(var c=0;6>c;++c)this._gl.deleteTexture(this._textures[c])};a.prototype.uploadFromHTMLImageElement=function(c,a,b){"undefined"===typeof b&&(b=0);switch(a){case 0:this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,this._textures[0]);this._gl.texImage2D(this._gl.TEXTURE_CUBE_MAP_POSITIVE_X,
b,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,c);this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null);break;case 1:this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,this._textures[1]);this._gl.texImage2D(this._gl.TEXTURE_CUBE_MAP_NEGATIVE_X,b,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,c);this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null);break;case 2:this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,this._textures[2]);this._gl.texImage2D(this._gl.TEXTURE_CUBE_MAP_POSITIVE_Y,b,this._gl.RGBA,
this._gl.RGBA,this._gl.UNSIGNED_BYTE,c);this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null);break;case 3:this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,this._textures[3]);this._gl.texImage2D(this._gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,b,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,c);this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null);break;case 4:this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,this._textures[4]);this._gl.texImage2D(this._gl.TEXTURE_CUBE_MAP_POSITIVE_Z,b,this._gl.RGBA,this._gl.RGBA,
this._gl.UNSIGNED_BYTE,c);this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null);break;case 5:this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,this._textures[5]);this._gl.texImage2D(this._gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,b,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,c);this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null);break;default:throw"unknown side type";}};a.prototype.uploadFromBitmapData=function(c,a,b){"undefined"===typeof b&&(b=0);switch(a){case 0:this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,
this._textures[0]);this._gl.texImage2D(this._gl.TEXTURE_CUBE_MAP_POSITIVE_X,b,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,c.imageData);this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null);break;case 1:this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,this._textures[1]);this._gl.texImage2D(this._gl.TEXTURE_CUBE_MAP_NEGATIVE_X,b,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,c.imageData);this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null);break;case 2:this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,
this._textures[2]);this._gl.texImage2D(this._gl.TEXTURE_CUBE_MAP_POSITIVE_Y,b,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,c.imageData);this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null);break;case 3:this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,this._textures[3]);this._gl.texImage2D(this._gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,b,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,c.imageData);this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null);break;case 4:this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,
this._textures[4]);this._gl.texImage2D(this._gl.TEXTURE_CUBE_MAP_POSITIVE_Z,b,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,c.imageData);this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null);break;case 5:this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,this._textures[5]);this._gl.texImage2D(this._gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,b,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,c.imageData);this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null);break;default:throw"unknown side type";}};Object.defineProperty(a.prototype,
"size",{get:function(){return this._size},enumerable:!0,configurable:!0});a.prototype.glTextureAt=function(c){return this._textures[c]};return a}(b.display3D.TextureBase);g.CubeTexture=e})(b.display3D||(b.display3D={}))})(away||(away={}));(function(b){(function(b){var e=function(){function b(){}b.BACK="back";b.FRONT="front";b.FRONT_AND_BACK="frontAndBack";b.NONE="none";return b}();b.Context3DTriangleFace=e})(b.display3D||(b.display3D={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(){}b.BYTES_4="bytes4";b.FLOAT_1="float1";b.FLOAT_2="float2";b.FLOAT_3="float3";b.FLOAT_4="float4";return b}();b.Context3DVertexBufferFormat=e})(b.display3D||(b.display3D={}))})(away||(away={}));(function(b){(function(b){var e=function(){function b(){}b.FRAGMENT="fragment";b.VERTEX="vertex";return b}();b.Context3DProgramType=e})(b.display3D||(b.display3D={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(){}b.DESTINATION_ALPHA="destinationAlpha";b.DESTINATION_COLOR="destinationColor";b.ONE="one";b.ONE_MINUS_DESTINATION_ALPHA="oneMinusDestinationAlpha";b.ONE_MINUS_DESTINATION_COLOR="oneMinusDestinationColor";b.ONE_MINUS_SOURCE_ALPHA="oneMinusSourceAlpha";b.ONE_MINUS_SOURCE_COLOR="oneMinusSourceColor";b.SOURCE_ALPHA="sourceAlpha";b.SOURCE_COLOR="sourceColor";b.ZERO="zero";return b}();b.Context3DBlendFactor=e})(b.display3D||(b.display3D={}))})(away||
(away={}));(function(b){(function(b){var e=function(){function b(){}b.ALWAYS="always";b.EQUAL="equal";b.GREATER="greater";b.GREATER_EQUAL="greaterEqual";b.LESS="less";b.LESS_EQUAL="lessEqual";b.NEVER="never";b.NOT_EQUAL="notEqual";return b}();b.Context3DCompareMode=e})(b.display3D||(b.display3D={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(){}b.MIPLINEAR="miplinear";b.MIPNEAREST="mipnearest";b.MIPNONE="mipnone";return b}();b.Context3DMipFilter=e})(b.display3D||(b.display3D={}))})(away||(away={}));(function(b){(function(b){var e=function(){function b(){}b.BASELINE="baseline";b.BASELINE_CONSTRAINED="baselineConstrained";b.BASELINE_EXTENDED="baselineExtended";return b}();b.Context3DProfile=e})(b.display3D||(b.display3D={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(){}b.DECREMENT_SATURATE="decrementSaturate";b.DECREMENT_WRAP="decrementWrap";b.INCREMENT_SATURATE="incrementSaturate";b.INCREMENT_WRAP="incrementWrap";b.INVERT="invert";b.KEEP="keep";b.SET="set";b.ZERO="zero";return b}();b.Context3DStencilAction=e})(b.display3D||(b.display3D={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(){}b.LINEAR="linear";b.NEAREST="nearest";return b}();b.Context3DTextureFilter=e})(b.display3D||(b.display3D={}))})(away||(away={}));(function(b){(function(b){var e=function(){function b(){}b.CLAMP="clamp";b.REPEAT="repeat";return b}();b.Context3DWrapMode=e})(b.display3D||(b.display3D={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(a){this._currentMipFilter=this._currentFilter=this._currentWrap=0;this._indexBufferList=[];this._vertexBufferList=[];this._textureList=[];this._programList=[];this._samplerStates=[];try{this._gl=a.getContext("experimental-webgl"),this._gl||(this._gl=a.getContext("webgl"))}catch(c){}this._gl||alert("WebGL is not available.");for(a=0;a<d.MAX_SAMPLERS;++a)this._samplerStates[a]=new b.display3D.SamplerState,this._samplerStates[a].wrap=this._gl.REPEAT,
this._samplerStates[a].filter=this._gl.LINEAR,this._samplerStates[a].mipfilter=0}d.prototype.gl=function(){return this._gl};d.prototype.clear=function(a,c,k,b,d,f,l){"undefined"===typeof a&&(a=0);"undefined"===typeof c&&(c=0);"undefined"===typeof k&&(k=0);"undefined"===typeof b&&(b=1);"undefined"===typeof d&&(d=1);"undefined"===typeof f&&(f=0);"undefined"===typeof l&&(l=g.Context3DClearMask.ALL);this._drawing||(this.updateBlendStatus(),this._drawing=!0);this._gl.clearColor(a,c,k,b);this._gl.clearDepth(d);
this._gl.clearStencil(f);this._gl.clear(l)};d.prototype.configureBackBuffer=function(a,c,k,b){"undefined"===typeof b&&(b=!0);b&&(this._gl.enable(this._gl.STENCIL_TEST),this._gl.enable(this._gl.DEPTH_TEST));this._gl.viewport.width=a;this._gl.viewport.height=c;this._gl.viewport(0,0,a,c)};d.prototype.createCubeTexture=function(a,c,k,q){a=new b.display3D.CubeTexture(this._gl,a);this._textureList.push(a);return a};d.prototype.createIndexBuffer=function(a){a=new b.display3D.IndexBuffer3D(this._gl,a);this._indexBufferList.push(a);
return a};d.prototype.createProgram=function(){var a=new b.display3D.Program3D(this._gl);this._programList.push(a);return a};d.prototype.createTexture=function(a,c,k,q,d){a=new b.display3D.Texture(this._gl,a,c);this._textureList.push(a);return a};d.prototype.createVertexBuffer=function(a,c){var k=new b.display3D.VertexBuffer3D(this._gl,a,c);this._vertexBufferList.push(k);return k};d.prototype.dispose=function(){var a;for(a=0;a<this._indexBufferList.length;++a)this._indexBufferList[a].dispose();this._indexBufferList=
null;for(a=0;a<this._vertexBufferList.length;++a)this._vertexBufferList[a].dispose();this._vertexBufferList=null;for(a=0;a<this._textureList.length;++a)this._textureList[a].dispose();this._textureList=null;for(a=0;a<this._programList.length;++a)this._programList[a].dispose();for(a=0;a<this._samplerStates.length;++a)this._samplerStates[a]=null;this._programList=null};d.prototype.drawToBitmapData=function(a){throw new b.errors.PartialImplementationError;};d.prototype.drawTriangles=function(a,c,k){"undefined"===
typeof c&&(c=0);"undefined"===typeof k&&(k=-1);if(!this._drawing)throw"Need to clear before drawing if the buffer has not been cleared since the last present() call.";var b=0,b=-1==k?a.numIndices:3*k;this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,a.glBuffer);this._gl.drawElements(this._gl.TRIANGLES,b,this._gl.UNSIGNED_SHORT,c)};d.prototype.present=function(){this._drawing=!1};d.prototype.setBlendFactors=function(a,c){this._blendEnabled=!0;switch(a){case b.display3D.Context3DBlendFactor.ONE:this._blendSourceFactor=
this._gl.ONE;break;case b.display3D.Context3DBlendFactor.DESTINATION_ALPHA:this._blendSourceFactor=this._gl.DST_ALPHA;break;case b.display3D.Context3DBlendFactor.DESTINATION_COLOR:this._blendSourceFactor=this._gl.DST_COLOR;break;case b.display3D.Context3DBlendFactor.ONE:this._blendSourceFactor=this._gl.ONE;break;case b.display3D.Context3DBlendFactor.ONE_MINUS_DESTINATION_ALPHA:this._blendSourceFactor=this._gl.ONE_MINUS_DST_ALPHA;break;case b.display3D.Context3DBlendFactor.ONE_MINUS_DESTINATION_COLOR:this._blendSourceFactor=
this._gl.ONE_MINUS_DST_COLOR;break;case b.display3D.Context3DBlendFactor.ONE_MINUS_SOURCE_ALPHA:this._blendSourceFactor=this._gl.ONE_MINUS_SRC_ALPHA;break;case b.display3D.Context3DBlendFactor.ONE_MINUS_SOURCE_COLOR:this._blendSourceFactor=this._gl.ONE_MINUS_SRC_COLOR;break;case b.display3D.Context3DBlendFactor.SOURCE_ALPHA:this._blendSourceFactor=this._gl.SRC_ALPHA;break;case b.display3D.Context3DBlendFactor.SOURCE_COLOR:this._blendSourceFactor=this._gl.SRC_COLOR;break;case b.display3D.Context3DBlendFactor.ZERO:this._blendSourceFactor=
this._gl.ZERO;break;default:throw"Unknown blend source factor";}switch(c){case b.display3D.Context3DBlendFactor.ONE:this._blendDestinationFactor=this._gl.ONE;break;case b.display3D.Context3DBlendFactor.DESTINATION_ALPHA:this._blendDestinationFactor=this._gl.DST_ALPHA;break;case b.display3D.Context3DBlendFactor.DESTINATION_COLOR:this._blendDestinationFactor=this._gl.DST_COLOR;break;case b.display3D.Context3DBlendFactor.ONE:this._blendDestinationFactor=this._gl.ONE;break;case b.display3D.Context3DBlendFactor.ONE_MINUS_DESTINATION_ALPHA:this._blendDestinationFactor=
this._gl.ONE_MINUS_DST_ALPHA;break;case b.display3D.Context3DBlendFactor.ONE_MINUS_DESTINATION_COLOR:this._blendDestinationFactor=this._gl.ONE_MINUS_DST_COLOR;break;case b.display3D.Context3DBlendFactor.ONE_MINUS_SOURCE_ALPHA:this._blendDestinationFactor=this._gl.ONE_MINUS_SRC_ALPHA;break;case b.display3D.Context3DBlendFactor.ONE_MINUS_SOURCE_COLOR:this._blendDestinationFactor=this._gl.ONE_MINUS_SRC_COLOR;break;case b.display3D.Context3DBlendFactor.SOURCE_ALPHA:this._blendDestinationFactor=this._gl.SRC_ALPHA;
break;case b.display3D.Context3DBlendFactor.SOURCE_COLOR:this._blendDestinationFactor=this._gl.SRC_COLOR;break;case b.display3D.Context3DBlendFactor.ZERO:this._blendDestinationFactor=this._gl.ZERO;break;default:throw"Unknown blend destination factor";}this.updateBlendStatus()};d.prototype.setColorMask=function(a,c,k,b){this._gl.colorMask(a,c,k,b)};d.prototype.setCulling=function(a){if(a==g.Context3DTriangleFace.NONE)this._gl.disable(this._gl.CULL_FACE);else switch(this._gl.enable(this._gl.CULL_FACE),
a){case g.Context3DTriangleFace.FRONT:this._gl.cullFace(this._gl.FRONT);break;case g.Context3DTriangleFace.BACK:this._gl.cullFace(this._gl.BACK);break;case g.Context3DTriangleFace.FRONT_AND_BACK:this._gl.cullFace(this._gl.FRONT_AND_BACK);break;default:throw"Unknown Context3DTriangleFace type.";}};d.prototype.setDepthTest=function(a,c){switch(c){case g.Context3DCompareMode.ALWAYS:this._gl.depthFunc(this._gl.ALWAYS);break;case g.Context3DCompareMode.EQUAL:this._gl.depthFunc(this._gl.EQUAL);break;case g.Context3DCompareMode.GREATER:this._gl.depthFunc(this._gl.GREATER);
break;case g.Context3DCompareMode.GREATER_EQUAL:this._gl.depthFunc(this._gl.GEQUAL);break;case g.Context3DCompareMode.LESS:this._gl.depthFunc(this._gl.LESS);break;case g.Context3DCompareMode.LESS_EQUAL:this._gl.depthFunc(this._gl.LEQUAL);break;case g.Context3DCompareMode.NEVER:this._gl.depthFunc(this._gl.NEVER);break;case g.Context3DCompareMode.NOT_EQUAL:this._gl.depthFunc(this._gl.NOTEQUAL);break;default:throw"Unknown Context3DCompareMode type.";}this._gl.depthMask(a)};d.prototype.setProgram=function(a){this._currentProgram=
a;a.focusProgram()};d.prototype.getUniformLocationNameFromAgalRegisterIndex=function(a,c){switch(a){case g.Context3DProgramType.VERTEX:return"vc";case g.Context3DProgramType.FRAGMENT:return"fc";default:throw"Program Type "+a+" not supported";}};d.prototype.setProgramConstantsFromMatrix=function(a,c,k,b){"undefined"===typeof b&&(b=!1);a=this.getUniformLocationNameFromAgalRegisterIndex(a,c);this.setGLSLProgramConstantsFromMatrix(a,k,b)};d.prototype.setProgramConstantsFromArray=function(a,c,k,b){"undefined"===
typeof b&&(b=-1);for(var d=0;d<b;++d){var f=4*d,l=this.getUniformLocationNameFromAgalRegisterIndex(a,c+d)+(d+c);this.setGLSLProgramConstantsFromArray(l,k,f)}};d.prototype.setGLSLProgramConstantsFromMatrix=function(a,c,k){"undefined"===typeof k&&(k=!1);a=this._gl.getUniformLocation(this._currentProgram.glProgram,a);this._gl.uniformMatrix4fv(a,!k,new Float32Array(c.rawData))};d.prototype.setGLSLProgramConstantsFromArray=function(a,c,k){"undefined"===typeof k&&(k=0);a=this._gl.getUniformLocation(this._currentProgram.glProgram,
a);this._gl.uniform4f(a,c[k],c[k+1],c[k+2],c[k+3])};d.prototype.setScissorRectangle=function(a){a?(this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(a.x,a.y,a.width,a.height)):this._gl.disable(this._gl.SCISSOR_TEST)};d.prototype.setTextureAt=function(a,c){this.setGLSLTextureAt("fs"+a,c,a)};d.prototype.setGLSLTextureAt=function(a,c,k){if(c){switch(k){case 0:this._gl.activeTexture(this._gl.TEXTURE0);break;case 1:this._gl.activeTexture(this._gl.TEXTURE1);break;case 2:this._gl.activeTexture(this._gl.TEXTURE2);
break;case 3:this._gl.activeTexture(this._gl.TEXTURE3);break;case 4:this._gl.activeTexture(this._gl.TEXTURE4);break;case 5:this._gl.activeTexture(this._gl.TEXTURE5);break;case 6:this._gl.activeTexture(this._gl.TEXTURE6);break;case 7:this._gl.activeTexture(this._gl.TEXTURE7);break;default:throw"Texture "+k+" is out of bounds.";}a=this._gl.getUniformLocation(this._currentProgram.glProgram,a);if("texture2d"==c.textureType){this._gl.bindTexture(this._gl.TEXTURE_2D,c.glTexture);this._gl.uniform1i(a,k);
var b=this._samplerStates[k];b.wrap!=this._currentWrap&&(this._currentWrap=b.wrap,this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,b.wrap),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,b.wrap));b.filter!=this._currentFilter&&(this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,b.filter),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,b.filter))}else if("textureCube"==c.textureType)for(var d=0;6>d;++d)this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,
c.glTextureAt(d)),this._gl.uniform1i(a,k),b=this._samplerStates[k],b.wrap!=this._currentWrap&&(this._currentWrap=b.wrap,this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_S,b.wrap),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_T,b.wrap)),b.filter!=this._currentFilter&&(this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MIN_FILTER,b.filter),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MAG_FILTER,b.filter))}else this._gl.activeTexture(this._gl.TEXTURE0+
k),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null)};d.prototype.setSamplerStateAt=function(a,c,k,b){var h=0,f=0,l=0;switch(c){case g.Context3DWrapMode.REPEAT:h=this._gl.REPEAT;break;case g.Context3DWrapMode.CLAMP:h=this._gl.CLAMP_TO_EDGE;break;default:throw"Wrap is not supported: "+c;}switch(k){case g.Context3DTextureFilter.LINEAR:f=this._gl.LINEAR;break;case g.Context3DTextureFilter.NEAREST:f=this._gl.NEAREST;break;default:throw"Filter is not supported "+
k;}switch(b){case g.Context3DMipFilter.MIPNEAREST:l=this._gl.NEAREST_MIPMAP_NEAREST;break;case g.Context3DMipFilter.MIPLINEAR:l=this._gl.LINEAR_MIPMAP_LINEAR;break;case g.Context3DMipFilter.MIPNONE:l=this._gl.NONE;break;default:throw"MipFilter is not supported "+b;}if(0<=a&&a<d.MAX_SAMPLERS)this._samplerStates[a].wrap=h,this._samplerStates[a].filter=f,this._samplerStates[a].mipfilter=l;else throw"Sampler is out of bounds.";};d.prototype.setVertexBufferAt=function(a,c,k,b){"undefined"===typeof k&&
(k=0);"undefined"===typeof b&&(b=null);this.setGLSLVertexBufferAt("va"+a,c,k,b)};d.prototype.setGLSLVertexBufferAt=function(a,c,k,b){"undefined"===typeof k&&(k=0);"undefined"===typeof b&&(b=null);a=this._gl.getAttribLocation(this._currentProgram.glProgram,a);if(c){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,c.glBuffer);var d=this._gl.FLOAT;switch(b){case g.Context3DVertexBufferFormat.BYTES_4:b=4;break;case g.Context3DVertexBufferFormat.FLOAT_1:b=1;break;case g.Context3DVertexBufferFormat.FLOAT_2:b=
2;break;case g.Context3DVertexBufferFormat.FLOAT_3:b=3;break;case g.Context3DVertexBufferFormat.FLOAT_4:b=4;break;default:throw"Buffer format "+b+" is not supported.";}this._gl.enableVertexAttribArray(a);this._gl.vertexAttribPointer(a,b,d,!1,4*c.data32PerVertex,4*k)}else-1<a&&this._gl.disableVertexAttribArray(a)};d.prototype.updateBlendStatus=function(){this._blendEnabled?(this._gl.enable(this._gl.BLEND),this._gl.blendEquation(this._gl.FUNC_ADD),this._gl.blendFunc(this._blendSourceFactor,this._blendDestinationFactor)):
this._gl.disable(this._gl.BLEND)};d.MAX_SAMPLERS=8;d.modulo=0;return d}();g.Context3D=e})(b.display3D||(b.display3D={}))})(away||(away={}));
(function(b){(function(b){var e=function(d){function a(c){d.call(this,c);this._yFlip=-1}__extends(a,d);a.prototype.setProgramConstantsFromMatrix=function(c,a,b,d){"undefined"===typeof d&&(d=!1);b=b.rawData;d?(this.setProgramConstantsFromArray(c,a,[b[0],b[4],b[8],b[12]],1),this.setProgramConstantsFromArray(c,a+1,[b[1],b[5],b[9],b[13]],1),this.setProgramConstantsFromArray(c,a+2,[b[2],b[6],b[10],b[14]],1),this.setProgramConstantsFromArray(c,a+3,[b[3],b[7],b[11],b[15]],1)):(this.setProgramConstantsFromArray(c,
a,[b[0],b[1],b[2],b[3]],1),this.setProgramConstantsFromArray(c,a+1,[b[4],b[5],b[6],b[7]],1),this.setProgramConstantsFromArray(c,a+2,[b[8],b[9],b[10],b[11]],1),this.setProgramConstantsFromArray(c,a+3,[b[12],b[13],b[14],b[15]],1))};a.prototype.drawTriangles=function(c,a,b){"undefined"===typeof a&&(a=0);"undefined"===typeof b&&(b=-1);var h=this._gl.getUniformLocation(this._currentProgram.glProgram,"yflip");this._gl.uniform1f(h,this._yFlip);d.prototype.drawTriangles.call(this,c,a,b)};a.prototype.setCulling=
function(c){switch(c){case b.Context3DTriangleFace.FRONT:this._yFlip=-1;break;case b.Context3DTriangleFace.BACK:this._yFlip=1;break;case b.Context3DTriangleFace.FRONT_AND_BACK:this._yFlip=1;break;case b.Context3DTriangleFace.NONE:this._yFlip=1;break;default:throw"Unknown culling mode "+c+".";}};return a}(b.Context3D);b.AGLSLContext3D=e})(b.display3D||(b.display3D={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._iRenderOrderId=0;this._bothSides=!1;this._pBlendMode=b.display.BlendMode.NORMAL;this._numPasses=0;this._smooth=this._pMipmap=!0;this._repeat=!1;this._pDepthCompareMode=b.display3D.Context3DCompareMode.LESS_EQUAL;this._owners=[];this._passes=[];this._pDepthPass=new b.materials.DepthMapPass;this._pDistancePass=new b.materials.DistanceMapPass;this._pDepthPass.addEventListener(b.events.Event.CHANGE,this.onDepthPassChange,this);
this._pDistancePass.addEventListener(b.events.Event.CHANGE,this.onDistancePassChange,this);this.alphaPremultiplied=!0;this._iUniqueId=b.materials.MaterialBase.MATERIAL_ID_COUNT++}__extends(a,d);Object.defineProperty(a.prototype,"assetType",{get:function(){return b.library.AssetType.MATERIAL},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"lightPicker",{get:function(){return this._pLightPicker},set:function(c){this.setLightPicker(c)},enumerable:!0,configurable:!0});a.prototype.setLightPicker=
function(c){if(c!=this._pLightPicker){this._pLightPicker=c;c=this._passes.length;for(var a=0;a<c;++a)this._passes[a].lightPicker=this._pLightPicker}};Object.defineProperty(a.prototype,"mipmap",{get:function(){return this._pMipmap},set:function(c){this.setMipMap(c)},enumerable:!0,configurable:!0});a.prototype.setMipMap=function(c){this._pMipmap=c;for(var a=0;a<this._numPasses;++a)this._passes[a].mipmap=c};Object.defineProperty(a.prototype,"smooth",{get:function(){return this._smooth},set:function(c){this._smooth=
c;for(var a=0;a<this._numPasses;++a)this._passes[a].smooth=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"depthCompareMode",{get:function(){return this._pDepthCompareMode},set:function(c){this.setDepthCompareMode(c)},enumerable:!0,configurable:!0});a.prototype.setDepthCompareMode=function(c){this._pDepthCompareMode=c};Object.defineProperty(a.prototype,"repeat",{get:function(){return this._repeat},set:function(c){this._repeat=c;for(var a=0;a<this._numPasses;++a)this._passes[a].repeat=
c},enumerable:!0,configurable:!0});a.prototype.dispose=function(){var c;for(c=0;c<this._numPasses;++c)this._passes[c].dispose();this._pDepthPass.dispose();this._pDistancePass.dispose();this._pDepthPass.removeEventListener(b.events.Event.CHANGE,this.onDepthPassChange,this);this._pDistancePass.removeEventListener(b.events.Event.CHANGE,this.onDistancePassChange,this)};Object.defineProperty(a.prototype,"bothSides",{get:function(){return this._bothSides},set:function(c){this._bothSides=c;for(var a=0;a<
this._numPasses;++a)this._passes[a].bothSides=c;this._pDepthPass.bothSides=c;this._pDistancePass.bothSides=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"blendMode",{get:function(){return this.getBlendMode()},set:function(c){this.setBlendMode(c)},enumerable:!0,configurable:!0});a.prototype.getBlendMode=function(){return this._pBlendMode};a.prototype.setBlendMode=function(c){this._pBlendMode=c};Object.defineProperty(a.prototype,"alphaPremultiplied",{get:function(){return this._alphaPremultiplied},
set:function(c){this._alphaPremultiplied=c;for(var a=0;a<this._numPasses;++a)this._passes[a].alphaPremultiplied=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"requiresBlending",{get:function(){return this.getRequiresBlending()},enumerable:!0,configurable:!0});a.prototype.getRequiresBlending=function(){return this._pBlendMode!=b.display.BlendMode.NORMAL};Object.defineProperty(a.prototype,"uniqueId",{get:function(){return this._iUniqueId},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"_iNumPasses",{get:function(){return this._numPasses},enumerable:!0,configurable:!0});a.prototype.iHasDepthAlphaThreshold=function(){return 0<this._pDepthPass.alphaThreshold};a.prototype.iActivateForDepth=function(c,a,b){"undefined"===typeof b&&(b=!1);(this._distanceBasedDepthRender=b)?this._pDistancePass.iActivate(c,a):this._pDepthPass.iActivate(c,a)};a.prototype.iDeactivateForDepth=function(c){this._distanceBasedDepthRender?this._pDistancePass.iDeactivate(c):this._pDepthPass.iDeactivate(c)};a.prototype.iRenderDepth=
function(c,a,b,d){this._distanceBasedDepthRender?(c.animator&&this._pDistancePass.iUpdateAnimationState(c,a,b),this._pDistancePass.iRender(c,a,b,d)):(c.animator&&this._pDepthPass.iUpdateAnimationState(c,a,b),this._pDepthPass.iRender(c,a,b,d))};a.prototype.iPassRendersToTexture=function(c){return this._passes[c].renderToTexture};a.prototype.iActivatePass=function(c,a,b){this._passes[c].iActivate(a,b)};a.prototype.iDeactivatePass=function(c,a){this._passes[c].iDeactivate(a)};a.prototype.iRenderPass=
function(c,a,b,d,f){this._pLightPicker&&this._pLightPicker.collectLights(a,d);c=this._passes[c];a.animator&&c.iUpdateAnimationState(a,b,d.camera);c.iRender(a,b,d.camera,f)};a.prototype.iAddOwner=function(c){this._owners.push(c);if(c.animator){if(this._animationSet&&c.animator.animationSet!=this._animationSet)throw Error("A Material instance cannot be shared across renderables with different animator libraries");if(this._animationSet!=c.animator.animationSet){this._animationSet=c.animator.animationSet;
for(c=0;c<this._numPasses;++c)this._passes[c].animationSet=this._animationSet;this._pDepthPass.animationSet=this._animationSet;this._pDistancePass.animationSet=this._animationSet;this.iInvalidatePasses(null)}}};a.prototype.iRemoveOwner=function(c){this._owners.splice(this._owners.indexOf(c),1);if(0==this._owners.length){this._animationSet=null;for(c=0;c<this._numPasses;++c)this._passes[c].animationSet=this._animationSet;this._pDepthPass.animationSet=this._animationSet;this._pDistancePass.animationSet=
this._animationSet;this.iInvalidatePasses(null)}};Object.defineProperty(a.prototype,"iOwners",{get:function(){return this._owners},enumerable:!0,configurable:!0});a.prototype.iUpdateMaterial=function(c){};a.prototype.iDeactivate=function(c){this._passes[this._numPasses-1].iDeactivate(c)};a.prototype.iInvalidatePasses=function(c){var a,b,d;this._pDepthPass.iInvalidateShaderProgram();this._pDistancePass.iInvalidateShaderProgram();if(this._animationSet)for(this._animationSet.resetGPUCompatibility(),
b=this._owners.length,d=0;d<b;d++)a=this._owners[d],a.animator&&(a.animator.testGPUCompatibility(this._pDepthPass),a.animator.testGPUCompatibility(this._pDistancePass));for(var f=0;f<this._numPasses;++f)if(this._passes[f]!=c&&this._passes[f].iInvalidateShaderProgram(!1),this._animationSet)for(b=this._owners.length,d=0;d<b;d++)a=this._owners[d],a.animator&&a.animator.testGPUCompatibility(this._passes[f])};a.prototype.pRemovePass=function(c){this._passes.splice(this._passes.indexOf(c),1);--this._numPasses};
a.prototype.pClearPasses=function(){for(var c=0;c<this._numPasses;++c)this._passes[c].removeEventListener(b.events.Event.CHANGE,this.onPassChange,this);this._numPasses=this._passes.length=0};a.prototype.pAddPass=function(c){this._passes[this._numPasses++]=c;c.animationSet=this._animationSet;c.alphaPremultiplied=this._alphaPremultiplied;c.mipmap=this._pMipmap;c.smooth=this._smooth;c.repeat=this._repeat;c.lightPicker=this._pLightPicker;c.bothSides=this._bothSides;c.addEventListener(b.events.Event.CHANGE,
this.onPassChange,this);this.iInvalidatePasses(null)};a.prototype.onPassChange=function(c){c=1;for(var a,b,d=this._iRenderOrderId=0;d<this._numPasses;++d){a=this._passes[d]._iProgram3Dids;b=a.length;for(var f=0;f<b;++f)-1!=a[f]&&(this._iRenderOrderId+=c*a[f],f=b);c*=1E3}};a.prototype.onDistancePassChange=function(c){c=this._pDistancePass._iProgram3Dids;for(var a=c.length,b=this._iDepthPassId=0;b<a;++b)-1!=c[b]&&(this._iDepthPassId+=c[b],b=a)};a.prototype.onDepthPassChange=function(c){c=this._pDepthPass._iProgram3Dids;
for(var a=c.length,b=this._iDepthPassId=0;b<a;++b)-1!=c[b]&&(this._iDepthPassId+=c[b],b=a)};a.MATERIAL_ID_COUNT=0;return a}(b.library.NamedAssetBase);g.MaterialBase=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(a,c,k,q,d,f){"undefined"===typeof q&&(q=3355443);"undefined"===typeof d&&(d=3355443);"undefined"===typeof f&&(f=1);this._subSetIndex=this._index=-1;this._pThickness=0.5*f;this._pStart=a;this._pEnd=c;this.startColor=q;this.endColor=d}b.prototype.updateSegment=function(a,c,b,q,d,f){"undefined"===typeof q&&(q=3355443);"undefined"===typeof d&&(d=3355443);"undefined"===typeof f&&(f=1);this._pStart=a;this._pEnd=c;this._startColor!=q&&(this.startColor=
q);this._endColor!=d&&(this.endColor=d);this._pThickness=0.5*f;this.update()};Object.defineProperty(b.prototype,"start",{get:function(){return this._pStart},set:function(a){this._pStart=a;this.update()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"end",{get:function(){return this._pEnd},set:function(a){this._pEnd=a;this.update()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"thickness",{get:function(){return 2*this._pThickness},set:function(a){this._pThickness=
0.5*a;this.update()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"startColor",{get:function(){return this._startColor},set:function(a){this._pStartR=(a>>16&255)/255;this._pStartG=(a>>8&255)/255;this._pStartB=(a&255)/255;this._startColor=a;this.update()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"endColor",{get:function(){return this._endColor},set:function(a){this._pEndR=(a>>16&255)/255;this._pEndG=(a>>8&255)/255;this._pEndB=(a&255)/255;this._endColor=
a;this.update()},enumerable:!0,configurable:!0});b.prototype.dispose=function(){this._pEnd=this._pStart=null};Object.defineProperty(b.prototype,"iIndex",{get:function(){return this._index},set:function(a){this._index=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"iSubSetIndex",{get:function(){return this._subSetIndex},set:function(a){this._subSetIndex=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"iSegmentsBase",{set:function(a){this._pSegmentsBase=a},
enumerable:!0,configurable:!0});b.prototype.update=function(){this._pSegmentsBase&&this._pSegmentsBase.iUpdateSegment(this)};return b}();b.Segment=e})(b.primitives||(b.primitives={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(){this._pAabbPoints=[];this._pAabbPointsDirty=!0;this._pMin=new b.geom.Vector3D;this._pMax=new b.geom.Vector3D}Object.defineProperty(d.prototype,"max",{get:function(){return this._pMax},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"min",{get:function(){return this._pMin},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"aabbPoints",{get:function(){this._pAabbPointsDirty&&this.pUpdateAABBPoints();return this._pAabbPoints},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"boundingRenderable",{get:function(){this._pBoundingRenderable||(this._pBoundingRenderable=this.pCreateBoundingRenderable(),this.pUpdateBoundingRenderable());return this._pBoundingRenderable},enumerable:!0,configurable:!0});d.prototype.nullify=function(){this._pMin.x=this._pMin.y=this._pMin.z=0;this._pMax.x=this._pMax.y=this._pMax.z=0;this._pAabbPointsDirty=!0;this._pBoundingRenderable&&this.pUpdateBoundingRenderable()};d.prototype.disposeRenderable=
function(){this._pBoundingRenderable&&this._pBoundingRenderable.dispose();this._pBoundingRenderable=null};d.prototype.fromVertices=function(a){var c,b=a.length,q,d,f,l,g,e;if(0==b)this.nullify();else{var m;q=l=a[c++];d=g=a[c++];for(f=e=a[c++];c<b;)m=a[c++],m<q?q=m:m>l&&(l=m),m=a[c++],m<d?d=m:m>g&&(g=m),m=a[c++],m<f?f=m:m>e&&(e=m);this.fromExtremes(q,d,f,l,g,e)}};d.prototype.fromGeometry=function(a){a=a.subGeometries;var c=a.length,b,q,d,f,l,g;if(0<c){var e=0;b=q=d=Number.POSITIVE_INFINITY;for(f=l=
g=Number.NEGATIVE_INFINITY;e<c;)for(var m=a[e++],n=m.vertexData,p=n.length,r=m.vertexOffset,m=m.vertexStride;r<p;){var t=n[r];t<b?b=t:t>f&&(f=t);t=n[r+1];t<q?q=t:t>l&&(l=t);t=n[r+2];t<d?d=t:t>g&&(g=t);r+=m}this.fromExtremes(b,q,d,f,l,g)}else this.fromExtremes(0,0,0,0,0,0)};d.prototype.fromSphere=function(a,c){this.fromExtremes(a.x-c,a.y-c,a.z-c,a.x+c,a.y+c,a.z+c)};d.prototype.fromExtremes=function(a,c,b,q,d,f){this._pMin.x=a;this._pMin.y=c;this._pMin.z=b;this._pMax.x=q;this._pMax.y=d;this._pMax.z=
f;this._pAabbPointsDirty=!0;this._pBoundingRenderable&&this.pUpdateBoundingRenderable()};d.prototype.isInFrustum=function(a,c){throw new b.errors.AbstractMethodError;};d.prototype.overlaps=function(a){var c=a._pMin;a=a._pMax;return this._pMax.x>c.x&&this._pMin.x<a.x&&this._pMax.y>c.y&&this._pMin.y<a.y&&this._pMax.z>c.z&&this._pMin.z<a.z};d.prototype.clone=function(){throw new b.errors.AbstractMethodError;};d.prototype.rayIntersection=function(a,c,b){return-1};d.prototype.containsPoint=function(a){return!1};
d.prototype.pUpdateAABBPoints=function(){var a=this._pMax.x,c=this._pMax.y,b=this._pMax.z,q=this._pMin.x,d=this._pMin.y,f=this._pMin.z;this._pAabbPoints[0]=q;this._pAabbPoints[1]=d;this._pAabbPoints[2]=f;this._pAabbPoints[3]=a;this._pAabbPoints[4]=d;this._pAabbPoints[5]=f;this._pAabbPoints[6]=q;this._pAabbPoints[7]=c;this._pAabbPoints[8]=f;this._pAabbPoints[9]=a;this._pAabbPoints[10]=c;this._pAabbPoints[11]=f;this._pAabbPoints[12]=q;this._pAabbPoints[13]=d;this._pAabbPoints[14]=b;this._pAabbPoints[15]=
a;this._pAabbPoints[16]=d;this._pAabbPoints[17]=b;this._pAabbPoints[18]=q;this._pAabbPoints[19]=c;this._pAabbPoints[20]=b;this._pAabbPoints[21]=a;this._pAabbPoints[22]=c;this._pAabbPoints[23]=b;this._pAabbPointsDirty=!1};d.prototype.pUpdateBoundingRenderable=function(){throw new b.errors.AbstractMethodError;};d.prototype.pCreateBoundingRenderable=function(){throw new b.errors.AbstractMethodError;};d.prototype.classifyToPlane=function(a){throw new b.errors.AbstractMethodError;};d.prototype.transformFrom=
function(a,c){throw new b.errors.AbstractMethodError;};return d}();g.BoundingVolumeBase=e})(b.bounds||(b.bounds={}))})(away||(away={}));(function(b){(function(g){var e=function(b){function a(c,a){b.call(this,c);this._lens=a}__extends(a,b);Object.defineProperty(a.prototype,"lens",{get:function(){return this._lens},enumerable:!0,configurable:!0});a.MATRIX_CHANGED="matrixChanged";return a}(b.events.Event);g.LensEvent=e})(b.events||(b.events={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._pScissorRect=new b.geom.Rectangle;this._pViewPort=new b.geom.Rectangle;this._pNear=20;this._pFar=3E3;this._pAspectRatio=1;this._pMatrixInvalid=!0;this._pFrustumCorners=[];this._unprojectionInvalid=!0;this._pMatrix=new b.geom.Matrix3D}__extends(a,d);Object.defineProperty(a.prototype,"frustumCorners",{get:function(){return this._pFrustumCorners},set:function(c){this._pFrustumCorners=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"matrix",{get:function(){this._pMatrixInvalid&&(this.pUpdateMatrix(),this._pMatrixInvalid=!1);return this._pMatrix},set:function(c){this._pMatrix=c;this.pInvalidateMatrix()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"near",{get:function(){return this._pNear},set:function(c){c!=this._pNear&&(this._pNear=c,this.pInvalidateMatrix())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"far",{get:function(){return this._pFar},set:function(c){c!=this._pFar&&(this._pFar=
c,this.pInvalidateMatrix())},enumerable:!0,configurable:!0});a.prototype.project=function(c){var a=this.matrix.transformVector(c);a.x/=a.w;a.y=-a.y/a.w;a.z=c.z;return a};Object.defineProperty(a.prototype,"unprojectionMatrix",{get:function(){this._unprojectionInvalid&&(this._unprojection||(this._unprojection=new b.geom.Matrix3D),this._unprojection.copyFrom(this.matrix),this._unprojection.invert(),this._unprojectionInvalid=!1);return this._unprojection},enumerable:!0,configurable:!0});a.prototype.unproject=
function(c,a,q){throw new b.errors.AbstractMethodError;};a.prototype.clone=function(){throw new b.errors.AbstractMethodError;};Object.defineProperty(a.prototype,"iAspectRatio",{get:function(){return this._pAspectRatio},set:function(c){this._pAspectRatio!=c&&(this._pAspectRatio=c,this.pInvalidateMatrix())},enumerable:!0,configurable:!0});a.prototype.pInvalidateMatrix=function(){this._unprojectionInvalid=this._pMatrixInvalid=!0;this.dispatchEvent(new b.events.LensEvent(b.events.LensEvent.MATRIX_CHANGED,
this))};a.prototype.pUpdateMatrix=function(){throw new b.errors.AbstractMethodError;};a.prototype.iUpdateScissorRect=function(c,a,b,d){this._pScissorRect.x=c;this._pScissorRect.y=a;this._pScissorRect.width=b;this._pScissorRect.height=d;this.pInvalidateMatrix()};a.prototype.iUpdateViewport=function(c,a,b,d){this._pViewPort.x=c;this._pViewPort.y=a;this._pViewPort.width=b;this._pViewPort.height=d;this.pInvalidateMatrix()};return a}(b.events.EventDispatcher);g.LensBase=e})(b.cameras||(b.cameras={}))})(away||
(away={}));
(function(b){(function(g){var e=function(d){function a(c){"undefined"===typeof c&&(c=60);d.call(this);this.fieldOfView=c}__extends(a,d);Object.defineProperty(a.prototype,"fieldOfView",{get:function(){return this._fieldOfView},set:function(c){c!=this._fieldOfView&&(this._fieldOfView=c,this._focalLengthInv=Math.tan(this._fieldOfView*Math.PI/360),this._focalLength=1/this._focalLengthInv,this.pInvalidateMatrix())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"focalLength",{get:function(){return this._focalLength},
set:function(c){c!=this._focalLength&&(this._focalLength=c,this._focalLengthInv=1/this._focalLength,this._fieldOfView=360*Math.atan(this._focalLengthInv)/Math.PI,this.pInvalidateMatrix())},enumerable:!0,configurable:!0});a.prototype.unproject=function(c,a,q){c=new b.geom.Vector3D(c,-a,q,1);c.x*=q;c.y*=q;c.z=q;return c=this.unprojectionMatrix.transformVector(c)};a.prototype.clone=function(){var c=new a(this._fieldOfView);c._pNear=this._pNear;c._pFar=this._pFar;c._pAspectRatio=this._pAspectRatio;return c};
a.prototype.pUpdateMatrix=function(){var c=[];this._yMax=this._pNear*this._focalLengthInv;this._xMax=this._yMax*this._pAspectRatio;var a,b,d,f;if(0==this._pScissorRect.x&&0==this._pScissorRect.y&&this._pScissorRect.width==this._pViewPort.width&&this._pScissorRect.height==this._pViewPort.height)a=-this._xMax,b=this._xMax,d=-this._yMax,f=this._yMax,c[0]=this._pNear/this._xMax,c[5]=this._pNear/this._yMax,c[10]=this._pFar/(this._pFar-this._pNear),c[11]=1,c[1]=c[2]=c[3]=c[4]=c[6]=c[7]=c[8]=c[9]=c[12]=
c[13]=c[15]=0,c[14]=-this._pNear*c[10];else{b=this._xMax*(this._pViewPort.width/this._pScissorRect.width);f=this._yMax*(this._pViewPort.height/this._pScissorRect.height);d=this._xMax*(2*this._pScissorRect.x-this._pViewPort.width)/this._pScissorRect.width+this._xMax;var l=-this._yMax*(2*this._pScissorRect.y-this._pViewPort.height)/this._pScissorRect.height-this._yMax;a=d-b;b=d+b;d=l-f;f=l+f;c[0]=2*this._pNear/(b-a);c[5]=2*this._pNear/(f-d);c[8]=(b+a)/(b-a);c[9]=(f+d)/(f-d);c[10]=(this._pFar+this._pNear)/
(this._pFar-this._pNear);c[11]=1;c[1]=c[2]=c[3]=c[4]=c[6]=c[7]=c[12]=c[13]=c[15]=0;c[14]=-2*this._pFar*this._pNear/(this._pFar-this._pNear)}this._pMatrix.copyRawDataFrom(c);c=this._pFar*this._focalLengthInv;l=c*this._pAspectRatio;this._pFrustumCorners[0]=this._pFrustumCorners[9]=a;this._pFrustumCorners[3]=this._pFrustumCorners[6]=b;this._pFrustumCorners[1]=this._pFrustumCorners[4]=d;this._pFrustumCorners[7]=this._pFrustumCorners[10]=f;this._pFrustumCorners[12]=this._pFrustumCorners[21]=-l;this._pFrustumCorners[15]=
this._pFrustumCorners[18]=l;this._pFrustumCorners[13]=this._pFrustumCorners[16]=-c;this._pFrustumCorners[19]=this._pFrustumCorners[22]=c;this._pFrustumCorners[2]=this._pFrustumCorners[5]=this._pFrustumCorners[8]=this._pFrustumCorners[11]=this._pNear;this._pFrustumCorners[14]=this._pFrustumCorners[17]=this._pFrustumCorners[20]=this._pFrustumCorners[23]=this._pFar;this._pMatrixInvalid=!1};return a}(b.cameras.LensBase);g.PerspectiveLens=e})(b.cameras||(b.cameras={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._pMatrix.copyFrom((new b.cameras.PerspectiveLens).matrix)}__extends(a,d);Object.defineProperty(a.prototype,"near",{set:function(c){this._pNear=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"far",{set:function(c){this._pFar=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"iAspectRatio",{set:function(c){this._pAspectRatio=c},enumerable:!0,configurable:!0});a.prototype.clone=function(){var c=
new b.cameras.FreeMatrixLens;c._pMatrix.copyFrom(this._pMatrix);c._pNear=this._pNear;c._pFar=this._pFar;c._pAspectRatio=this._pAspectRatio;c.pInvalidateMatrix();return c};a.prototype.pUpdateMatrix=function(){this._pMatrixInvalid=!1};return a}(b.cameras.LensBase);g.FreeMatrixLens=e})(b.cameras||(b.cameras={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c){"undefined"===typeof c&&(c=500);d.call(this);this._projectionHeight=c}__extends(a,d);Object.defineProperty(a.prototype,"projectionHeight",{get:function(){return this._projectionHeight},set:function(c){c!=this._projectionHeight&&(this._projectionHeight=c,this.pInvalidateMatrix())},enumerable:!0,configurable:!0});a.prototype.unproject=function(c,a,q){c=new b.geom.Vector3D(c+this.matrix.rawData[12],-a+this.matrix.rawData[13],q,1);c=this.unprojectionMatrix.transformVector(c);
c.z=q;return c};a.prototype.clone=function(){var c=new b.cameras.OrthographicLens;c._pNear=this._pNear;c._pFar=this._pFar;c._pAspectRatio=this._pAspectRatio;c.projectionHeight=this._projectionHeight;return c};a.prototype.pUpdateMatrix=function(){var c=[];this._yMax=0.5*this._projectionHeight;this._xMax=this._yMax*this._pAspectRatio;var a,b,d,f;if(0==this._pScissorRect.x&&0==this._pScissorRect.y&&this._pScissorRect.width==this._pViewPort.width&&this._pScissorRect.height==this._pViewPort.height)a=-this._xMax,
b=this._xMax,d=-this._yMax,f=this._yMax,c[0]=2/(this._projectionHeight*this._pAspectRatio),c[5]=2/this._projectionHeight,c[10]=1/(this._pFar-this._pNear),c[14]=this._pNear/(this._pNear-this._pFar),c[1]=c[2]=c[3]=c[4]=c[6]=c[7]=c[8]=c[9]=c[11]=c[12]=c[13]=0;else{b=this._xMax*(this._pViewPort.width/this._pScissorRect.width);f=this._yMax*(this._pViewPort.height/this._pScissorRect.height);d=this._xMax*(2*this._pScissorRect.x-this._pViewPort.width)/this._pScissorRect.width+this._xMax;var l=-this._yMax*
(2*this._pScissorRect.y-this._pViewPort.height)/this._pScissorRect.height-this._yMax;a=d-b;b=d+b;d=l-f;f=l+f;c[0]=2/(b-a);c[5]=-2/(d-f);c[10]=1/(this._pFar-this._pNear);c[12]=(b+a)/(b-a);c[13]=(f+d)/(f-d);c[14]=this._pNear/(this.near-this.far);c[1]=c[2]=c[3]=c[4]=c[6]=c[7]=c[8]=c[9]=c[11]=0}c[15]=1;this._pFrustumCorners[0]=this._pFrustumCorners[9]=this._pFrustumCorners[12]=this._pFrustumCorners[21]=a;this._pFrustumCorners[3]=this._pFrustumCorners[6]=this._pFrustumCorners[15]=this._pFrustumCorners[18]=
b;this._pFrustumCorners[1]=this._pFrustumCorners[4]=this._pFrustumCorners[13]=this._pFrustumCorners[16]=d;this._pFrustumCorners[7]=this._pFrustumCorners[10]=this._pFrustumCorners[19]=this._pFrustumCorners[22]=f;this._pFrustumCorners[2]=this._pFrustumCorners[5]=this._pFrustumCorners[8]=this._pFrustumCorners[11]=this._pNear;this._pFrustumCorners[14]=this._pFrustumCorners[17]=this._pFrustumCorners[20]=this._pFrustumCorners[23]=this._pFar;this._pMatrix.copyRawDataFrom(c);this._pMatrixInvalid=!1};return a}(b.cameras.LensBase);
g.OrthographicLens=e})(b.cameras||(b.cameras={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a,b,h){d.call(this);this._minX=c;this._maxX=a;this._minY=b;this._maxY=h}__extends(a,d);Object.defineProperty(a.prototype,"minX",{get:function(){return this._minX},set:function(c){this._minX=c;this.pInvalidateMatrix()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxX",{get:function(){return this._maxX},set:function(c){this._maxX=c;this.pInvalidateMatrix()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"minY",{get:function(){return this._minY},set:function(c){this._minY=c;this.pInvalidateMatrix()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxY",{get:function(){return this._maxY},set:function(c){this._maxY=c;this.pInvalidateMatrix()},enumerable:!0,configurable:!0});a.prototype.unproject=function(c,a,q){c=new b.geom.Vector3D(c,-a,q,1);c=this.unprojectionMatrix.transformVector(c);c.z=q;return c};a.prototype.clone=function(){var c=new b.cameras.OrthographicOffCenterLens(this._minX,
this._maxX,this._minY,this._maxY);c._pNear=this._pNear;c._pFar=this._pFar;c._pAspectRatio=this._pAspectRatio;return c};a.prototype.pUpdateMatrix=function(){var c=[],a=1/(this._maxX-this._minX),b=1/(this._maxY-this._minY),d=1/(this._pFar-this._pNear);c[0]=2*a;c[5]=2*b;c[10]=d;c[12]=-(this._maxX+this._minX)*a;c[13]=-(this._maxY+this._minY)*b;c[14]=-this._pNear*d;c[15]=1;c[1]=c[2]=c[3]=c[4]=c[6]=c[7]=c[8]=c[9]=c[11]=0;this._pMatrix.copyRawDataFrom(c);this._pFrustumCorners[0]=this._pFrustumCorners[9]=
this._pFrustumCorners[12]=this._pFrustumCorners[21]=this._minX;this._pFrustumCorners[3]=this._pFrustumCorners[6]=this._pFrustumCorners[15]=this._pFrustumCorners[18]=this._maxX;this._pFrustumCorners[1]=this._pFrustumCorners[4]=this._pFrustumCorners[13]=this._pFrustumCorners[16]=this._minY;this._pFrustumCorners[7]=this._pFrustumCorners[10]=this._pFrustumCorners[19]=this._pFrustumCorners[22]=this._maxY;this._pFrustumCorners[2]=this._pFrustumCorners[5]=this._pFrustumCorners[8]=this._pFrustumCorners[11]=
this._pNear;this._pFrustumCorners[14]=this._pFrustumCorners[17]=this._pFrustumCorners[20]=this._pFrustumCorners[23]=this._pFar;this._pMatrixInvalid=!1};return a}(b.cameras.LensBase);g.OrthographicOffCenterLens=e})(b.cameras||(b.cameras={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a,b,h){"undefined"===typeof c&&(c=-40);"undefined"===typeof a&&(a=40);"undefined"===typeof b&&(b=-40);"undefined"===typeof h&&(h=40);d.call(this);this.minAngleX=c;this.maxAngleX=a;this.minAngleY=b;this.maxAngleY=h}__extends(a,d);Object.defineProperty(a.prototype,"minAngleX",{get:function(){return this._minAngleX},set:function(c){this._minAngleX=c;this._tanMinX=Math.tan(this._minAngleX*Math.PI/180);this.pInvalidateMatrix()},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"maxAngleX",{get:function(){return this._maxAngleX},set:function(c){this._maxAngleX=c;this._tanMaxX=Math.tan(this._maxAngleX*Math.PI/180);this.pInvalidateMatrix()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"minAngleY",{get:function(){return this._minAngleY},set:function(c){this._minAngleY=c;this._tanMinY=Math.tan(this._minAngleY*Math.PI/180);this.pInvalidateMatrix()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxAngleY",
{get:function(){return this._maxAngleY},set:function(c){this._maxAngleY=c;this._tanMaxY=Math.tan(this._maxAngleY*Math.PI/180);this.pInvalidateMatrix()},enumerable:!0,configurable:!0});a.prototype.unproject=function(c,a,q){c=new b.geom.Vector3D(c,-a,q,1);c.x*=q;c.y*=q;c=this.unprojectionMatrix.transformVector(c);c.z=q;return c};a.prototype.clone=function(){var c=new b.cameras.PerspectiveOffCenterLens(this._minAngleX,this._maxAngleX,this._minAngleY,this._maxAngleY);c._pNear=this._pNear;c._pFar=this._pFar;
c._pAspectRatio=this._pAspectRatio;return c};a.prototype.pUpdateMatrix=function(){var c=[];this._minLengthX=this._pNear*this._tanMinX;this._maxLengthX=this._pNear*this._tanMaxX;this._minLengthY=this._pNear*this._tanMinY;this._maxLengthY=this._pNear*this._tanMaxY;var a=-this._minLengthX/(this._maxLengthX-this._minLengthX),b=-this._minLengthY/(this._maxLengthY-this._minLengthY),d,a=-this._minLengthX*(this._pScissorRect.x+this._pScissorRect.width*a)/(this._pScissorRect.width*a),f=this._minLengthY*(this._pScissorRect.y+
this._pScissorRect.height*b)/(this._pScissorRect.height*b),b=a-(this._maxLengthX-this._minLengthX)*(this._pViewPort.width/this._pScissorRect.width);d=f+(this._maxLengthY-this._minLengthY)*(this._pViewPort.height/this._pScissorRect.height);c[0]=2*this._pNear/(a-b);c[5]=2*this._pNear/(d-f);c[8]=(a+b)/(a-b);c[9]=(d+f)/(d-f);c[10]=(this._pFar+this._pNear)/(this._pFar-this._pNear);c[11]=1;c[1]=c[2]=c[3]=c[4]=c[6]=c[7]=c[12]=c[13]=c[15]=0;c[14]=-2*this._pFar*this._pNear/(this._pFar-this._pNear);this._pMatrix.copyRawDataFrom(c);
this._minLengthX=this._pFar*this._tanMinX;this._maxLengthX=this._pFar*this._tanMaxX;this._minLengthY=this._pFar*this._tanMinY;this._maxLengthY=this._pFar*this._tanMaxY;this._pFrustumCorners[0]=this._pFrustumCorners[9]=b;this._pFrustumCorners[3]=this._pFrustumCorners[6]=a;this._pFrustumCorners[1]=this._pFrustumCorners[4]=f;this._pFrustumCorners[7]=this._pFrustumCorners[10]=d;this._pFrustumCorners[12]=this._pFrustumCorners[21]=this._minLengthX;this._pFrustumCorners[15]=this._pFrustumCorners[18]=this._maxLengthX;
this._pFrustumCorners[13]=this._pFrustumCorners[16]=this._minLengthY;this._pFrustumCorners[19]=this._pFrustumCorners[22]=this._maxLengthY;this._pFrustumCorners[2]=this._pFrustumCorners[5]=this._pFrustumCorners[8]=this._pFrustumCorners[11]=this._pNear;this._pFrustumCorners[14]=this._pFrustumCorners[17]=this._pFrustumCorners[20]=this._pFrustumCorners[23]=this._pFar;this._pMatrixInvalid=!1};return a}(b.cameras.LensBase);g.PerspectiveOffCenterLens=e})(b.cameras||(b.cameras={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a){d.call(this);this.baseLens=c;this.plane=a}__extends(a,d);Object.defineProperty(a.prototype,"frustumCorners",{get:function(){return this._baseLens.frustumCorners},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"near",{get:function(){return this._baseLens.near},set:function(c){this._baseLens.near=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"far",{get:function(){return this._baseLens.far},set:function(c){this._baseLens.far=
c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"iAspectRatio",{get:function(){return this._baseLens.iAspectRatio},set:function(c){this._baseLens.iAspectRatio=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"plane",{get:function(){return this._plane},set:function(c){this._plane=c;this.pInvalidateMatrix()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"baseLens",{set:function(c){this._baseLens&&this._baseLens.removeEventListener(b.events.LensEvent.MATRIX_CHANGED,
this.onLensMatrixChanged,this);(this._baseLens=c)&&this._baseLens.addEventListener(b.events.LensEvent.MATRIX_CHANGED,this.onLensMatrixChanged,this);this.pInvalidateMatrix()},enumerable:!0,configurable:!0});a.prototype.onLensMatrixChanged=function(c){this.pInvalidateMatrix()};a.prototype.pUpdateMatrix=function(){this._pMatrix.copyFrom(this._baseLens.matrix);var c=this._plane.a,a=this._plane.b,q=this._plane.c,d=-this._plane.d+0.05,f=new b.geom.Vector3D(0<=c?1:-1,0<=a?1:-1,1,1),l=this._pMatrix.clone();
l.invert();l=l.transformVector(f);this._pMatrix.copyRowTo(3,f);f=(l.x*f.x+l.y*f.y+l.z*f.z+l.w*f.w)/(c*l.x+a*l.y+q*l.z+d*l.w);this._pMatrix.copyRowFrom(2,new b.geom.Vector3D(c*f,a*f,q*f,d*f))};return a}(b.cameras.LensBase);g.ObliqueNearPlaneLens=e})(b.cameras||(b.cameras={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(c,a){b.call(this,c);this._camera=a}__extends(a,b);Object.defineProperty(a.prototype,"camera",{get:function(){return this._camera},enumerable:!0,configurable:!0});a.LENS_CHANGED="lensChanged";return a}(b.events.Event);g.CameraEvent=e})(b.events||(b.events={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a){"undefined"===typeof c&&(c=!0);"undefined"===typeof a&&(a=null);d.call(this);this._alwaysIn=c;this._renderable=a;this._pMax.x=this._pMax.y=this._pMax.z=Number.POSITIVE_INFINITY;this._pMin.x=this._pMin.y=this._pMin.z=this._alwaysIn?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY}__extends(a,d);a.prototype.clone=function(){return new b.bounds.NullBounds(this._alwaysIn)};a.prototype.pCreateBoundingRenderable=function(){return null};a.prototype.isInFrustum=
function(c,a){return this._alwaysIn};a.prototype.fromGeometry=function(c){};a.prototype.fromSphere=function(c,a){};a.prototype.fromExtremes=function(c,a,b,d,f,l){};a.prototype.classifyToPlane=function(c){return b.math.PlaneClassification.INTERSECT};a.prototype.transformFrom=function(c,a){this._alwaysIn=c._alwaysIn};return a}(b.bounds.BoundingVolumeBase);g.NullBounds=e})(b.bounds||(b.bounds={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._centerZ=this._centerY=this._centerX=this._radius=0}__extends(a,d);Object.defineProperty(a.prototype,"radius",{get:function(){return this._radius},enumerable:!0,configurable:!0});a.prototype.nullify=function(){d.prototype.nullify.call(this);this._radius=this._centerX=this._centerY=this._centerZ=0};a.prototype.isInFrustum=function(c,a){for(var b=0;b<a;++b){var d=c[b];if(0>d.a*(this._centerX+(0>d.a?-this._radius:this._radius))+
d.b*(this._centerY+(0>d.b?-this._radius:this._radius))+d.c*(this._centerZ+(0>d.c?-this._radius:this._radius))-d.d)return!1}return!0};a.prototype.fromSphere=function(c,a){this._centerX=c.x;this._centerY=c.y;this._centerZ=c.z;this._radius=a;this._pMax.x=this._centerX+a;this._pMax.y=this._centerY+a;this._pMax.z=this._centerZ+a;this._pMin.x=this._centerX-a;this._pMin.y=this._centerY-a;this._pMin.z=this._centerZ-a;this._pAabbPointsDirty=!0;this._pBoundingRenderable&&this.pUpdateBoundingRenderable()};a.prototype.fromExtremes=
function(c,a,b,h,f,l){this._centerX=0.5*(h+c);this._centerY=0.5*(f+a);this._centerZ=0.5*(l+b);var g=h-c,e=f-a,m=l-b;e>g&&(g=e);m>g&&(g=m);this._radius=g*Math.sqrt(0.5);d.prototype.fromExtremes.call(this,c,a,b,h,f,l)};a.prototype.clone=function(){var c=new a;c.fromSphere(new b.geom.Vector3D(this._centerX,this._centerY,this._centerZ),this._radius);return c};a.prototype.rayIntersection=function(c,a,b){if(this.containsPoint(c))return 0;var d=c.x-this._centerX,f=c.y-this._centerY;c=c.z-this._centerZ;var l=
a.x,g=a.y;a=a.z;var e;e=l*l+g*g+a*a;var m=2*(d*l+f*g+c*a),n=m*m-4*e*(d*d+f*f+c*c-this._radius*this._radius);return 0<=n&&(n=Math.sqrt(n),e=(-m-n)/(2*e),0<=e)?(b.x=d+e*l,b.y=f+e*g,b.z=c+e*a,b.normalize(),e):-1};a.prototype.containsPoint=function(c){var a=c.x-this._centerX,b=c.y-this._centerY;c=c.z-this._centerZ;return Math.sqrt(a*a+b*b+c*c)<=this._radius};a.prototype.pUpdateBoundingRenderable=function(){var c=this._radius;0==c&&(c=0.0010);this._pBoundingRenderable.scaleX=c;this._pBoundingRenderable.scaleY=
c;this._pBoundingRenderable.scaleZ=c;this._pBoundingRenderable.x=this._centerX;this._pBoundingRenderable.y=this._centerY;this._pBoundingRenderable.z=this._centerZ};a.prototype.pCreateBoundingRenderable=function(){return new b.primitives.WireframeSphere(1,16,12,16777215,0.5)};a.prototype.classifyToPlane=function(c){var a=c.a,q=c.b,d=c.c;c=a*this._centerX+q*this._centerY+d*this._centerZ-c.d;0>a&&(a=-a);0>q&&(q=-q);0>d&&(d=-d);a=(a+q+d)*this._radius;return c>a?b.math.PlaneClassification.FRONT:c<-a?b.math.PlaneClassification.BACK:
b.math.PlaneClassification.INTERSECT};a.prototype.transformFrom=function(c,a){var b=c._centerX,d=c._centerY,f=c._centerZ,l=[];a.copyRawDataTo(l);var g=l[0],e=l[4],m=l[8],n=l[1],p=l[5],r=l[9],t=l[13],v=l[2],x=l[6],u=l[10],y=l[14];this._centerX=b*g+d*e+f*m+l[12];this._centerY=b*n+d*p+f*r+t;this._centerZ=b*v+d*x+f*u+y;0>g&&(g=-g);0>e&&(e=-e);0>m&&(m=-m);0>n&&(n=-n);0>p&&(p=-p);0>r&&(r=-r);0>v&&(v=-v);0>x&&(x=-x);0>u&&(u=-u);b=g+e+m;n=n+p+r;v=v+x+u;this._radius=c._radius*Math.sqrt(b*b+n*n+v*v);this._pMin.x=
this._centerX-this._radius;this._pMin.y=this._centerY-this._radius;this._pMin.z=this._centerZ-this._radius;this._pMax.x=this._centerX+this._radius;this._pMax.y=this._centerY+this._radius;this._pMax.z=this._centerZ+this._radius};return a}(b.bounds.BoundingVolumeBase);g.BoundingSphere=e})(b.bounds||(b.bounds={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._halfExtentsZ=this._halfExtentsY=this._halfExtentsX=this._centerZ=this._centerY=this._centerX=0}__extends(a,d);a.prototype.nullify=function(){d.prototype.nullify.call(this);this._halfExtentsX=this._halfExtentsY=this._halfExtentsZ=this._centerX=this._centerY=this._centerZ=0};a.prototype.isInFrustum=function(c,a){for(var b=0;b<a;++b){var d=c[b],f=d.a,l=d.b,g=d.c;if(0>f*(this._centerX+(0>f?-this._halfExtentsX:this._halfExtentsX))+
l*(this._centerY+(0>l?-this._halfExtentsY:this._halfExtentsY))+g*(this._centerZ+(0>g?-this._halfExtentsZ:this._halfExtentsZ))-d.d)return!1}return!0};a.prototype.rayIntersection=function(c,a,b){if(this.containsPoint(c))return 0;var d=c.x-this._centerX,f=c.y-this._centerY;c=c.z-this._centerZ;var l=a.x,g=a.y;a=a.z;var e,m,n,p,r;0>l&&(p=(this._halfExtentsX-d)/l,0<p&&(m=f+p*g,n=c+p*a,m>-this._halfExtentsY&&(m<this._halfExtentsY&&n>-this._halfExtentsZ&&n<this._halfExtentsZ)&&(b.x=1,b.y=0,b.z=0,r=!0)));
!r&&0<l&&(p=(-this._halfExtentsX-d)/l,0<p&&(m=f+p*g,n=c+p*a,m>-this._halfExtentsY&&(m<this._halfExtentsY&&n>-this._halfExtentsZ&&n<this._halfExtentsZ)&&(b.x=-1,b.y=0,b.z=0,r=!0)));!r&&0>g&&(p=(this._halfExtentsY-f)/g,0<p&&(e=d+p*l,n=c+p*a,e>-this._halfExtentsX&&(e<this._halfExtentsX&&n>-this._halfExtentsZ&&n<this._halfExtentsZ)&&(b.x=0,b.y=1,b.z=0,r=!0)));!r&&0<g&&(p=(-this._halfExtentsY-f)/g,0<p&&(e=d+p*l,n=c+p*a,e>-this._halfExtentsX&&(e<this._halfExtentsX&&n>-this._halfExtentsZ&&n<this._halfExtentsZ)&&
(b.x=0,b.y=-1,b.z=0,r=!0)));!r&&0>a&&(p=(this._halfExtentsZ-c)/a,0<p&&(e=d+p*l,m=f+p*g,m>-this._halfExtentsY&&(m<this._halfExtentsY&&e>-this._halfExtentsX&&e<this._halfExtentsX)&&(b.x=0,b.y=0,b.z=1,r=!0)));!r&&0<a&&(p=(-this._halfExtentsZ-c)/a,0<p&&(e=d+p*l,m=f+p*g,m>-this._halfExtentsY&&(m<this._halfExtentsY&&e>-this._halfExtentsX&&e<this._halfExtentsX)&&(b.x=0,b.y=0,b.z=-1,r=!0)));return r?p:-1};a.prototype.containsPoint=function(c){var a=c.x-this._centerX,b=c.y-this._centerY;c=c.z-this._centerZ;
return a<=this._halfExtentsX&&a>=-this._halfExtentsX&&b<=this._halfExtentsY&&b>=-this._halfExtentsY&&c<=this._halfExtentsZ&&c>=-this._halfExtentsZ};a.prototype.fromExtremes=function(c,a,b,h,f,l){this._centerX=0.5*(h+c);this._centerY=0.5*(f+a);this._centerZ=0.5*(l+b);this._halfExtentsX=0.5*(h-c);this._halfExtentsY=0.5*(f-a);this._halfExtentsZ=0.5*(l-b);d.prototype.fromExtremes.call(this,c,a,b,h,f,l)};a.prototype.clone=function(){var c=new a;c.fromExtremes(this._pMin.x,this._pMin.y,this._pMin.z,this._pMax.x,
this._pMax.y,this._pMax.z);return c};Object.defineProperty(a.prototype,"halfExtentsX",{get:function(){return this._halfExtentsX},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"halfExtentsY",{get:function(){return this._halfExtentsY},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"halfExtentsZ",{get:function(){return this._halfExtentsZ},enumerable:!0,configurable:!0});a.prototype.closestPointToPoint=function(c,a){"undefined"===typeof a&&(a=null);var d;null==a&&
(a=new b.geom.Vector3D);d=c.x;d<this._pMin.x&&(d=this._pMin.x);d>this._pMax.x&&(d=this._pMax.x);a.x=d;d=c.y;d<this._pMin.y&&(d=this._pMin.y);d>this._pMax.y&&(d=this._pMax.y);a.y=d;d=c.z;d<this._pMin.z&&(d=this._pMin.z);d>this._pMax.z&&(d=this._pMax.z);a.z=d;return a};a.prototype.pUpdateBoundingRenderable=function(){this._pBoundingRenderable.scaleX=Math.max(2*this._halfExtentsX,0.0010);this._pBoundingRenderable.scaleY=Math.max(2*this._halfExtentsY,0.0010);this._pBoundingRenderable.scaleZ=Math.max(2*
this._halfExtentsZ,0.0010);this._pBoundingRenderable.x=this._centerX;this._pBoundingRenderable.y=this._centerY;this._pBoundingRenderable.z=this._centerZ};a.prototype.pCreateBoundingRenderable=function(){return new b.primitives.WireframeCube(1,1,1,16777215,0.5)};a.prototype.classifyToPlane=function(c){var a=c.a,d=c.b,h=c.c;c=a*this._centerX+d*this._centerY+h*this._centerZ-c.d;0>a&&(a=-a);0>d&&(d=-d);0>h&&(h=-h);a=a*this._halfExtentsX+d*this._halfExtentsY+h*this._halfExtentsZ;return c>a?b.math.PlaneClassification.FRONT:
c<-a?b.math.PlaneClassification.BACK:b.math.PlaneClassification.INTERSECT};a.prototype.transformFrom=function(c,a){var d=c._centerX,h=c._centerY,f=c._centerZ,l=b.math.Matrix3DUtils.RAW_DATA_CONTAINER;a.copyRawDataTo(l);var g=l[0],e=l[4],m=l[8],n=l[1],p=l[5],r=l[9],t=l[13],v=l[2],x=l[6],u=l[10],y=l[14];this._centerX=d*g+h*e+f*m+l[12];this._centerY=d*n+h*p+f*r+t;this._centerZ=d*v+h*x+f*u+y;0>g&&(g=-g);0>e&&(e=-e);0>m&&(m=-m);0>n&&(n=-n);0>p&&(p=-p);0>r&&(r=-r);0>v&&(v=-v);0>x&&(x=-x);0>u&&(u=-u);d=
c._halfExtentsX;h=c._halfExtentsY;f=c._halfExtentsZ;this._halfExtentsX=d*g+h*e+f*m;this._halfExtentsY=d*n+h*p+f*r;this._halfExtentsZ=d*v+h*x+f*u;this._pMin.x=this._centerX-this._halfExtentsX;this._pMin.y=this._centerY-this._halfExtentsY;this._pMin.z=this._centerZ-this._halfExtentsZ;this._pMax.x=this._centerX+this._halfExtentsX;this._pMax.y=this._centerY+this._halfExtentsY;this._pMax.z=this._centerZ+this._halfExtentsZ};return a}(b.bounds.BoundingVolumeBase);g.AxisAlignedBoundingBox=e})(b.bounds||(b.bounds=
{}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._pSceneTransform=new b.geom.Matrix3D;this._pSceneTransformDirty=!0;this._children=[];this._mouseChildren=!0;this._inverseSceneTransform=new b.geom.Matrix3D;this._inverseSceneTransformDirty=!0;this._scenePosition=new b.geom.Vector3D;this._implicitVisibility=this._explicitVisibility=this._scenePositionDirty=!0;this._pIgnoreTransform=!1}__extends(a,d);a.prototype.getIgnoreTransform=function(){return this._pIgnoreTransform};a.prototype.setIgnoreTransform=
function(c){this._pIgnoreTransform=c;this._pSceneTransformDirty=!c;this._inverseSceneTransformDirty=!c;this._scenePositionDirty=!c;c&&(this._pSceneTransform.identity(),this._scenePosition.setTo(0,0,0))};a.prototype.iGetImplicitPartition=function(){return this._pImplicitPartition};a.prototype.iSetImplicitPartition=function(c){if(c!=this._pImplicitPartition){var a=0,b=this._children.length,d;for(this._pImplicitPartition=c;a<b;)d=this._children[a++],d._pExplicitPartition||(d._pImplicitPartition=c)}};
Object.defineProperty(a.prototype,"_iIsVisible",{get:function(){return this._implicitVisibility&&this._explicitVisibility},enumerable:!0,configurable:!0});a.prototype.iSetParent=function(c){this._pParent=c;this.pUpdateMouseChildren();null==c?this.scene=null:(this.notifySceneTransformChange(),this.notifySceneChange())};a.prototype.notifySceneTransformChange=function(){if(!this._pSceneTransformDirty&&!this._pIgnoreTransform){this.pInvalidateSceneTransform();for(var c=0,a=this._children.length;c<a;)this._children[c++].notifySceneTransformChange();
this._listenToSceneTransformChanged&&(this._sceneTransformChanged||(this._sceneTransformChanged=new b.events.Object3DEvent(b.events.Object3DEvent.SCENETRANSFORM_CHANGED,this)),this.dispatchEvent(this._sceneTransformChanged))}};a.prototype.notifySceneChange=function(){this.notifySceneTransformChange();for(var c,a=this._children.length;c<a;)this._children[c++].notifySceneChange();this._listenToSceneChanged&&(this._scenechanged||(this._scenechanged=new b.events.Object3DEvent(b.events.Object3DEvent.SCENE_CHANGED,
this)),this.dispatchEvent(this._scenechanged))};a.prototype.pUpdateMouseChildren=function(){this._iAncestorsAllowMouseEnabled=this._pParent&&!this._pParent._iIsRoot?this._pParent._iAncestorsAllowMouseEnabled&&this._pParent.mouseChildren:this.mouseChildren;for(var c=this._children.length,a=0;a<c;++a)this._children[a].pUpdateMouseChildren()};Object.defineProperty(a.prototype,"mouseEnabled",{get:function(){return this._pMouseEnabled},set:function(c){this._pMouseEnabled=c;this.pUpdateMouseChildren()},
enumerable:!0,configurable:!0});a.prototype.iInvalidateTransform=function(){d.prototype.iInvalidateTransform.call(this);this.notifySceneTransformChange()};a.prototype.pInvalidateSceneTransform=function(){this._pSceneTransformDirty=!this._pIgnoreTransform;this._inverseSceneTransformDirty=!this._pIgnoreTransform;this._scenePositionDirty=!this._pIgnoreTransform};a.prototype.pUpdateSceneTransform=function(){this._pParent&&!this._pParent._iIsRoot?(this._pSceneTransform.copyFrom(this._pParent.sceneTransform),
this._pSceneTransform.prepend(this.transform)):this._pSceneTransform.copyFrom(this.transform);this._pSceneTransformDirty=!1};Object.defineProperty(a.prototype,"mouseChildren",{get:function(){return this._mouseChildren},set:function(c){this._mouseChildren=c;this.pUpdateMouseChildren()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"visible",{get:function(){return this._explicitVisibility},set:function(c){var a=this._children.length;this._explicitVisibility=c;for(c=0;c<a;++c)this._children[c].updateImplicitVisibility()},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"assetType",{get:function(){return b.library.AssetType.CONTAINER},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"scenePosition",{get:function(){this._scenePositionDirty&&(this.sceneTransform.copyColumnTo(3,this._scenePosition),this._scenePositionDirty=!1);return this._scenePosition},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"minX",{get:function(){for(var c,a=this._children.length,b=Number.POSITIVE_INFINITY,
d;c<a;)d=this._children[c++],d=d.minX+d.x,d<b&&(b=d);return b},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"minY",{get:function(){for(var c,a=this._children.length,b=Number.POSITIVE_INFINITY,d;c<a;)d=this._children[c++],d=d.minY+d.y,d<b&&(b=d);return b},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"minZ",{get:function(){for(var c,a=this._children.length,b=Number.POSITIVE_INFINITY,d;c<a;)d=this._children[c++],d=d.minZ+d.z,d<b&&(b=d);return b},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"maxX",{get:function(){for(var c,a=this._children.length,b=Number.NEGATIVE_INFINITY,d;c<a;)d=this._children[c++],d=d.maxX+d.x,d>b&&(b=d);return b},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxY",{get:function(){for(var c,a=this._children.length,b=Number.NEGATIVE_INFINITY,d;c<a;)d=this._children[c++],d=d.maxY+d.y,d>b&&(b=d);return b},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxZ",{get:function(){for(var c,
a=this._children.length,b=Number.NEGATIVE_INFINITY,d;c<a;)d=this._children[c++],d=d.maxZ+d.z,d>b&&(b=d);return b},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"partition",{get:function(){return this._pExplicitPartition},set:function(c){this._pExplicitPartition=c;this.iSetImplicitPartition(c?c:this._pParent?this._pParent.iGetImplicitPartition():null)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sceneTransform",{get:function(){this._pSceneTransformDirty&&
this.pUpdateSceneTransform();return this._pSceneTransform},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"scene",{get:function(){return this._pScene},set:function(c){this.setScene(c)},enumerable:!0,configurable:!0});a.prototype.setScene=function(c){for(var a=0,d=this._children.length;a<d;)this._children[a++].scene=c;this._pScene!=c&&(null==c&&(this._oldScene=this._pScene),this._pExplicitPartition&&(this._oldScene&&this._oldScene!=this._pScene)&&(this.partition=null),c&&(this._oldScene=
null),(this._pScene=c)?this._pScene.dispatchEvent(new b.events.Scene3DEvent(b.events.Scene3DEvent.ADDED_TO_SCENE,this)):this._oldScene&&this._oldScene.dispatchEvent(new b.events.Scene3DEvent(b.events.Scene3DEvent.REMOVED_FROM_SCENE,this)))};Object.defineProperty(a.prototype,"inverseSceneTransform",{get:function(){this._inverseSceneTransformDirty&&(this._inverseSceneTransform.copyFrom(this.sceneTransform),this._inverseSceneTransform.invert(),this._inverseSceneTransformDirty=!1);return this._inverseSceneTransform},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"parent",{get:function(){return this._pParent},enumerable:!0,configurable:!0});a.prototype.contains=function(c){return 0<=this._children.indexOf(c)};a.prototype.addChild=function(c){if(null==c)throw new b.errors.Error("Parameter child cannot be null.");c._pParent&&c._pParent.removeChild(c);c._pExplicitPartition||c.iSetImplicitPartition(this._pImplicitPartition);c.iSetParent(this);c.scene=this._pScene;c.notifySceneTransformChange();
c.pUpdateMouseChildren();c.updateImplicitVisibility();this._children.push(c);return c};a.prototype.addChildren=function(c){for(var a in c)this.addChild(a)};a.prototype.removeChild=function(c){if(null==c)throw new b.errors.Error("Parameter child cannot be null");var a=this._children.indexOf(c);if(-1==a)throw new b.errors.Error("Parameter is not a child of the caller");this.removeChildInternal(a,c)};a.prototype.removeChildAt=function(c){this.removeChildInternal(c,this._children[c])};a.prototype.removeChildInternal=
function(c,a){this._children.splice(c,1);a.iSetParent(null);a._pExplicitPartition||a.iSetImplicitPartition(null)};a.prototype.getChildAt=function(c){return this._children[c]};Object.defineProperty(a.prototype,"numChildren",{get:function(){return this._children.length},enumerable:!0,configurable:!0});a.prototype.lookAt=function(c,a){"undefined"===typeof a&&(a=null);d.prototype.lookAt.call(this,c,a);this.notifySceneTransformChange()};a.prototype.translateLocal=function(c,a){d.prototype.translateLocal.call(this,
c,a);this.notifySceneTransformChange()};a.prototype.dispose=function(){this.parent&&this.parent.removeChild(this)};a.prototype.disposeWithChildren=function(){for(this.dispose();0<this.numChildren;)this.getChildAt(0).dispose()};a.prototype.clone=function(){var c=new b.containers.ObjectContainer3D;c.pivotPoint=this.pivotPoint;c.transform=this.transform;c.partition=this.partition;c.name=name;for(var a=this._children.length,d=0;d<a;++d)c.addChild(this._children[d].clone());return c};a.prototype.rotate=
function(c,a){d.prototype.rotate.call(this,c,a);this.notifySceneTransformChange()};a.prototype.updateImplicitVisibility=function(){var c=this._children.length;this._implicitVisibility=this._pParent._explicitVisibility&&this._pParent._implicitVisibility;for(var a=0;a<c;++a)this._children[a].updateImplicitVisibility()};return a}(b.base.Object3D);g.ObjectContainer3D=e})(b.containers||(b.containers={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._worldBoundsInvalid=this._pBoundsInvalid=!0;this._pBounds=this.pGetDefaultBoundingVolume();this._worldBounds=this.pGetDefaultBoundingVolume()}__extends(a,d);a.prototype.setIgnoreTransform=function(c){this._pScene&&this._pScene.iInvalidateEntityBounds(this);d.prototype.setIgnoreTransform.call(this,c)};Object.defineProperty(a.prototype,"shaderPickingDetails",{get:function(){return this._shaderPickingDetails},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"staticNode",{get:function(){return this._iStaticNode},set:function(c){this._iStaticNode=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"pickingCollisionVO",{get:function(){this._iPickingCollisionVO||(this._iPickingCollisionVO=new b.pick.PickingCollisionVO(this));return this._iPickingCollisionVO},enumerable:!0,configurable:!0});a.prototype.iCollidesBefore=function(c,a){return!0};Object.defineProperty(a.prototype,"showBounds",{get:function(){return this._showBounds},
set:function(c){c!=this._showBounds&&((this._showBounds=c)?this.addBounds():this.removeBounds())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"minX",{get:function(){this._pBoundsInvalid&&this.pUpdateBounds();return this._pBounds.min.x},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"minY",{get:function(){this._pBoundsInvalid&&this.pUpdateBounds();return this._pBounds.min.y},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"minZ",{get:function(){this._pBoundsInvalid&&
this.pUpdateBounds();return this._pBounds.min.z},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxX",{get:function(){this._pBoundsInvalid&&this.pUpdateBounds();return this._pBounds.max.x},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxY",{get:function(){this._pBoundsInvalid&&this.pUpdateBounds();return this._pBounds.max.y},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxZ",{get:function(){this._pBoundsInvalid&&this.pUpdateBounds();
return this._pBounds.max.z},enumerable:!0,configurable:!0});a.prototype.getBounds=function(){this._pBoundsInvalid&&this.pUpdateBounds();return this._pBounds};Object.defineProperty(a.prototype,"bounds",{get:function(){return this.getBounds()},set:function(c){this.removeBounds();this._pBounds=c;this._worldBounds=c.clone();this.pInvalidateBounds();this._showBounds&&this.addBounds()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"worldBounds",{get:function(){this._worldBoundsInvalid&&
this.updateWorldBounds();return this._worldBounds},enumerable:!0,configurable:!0});a.prototype.updateWorldBounds=function(){this._worldBounds.transformFrom(this.getBounds(),this.sceneTransform);this._worldBoundsInvalid=!1};a.prototype.iSetImplicitPartition=function(c){c!=this._pImplicitPartition&&(this._pImplicitPartition&&this.notifyPartitionUnassigned(),d.prototype.iSetImplicitPartition.call(this,c),this.notifyPartitionAssigned())};Object.defineProperty(a.prototype,"scene",{set:function(c){c!=this._pScene&&
(this._pScene&&this._pScene.iUnregisterEntity(this),c&&c.iRegisterEntity(this),d.prototype.setScene.call(this,c))},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"assetType",{get:function(){return b.library.AssetType.ENTITY},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"pickingCollider",{get:function(){return this._iPickingCollider},set:function(c){this.setPickingCollider(c)},enumerable:!0,configurable:!0});a.prototype.setPickingCollider=function(c){this._iPickingCollider=
c};a.prototype.getEntityPartitionNode=function(){this._partitionNode||(this._partitionNode=this.pCreateEntityPartitionNode());return this._partitionNode};a.prototype.isIntersectingRay=function(c,a){var d=this.inverseSceneTransform.transformVector(c),h=this.inverseSceneTransform.deltaTransformVector(a);this._iPickingCollisionVO.localNormal||(this._iPickingCollisionVO.localNormal=new b.geom.Vector3D);var f=this._pBounds.rayIntersection(d,h,this._iPickingCollisionVO.localNormal);if(0>f)return!1;this._iPickingCollisionVO.rayEntryDistance=
f;this._iPickingCollisionVO.localRayPosition=d;this._iPickingCollisionVO.localRayDirection=h;this._iPickingCollisionVO.rayPosition=c;this._iPickingCollisionVO.rayDirection=a;this._iPickingCollisionVO.rayOriginIsInsideBounds=0==f;return!0};a.prototype.pCreateEntityPartitionNode=function(){throw new b.errors.AbstractMethodError;};a.prototype.pGetDefaultBoundingVolume=function(){return new b.bounds.AxisAlignedBoundingBox};a.prototype.pUpdateBounds=function(){throw new b.errors.AbstractMethodError;};
a.prototype.pInvalidateSceneTransform=function(){this._pIgnoreTransform||(d.prototype.pInvalidateSceneTransform.call(this),this._worldBoundsInvalid=!0,this.notifySceneBoundsInvalid())};a.prototype.pInvalidateBounds=function(){this._worldBoundsInvalid=this._pBoundsInvalid=!0;this.notifySceneBoundsInvalid()};a.prototype.pUpdateMouseChildren=function(){if(this._pParent&&!this.pickingCollider&&this._pParent instanceof b.entities.Entity){var c=this._pParent.pickingCollider;c&&(this.pickingCollider=c)}d.prototype.pUpdateMouseChildren.call(this)};
a.prototype.notifySceneBoundsInvalid=function(){this._pScene&&this._pScene.iInvalidateEntityBounds(this)};a.prototype.notifyPartitionAssigned=function(){this._pScene&&this._pScene.iRegisterPartition(this)};a.prototype.notifyPartitionUnassigned=function(){this._pScene&&this._pScene.iUnregisterPartition(this)};a.prototype.addBounds=function(){this._boundsIsShown||(this._boundsIsShown=!0,this.addChild(this._pBounds.boundingRenderable))};a.prototype.removeBounds=function(){this._boundsIsShown&&(this._boundsIsShown=
!1,this.removeChild(this._pBounds.boundingRenderable),this._pBounds.disposeRenderable())};a.prototype.iInternalUpdate=function(){this._iController&&this._iController.update()};return a}(b.containers.ObjectContainer3D);g.Entity=e})(b.entities||(b.entities={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c){"undefined"===typeof c&&(c=null);d.call(this);this._viewProjection=new b.geom.Matrix3D;this._frustumPlanesDirty=this._viewProjectionDirty=!0;this._lens=c||new b.cameras.PerspectiveLens;this._lens.addEventListener(b.events.LensEvent.MATRIX_CHANGED,this.onLensMatrixChanged,this);this._frustumPlanes=[];for(c=0;6>c;++c)this._frustumPlanes[c]=new b.math.Plane3D;this.z=-1E3}__extends(a,d);a.prototype.pGetDefaultBoundingVolume=function(){return new b.bounds.NullBounds};
Object.defineProperty(a.prototype,"assetType",{get:function(){return b.library.AssetType.CAMERA},enumerable:!0,configurable:!0});a.prototype.onLensMatrixChanged=function(c){this._frustumPlanesDirty=this._viewProjectionDirty=!0;this.dispatchEvent(c)};Object.defineProperty(a.prototype,"frustumPlanes",{get:function(){this._frustumPlanesDirty&&this.updateFrustum();return this._frustumPlanes},enumerable:!0,configurable:!0});a.prototype.updateFrustum=function(){var c,a,b,d,f,l,g,e,m,n,p,r,t,v,x,u,y,z,B,
A;c=Array(16);var C;this.viewProjection.copyRawDataTo(c);d=c[0];f=c[4];l=c[8];g=c[12];e=c[1];m=c[5];n=c[9];p=c[13];r=c[2];t=c[6];v=c[10];x=c[14];u=c[3];y=c[7];z=c[11];B=c[15];A=this._frustumPlanes[0];c=u+d;a=y+f;b=z+l;C=1/Math.sqrt(c*c+a*a+b*b);A.a=c*C;A.b=a*C;A.c=b*C;A.d=-(B+g)*C;A=this._frustumPlanes[1];c=u-d;a=y-f;b=z-l;C=1/Math.sqrt(c*c+a*a+b*b);A.a=c*C;A.b=a*C;A.c=b*C;A.d=(g-B)*C;A=this._frustumPlanes[2];c=u+e;a=y+m;b=z+n;C=1/Math.sqrt(c*c+a*a+b*b);A.a=c*C;A.b=a*C;A.c=b*C;A.d=-(B+p)*C;A=this._frustumPlanes[3];
c=u-e;a=y-m;b=z-n;C=1/Math.sqrt(c*c+a*a+b*b);A.a=c*C;A.b=a*C;A.c=b*C;A.d=(p-B)*C;A=this._frustumPlanes[4];c=r;a=t;b=v;C=1/Math.sqrt(c*c+a*a+b*b);A.a=c*C;A.b=a*C;A.c=b*C;A.d=-x*C;A=this._frustumPlanes[5];c=u-r;a=y-t;b=z-v;C=1/Math.sqrt(c*c+a*a+b*b);A.a=c*C;A.b=a*C;A.c=b*C;A.d=(x-B)*C;this._frustumPlanesDirty=!1};a.prototype.pInvalidateSceneTransform=function(){d.prototype.pInvalidateSceneTransform.call(this);this._frustumPlanesDirty=this._viewProjectionDirty=!0};a.prototype.pUpdateBounds=function(){this._pBounds.nullify();
this._pBoundsInvalid=!1};a.prototype.pCreateEntityPartitionNode=function(){return new b.partition.CameraNode(this)};Object.defineProperty(a.prototype,"lens",{get:function(){return this._lens},set:function(c){if(this._lens!=c){if(!c)throw Error("Lens cannot be null!");this._lens.removeEventListener(b.events.LensEvent.MATRIX_CHANGED,this.onLensMatrixChanged,this);this._lens=c;this._lens.addEventListener(b.events.LensEvent.MATRIX_CHANGED,this.onLensMatrixChanged,this);this.dispatchEvent(new b.events.CameraEvent(b.events.CameraEvent.LENS_CHANGED,
this))}},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"viewProjection",{get:function(){this._viewProjectionDirty&&(this._viewProjection.copyFrom(this.inverseSceneTransform),this._viewProjection.append(this._lens.matrix),this._viewProjectionDirty=!1);return this._viewProjection},enumerable:!0,configurable:!0});a.prototype.getRay=function(c,a,b){return this.sceneTransform.deltaTransformVector(this._lens.unproject(c,a,b))};a.prototype.project=function(c){return this._lens.project(this.inverseSceneTransform.transformVector(c))};
a.prototype.unproject=function(c,a,b){return this.sceneTransform.transformVector(this._lens.unproject(c,a,b))};return a}(b.entities.Entity);g.Camera3D=e})(b.cameras||(b.cameras={}))})(away||(away={}));
(function(b){(function(g){var e=function(c){function k(){c.call(this);this.LIMIT=196605;this._subSetCount=this._indexSegments=0;this._subSets=[];this.addSubSet();this._pSegments={};this.material=new b.materials.SegmentMaterial}__extends(k,c);k.prototype.addSegment=function(c){c.iSegmentsBase=this;this._hasData=!0;var a=this._subSets.length-1,b=this._subSets[a];b.vertices.length+44>this.LIMIT&&(b=this.addSubSet(),a++);c.iIndex=b.vertices.length;c.iSubSetIndex=a;this.iUpdateSegment(c);var k=b.lineCount<<
2;b.indices.push(k,k+1,k+2,k+3,k+2,k+1);b.numVertices=b.vertices.length/11;b.numIndices=b.indices.length;b.lineCount++;b=new d;b.index=k;b.subSetIndex=a;b.segment=c;this._pSegments[this._indexSegments]=b;this._indexSegments++};k.prototype.removeSegmentByIndex=function(c,a){"undefined"===typeof a&&(a=!1);var b;if(!(c>=this._indexSegments)&&this._pSegments[c]){b=this._pSegments[c];var k;if(this._subSets[b.subSetIndex]){var d=b.subSetIndex;k=this._subSets[b.subSetIndex];b=b.segment;for(var g=k.indices,
e=6*c;e<g.length;++e)g[e]-=4;k.indices.splice(6*c,6);k.vertices.splice(44*c,44);k.numVertices=k.vertices.length/11;k.numIndices=g.length;k.vertexBufferDirty=!0;k.indexBufferDirty=!0;k.lineCount--;a?b.dispose():(b.iIndex=-1,b.iSegmentsBase=null);0==k.lineCount&&(0==d?this._hasData=!1:(k.dispose(),this._subSets[d]=null,this._subSets.splice(d,1)));this.reOrderIndices(d,c);this._pSegments[this._indexSegments]=null;this._indexSegments--}}};k.prototype.removeSegment=function(c,a){-1!=c.iIndex&&this.removeSegmentByIndex(c.iIndex/
44)};k.prototype.removeAllSegments=function(){for(var c,a=0;a<this._subSetCount;++a)c=this._subSets[a],c.vertices=null,c.indices=null,c.vertexBuffer&&c.vertexBuffer.dispose(),c.indexBuffer&&c.indexBuffer.dispose();for(var b in this._pSegments)b=null;this._pSegments=null;this._subSetCount=0;this._activeSubSet=null;this._indexSegments=0;this._subSets=[];this._pSegments={};this.addSubSet();this._hasData=!1};k.prototype.getSegment=function(c){return c>this._indexSegments-1?null:this._pSegments[c].segment};
Object.defineProperty(k.prototype,"segmentCount",{get:function(){return this._indexSegments},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"iSubSetCount",{get:function(){return this._subSetCount},enumerable:!0,configurable:!0});k.prototype.iUpdateSegment=function(c){var a=c._pStart,b=c._pEnd,k=a.x,d=a.y,a=a.z,g=b.x,e=b.y,b=b.z,n=c._pStartR,p=c._pStartG,r=c._pStartB,t=c._pEndR,v=c._pEndG,x=c._pEndB,u=c.iIndex,y=c.thickness;c=this._subSets[c.iSubSetIndex];var z=c.vertices;z[u++]=
k;z[u++]=d;z[u++]=a;z[u++]=g;z[u++]=e;z[u++]=b;z[u++]=y;z[u++]=n;z[u++]=p;z[u++]=r;z[u++]=1;z[u++]=g;z[u++]=e;z[u++]=b;z[u++]=k;z[u++]=d;z[u++]=a;z[u++]=-y;z[u++]=t;z[u++]=v;z[u++]=x;z[u++]=1;z[u++]=k;z[u++]=d;z[u++]=a;z[u++]=g;z[u++]=e;z[u++]=b;z[u++]=-y;z[u++]=n;z[u++]=p;z[u++]=r;z[u++]=1;z[u++]=g;z[u++]=e;z[u++]=b;z[u++]=k;z[u++]=d;z[u++]=a;z[u++]=y;z[u++]=t;z[u++]=v;z[u++]=x;z[u++]=1;this._pBoundsInvalid=c.vertexBufferDirty=!0};Object.defineProperty(k.prototype,"hasData",{get:function(){return this._hasData},
enumerable:!0,configurable:!0});k.prototype.getIndexBuffer=function(c){if(this._activeSubSet.indexContext3D!=c.context3D||this._activeSubSet.indexBufferDirty)this._activeSubSet.indexBuffer=c._iContext3D.createIndexBuffer(this._activeSubSet.numIndices),this._activeSubSet.indexBuffer.uploadFromArray(this._activeSubSet.indices,0,this._activeSubSet.numIndices),this._activeSubSet.indexBufferDirty=!1,this._activeSubSet.indexContext3D=c.context3D;return this._activeSubSet.indexBuffer};k.prototype.activateVertexBuffer=
function(c,a){var k=this._subSets[c];this._activeSubSet=k;this._numIndices=k.numIndices;var d=k.vertexBuffer;if(k.vertexContext3D!=a.context3D||k.vertexBufferDirty)k.vertexBuffer=a._iContext3D.createVertexBuffer(k.numVertices,11),k.vertexBuffer.uploadFromArray(k.vertices,0,k.numVertices),k.vertexBufferDirty=!1,k.vertexContext3D=a.context3D;k=a._iContext3D;k.setVertexBufferAt(0,d,0,b.display3D.Context3DVertexBufferFormat.FLOAT_3);k.setVertexBufferAt(1,d,3,b.display3D.Context3DVertexBufferFormat.FLOAT_3);
k.setVertexBufferAt(2,d,6,b.display3D.Context3DVertexBufferFormat.FLOAT_1);k.setVertexBufferAt(3,d,7,b.display3D.Context3DVertexBufferFormat.FLOAT_4)};k.prototype.activateUVBuffer=function(c,a){};k.prototype.activateVertexNormalBuffer=function(c,a){};k.prototype.activateVertexTangentBuffer=function(c,a){};k.prototype.activateSecondaryUVBuffer=function(c,a){};k.prototype.reOrderIndices=function(c,a){for(var b,k=a;k<this._indexSegments-1;++k)b=this._pSegments[k+1],b.index=k,b.subSetIndex==c&&(b.segment.iIndex-=
44),this._pSegments[k]=b};k.prototype.addSubSet=function(){var c=new a;this._subSets.push(c);c.vertices=[];c.numVertices=0;c.indices=[];c.numIndices=0;c.vertexBufferDirty=!0;c.indexBufferDirty=!0;c.lineCount=0;this._subSetCount++;return c};k.prototype.dispose=function(){c.prototype.dispose.call(this);this.removeAllSegments();this._material=this._pSegments=null;var a=this._subSets[0];a.vertices=null;this._subSets=a.indices=null};Object.defineProperty(k.prototype,"mouseEnabled",{get:function(){return!1},
enumerable:!0,configurable:!0});k.prototype.pGetDefaultBoundingVolume=function(){return new b.bounds.BoundingSphere};k.prototype.pUpdateBounds=function(){for(var c,a,b,k=Infinity,d=Infinity,g=Infinity,e=-Infinity,n=-Infinity,p=-Infinity,r,t=0;t<this._subSetCount;++t)if(c=this._subSets[t],b=0,r=c.vertices,c=r.length,0!=c)for(;b<c;)a=r[b++],a<k?k=a:a>e&&(e=a),a=r[b++],a<d?d=a:a>n&&(n=a),a=r[b++],a<g?g=a:a>p&&(p=a),b+=8;Infinity!=k?this._pBounds.fromExtremes(k,d,g,e,n,p):this._pBounds.fromExtremes(-0.5,
-0.5,-0.5,0.5,0.5,0.5);this._pBoundsInvalid=!1};k.prototype.pCreateEntityPartitionNode=function(){return new b.partition.RenderableNode(this)};Object.defineProperty(k.prototype,"numTriangles",{get:function(){return this._numIndices/3},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"sourceEntity",{get:function(){return this},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"castsShadows",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,
"material",{get:function(){return this._material},set:function(c){c!=this._material&&(this._material&&this._material.iRemoveOwner(this),(this._material=c)&&this._material.iAddOwner(this))},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"animator",{get:function(){return this._animator},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"uvTransform",{get:function(){return null},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"vertexData",{get:function(){return null},
enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"indexData",{get:function(){return null},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"UVData",{get:function(){return null},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"numVertices",{get:function(){return null},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"vertexStride",{get:function(){return 11},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"vertexNormalData",
{get:function(){return null},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"vertexTangentData",{get:function(){return null},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"vertexOffset",{get:function(){return 0},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"vertexNormalOffset",{get:function(){return 0},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"vertexTangentOffset",{get:function(){return 0},enumerable:!0,configurable:!0});
Object.defineProperty(k.prototype,"assetType",{get:function(){return b.library.AssetType.SEGMENT_SET},enumerable:!0,configurable:!0});k.prototype.getRenderSceneTransform=function(c){return this._pSceneTransform};return k}(b.entities.Entity);g.SegmentSet=e;var d=function(){return function(){}}(),a=function(){function c(){}c.prototype.dispose=function(){this.vertices=null;this.vertexBuffer&&this.vertexBuffer.dispose();this.indexBuffer&&this.indexBuffer.dispose()};return c}()})(b.entities||(b.entities=
{}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a){"undefined"===typeof a&&(a=null);d.call(this);this._shareAnimationGeometry=this._castsShadows=!0;this._subMeshes=[];this.geometry=null==c?new b.base.Geometry:c;this.material=null==a?b.materials.DefaultMaterialManager.getDefaultMaterial(this):a}__extends(a,d);a.prototype.bakeTransformations=function(){this.geometry.applyTransformation(this.transform);this.transform.identity()};Object.defineProperty(a.prototype,"assetType",{get:function(){return b.library.AssetType.MESH},
enumerable:!0,configurable:!0});a.prototype.onGeometryBoundsInvalid=function(c){this.pInvalidateBounds()};Object.defineProperty(a.prototype,"castsShadows",{get:function(){return this._castsShadows},set:function(c){this._castsShadows=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"animator",{get:function(){return this._animator},set:function(c){b.Debug.throwPIR("Mesh","set animator","Partial Implementation")},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"geometry",
{get:function(){return this._geometry},set:function(c){var a;if(this._geometry){this._geometry.removeEventListener(b.events.GeometryEvent.BOUNDS_INVALID,this.onGeometryBoundsInvalid,this);this._geometry.removeEventListener(b.events.GeometryEvent.SUB_GEOMETRY_ADDED,this.onSubGeometryAdded,this);this._geometry.removeEventListener(b.events.GeometryEvent.SUB_GEOMETRY_REMOVED,this.onSubGeometryRemoved,this);for(a=0;a<this._subMeshes.length;++a)this._subMeshes[a].dispose();this._subMeshes.length=0}if(this._geometry=
c)for(this._geometry.addEventListener(b.events.GeometryEvent.BOUNDS_INVALID,this.onGeometryBoundsInvalid,this),this._geometry.addEventListener(b.events.GeometryEvent.SUB_GEOMETRY_ADDED,this.onSubGeometryAdded,this),this._geometry.addEventListener(b.events.GeometryEvent.SUB_GEOMETRY_REMOVED,this.onSubGeometryRemoved,this),c=this._geometry.subGeometries,a=0;a<c.length;++a)this.addSubMesh(c[a]);this._material&&(this._material.iRemoveOwner(this),this._material.iAddOwner(this))},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"material",{get:function(){return this._material},set:function(c){c!=this._material&&(this._material&&this._material.iRemoveOwner(this),(this._material=c)&&this._material.iAddOwner(this))},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"subMeshes",{get:function(){this._geometry.iValidate();return this._subMeshes},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"shareAnimationGeometry",{get:function(){return this._shareAnimationGeometry},
set:function(c){this._shareAnimationGeometry=c},enumerable:!0,configurable:!0});a.prototype.clearAnimationGeometry=function(){b.Debug.throwPIR("away.entities.Mesh","away.entities.Mesh","Missing Dependency: IAnimator")};a.prototype.dispose=function(){d.prototype.dispose.call(this);this.geometry=this.material=null};a.prototype.disposeWithAnimatorAndChildren=function(){this.disposeWithChildren();b.Debug.throwPIR("away.entities.Mesh","away.entities.Mesh","Missing Dependency: IAnimator")};a.prototype.clone=
function(){var c=new b.entities.Mesh(this._geometry,this._material);c.transform=this.transform;c.pivotPoint=this.pivotPoint;c.partition=this.partition;c.bounds=this._pBounds.clone();c.name=this.name;c.castsShadows=this.castsShadows;c.shareAnimationGeometry=this.shareAnimationGeometry;c.mouseEnabled=this.mouseEnabled;c.mouseChildren=this.mouseChildren;c.extra=this.extra;for(var a=this._subMeshes.length,d=0;d<a;++d)c._subMeshes[d].material=this._subMeshes[d].material;for(var a=this.numChildren,h,d=
0;d<a;++d)h=this.getChildAt(d).clone(),c.addChild(h);return c};a.prototype.pUpdateBounds=function(){this._pBounds.fromGeometry(this._geometry);this._pBoundsInvalid=!1};a.prototype.pCreateEntityPartitionNode=function(){return new b.partition.MeshNode(this)};a.prototype.onSubGeometryAdded=function(c){this.addSubMesh(c.subGeometry)};a.prototype.onSubGeometryRemoved=function(c){var a=c.subGeometry,b=this._subMeshes.length,d;for(d=0;d<b;++d)if(c=this._subMeshes[d],c.subGeometry==a){c.dispose();this._subMeshes.splice(d,
1);break}for(--b;d<b;++d)this._subMeshes[d]._iIndex=d};a.prototype.addSubMesh=function(c){c=new b.base.SubMesh(c,this,null);var a=this._subMeshes.length;c._iIndex=a;this._subMeshes[a]=c;this.pInvalidateBounds()};a.prototype.getSubMeshForSubGeometry=function(c){return this._subMeshes[this._geometry.subGeometries.indexOf(c)]};a.prototype.iCollidesBefore=function(c,a){this._iPickingCollider.setLocalRay(this._iPickingCollisionVO.localRayPosition,this._iPickingCollisionVO.localRayDirection);this._iPickingCollisionVO.renderable=
null;for(var b=this._subMeshes.length,d=0;d<b;++d){var f=this._subMeshes[d];if(this._iPickingCollider.testSubMeshCollision(f,this._iPickingCollisionVO,c)&&(c=this._iPickingCollisionVO.rayEntryDistance,this._iPickingCollisionVO.renderable=f,!a))return!0}return null!=this._iPickingCollisionVO.renderable};return a}(b.entities.Entity);g.Mesh=e})(b.entities||(b.entities={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,k,q){d.call(this);this._shadowCaster=!1;this.material=c;this._width=k;this._height=q;this._spriteMatrix=new b.geom.Matrix3D;a._geometry||(a._geometry=new b.base.SubGeometry,a._geometry.updateVertexData([-0.5,0.5,0,0.5,0.5,0,0.5,-0.5,0,-0.5,-0.5,0]),a._geometry.updateUVData([0,0,1,0,1,1,0,1]),a._geometry.updateIndexData([0,1,2,0,2,3]),a._geometry.updateVertexTangentData([1,0,0,1,0,0,1,0,0,1,0,0]),a._geometry.updateVertexNormalData([0,0,-1,0,
0,-1,0,0,-1,0,0,-1]))}__extends(a,d);Object.defineProperty(a.prototype,"pickingCollider",{set:function(c){d.prototype.setPickingCollider.call(this,c);c&&(this._pickingSubMesh=new b.base.SubMesh(a._geometry,null),this._pickingTransform=new b.geom.Matrix3D)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return this._width},set:function(c){this._width!=c&&(this._width=c,this.iInvalidateTransform())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"height",{get:function(){return this._height},set:function(c){this._height!=c&&(this._height=c,this.iInvalidateTransform())},enumerable:!0,configurable:!0});a.prototype.activateVertexBuffer=function(c,b){a._geometry.activateVertexBuffer(c,b)};a.prototype.activateUVBuffer=function(c,b){a._geometry.activateUVBuffer(c,b)};a.prototype.activateSecondaryUVBuffer=function(c,b){a._geometry.activateSecondaryUVBuffer(c,b)};a.prototype.activateVertexNormalBuffer=function(c,b){a._geometry.activateVertexNormalBuffer(c,
b)};a.prototype.activateVertexTangentBuffer=function(c,b){a._geometry.activateVertexTangentBuffer(c,b)};a.prototype.getIndexBuffer=function(c){return a._geometry.getIndexBuffer(c)};Object.defineProperty(a.prototype,"numTriangles",{get:function(){return 2},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sourceEntity",{get:function(){return this},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"material",{get:function(){return this._material},set:function(c){c!=
this._material&&(this._material&&this._material.iRemoveOwner(this),(this._material=c)&&this._material.iAddOwner(this))},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"animator",{get:function(){return this._animator},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"castsShadows",{get:function(){return this._shadowCaster},enumerable:!0,configurable:!0});a.prototype.pGetDefaultBoundingVolume=function(){return new b.bounds.AxisAlignedBoundingBox};a.prototype.pUpdateBounds=
function(){this._pBounds.fromExtremes(-0.5*this._pScaleX,-0.5*this._pScaleY,-0.5*this._pScaleZ,0.5*this._pScaleX,0.5*this._pScaleY,0.5*this._pScaleZ);this._pBoundsInvalid=!1};a.prototype.pCreateEntityPartitionNode=function(){return new b.partition.RenderableNode(this)};a.prototype.pUpdateTransform=function(){d.prototype.pUpdateTransform.call(this);this._pTransform.prependScale(this._width,this._height,Math.max(this._width,this._height))};Object.defineProperty(a.prototype,"uvTransform",{get:function(){return null},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexData",{get:function(){return a._geometry.vertexData},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"indexData",{get:function(){return a._geometry.indexData},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"UVData",{get:function(){return a._geometry.UVData},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"numVertices",{get:function(){return a._geometry.numVertices},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"vertexStride",{get:function(){return a._geometry.vertexStride},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexNormalData",{get:function(){return a._geometry.vertexNormalData},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexTangentData",{get:function(){return a._geometry.vertexTangentData},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexOffset",{get:function(){return a._geometry.vertexOffset},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexNormalOffset",{get:function(){return a._geometry.vertexNormalOffset},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexTangentOffset",{get:function(){return a._geometry.vertexTangentOffset},enumerable:!0,configurable:!0});a.prototype.iCollidesBefore=function(c,a){var d=this._camera.inverseSceneTransform.clone();d.transpose();var h=b.math.Matrix3DUtils.RAW_DATA_CONTAINER;d.copyRawDataTo(h);h[3]=0;h[7]=0;
h[11]=0;h[12]=0;h[13]=0;h[14]=0;this._pickingTransform.copyRawDataFrom(h);this._pickingTransform.prependScale(this._width,this._height,Math.max(this._width,this._height));this._pickingTransform.appendTranslation(this.scenePosition.x,this.scenePosition.y,this.scenePosition.z);this._pickingTransform.invert();d=this._pickingTransform.transformVector(this._iPickingCollisionVO.rayPosition);h=this._pickingTransform.deltaTransformVector(this._iPickingCollisionVO.rayDirection);this._iPickingCollider.setLocalRay(d,
h);this._iPickingCollisionVO.renderable=null;this._iPickingCollider.testSubMeshCollision(this._pickingSubMesh,this._iPickingCollisionVO,c)&&(this._iPickingCollisionVO.renderable=this._pickingSubMesh);return null!=this._iPickingCollisionVO.renderable};a.prototype.getRenderSceneTransform=function(c){c=c.sceneTransform.decompose();var a=c[2];c[0]=this.scenePosition;a.x=this._width*this._pScaleX;a.y=this._height*this._pScaleY;this._spriteMatrix.recompose(c);return this._spriteMatrix};return a}(b.entities.Entity);
g.Sprite3D=e})(b.entities||(b.entities={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(a,c,b){"undefined"===typeof b&&(b=null);this._uvRotation=this._iIndex=0;this._scaleV=this._scaleU=1;this._offsetV=this._offsetU=0;this._parentMesh=c;this._subGeometry=a;this.material=b}Object.defineProperty(d.prototype,"shaderPickingDetails",{get:function(){return this.sourceEntity.shaderPickingDetails},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"offsetU",{get:function(){return this._offsetU},set:function(a){a!=this._offsetU&&
(this._offsetU=a,this._uvTransformDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"offsetV",{get:function(){return this._offsetV},set:function(a){a!=this._offsetV&&(this._offsetV=a,this._uvTransformDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"scaleU",{get:function(){return this._scaleU},set:function(a){a!=this._scaleU&&(this._scaleU=a,this._uvTransformDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"scaleV",
{get:function(){return this._scaleV},set:function(a){a!=this._scaleV&&(this._scaleV=a,this._uvTransformDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"uvRotation",{get:function(){return this._uvRotation},set:function(a){a!=this._uvRotation&&(this._uvRotation=a,this._uvTransformDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"sourceEntity",{get:function(){return this._parentMesh},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"subGeometry",{get:function(){return this._subGeometry},set:function(a){this._subGeometry=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"material",{get:function(){return this._iMaterial||this._parentMesh.material},set:function(a){this._iMaterial&&this._iMaterial.iRemoveOwner(this);(this._iMaterial=a)&&this._iMaterial.iAddOwner(this)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"sceneTransform",{get:function(){return this._parentMesh.sceneTransform},enumerable:!0,
configurable:!0});Object.defineProperty(d.prototype,"inverseSceneTransform",{get:function(){return this._parentMesh.inverseSceneTransform},enumerable:!0,configurable:!0});d.prototype.activateVertexBuffer=function(a,c){this._subGeometry.activateVertexBuffer(a,c)};d.prototype.activateVertexNormalBuffer=function(a,c){this._subGeometry.activateVertexNormalBuffer(a,c)};d.prototype.activateVertexTangentBuffer=function(a,c){this._subGeometry.activateVertexTangentBuffer(a,c)};d.prototype.activateUVBuffer=
function(a,c){this._subGeometry.activateUVBuffer(a,c)};d.prototype.activateSecondaryUVBuffer=function(a,c){this._subGeometry.activateSecondaryUVBuffer(a,c)};d.prototype.getIndexBuffer=function(a){return this._subGeometry.getIndexBuffer(a)};Object.defineProperty(d.prototype,"numTriangles",{get:function(){return this._subGeometry.numTriangles},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"animator",{get:function(){return this._parentMesh.animator},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"mouseEnabled",{get:function(){return this._parentMesh.mouseEnabled||this._parentMesh._iAncestorsAllowMouseEnabled},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"castsShadows",{get:function(){return this._parentMesh.castsShadows},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"iParentMesh",{get:function(){return this._parentMesh},set:function(a){this._parentMesh=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"uvTransform",{get:function(){this._uvTransformDirty&&this.updateUVTransform();return this._uvTransform},enumerable:!0,configurable:!0});d.prototype.updateUVTransform=function(){null==this._uvTransform&&(this._uvTransform=new b.geom.Matrix);this._uvTransform.identity();0!=this._uvRotation&&this._uvTransform.rotate(this._uvRotation);1==this._scaleU&&1==this._scaleV||this._uvTransform.scale(this._scaleU,this._scaleV);this._uvTransform.translate(this._offsetU,this._offsetV);this._uvTransformDirty=!1};
d.prototype.dispose=function(){this.material=null};Object.defineProperty(d.prototype,"vertexData",{get:function(){return this._subGeometry.vertexData},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"indexData",{get:function(){return this._subGeometry.indexData},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"UVData",{get:function(){return this._subGeometry.UVData},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"bounds",{get:function(){return this._parentMesh.getBounds()},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"visible",{get:function(){return this._parentMesh.visible},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"numVertices",{get:function(){return this._subGeometry.numVertices},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"vertexStride",{get:function(){return this._subGeometry.vertexStride},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"UVStride",{get:function(){return this._subGeometry.UVStride},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"vertexNormalData",{get:function(){return this._subGeometry.vertexNormalData},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"vertexTangentData",{get:function(){return this._subGeometry.vertexTangentData},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"UVOffset",{get:function(){return this._subGeometry.UVOffset},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"vertexOffset",{get:function(){return this._subGeometry.vertexOffset},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"vertexNormalOffset",{get:function(){return this._subGeometry.vertexNormalOffset},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"vertexTangentOffset",{get:function(){return this._subGeometry.vertexTangentOffset},enumerable:!0,configurable:!0});d.prototype.getRenderSceneTransform=function(a){return this._parentMesh.sceneTransform};return d}();g.SubMesh=e})(b.base||(b.base={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a){"undefined"===typeof c&&(c=16777215);"undefined"===typeof a&&(a=1);d.call(this);this._geomDirty=!0;0>=a&&(a=1);this._color=c;this._thickness=a;this.mouseEnabled=this.mouseChildren=!1}__extends(a,d);Object.defineProperty(a.prototype,"color",{get:function(){return this._color},set:function(c){this._color=c;for(var a in this._pSegments)a.segment.startColor=a.segment.endColor=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"thickness",{get:function(){return this._thickness},set:function(c){this._thickness=c;for(var a in this._pSegments)a.segment.thickness=a.segment.thickness=c},enumerable:!0,configurable:!0});a.prototype.removeAllSegments=function(){d.prototype.removeAllSegments.call(this)};a.prototype.getBounds=function(){this._geomDirty&&this.updateGeometry();return d.prototype.getBounds.call(this)};a.prototype.pBuildGeometry=function(){throw new b.errors.AbstractMethodError;};a.prototype.pInvalidateGeometry=function(){this._geomDirty=
!0;this.pInvalidateBounds()};a.prototype.updateGeometry=function(){this.pBuildGeometry();this._geomDirty=!1};a.prototype.pUpdateOrAddSegment=function(c,a,d){var h,f;null!=(c=this.getSegment(c))?(h=c.start,f=c.end,h.x=a.x,h.y=a.y,h.z=a.z,f.x=d.x,f.y=d.y,f.z=d.z,c.updateSegment(h,f,null,this._color,this._color,this._thickness)):this.addSegment(new b.primitives.LineSegment(a.clone(),d.clone(),this._color,this._color,this._thickness))};a.prototype.pUpdateMouseChildren=function(){this._iAncestorsAllowMouseEnabled=
!1};return a}(b.entities.SegmentSet);g.WireframePrimitiveBase=e})(b.primitives||(b.primitives={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a,b,h,f){"undefined"===typeof c&&(c=50);"undefined"===typeof a&&(a=16);"undefined"===typeof b&&(b=12);"undefined"===typeof h&&(h=16777215);"undefined"===typeof f&&(f=1);d.call(this,h,f);this._radius=c;this._segmentsW=a;this._segmentsH=b}__extends(a,d);a.prototype.pBuildGeometry=function(){var c=[],a=new b.geom.Vector3D,d=new b.geom.Vector3D,h,f,l=0,g=0;for(f=0;f<=this._segmentsH;++f){h=Math.PI*f/this._segmentsH;var e=-this._radius*Math.cos(h),
m=this._radius*Math.sin(h);for(h=0;h<=this._segmentsW;++h){var n=2*Math.PI*h/this._segmentsW,p=m*Math.cos(n),n=m*Math.sin(n);c[l++]=p;c[l++]=-e;c[l++]=n}}for(f=1;f<=this._segmentsH;++f)for(h=1;h<=this._segmentsW;++h)l=3*((this._segmentsW+1)*f+h),e=3*((this._segmentsW+1)*f+h-1),m=3*((this._segmentsW+1)*(f-1)+h-1),p=3*((this._segmentsW+1)*(f-1)+h),f==this._segmentsH?(a.x=c[m],a.y=c[m+1],a.z=c[m+2],d.x=c[p],d.y=c[p+1],d.z=c[p+2],this.pUpdateOrAddSegment(g++,a,d),a.x=c[l],a.y=c[l+1],a.z=c[l+2]):1==f?
(d.x=c[e],d.y=c[e+1],d.z=c[e+2],a.x=c[m],a.y=c[m+1],a.z=c[m+2]):(d.x=c[e],d.y=c[e+1],d.z=c[e+2],a.x=c[m],a.y=c[m+1],a.z=c[m+2],this.pUpdateOrAddSegment(g++,a,d),d.x=c[p],d.y=c[p+1],d.z=c[p+2]),this.pUpdateOrAddSegment(g++,a,d)};return a}(b.primitives.WireframePrimitiveBase);g.WireframeSphere=e})(b.primitives||(b.primitives={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a,b,h,f){"undefined"===typeof c&&(c=100);"undefined"===typeof a&&(a=100);"undefined"===typeof b&&(b=100);"undefined"===typeof h&&(h=16777215);"undefined"===typeof f&&(f=1);d.call(this,h,f);this._width=c;this._height=a;this._depth=b}__extends(a,d);Object.defineProperty(a.prototype,"width",{get:function(){return this._width},set:function(c){this._width=c;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"height",{get:function(){return this._height},set:function(c){if(0>=c)throw Error("Value needs to be greater than 0");this._height=c;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"depth",{get:function(){return this._depth},set:function(c){this._depth=c;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});a.prototype.pBuildGeometry=function(){var c=new b.geom.Vector3D,a=new b.geom.Vector3D,d=0.5*this._width,h=0.5*this._height,f=0.5*this._depth;
c.x=-d;c.y=h;c.z=-f;a.x=-d;a.y=-h;a.z=-f;this.pUpdateOrAddSegment(0,c,a);c.z=f;a.z=f;this.pUpdateOrAddSegment(1,c,a);c.x=d;a.x=d;this.pUpdateOrAddSegment(2,c,a);c.z=-f;a.z=-f;this.pUpdateOrAddSegment(3,c,a);c.x=-d;c.y=-h;c.z=-f;a.x=d;a.y=-h;a.z=-f;this.pUpdateOrAddSegment(4,c,a);c.y=h;a.y=h;this.pUpdateOrAddSegment(5,c,a);c.z=f;a.z=f;this.pUpdateOrAddSegment(6,c,a);c.y=-h;a.y=-h;this.pUpdateOrAddSegment(7,c,a);c.x=-d;c.y=-h;c.z=-f;a.x=-d;a.y=-h;a.z=f;this.pUpdateOrAddSegment(8,c,a);c.y=h;a.y=h;this.pUpdateOrAddSegment(9,
c,a);c.x=d;a.x=d;this.pUpdateOrAddSegment(10,c,a);c.y=-h;a.y=-h;this.pUpdateOrAddSegment(11,c,a)};return a}(b.primitives.WireframePrimitiveBase);g.WireframeCube=e})(b.primitives||(b.primitives={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a,b,h,f,l,e){"undefined"===typeof c&&(c=50);"undefined"===typeof a&&(a=50);"undefined"===typeof b&&(b=100);"undefined"===typeof h&&(h=16);"undefined"===typeof f&&(f=1);"undefined"===typeof l&&(l=16777215);"undefined"===typeof e&&(e=1);d.call(this,l,e);this._topRadius=c;this._bottomRadius=a;this._height=b;this._segmentsW=h;this._segmentsH=f}__extends(a,d);a.prototype.pBuildGeometry=function(){var c,k,d=this._topRadius,h,f=a.TWO_PI/this._segmentsW,
l=0,e,g,m=Array(this._segmentsH+1);for(k=0;k<=this._segmentsH;++k){m[k]=Array(this._segmentsW+1);d=this._topRadius-k/this._segmentsH*(this._topRadius-this._bottomRadius);g=-(this._height/2)+k/this._segmentsH*this._height;var n=null;for(c=0;c<=this._segmentsW;++c){h=c*f;e=d*Math.cos(h);h=d*Math.sin(h);var p;n?(p=new b.geom.Vector3D(e,-g,h),this.pUpdateOrAddSegment(l++,p,n),n=p):n=new b.geom.Vector3D(e,-g,h);0<k&&this.pUpdateOrAddSegment(l++,p,m[k-1][c]);m[k][c]=n}}};Object.defineProperty(a.prototype,
"topRadius",{get:function(){return this._topRadius},set:function(c){this._topRadius=c;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"bottomRadius",{get:function(){return this._bottomRadius},set:function(c){this._bottomRadius=c;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._height},set:function(c){if(0>=this.height)throw Error("Height must be a value greater than zero.");
this._height=c;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});a.TWO_PI=2*Math.PI;return a}(b.primitives.WireframePrimitiveBase);g.WireframeCylinder=e})(b.primitives||(b.primitives={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a,b,h,f,l,e){"undefined"===typeof b&&(b=10);"undefined"===typeof h&&(h=10);"undefined"===typeof f&&(f=16777215);"undefined"===typeof l&&(l=1);"undefined"===typeof e&&(e="yz");d.call(this,f,l);this._width=c;this._height=a;this._segmentsW=b;this._segmentsH=h;this._orientation=e}__extends(a,d);Object.defineProperty(a.prototype,"orientation",{get:function(){return this._orientation},set:function(c){this._orientation=c;this.pInvalidateGeometry()},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return this._width},set:function(c){this._width=c;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._height},set:function(c){if(0>=c)throw Error("Value needs to be greater than 0");this._height=c;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"segmentsW",{get:function(){return this._segmentsW},
set:function(c){this._segmentsW=c;this.removeAllSegments();this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"segmentsH",{get:function(){return this._segmentsH},set:function(c){this._segmentsH=c;this.removeAllSegments();this.pInvalidateGeometry()},enumerable:!0,configurable:!0});a.prototype.pBuildGeometry=function(){var c=new b.geom.Vector3D,k=new b.geom.Vector3D,d=0.5*this._width,h=0.5*this._height,f=0;if(this._orientation==a.ORIENTATION_XY){c.y=h;c.z=
0;k.y=-h;for(h=k.z=0;h<=this._segmentsW;++h)c.x=k.x=(h/this._segmentsW-0.5)*this._width,this.pUpdateOrAddSegment(f++,c,k);c.x=-d;k.x=d;for(d=0;d<=this._segmentsH;++d)c.y=k.y=(d/this._segmentsH-0.5)*this._height,this.pUpdateOrAddSegment(f++,c,k)}else if(this._orientation==a.ORIENTATION_XZ){c.z=h;c.y=0;k.z=-h;for(h=k.y=0;h<=this._segmentsW;++h)c.x=k.x=(h/this._segmentsW-0.5)*this._width,this.pUpdateOrAddSegment(f++,c,k);c.x=-d;k.x=d;for(d=0;d<=this._segmentsH;++d)c.z=k.z=(d/this._segmentsH-0.5)*this._height,
this.pUpdateOrAddSegment(f++,c,k)}else if(this._orientation==a.ORIENTATION_YZ){c.y=h;c.x=0;k.y=-h;for(h=k.x=0;h<=this._segmentsW;++h)c.z=k.z=(h/this._segmentsW-0.5)*this._width,this.pUpdateOrAddSegment(f++,c,k);c.z=d;k.z=-d;for(d=0;d<=this._segmentsH;++d)c.y=k.y=(d/this._segmentsH-0.5)*this._height,this.pUpdateOrAddSegment(f++,c,k)}};a.ORIENTATION_YZ="yz";a.ORIENTATION_XY="xy";a.ORIENTATION_XZ="xz";return a}(b.primitives.WireframePrimitiveBase);g.WireframePlane=e})(b.primitives||(b.primitives={}))})(away||
(away={}));
(function(b){(function(g){var e=function(d){function a(c,a,b,h,f){"undefined"===typeof b&&(b=16777215);"undefined"===typeof h&&(h=1);"undefined"===typeof f&&(f="yz");d.call(this,b,h);this._radius=c;this._sides=a;this._orientation=f}__extends(a,d);Object.defineProperty(a.prototype,"orientation",{get:function(){return this._orientation},set:function(c){this._orientation=c;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"radius",{get:function(){return this._radius},set:function(c){this._radius=
c;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sides",{get:function(){return this._sides},set:function(c){this._sides=c;this.removeAllSegments();this.pInvalidateGeometry()},enumerable:!0,configurable:!0});a.prototype.pBuildGeometry=function(){var c=new b.geom.Vector3D,k=new b.geom.Vector3D,d=0,h;if(this._orientation==a.ORIENTATION_XY)for(c.z=0,h=k.z=0;h<this._sides;++h)c.x=this._radius*Math.cos(2*Math.PI*h/this._sides),c.y=this._radius*Math.sin(2*
Math.PI*h/this._sides),k.x=this._radius*Math.cos(2*Math.PI*(h+1)/this._sides),k.y=this._radius*Math.sin(2*Math.PI*(h+1)/this._sides),this.pUpdateOrAddSegment(d++,c,k);else if(this._orientation==a.ORIENTATION_XZ)for(c.y=0,h=k.y=0;h<this._sides;++h)c.x=this._radius*Math.cos(2*Math.PI*h/this._sides),c.z=this._radius*Math.sin(2*Math.PI*h/this._sides),k.x=this._radius*Math.cos(2*Math.PI*(h+1)/this._sides),k.z=this._radius*Math.sin(2*Math.PI*(h+1)/this._sides),this.pUpdateOrAddSegment(d++,c,k);else if(this._orientation==
a.ORIENTATION_YZ)for(c.x=0,h=k.x=0;h<this._sides;++h)c.z=this._radius*Math.cos(2*Math.PI*h/this._sides),c.y=this._radius*Math.sin(2*Math.PI*h/this._sides),k.z=this._radius*Math.cos(2*Math.PI*(h+1)/this._sides),k.y=this._radius*Math.sin(2*Math.PI*(h+1)/this._sides),this.pUpdateOrAddSegment(d++,c,k)};a.ORIENTATION_YZ="yz";a.ORIENTATION_XY="xy";a.ORIENTATION_XZ="xz";return a}(b.primitives.WireframePrimitiveBase);g.WireframeRegularPolygon=e})(b.primitives||(b.primitives={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a,b,h,f){"undefined"===typeof b&&(b=16777215);"undefined"===typeof h&&(h=1);"undefined"===typeof f&&(f="yz");d.call(this,b,h);this._width=c;this._height=a;this._orientation=f}__extends(a,d);Object.defineProperty(a.prototype,"orientation",{get:function(){return this._orientation},set:function(c){this._orientation=c;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return this._width},
set:function(c){if(0>=c)throw Error("Value needs to be greater than 0");this._width=c;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._height},set:function(c){if(0>=c)throw Error("Value needs to be greater than 0");this._height=c;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});a.prototype.pBuildGeometry=function(){var c,k,d,h,f,l=0.5*this._width;switch(this._orientation){case a.ORIENTATION_XY:c=new b.geom.Vector3D(-l,
l,0);k=new b.geom.Vector3D(l,l,0);d=new b.geom.Vector3D(l,-l,0);h=new b.geom.Vector3D(-l,-l,0);f=new b.geom.Vector3D(0,0,this._height);break;case a.ORIENTATION_XZ:c=new b.geom.Vector3D(-l,0,l);k=new b.geom.Vector3D(l,0,l);d=new b.geom.Vector3D(l,0,-l);h=new b.geom.Vector3D(-l,0,-l);f=new b.geom.Vector3D(0,this._height,0);break;case a.ORIENTATION_YZ:c=new b.geom.Vector3D(0,-l,l),k=new b.geom.Vector3D(0,l,l),d=new b.geom.Vector3D(0,l,-l),h=new b.geom.Vector3D(0,-l,-l),f=new b.geom.Vector3D(this._height,
0,0)}this.pUpdateOrAddSegment(0,c,k);this.pUpdateOrAddSegment(1,k,d);this.pUpdateOrAddSegment(2,d,h);this.pUpdateOrAddSegment(3,h,c);this.pUpdateOrAddSegment(4,c,f);this.pUpdateOrAddSegment(5,k,f);this.pUpdateOrAddSegment(6,d,f);this.pUpdateOrAddSegment(7,h,f)};a.ORIENTATION_YZ="yz";a.ORIENTATION_XY="xy";a.ORIENTATION_XZ="xz";return a}(b.primitives.WireframePrimitiveBase);g.WireframeTetrahedron=e})(b.primitives||(b.primitives={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c){d.call(this);this._uvTransform=new b.geom.Matrix;this._material=new b.materials.SkyBoxMaterial(c);this._material.iAddOwner(this);this._geometry=new b.base.SubGeometry;this.buildGeometry(this._geometry)}__extends(a,d);Object.defineProperty(a.prototype,"animator",{get:function(){return this._animator},enumerable:!0,configurable:!0});a.prototype.pGetDefaultBoundingVolume=function(){return new b.bounds.NullBounds};a.prototype.activateVertexBuffer=
function(c,a){this._geometry.activateVertexBuffer(c,a)};a.prototype.activateUVBuffer=function(c,a){};a.prototype.activateVertexNormalBuffer=function(c,a){};a.prototype.activateVertexTangentBuffer=function(c,a){};a.prototype.activateSecondaryUVBuffer=function(c,a){};a.prototype.getIndexBuffer=function(c){return this._geometry.getIndexBuffer(c)};Object.defineProperty(a.prototype,"numTriangles",{get:function(){return this._geometry.numTriangles},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"sourceEntity",{get:function(){return null},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"material",{get:function(){return this._material},set:function(c){throw new b.errors.AbstractMethodError("Unsupported method!");},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"assetType",{get:function(){return b.library.AssetType.SKYBOX},enumerable:!0,configurable:!0});a.prototype.pInvalidateBounds=function(){};a.prototype.pCreateEntityPartitionNode=function(){return new b.partition.SkyBoxNode(this)};
a.prototype.pUpdateBounds=function(){this._pBoundsInvalid=!1};a.prototype.buildGeometry=function(c){c.updateVertexData([-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1]);c.updateIndexData([0,1,2,2,3,0,6,5,4,4,7,6,2,6,7,7,3,2,4,5,1,1,0,4,4,0,3,3,7,4,2,1,5,5,6,2])};Object.defineProperty(a.prototype,"castsShadows",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"uvTransform",{get:function(){return this._uvTransform},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"vertexData",{get:function(){return this._geometry.vertexData},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"indexData",{get:function(){return this._geometry.indexData},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"UVData",{get:function(){return this._geometry.UVData},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"numVertices",{get:function(){return this._geometry.numVertices},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"vertexStride",{get:function(){return this._geometry.vertexStride},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexNormalData",{get:function(){return this._geometry.vertexNormalData},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexTangentData",{get:function(){return this._geometry.vertexTangentData},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexOffset",{get:function(){return this._geometry.vertexOffset},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexNormalOffset",{get:function(){return this._geometry.vertexNormalOffset},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexTangentOffset",{get:function(){return this._geometry.vertexTangentOffset},enumerable:!0,configurable:!0});a.prototype.getRenderSceneTransform=function(c){return this._pSceneTransform};return a}(b.entities.Entity);g.SkyBox=e})(b.primitives||(b.primitives={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(){this._iNumEntities=this._pNumChildNodes=0;this._pChildNodes=[]}Object.defineProperty(d.prototype,"showDebugBounds",{get:function(){return null!=this._pDebugPrimitive},set:function(a){if(!this._pDebugPrimitive||!0!=a)if(this._pDebugPrimitive||!1!=a){if(a)throw new b.errors.PartialImplementationError;this._pDebugPrimitive.dispose();this._pDebugPrimitive=null;for(var c=0;c<this._pNumChildNodes;++c)this._pChildNodes[c].showDebugBounds=a}},enumerable:!0,
configurable:!0});Object.defineProperty(d.prototype,"parent",{get:function(){return this._iParent},enumerable:!0,configurable:!0});d.prototype.iAddNode=function(a){a._iParent=this;this._iNumEntities+=a._pNumEntities;this._pChildNodes[this._pNumChildNodes++]=a;a.showDebugBounds=null!=this._pDebugPrimitive;var c=a._pNumEntities;a=this;do a._iNumEntities+=c;while(null!=(a=a._iParent))};d.prototype.iRemoveNode=function(a){var c=this._pChildNodes.indexOf(a);this._pChildNodes[c]=this._pChildNodes[--this._pNumChildNodes];
this._pChildNodes.pop();c=a._pNumEntities;a=this;do a._pNumEntities-=c;while(null!=(a=a._iParent))};d.prototype.isInFrustum=function(a,c){return!0};d.prototype.isIntersectingRay=function(a,c){return!0};d.prototype.findPartitionForEntity=function(a){return this};d.prototype.acceptTraverser=function(a){if((0!=this._pNumEntities||this._pDebugPrimitive)&&a.enterNode(this)){for(var c=0;c<this._pNumChildNodes;)this._pChildNodes[c++].acceptTraverser(a);this._pDebugPrimitive&&a.applyRenderable(this._pDebugPrimitive)}};
d.prototype.pCreateDebugBounds=function(){return null};Object.defineProperty(d.prototype,"_pNumEntities",{get:function(){return this._iNumEntities},enumerable:!0,configurable:!0});d.prototype._pUpdateNumEntities=function(a){a-=this._pNumEntities;var c=this;do c._pNumEntities+=a;while(null!=(c=c._iParent))};return d}();g.NodeBase=e})(b.partition||(b.partition={}))})(away||(away={}));
(function(b){(function(b){var e=function(){return function(){}}();b.NullNode=e})(b.partition||(b.partition={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(a){this._updatesMade=!1;this._rootNode=a||new b.partition.NullNode}Object.defineProperty(d.prototype,"showDebugBounds",{get:function(){return this._rootNode.showDebugBounds},set:function(a){this._rootNode.showDebugBounds=a},enumerable:!0,configurable:!0});d.prototype.traverse=function(a){this._updatesMade&&this.updateEntities();++b.traverse.PartitionTraverser._iCollectionMark;this._rootNode.acceptTraverser(a)};d.prototype.iMarkForUpdate=function(a){a=
a.getEntityPartitionNode();for(var c=this._updateQueue;c;){if(a==c)return;c=c._iUpdateQueueNext}a._iUpdateQueueNext=this._updateQueue;this._updateQueue=a;this._updatesMade=!0};d.prototype.iRemoveEntity=function(a){a=a.getEntityPartitionNode();var c;a.removeFromParent();if(a==this._updateQueue)this._updateQueue=a._iUpdateQueueNext;else{for(c=this._updateQueue;c&&c._iUpdateQueueNext!=a;)c=c._iUpdateQueueNext;c&&(c._iUpdateQueueNext=a._iUpdateQueueNext)}a._iUpdateQueueNext=null;this._updateQueue||(this._updatesMade=
!1)};d.prototype.updateEntities=function(){var a=this._updateQueue,c;this._updateQueue=null;this._updatesMade=!1;do c=this._rootNode.findPartitionForEntity(a.entity),a.parent!=c&&(a&&a.removeFromParent(),c.iAddNode(a)),c=a._iUpdateQueueNext,a._iUpdateQueueNext=null,a.entity.iInternalUpdate();while(null!=(a=c))};return d}();g.Partition3D=e})(b.partition||(b.partition={}))})(away||(away={}));
(function(b){(function(b){var e=function(){return function(b){this.entity=b}}();b.PickingCollisionVO=e})(b.pick||(b.pick={}))})(away||(away={}));
(function(b){(function(b){var e=function(b){function a(c){b.call(this);this._entity=c;this._iNumEntities=1}__extends(a,b);Object.defineProperty(a.prototype,"entity",{get:function(){return this._entity},enumerable:!0,configurable:!0});a.prototype.removeFromParent=function(){this._iParent&&this._iParent.iRemoveNode(this);this._iParent=null};a.prototype.isInFrustum=function(c,a){return this._entity._iIsVisible?this._entity.worldBounds.isInFrustum(c,a):!1};a.prototype.acceptTraverser=function(c){c.applyEntity(this._entity)};
a.prototype.isIntersectingRay=function(c,a){return this._entity._iIsVisible?this._entity.isIntersectingRay(c,a):!1};return a}(b.NodeBase);b.EntityNode=e})(b.partition||(b.partition={}))})(away||(away={}));(function(b){(function(g){var e=function(b){function a(c){b.call(this,c)}__extends(a,b);a.prototype.acceptTraverser=function(c){};return a}(b.partition.EntityNode);g.CameraNode=e})(b.partition||(b.partition={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(c){b.call(this,c);this._light=c}__extends(a,b);Object.defineProperty(a.prototype,"light",{get:function(){return this._light},enumerable:!0,configurable:!0});a.prototype.acceptTraverser=function(c){c.enterNode(this)&&(b.prototype.acceptTraverser.call(this,c),c.applyUnknownLight(this._light))};return a}(b.partition.EntityNode);g.LightNode=e})(b.partition||(b.partition={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(c){b.call(this,c);this._light=c}__extends(a,b);Object.defineProperty(a.prototype,"light",{get:function(){return this._light},enumerable:!0,configurable:!0});a.prototype.acceptTraverser=function(c){c.enterNode(this)&&(b.prototype.acceptTraverser.call(this,c),c.applyDirectionalLight(this._light))};return a}(b.partition.EntityNode);g.DirectionalLightNode=e})(b.partition||(b.partition={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(c){b.call(this,c);this._light=c}__extends(a,b);Object.defineProperty(a.prototype,"light",{get:function(){return this._light},enumerable:!0,configurable:!0});a.prototype.acceptTraverser=function(c){c.enterNode(this)&&(b.prototype.acceptTraverser.call(this,c),c.applyPointLight(this._light))};return a}(b.partition.EntityNode);g.PointLightNode=e})(b.partition||(b.partition={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(c){b.call(this,c);this._light=c}__extends(a,b);Object.defineProperty(a.prototype,"light",{get:function(){return this._light},enumerable:!0,configurable:!0});a.prototype.acceptTraverser=function(c){c.enterNode(this)&&(b.prototype.acceptTraverser.call(this,c),c.applyLightProbe(this._light))};return a}(b.partition.EntityNode);g.LightProbeNode=e})(b.partition||(b.partition={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(c){b.call(this,c);this._mesh=c}__extends(a,b);Object.defineProperty(a.prototype,"mesh",{get:function(){return this._mesh},enumerable:!0,configurable:!0});a.prototype.acceptTraverser=function(c){if(c.enterNode(this)){b.prototype.acceptTraverser.call(this,c);for(var a=this._mesh.subMeshes,q=0,h=a.length;q<h;)c.applyRenderable(a[q++])}};return a}(b.partition.EntityNode);g.MeshNode=e})(b.partition||(b.partition={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(c){b.call(this,c);this._skyBox=c}__extends(a,b);a.prototype.acceptTraverser=function(c){c.enterNode(this)&&(b.prototype.acceptTraverser.call(this,c),c.applySkyBox(this._skyBox))};a.prototype.isInFrustum=function(c,a){return!0};return a}(b.partition.EntityNode);g.SkyBoxNode=e})(b.partition||(b.partition={}))})(away||(away={}));
(function(b){(function(b){var e=function(b){function a(c,a){"undefined"===typeof c&&(c="");"undefined"===typeof a&&(a=0);b.call(this,"PartialImplementationError - this function is in development. Required Dependency: "+c,a)}__extends(a,b);return a}(b.Error);b.PartialImplementationError=e})(b.errors||(b.errors={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(){}b.ENTITY="entity";b.SKYBOX="skybox";b.CAMERA="camera";b.SEGMENT_SET="segmentSet";b.MESH="mesh";b.GEOMETRY="geometry";b.SKELETON="skeleton";b.SKELETON_POSE="skeletonPose";b.CONTAINER="container";b.TEXTURE="texture";b.TEXTURE_PROJECTOR="textureProjector";b.MATERIAL="material";b.ANIMATION_SET="animationSet";b.ANIMATION_STATE="animationState";b.ANIMATION_NODE="animationNode";b.ANIMATOR="animator";b.STATE_TRANSITION="stateTransition";b.LIGHT="light";
b.LIGHT_PICKER="lightPicker";b.SHADOW_MAP_METHOD="shadowMapMethod";b.EFFECTS_METHOD="effectsMethod";return b}();b.AssetType=e})(b.library||(b.library={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c){d.call(this);this._canvas=c}__extends(a,d);a.prototype.requestContext=function(c){"undefined"===typeof c&&(c=!1);try{this._context3D=c?new b.display3D.AGLSLContext3D(this._canvas):new b.display3D.Context3D(this._canvas)}catch(a){this.dispatchEvent(new b.events.Event(b.events.Event.ERROR))}this._context3D&&this.dispatchEvent(new b.events.Event(b.events.Event.CONTEXT3D_CREATE))};Object.defineProperty(a.prototype,"width",{get:function(){return this._width},
set:function(c){this._width=c;b.utils.CSS.setCanvasWidth(this._canvas,c)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._height},set:function(c){this._height=c;b.utils.CSS.setCanvasHeight(this._canvas,c)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"x",{get:function(){return this._x},set:function(c){this._x=c;b.utils.CSS.setCanvasX(this._canvas,c)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"y",{get:function(){return this._y},
set:function(c){this._y=c;b.utils.CSS.setCanvasY(this._canvas,c)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"visible",{get:function(){return b.utils.CSS.getCanvasVisibility(this._canvas)},set:function(c){b.utils.CSS.setCanvasVisibility(this._canvas,c)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"canvas",{get:function(){return this._canvas},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"context3D",{get:function(){return this._context3D},
enumerable:!0,configurable:!0});return a}(b.events.EventDispatcher);g.Stage3D=e})(b.display||(b.display={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(){}b.setCanvasSize=function(a,c,b){a.style.width=c+"px";a.style.height=b+"px";a.width=c;a.height=b};b.setCanvasWidth=function(a,c){a.style.width=c+"px";a.width=c};b.setCanvasHeight=function(a,c){a.style.height=c+"px";a.height=c};b.setCanvasX=function(a,c){a.style.position="absolute";a.style.left=c+"px"};b.setCanvasY=function(a,c){a.style.position="absolute";a.style.top=c+"px"};b.getCanvasVisibility=function(a){return"visible"==a.style.visibility};
b.setCanvasVisibility=function(a,c){a.style.visibility=c?"visible":"hidden"};b.setCanvasAlpha=function(a,c){a.getContext("2d").globalAlpha=c};b.setCanvasPosition=function(a,c,b,d){"undefined"===typeof d&&(d=!1);a.style.position=d?"absolute":"relative";a.style.left=c+"px";a.style.top=b+"px"};return b}();b.CSS=e})(b.utils||(b.utils={}))})(away||(away={}));
(function(b){(function(b){var e=function(b){function a(c,a){"undefined"===typeof c&&(c="DocumentError");"undefined"===typeof a&&(a=0);b.call(this,c,a)}__extends(a,b);a.DOCUMENT_DOES_NOT_EXIST="documentDoesNotExist";return a}(b.Error);b.DocumentError=e})(b.errors||(b.errors={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(){}d.prototype._pPetCollisionNormal=function(a,c,k){var d=new b.geom.Vector3D,h=3*a[k],d=3*a[k+1];k=3*a[k+2];a=new b.geom.Vector3D(c[h],c[h+1],c[h+2]);d=new b.geom.Vector3D(c[d],c[d+1],c[d+2]);c=new b.geom.Vector3D(c[k],c[k+1],c[k+2]);d=d.subtract(a);c=c.subtract(a);d=d.crossProduct(c);d.normalize();return d};d.prototype._pGetCollisionUV=function(a,c,k,d,h,f,l,e){var g=new b.geom.Point,m=a[k]*e+l,n=new b.geom.Vector3D(c[m],c[m+1]),m=a[k+1]*e+l,
p=new b.geom.Vector3D(c[m],c[m+1]),m=a[k+2]*e+l;a=new b.geom.Vector3D(c[m],c[m+1]);g.x=f*n.x+d*p.x+h*a.x;g.y=f*n.y+d*p.y+h*a.y;return g};d.prototype.pGetMeshSubgeometryIndex=function(a){b.Debug.throwPIR("away.pick.PickingColliderBase","pGetMeshSubMeshIndex","GeometryUtils.getMeshSubMeshIndex");return 0};d.prototype.pGetMeshSubMeshIndex=function(a){b.Debug.throwPIR("away.pick.PickingColliderBase","pGetMeshSubMeshIndex","GeometryUtils.getMeshSubMeshIndex");return 0};d.prototype.setLocalRay=function(a,
c){this.rayPosition=a;this.rayDirection=c};return d}();g.PickingColliderBase=e})(b.pick||(b.pick={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c){"undefined"===typeof c&&(c=!1);d.call(this);this._findClosestCollision=c}__extends(a,d);a.prototype.testSubMeshCollision=function(c,a,d){for(var h,f,l,e,g,m,n,p,r,t,v,x,u,y,z,B,A,C,E,D=c.indexData,F=c.vertexData,J=c.UVData,G=-1,H=c.material.bothSides,I=c.vertexStride,K=c.vertexOffset,L=c.UVStride,M=c.UVOffset,O=D.length,N=0;N<O;N+=3)if(f=K+D[N]*I,l=K+D[N+1]*I,e=K+D[N+2]*I,g=F[f],m=F[f+1],f=F[f+2],v=F[l],x=F[l+1],u=F[l+2],n=F[e],l=F[e+1],e=
F[e+2],v-=g,x-=m,u-=f,y=n-g,z=l-m,B=e-f,l=x*B-u*z,e=u*y-v*B,n=v*z-x*y,h=1/Math.sqrt(l*l+e*e+n*n),l*=h,e*=h,n*=h,h=l*this.rayDirection.x+e*+this.rayDirection.y+n*this.rayDirection.z,!H&&0>h||H&&0!=h)if(p=-(l*g+e*m+n*f),p=-(l*this.rayPosition.x+e*this.rayPosition.y+n*this.rayPosition.z+p),h=p/h,p=this.rayPosition.x+h*this.rayDirection.x,r=this.rayPosition.y+h*this.rayDirection.y,t=this.rayPosition.z+h*this.rayDirection.z,A=v*y+x*z+u*B,C=v*v+x*x+u*u,E=y*y+z*z+B*B,g=p-g,m=r-m,f=t-f,v=g*v+m*x+f*u,g=g*
y+m*z+f*B,f=1/(C*E-A*A),m=f*(E*v-A*g),g=f*(-A*v+C*g),!(0>m||0>g||(f=1-m-g,0>f||!(0<h&&h<d)||(d=h,G=N/3,a.rayEntryDistance=h,a.localPosition=new b.geom.Vector3D(p,r,t),a.localNormal=new b.geom.Vector3D(l,e,n),a.uv=this._pGetCollisionUV(D,J,N,m,g,f,M,L),a.index=N,a.subGeometryIndex=this.pGetMeshSubMeshIndex(c),this._findClosestCollision))))return!0;return 0<=G?!0:!1};return a}(b.pick.PickingColliderBase);g.AS3PickingCollider=e})(b.pick||(b.pick={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(){}d.BOUNDS_ONLY=null;d.AS3_FIRST_ENCOUNTERED=new b.pick.AS3PickingCollider(!1);d.AS3_BEST_HIT=new b.pick.AS3PickingCollider(!0);return d}();g.PickingColliderType=e})(b.pick||(b.pick={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(a,c,k,q,h){"undefined"===typeof a&&(a=null);"undefined"===typeof c&&(c=null);"undefined"===typeof k&&(k=null);"undefined"===typeof q&&(q=!1);"undefined"===typeof h&&(h="baseline");this._pBackBufferInvalid=!0;this._pShareContext=!1;this._height=this._width=0;this._localPos=new b.geom.Point;this._globalPos=new b.geom.Point;this._backgroundColor=this._deltaTime=this._time=0;this._backgroundAlpha=1;this._depthTextureInvalid=!0;this._antiAlias=0;this._viewportDirty=
this._scissorRectDirty=!0;this._layeredView=this._depthPrepass=!1;null==d.sStage&&(d.sStage=new b.display.Stage);this._profile=h;this._pScene=a||new g.Scene3D;this._pScene.addEventListener(b.events.Scene3DEvent.PARTITION_CHANGED,this.onScenePartitionChanged,this);this._pCamera=c||new b.cameras.Camera3D;this._pRenderer=k||new b.render.DefaultRenderer;this._depthRenderer=new b.render.DepthRenderer;this._forceSoftware=q;this._pEntityCollector=this._pRenderer.iCreateEntityCollector();this._pEntityCollector.camera=
this._pCamera;this._pScissorRect=new b.geom.Rectangle;this._pCamera.addEventListener(b.events.CameraEvent.LENS_CHANGED,this.onLensChanged,this);this._pCamera.partition=this._pScene.partition;this.stage=d.sStage;this.onAddedToStage()}d.prototype.onScenePartitionChanged=function(a){this._pCamera&&(this._pCamera.partition=this.scene.partition)};Object.defineProperty(d.prototype,"stage3DProxy",{get:function(){return this._pStage3DProxy},set:function(a){this._pStage3DProxy&&this._pStage3DProxy.removeEventListener(b.events.Stage3DEvent.VIEWPORT_UPDATED,
this.onViewportUpdated,this);this._pStage3DProxy=a;this._pStage3DProxy.addEventListener(b.events.Stage3DEvent.VIEWPORT_UPDATED,this.onViewportUpdated,this);this._pRenderer.iStage3DProxy=this._depthRenderer.iStage3DProxy=this._pStage3DProxy;this._pBackBufferInvalid=this._globalPosDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"layeredView",{get:function(){return this._layeredView},set:function(a){this._layeredView=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"filters3d",{get:function(){return this._pFilter3DRenderer?this._pFilter3DRenderer.filters:null},set:function(a){a&&0==a.length&&(a=null);this._pFilter3DRenderer&&!a?(this._pFilter3DRenderer.dispose(),this._pFilter3DRenderer=null):!this._pFilter3DRenderer&&a&&(this._pFilter3DRenderer=new b.render.Filter3DRenderer(this._pStage3DProxy),this._pFilter3DRenderer.filters=a);this._pFilter3DRenderer?(this._pFilter3DRenderer.filters=a,this._pRequireDepthRender=this._pFilter3DRenderer.requireDepthRender):(this._pRequireDepthRender=
!1,this._pDepthRender&&(this._pDepthRender.dispose(),this._pDepthRender=null))},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"renderer",{get:function(){return this._pRenderer},set:function(a){this._pRenderer.iDispose();this._pRenderer=a;this._pEntityCollector=this._pRenderer.iCreateEntityCollector();this._pEntityCollector.camera=this._pCamera;this._pRenderer.iStage3DProxy=this._pStage3DProxy;this._pRenderer.antiAlias=this._antiAlias;this._pRenderer.iBackgroundR=(this._backgroundColor>>
16&255)/255;this._pRenderer.iBackgroundG=(this._backgroundColor>>8&255)/255;this._pRenderer.iBackgroundB=(this._backgroundColor&255)/255;this._pRenderer.iBackgroundAlpha=this._backgroundAlpha;this._pRenderer.iViewWidth=this._width;this._pRenderer.iViewHeight=this._height;this._pBackBufferInvalid=!0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(a){this._backgroundColor=a;this._pRenderer.iBackgroundR=(a>>
16&255)/255;this._pRenderer.iBackgroundG=(a>>8&255)/255;this._pRenderer.iBackgroundB=(a&255)/255},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"backgroundAlpha",{get:function(){return this._backgroundAlpha},set:function(a){1<a?a=1:0>a&&(a=0);this._backgroundAlpha=this._pRenderer.iBackgroundAlpha=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"camera",{get:function(){return this._pCamera},set:function(a){this._pCamera.removeEventListener(b.events.CameraEvent.LENS_CHANGED,
this.onLensChanged,this);this._pCamera=a;this._pEntityCollector.camera=this._pCamera;this._pScene&&(this._pCamera.partition=this._pScene.partition);this._pCamera.addEventListener(b.events.CameraEvent.LENS_CHANGED,this.onLensChanged,this);this._viewportDirty=this._scissorRectDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"scene",{get:function(){return this._pScene},set:function(a){this._pScene.removeEventListener(b.events.Scene3DEvent.PARTITION_CHANGED,this.onScenePartitionChanged,
this);this._pScene=a;this._pScene.addEventListener(b.events.Scene3DEvent.PARTITION_CHANGED,this.onScenePartitionChanged,this);this._pCamera&&(this._pCamera.partition=this._pScene.partition)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"deltaTime",{get:function(){return this._deltaTime},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"width",{get:function(){return this._width},set:function(a){this._width!=a&&(this._pRttBufferManager&&(this._pRttBufferManager.viewWidth=
a),this._width=a,this._aspectRatio=this._width/this._height,this._pCamera.lens.iAspectRatio=this._aspectRatio,this._depthTextureInvalid=!0,this._pRenderer.iViewWidth=a,this._pScissorRect.width=a,this._scissorRectDirty=this._pBackBufferInvalid=!0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"height",{get:function(){return this._height},set:function(a){this._height!=a&&(this._pRttBufferManager&&(this._pRttBufferManager.viewHeight=a),this._height=a,this._aspectRatio=this._width/
this._height,this._pCamera.lens.iAspectRatio=this._aspectRatio,this._depthTextureInvalid=!0,this._pRenderer.iViewHeight=a,this._pScissorRect.height=a,this._scissorRectDirty=this._pBackBufferInvalid=!0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"x",{get:function(){return this._localPos.x},set:function(a){this.x!=a&&(this._globalPos.x=this._localPos.x=a,this._globalPosDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"y",{get:function(){return this._localPos.y},
set:function(a){this.y!=a&&(this._globalPos.y=this._localPos.y=a,this._globalPosDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"visible",{get:function(){return!0},set:function(a){},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"canvas",{get:function(){return this._pStage3DProxy.canvas},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"antiAlias",{get:function(){return this._antiAlias},set:function(a){this._antiAlias=a;this._pRenderer.antiAlias=
a;this._pBackBufferInvalid=!0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"renderedFacesCount",{get:function(){return this._pEntityCollector._pNumTriangles},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"shareContext",{get:function(){return this._pShareContext},set:function(a){this._pShareContext!=a&&(this._pShareContext=a,this._globalPosDirty=!0)},enumerable:!0,configurable:!0});d.prototype.pUpdateBackBuffer=function(){this._pStage3DProxy._iContext3D&&!this._pShareContext&&
(this._width&&this._height)&&(this._pStage3DProxy.configureBackBuffer(this._width,this._height,this._antiAlias,!0),this._pBackBufferInvalid=!1)};d.prototype.render=function(){this._pStage3DProxy.recoverFromDisposal()?(this._pBackBufferInvalid&&this.pUpdateBackBuffer(),this._pShareContext&&this._layeredView&&this._pStage3DProxy.clearDepthBuffer(),this._globalPosDirty&&this.pUpdateGlobalPos(),this.pUpdateTime(),this.pUpdateViewSizeData(),this._pEntityCollector.clear(),this._pScene.traversePartitions(this._pEntityCollector),
this._pRequireDepthRender&&this.pRenderSceneDepthToTexture(this._pEntityCollector),this._depthPrepass&&this.pRenderDepthPrepass(this._pEntityCollector),this._pRenderer.iClearOnRender=!this._depthPrepass,this._pFilter3DRenderer&&this._pStage3DProxy._iContext3D?(this._pRenderer.iRender(this._pEntityCollector,this._pFilter3DRenderer.getMainInputTexture(this._pStage3DProxy),this._pRttBufferManager.renderToTextureRect),this._pFilter3DRenderer.render(this._pStage3DProxy,this._pCamera,this._pDepthRender)):
(this._pRenderer.iShareContext=this._pShareContext)?this._pRenderer.iRender(this._pEntityCollector,null,this._pScissorRect):this._pRenderer.iRender(this._pEntityCollector),this._pShareContext||this._pStage3DProxy.present(),this._pEntityCollector.cleanUp(),this._pStage3DProxy.bufferClear=!1):this._pBackBufferInvalid=!0};d.prototype.pUpdateGlobalPos=function(){this._globalPosDirty=!1;this._pStage3DProxy&&(this._pShareContext?(this._pScissorRect.x=this._globalPos.x-this._pStage3DProxy.x,this._pScissorRect.y=
this._globalPos.y-this._pStage3DProxy.y):(this._pScissorRect.x=0,this._pScissorRect.y=0,this._pStage3DProxy.x=this._globalPos.x,this._pStage3DProxy.y=this._globalPos.y),this._scissorRectDirty=!0)};d.prototype.pUpdateTime=function(){var a=b.utils.getTimer();0==this._time&&(this._time=a);this._deltaTime=a-this._time;this._time=a};d.prototype.pUpdateViewSizeData=function(){this._pCamera.lens.iAspectRatio=this._aspectRatio;this._scissorRectDirty&&(this._scissorRectDirty=!1,this._pCamera.lens.iUpdateScissorRect(this._pScissorRect.x,
this._pScissorRect.y,this._pScissorRect.width,this._pScissorRect.height));this._viewportDirty&&(this._viewportDirty=!1,this._pCamera.lens.iUpdateViewport(this._pStage3DProxy.viewPort.x,this._pStage3DProxy.viewPort.y,this._pStage3DProxy.viewPort.width,this._pStage3DProxy.viewPort.height));this._pFilter3DRenderer||this._pRenderer.iRenderToTexture?(this._pRenderer.iTextureRatioX=this._pRttBufferManager.textureRatioX,this._pRenderer.iTextureRatioY=this._pRttBufferManager.textureRatioY):(this._pRenderer.iTextureRatioX=
1,this._pRenderer.iTextureRatioY=1)};d.prototype.pRenderDepthPrepass=function(a){this._depthRenderer.disableColor=!0;this._pFilter3DRenderer||this._pRenderer.iRenderToTexture?(this._depthRenderer.iTextureRatioX=this._pRttBufferManager.textureRatioX,this._depthRenderer.iTextureRatioY=this._pRttBufferManager.textureRatioY,this._depthRenderer.iRender(a,this._pFilter3DRenderer.getMainInputTexture(this._pStage3DProxy),this._pRttBufferManager.renderToTextureRect)):(this._depthRenderer.iTextureRatioX=1,
this._depthRenderer.iTextureRatioY=1,this._depthRenderer.iRender(a));this._depthRenderer.disableColor=!1};d.prototype.pRenderSceneDepthToTexture=function(a){!this._depthTextureInvalid&&this._pDepthRender||this.initDepthTexture(this._pStage3DProxy._iContext3D);this._depthRenderer.iTextureRatioX=this._pRttBufferManager.textureRatioX;this._depthRenderer.iTextureRatioY=this._pRttBufferManager.textureRatioY;this._depthRenderer.iRender(a,this._pDepthRender)};d.prototype.initDepthTexture=function(a){this._depthTextureInvalid=
!1;this._pDepthRender&&this._pDepthRender.dispose();this._pDepthRender=a.createTexture(this._pRttBufferManager.textureWidth,this._pRttBufferManager.textureHeight,b.display3D.Context3DTextureFormat.BGRA,!0)};d.prototype.dispose=function(){this._pStage3DProxy.removeEventListener(b.events.Stage3DEvent.VIEWPORT_UPDATED,this.onViewportUpdated,this);this.shareContext||this._pStage3DProxy.dispose();this._pRenderer.iDispose();this._pDepthRender&&this._pDepthRender.dispose();this._pRttBufferManager&&this._pRttBufferManager.dispose();
this._pEntityCollector=this._pRenderer=this._pStage3DProxy=this._depthRenderer=this._pDepthRender=this._pRttBufferManager=null};Object.defineProperty(d.prototype,"iEntityCollector",{get:function(){return this._pEntityCollector},enumerable:!0,configurable:!0});d.prototype.onLensChanged=function(a){this._viewportDirty=this._scissorRectDirty=!0};d.prototype.onViewportUpdated=function(a){this._pShareContext&&(this._pScissorRect.x=this._globalPos.x-this._pStage3DProxy.x,this._pScissorRect.y=this._globalPos.y-
this._pStage3DProxy.y,this._scissorRectDirty=!0);this._viewportDirty=!0};Object.defineProperty(d.prototype,"depthPrepass",{get:function(){return this._depthPrepass},set:function(a){this._depthPrepass=a},enumerable:!0,configurable:!0});d.prototype.onAddedToStage=function(){this._addedToStage=!0;null==this._pStage3DProxy&&(this._pStage3DProxy=b.managers.Stage3DManager.getInstance(this.stage).getFreeStage3DProxy(this._forceSoftware,this._profile),this._pStage3DProxy.addEventListener(b.events.Stage3DEvent.VIEWPORT_UPDATED,
this.onViewportUpdated,this));this._globalPosDirty=!0;this._pRttBufferManager=b.managers.RTTBufferManager.getInstance(this._pStage3DProxy);this._pRenderer.iStage3DProxy=this._depthRenderer.iStage3DProxy=this._pStage3DProxy;0==this._width?this.width=this.stage.stageWidth:this._pRttBufferManager.viewWidth=this._width;0==this._height?this.height=this.stage.stageHeight:this._pRttBufferManager.viewHeight=this._height};d.prototype.project=function(a){a=this._pCamera.project(a);a.x=(a.x+1)*this._width/2;
a.y=(a.y+1)*this._height/2;return a};d.prototype.unproject=function(a,c,b){return this._pCamera.unproject((2*a-this._width)/this._pStage3DProxy.width,(2*c-this._height)/this._pStage3DProxy.height,b)};d.prototype.getRay=function(a,c,b){return this._pCamera.getRay((2*a-this._width)/this._width,(2*c-this._height)/this._height,b)};return d}();g.View3D=e})(b.containers||(b.containers={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(){}d.prototype.resolveConflict=function(a,c,k,d){throw new b.errors.AbstractMethodError;};d.prototype.create=function(){throw new b.errors.AbstractMethodError;};d.prototype._pUpdateNames=function(a,c,k,d,h,f){var l;l=f===b.library.ConflictPrecedence.FAVOR_NEW?d:k;d=f===b.library.ConflictPrecedence.FAVOR_NEW?k:d;k=d.name;h[l.name]=l;h[c]=d;d.resetAssetPath(c,a,!1);d.dispatchEvent(new b.events.AssetEvent(b.events.AssetEvent.ASSET_CONFLICT_RESOLVED,
d,k))};return d}();g.ConflictStrategyBase=e})(b.library||(b.library={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c){"undefined"===typeof c&&(c=".");d.call(this);this._separator=c;this._next_suffix={}}__extends(a,d);a.prototype.resolveConflict=function(c,a,b,d){var f,l,e;f=c.name;0<=f.indexOf(this._separator)?(l=f.substring(0,f.lastIndexOf(this._separator)),e=parseInt(f.substring(l.length-1)),isNaN(e)&&(l=f,e=0)):(l=f,e=0);0==e&&this._next_suffix.hasOwnProperty(l)&&(e=this._next_suffix[l]);do e++,f=l.concat(this._separator,e.toString());while(b.hasOwnProperty(f));
this._next_suffix[l]=e;this._pUpdateNames(a.assetNamespace,f,a,c,b,d)};a.prototype.create=function(){return new b.library.NumSuffixConflictStrategy(this._separator)};return a}(b.library.ConflictStrategyBase);g.NumSuffixConflictStrategy=e})(b.library||(b.library={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this)}__extends(a,d);a.prototype.resolveConflict=function(c,a,b,d){};a.prototype.create=function(){return new b.library.IgnoreConflictStrategy};return a}(b.library.ConflictStrategyBase);g.IgnoreConflictStrategy=e})(b.library||(b.library={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this)}__extends(a,d);a.prototype.resolveConflict=function(c,a,d,h){throw new b.errors.Error("Asset name collision while AssetLibrary.namingStrategy set to AssetLibrary.THROW_ERROR. Asset path: "+c.assetFullPath);};a.prototype.create=function(){return new a};return a}(b.library.ConflictStrategyBase);g.ErrorConflictStrategy=e})(b.library||(b.library={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(){}b.FAVOR_OLD="favorOld";b.FAVOR_NEW="favorNew";return b}();b.ConflictPrecedence=e})(b.library||(b.library={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c){d.call(this);this._loadingSessionsGarbage=[];this._assets=[];this._assetDictionary={};this._loadingSessions=[];this.conflictStrategy=b.library.ConflictStrategy.IGNORE.create();this.conflictPrecedence=b.library.ConflictPrecedence.FAVOR_NEW}__extends(a,d);a.getInstance=function(c){"undefined"===typeof c&&(c="default");c||(c="default");b.library.AssetLibrary._iInstances.hasOwnProperty(c)||(b.library.AssetLibrary._iInstances[c]=new b.library.AssetLibraryBundle(new AssetLibraryBundleSingletonEnforcer));
return b.library.AssetLibrary._iInstances[c]};a.prototype.enableParser=function(c){b.loaders.SingleFileLoader.enableParser(c)};a.prototype.enableParsers=function(c){b.loaders.SingleFileLoader.enableParsers(c)};Object.defineProperty(a.prototype,"conflictStrategy",{get:function(){return this._strategy},set:function(c){if(!c)throw new b.errors.Error("namingStrategy must not be null. To ignore naming, use AssetLibrary.IGNORE");this._strategy=c.create()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"conflictPrecedence",{get:function(){return this._strategyPreference},set:function(c){this._strategyPreference=c},enumerable:!0,configurable:!0});a.prototype.createIterator=function(c,a,d){"undefined"===typeof c&&(c=null);"undefined"===typeof a&&(a=null);"undefined"===typeof d&&(d=null);return new b.library.AssetLibraryIterator(this._assets,c,a,d)};a.prototype.load=function(c,a,b,d){"undefined"===typeof a&&(a=null);"undefined"===typeof b&&(b=null);"undefined"===typeof d&&(d=null);return this.loadResource(c,
a,b,d)};a.prototype.loadData=function(c,a,b,d){"undefined"===typeof a&&(a=null);"undefined"===typeof b&&(b=null);"undefined"===typeof d&&(d=null);return this.parseResource(c,a,b,d)};a.prototype.getAsset=function(c,a){"undefined"===typeof a&&(a=null);this._assetDictDirty&&this.rehashAssetDict();null==a&&(a=b.library.NamedAssetBase.DEFAULT_NAMESPACE);return this._assetDictionary.hasOwnProperty(a)?this._assetDictionary[a][c]:null};a.prototype.addAsset=function(c){var a,d;0<=this._assets.indexOf(c)||
(d=this.getAsset(c.name,c.assetNamespace),a=c.assetNamespace||g.NamedAssetBase.DEFAULT_NAMESPACE,null!=d&&this._strategy.resolveConflict(c,d,this._assetDictionary[a],this._strategyPreference),c.id=b.library.IDUtil.createUID(),this._assets.push(c),this._assetDictionary.hasOwnProperty(a)||(this._assetDictionary[a]={}),this._assetDictionary[a][c.name]=c,c.addEventListener(b.events.AssetEvent.ASSET_RENAME,this.onAssetRename,this),c.addEventListener(b.events.AssetEvent.ASSET_CONFLICT_RESOLVED,this.onAssetConflictResolved,
this))};a.prototype.removeAsset=function(c,a){"undefined"===typeof a&&(a=!0);var d;this.removeAssetFromDict(c);c.removeEventListener(b.events.AssetEvent.ASSET_RENAME,this.onAssetRename,this);c.removeEventListener(b.events.AssetEvent.ASSET_CONFLICT_RESOLVED,this.onAssetConflictResolved,this);d=this._assets.indexOf(c);0<=d&&this._assets.splice(d,1);a&&c.dispose()};a.prototype.removeAssetByName=function(c,a,b){"undefined"===typeof a&&(a=null);"undefined"===typeof b&&(b=!0);(c=this.getAsset(c,a))&&this.removeAsset(c,
b);return c};a.prototype.removeAllAssets=function(c){"undefined"===typeof c&&(c=!0);if(c)for(var a=0;a<this._assets.length;a++)c=this._assets[a],c.dispose();this._assets.length=0;this.rehashAssetDict()};a.prototype.removeNamespaceAssets=function(c,a){"undefined"===typeof c&&(c=null);"undefined"===typeof a&&(a=!0);var d=0,h,f;f=this._assets.concat();this._assets.length=0;null==c&&(c=b.library.NamedAssetBase.DEFAULT_NAMESPACE);for(var l=0;l<f.length;l++)h=f[l],h.assetNamespace==c?(a&&h.dispose(),this.removeAssetFromDict(h,
!1)):this._assets[d++]=h;this._assetDictionary.hasOwnProperty(c)&&delete this._assetDictionary[c]};a.prototype.removeAssetFromDict=function(c,a){"undefined"===typeof a&&(a=!0);this._assetDictDirty&&this.rehashAssetDict();if(this._assetDictionary.hasOwnProperty(c.assetNamespace)&&(this._assetDictionary[c.assetNamespace].hasOwnProperty(c.name)&&delete this._assetDictionary[c.assetNamespace][c.name],a)){var b,d=!0;for(b in this._assetDictionary[c.assetNamespace]){d=!1;break}d&&delete this._assetDictionary[c.assetNamespace]}};
a.prototype.loadResource=function(c,a,d,h){"undefined"===typeof a&&(a=null);"undefined"===typeof d&&(d=null);"undefined"===typeof h&&(h=null);var f=new b.loaders.AssetLoader;this._loadingSessions||(this._loadingSessions=[]);this._loadingSessions.push(f);f.addEventListener(b.events.LoaderEvent.RESOURCE_COMPLETE,this.onResourceRetrieved,this);f.addEventListener(b.events.LoaderEvent.DEPENDENCY_COMPLETE,this.onDependencyRetrieved,this);f.addEventListener(b.events.AssetEvent.TEXTURE_SIZE_ERROR,this.onTextureSizeError,
this);f.addEventListener(b.events.AssetEvent.ASSET_COMPLETE,this.onAssetComplete,this);f.addEventListener(b.events.AssetEvent.ANIMATION_SET_COMPLETE,this.onAssetComplete,this);f.addEventListener(b.events.AssetEvent.ANIMATION_STATE_COMPLETE,this.onAssetComplete,this);f.addEventListener(b.events.AssetEvent.ANIMATION_NODE_COMPLETE,this.onAssetComplete,this);f.addEventListener(b.events.AssetEvent.STATE_TRANSITION_COMPLETE,this.onAssetComplete,this);f.addEventListener(b.events.AssetEvent.TEXTURE_COMPLETE,
this.onAssetComplete,this);f.addEventListener(b.events.AssetEvent.CONTAINER_COMPLETE,this.onAssetComplete,this);f.addEventListener(b.events.AssetEvent.GEOMETRY_COMPLETE,this.onAssetComplete,this);f.addEventListener(b.events.AssetEvent.MATERIAL_COMPLETE,this.onAssetComplete,this);f.addEventListener(b.events.AssetEvent.MESH_COMPLETE,this.onAssetComplete,this);f.addEventListener(b.events.AssetEvent.ENTITY_COMPLETE,this.onAssetComplete,this);f.addEventListener(b.events.AssetEvent.SKELETON_COMPLETE,this.onAssetComplete,
this);f.addEventListener(b.events.AssetEvent.SKELETON_POSE_COMPLETE,this.onAssetComplete,this);f._iAddErrorHandler(this.onDependencyRetrievingError);f._iAddParseErrorHandler(this.onDependencyRetrievingParseError);return f.load(c,a,d,h)};a.prototype.stopAllLoadingSessions=function(){var c;this._loadingSessions||(this._loadingSessions=[]);var a=this._loadingSessions.length;for(c=0;c<a;c++)this.killLoadingSession(this._loadingSessions[c]);this._loadingSessions=null};a.prototype.parseResource=function(c,
a,d,h){"undefined"===typeof a&&(a=null);"undefined"===typeof d&&(d=null);"undefined"===typeof h&&(h=null);var f=new b.loaders.AssetLoader;this._loadingSessions||(this._loadingSessions=[]);this._loadingSessions.push(f);f.addEventListener(b.events.LoaderEvent.RESOURCE_COMPLETE,this.onResourceRetrieved,this);f.addEventListener(b.events.LoaderEvent.DEPENDENCY_COMPLETE,this.onDependencyRetrieved,this);f.addEventListener(b.events.AssetEvent.TEXTURE_SIZE_ERROR,this.onTextureSizeError,this);f.addEventListener(b.events.AssetEvent.ASSET_COMPLETE,
this.onAssetComplete,this);f.addEventListener(b.events.AssetEvent.ANIMATION_SET_COMPLETE,this.onAssetComplete,this);f.addEventListener(b.events.AssetEvent.ANIMATION_STATE_COMPLETE,this.onAssetComplete,this);f.addEventListener(b.events.AssetEvent.ANIMATION_NODE_COMPLETE,this.onAssetComplete,this);f.addEventListener(b.events.AssetEvent.STATE_TRANSITION_COMPLETE,this.onAssetComplete,this);f.addEventListener(b.events.AssetEvent.TEXTURE_COMPLETE,this.onAssetComplete,this);f.addEventListener(b.events.AssetEvent.CONTAINER_COMPLETE,
this.onAssetComplete,this);f.addEventListener(b.events.AssetEvent.GEOMETRY_COMPLETE,this.onAssetComplete,this);f.addEventListener(b.events.AssetEvent.MATERIAL_COMPLETE,this.onAssetComplete,this);f.addEventListener(b.events.AssetEvent.MESH_COMPLETE,this.onAssetComplete,this);f.addEventListener(b.events.AssetEvent.ENTITY_COMPLETE,this.onAssetComplete,this);f.addEventListener(b.events.AssetEvent.SKELETON_COMPLETE,this.onAssetComplete,this);f.addEventListener(b.events.AssetEvent.SKELETON_POSE_COMPLETE,
this.onAssetComplete,this);f._iAddErrorHandler(this.onDependencyRetrievingError);f._iAddParseErrorHandler(this.onDependencyRetrievingParseError);return f.loadData(c,"",a,d,h)};a.prototype.rehashAssetDict=function(){var c;this._assetDictionary={};for(var a=this._assets.length,b=0;b<a;b++)c=this._assets[b],this._assetDictionary.hasOwnProperty(c.assetNamespace)||(this._assetDictionary[c.assetNamespace]={}),this._assetDictionary[c.assetNamespace][c.name]=c;this._assetDictDirty=!1};a.prototype.onDependencyRetrieved=
function(c){this.dispatchEvent(c)};a.prototype.onDependencyRetrievingError=function(c){return this.hasEventListener(b.events.LoaderEvent.LOAD_ERROR,this.onDependencyRetrievingError,this)?(this.dispatchEvent(c),!0):!1};a.prototype.onDependencyRetrievingParseError=function(c){return this.hasEventListener(b.events.ParserEvent.PARSE_ERROR,this.onDependencyRetrievingParseError,this)?(this.dispatchEvent(c),!0):!1};a.prototype.onAssetComplete=function(c){c.type==b.events.AssetEvent.ASSET_COMPLETE&&this.addAsset(c.asset);
this.dispatchEvent(c.clone())};a.prototype.onTextureSizeError=function(c){this.dispatchEvent(c.clone())};a.prototype.onResourceRetrieved=function(c){var a=this,b=c.target;this.dispatchEvent(c.clone());c=this._loadingSessions.indexOf(b);this._loadingSessions.splice(c,1);this._loadingSessionsGarbage.push(b);this._gcTimeoutIID=setTimeout(function(){a.loadingSessionGC()},100)};a.prototype.loadingSessionGC=function(){for(var c;0<this._loadingSessionsGarbage.length;)c=this._loadingSessionsGarbage.pop(),
this.killLoadingSession(c);clearTimeout(this._gcTimeoutIID);this._gcTimeoutIID=null};a.prototype.killLoadingSession=function(c){c.removeEventListener(b.events.LoaderEvent.LOAD_ERROR,this.onDependencyRetrievingError,this);c.removeEventListener(b.events.LoaderEvent.RESOURCE_COMPLETE,this.onResourceRetrieved,this);c.removeEventListener(b.events.LoaderEvent.DEPENDENCY_COMPLETE,this.onDependencyRetrieved,this);c.removeEventListener(b.events.AssetEvent.TEXTURE_SIZE_ERROR,this.onTextureSizeError,this);c.removeEventListener(b.events.AssetEvent.ASSET_COMPLETE,
this.onAssetComplete,this);c.removeEventListener(b.events.AssetEvent.ANIMATION_SET_COMPLETE,this.onAssetComplete,this);c.removeEventListener(b.events.AssetEvent.ANIMATION_STATE_COMPLETE,this.onAssetComplete,this);c.removeEventListener(b.events.AssetEvent.ANIMATION_NODE_COMPLETE,this.onAssetComplete,this);c.removeEventListener(b.events.AssetEvent.STATE_TRANSITION_COMPLETE,this.onAssetComplete,this);c.removeEventListener(b.events.AssetEvent.TEXTURE_COMPLETE,this.onAssetComplete,this);c.removeEventListener(b.events.AssetEvent.CONTAINER_COMPLETE,
this.onAssetComplete,this);c.removeEventListener(b.events.AssetEvent.GEOMETRY_COMPLETE,this.onAssetComplete,this);c.removeEventListener(b.events.AssetEvent.MATERIAL_COMPLETE,this.onAssetComplete,this);c.removeEventListener(b.events.AssetEvent.MESH_COMPLETE,this.onAssetComplete,this);c.removeEventListener(b.events.AssetEvent.ENTITY_COMPLETE,this.onAssetComplete,this);c.removeEventListener(b.events.AssetEvent.SKELETON_COMPLETE,this.onAssetComplete,this);c.removeEventListener(b.events.AssetEvent.SKELETON_POSE_COMPLETE,
this.onAssetComplete,this);c.stop()};a.prototype.onAssetRename=function(c){var a=c.target,b=this.getAsset(a.assetNamespace,a.name);null!=b?this._strategy.resolveConflict(a,b,this._assetDictionary[a.assetNamespace],this._strategyPreference):(a=this._assetDictionary[c.asset.assetNamespace],null!=a&&(a[c.assetPrevName]=null,a[c.asset.name]=c.asset))};a.prototype.onAssetConflictResolved=function(c){this.dispatchEvent(c.clone())};return a}(b.events.EventDispatcher);g.AssetLibraryBundle=e})(b.library||
(b.library={}))})(away||(away={}));var AssetLibraryBundleSingletonEnforcer=function(){return function(){}}();
(function(b){(function(b){var e=function(){function b(a,c){"undefined"===typeof a&&(a=!0);"undefined"===typeof c&&(c=null);this._includeDependencies=a;this._dependencyBaseUrl=c||"";this._embeddedDataByUrl={};this._remappedUrls={};this._materialMode=b.UNDEFINED}Object.defineProperty(b.prototype,"includeDependencies",{get:function(){return this._includeDependencies},set:function(a){this._includeDependencies=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"materialMode",{get:function(){return this._materialMode},
set:function(a){this._materialMode=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"dependencyBaseUrl",{get:function(){return this._dependencyBaseUrl},set:function(a){this._dependencyBaseUrl=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"overrideAbsolutePaths",{get:function(){return this._overrideAbsPath},set:function(a){this._overrideAbsPath=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"overrideFullURLs",{get:function(){return this._overrideFullUrls},
set:function(a){this._overrideFullUrls=a},enumerable:!0,configurable:!0});b.prototype.mapUrl=function(a,c){this._remappedUrls[a]=c};b.prototype.mapUrlToData=function(a,c){this._embeddedDataByUrl[a]=c};b.prototype._iHasDataForUrl=function(a){return this._embeddedDataByUrl.hasOwnProperty(a)};b.prototype._iGetDataForUrl=function(a){return this._embeddedDataByUrl[a]};b.prototype._iHasMappingForUrl=function(a){return this._remappedUrls.hasOwnProperty(a)};b.prototype._iGetRemappedUrl=function(a){return this._remappedUrls[a]};
b.UNDEFINED=0;b.SINGLEPASS_MATERIALS=1;b.MULTIPASS_MATERIALS=2;return b}();b.AssetLoaderContext=e})(b.loaders||(b.loaders={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(a,c,k,d){this._assets=a;this.filter(c,k,d)}Object.defineProperty(b.prototype,"currentAsset",{get:function(){return this._idx<this._filtered.length?this._filtered[this._idx]:null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"numAssets",{get:function(){return this._filtered.length},enumerable:!0,configurable:!0});b.prototype.next=function(){var a=null;this._idx<this._filtered.length&&(a=this._filtered[this._idx]);this._idx++;
return a};b.prototype.reset=function(){this._idx=0};b.prototype.setIndex=function(a){this._idx=a};b.prototype.filter=function(a,c,b){if(a||c){var d,h;d=0;this._filtered=[];for(var f=this._assets.length,l=0;l<f;l++)if(h=this._assets[l],!a||h.assetType==a)if(!c||h.assetNamespace==c)if(null==b||b(h))this._filtered[d++]=h}else this._filtered=this._assets};return b}();b.AssetLibraryIterator=e})(b.library||(b.library={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._stack=[];this._errorHandlers=[];this._parseErrorHandlers=[]}__extends(a,d);Object.defineProperty(a.prototype,"baseDependency",{get:function(){return this._baseDependency},enumerable:!0,configurable:!0});a.enableParser=function(c){b.loaders.SingleFileLoader.enableParser(c)};a.enableParsers=function(c){b.loaders.SingleFileLoader.enableParsers(c)};a.prototype.load=function(c,a,d,h){"undefined"===typeof a&&(a=null);"undefined"===
typeof d&&(d=null);"undefined"===typeof h&&(h=null);return this._token?null:(this._token=new b.loaders.AssetLoaderToken(this),this._uri=c.url=c.url.replace(/\\/g,"/"),this._context=a,this._namespace=d,this._baseDependency=new b.loaders.ResourceDependency("",c,null,null),this.retrieveDependency(this._baseDependency,h),this._token)};a.prototype.loadData=function(c,a,d,h,f){"undefined"===typeof d&&(d=null);"undefined"===typeof h&&(h=null);"undefined"===typeof f&&(f=null);return this._token?null:(this._token=
new b.loaders.AssetLoaderToken(this),this._uri=a,this._context=d,this._namespace=h,this._baseDependency=new g.ResourceDependency(a,null,c,null),this.retrieveDependency(this._baseDependency,f),this._token)};a.prototype.retrieveNext=function(c){"undefined"===typeof c&&(c=null);if(this._loadingDependency.dependencies.length)c=this._loadingDependency.dependencies.pop(),this._stack.push(this._loadingDependency),this.retrieveDependency(c);else if(this._loadingDependency._iLoader.parser&&this._loadingDependency._iLoader.parser.parsingPaused)this._loadingDependency._iLoader.parser._iResumeParsingAfterDependencies(),
this._stack.pop();else if(this._stack.length){var a=this._loadingDependency;this._loadingDependency=this._stack.pop();a._iSuccess&&a.resolve();this.retrieveNext(c)}else this.dispatchEvent(new b.events.LoaderEvent(b.events.LoaderEvent.RESOURCE_COMPLETE,this._uri))};a.prototype.retrieveDependency=function(c,a){"undefined"===typeof a&&(a=null);var d;d=0;this._context&&0!=this._context.materialMode&&(d=this._context.materialMode);this._loadingDependency=c;this._loadingDependency._iLoader=new b.loaders.SingleFileLoader(d);
this.addEventListeners(this._loadingDependency._iLoader);d=this._loadingDependency.data;this._context&&(this._loadingDependency.request&&this._context._iHasDataForUrl(this._loadingDependency.request.url))&&(d=this._context._iGetDataForUrl(this._loadingDependency.request.url));d?this._loadingDependency.retrieveAsRawData?(this.dispatchEvent(new b.events.LoaderEvent(b.events.LoaderEvent.DEPENDENCY_COMPLETE,this._loadingDependency.request.url,!0)),this._loadingDependency._iSetData(d),this._loadingDependency.resolve(),
this.retrieveNext()):this._loadingDependency._iLoader.parseData(d,a,this._loadingDependency.request):(c.request.url=this.resolveDependencyUrl(c),this._loadingDependency._iLoader.load(c.request,a,this._loadingDependency.retrieveAsRawData))};a.prototype.joinUrl=function(c,a){"/"==a.charAt(0)&&(a=a.substr(1));if(0==c.length)return a;"/"==c.charAt(c.length-1)&&(c=c.substr(0,c.length-1));return c.concat("/",a)};a.prototype.resolveDependencyUrl=function(c){var a;c=c.request.url;if(this._context&&this._context._iHasMappingForUrl(c))return this._context._iGetRemappedUrl(c);
if(c==this._uri)return c;a=/\/^[a-zA-Z]{3,4}:\/\/\//;if("/"==c.charAt(0))return this._context&&this._context.overrideAbsolutePaths?this.joinUrl(this._context.dependencyBaseUrl,c):c;if(a.test(c)&&this._context&&this._context.overrideFullURLs)return c=c.replace(a),this.joinUrl(this._context.dependencyBaseUrl,c);a=this._context&&this._context.dependencyBaseUrl?this._context.dependencyBaseUrl:this._uri.substring(0,this._uri.lastIndexOf("/")+1);return this.joinUrl(a,c)};a.prototype.retrieveLoaderDependencies=
function(c){if(this._loadingDependency){var a,b=c.dependencies.length;for(a=0;a<b;a++)this._loadingDependency.dependencies[a]=c.dependencies[a];c.dependencies.length=0;this._stack.push(this._loadingDependency);this.retrieveNext()}};a.prototype.onRetrievalFailed=function(c){var a,d=this._loadingDependency!=this._baseDependency;this.removeEventListeners(c.target);c=new b.events.LoaderEvent(b.events.LoaderEvent.LOAD_ERROR,this._uri,d,c.message);this.dispatchEvent(c);a=!0;var h,f=this._errorHandlers.length;
for(h=0;h<f;h++){var l=this._errorHandlers[h];a=a||l(c)}if(a)d?(this._loadingDependency.resolveFailure(),this.retrieveNext()):this.dispose();else throw new b.errors.Error(c.message);};a.prototype.onParserError=function(c){var a;this.removeEventListeners(c.target);c=new b.events.ParserEvent(b.events.ParserEvent.PARSE_ERROR,c.message);this.dispatchEvent(c);a=!0;var d,h=this._parseErrorHandlers.length;for(d=0;d<h;d++){var f=this._parseErrorHandlers[d];a=a||f(c)}if(a)this.dispose();else throw Error(c.message);
};a.prototype.onAssetComplete=function(c){c.type==b.events.AssetEvent.ASSET_COMPLETE&&(this._loadingDependency&&this._loadingDependency.assets.push(c.asset),c.asset.resetAssetPath(c.asset.name,this._namespace));this._loadingDependency.suppresAssetEvents||this.dispatchEvent(c.clone())};a.prototype.onReadyForDependencies=function(c){c=c.target;this._context&&!this._context.includeDependencies?c.parser._iResumeParsingAfterDependencies():this.retrieveLoaderDependencies(c)};a.prototype.onRetrievalComplete=
function(c){var a=c.target;this._loadingDependency._iSetData(a.data);this._loadingDependency._iSuccess=!0;this.dispatchEvent(new b.events.LoaderEvent(b.events.LoaderEvent.DEPENDENCY_COMPLETE,c.url));this.removeEventListeners(a);!a.dependencies.length||this._context&&!this._context.includeDependencies?this.retrieveNext():this.retrieveLoaderDependencies(a)};a.prototype.onTextureSizeError=function(c){c.asset.name=this._loadingDependency.resolveName(c.asset);this.dispatchEvent(c)};a.prototype.addEventListeners=
function(c){c.addEventListener(b.events.LoaderEvent.DEPENDENCY_COMPLETE,this.onRetrievalComplete,this);c.addEventListener(b.events.LoaderEvent.LOAD_ERROR,this.onRetrievalFailed,this);c.addEventListener(b.events.AssetEvent.TEXTURE_SIZE_ERROR,this.onTextureSizeError,this);c.addEventListener(b.events.AssetEvent.ASSET_COMPLETE,this.onAssetComplete,this);c.addEventListener(b.events.AssetEvent.ANIMATION_SET_COMPLETE,this.onAssetComplete,this);c.addEventListener(b.events.AssetEvent.ANIMATION_STATE_COMPLETE,
this.onAssetComplete,this);c.addEventListener(b.events.AssetEvent.ANIMATION_NODE_COMPLETE,this.onAssetComplete,this);c.addEventListener(b.events.AssetEvent.STATE_TRANSITION_COMPLETE,this.onAssetComplete,this);c.addEventListener(b.events.AssetEvent.TEXTURE_COMPLETE,this.onAssetComplete,this);c.addEventListener(b.events.AssetEvent.CONTAINER_COMPLETE,this.onAssetComplete,this);c.addEventListener(b.events.AssetEvent.GEOMETRY_COMPLETE,this.onAssetComplete,this);c.addEventListener(b.events.AssetEvent.MATERIAL_COMPLETE,
this.onAssetComplete,this);c.addEventListener(b.events.AssetEvent.MESH_COMPLETE,this.onAssetComplete,this);c.addEventListener(b.events.AssetEvent.ENTITY_COMPLETE,this.onAssetComplete,this);c.addEventListener(b.events.AssetEvent.SKELETON_COMPLETE,this.onAssetComplete,this);c.addEventListener(b.events.AssetEvent.SKELETON_POSE_COMPLETE,this.onAssetComplete,this);c.addEventListener(b.events.ParserEvent.READY_FOR_DEPENDENCIES,this.onReadyForDependencies,this);c.addEventListener(b.events.ParserEvent.PARSE_ERROR,
this.onParserError,this)};a.prototype.removeEventListeners=function(c){c.removeEventListener(b.events.ParserEvent.READY_FOR_DEPENDENCIES,this.onReadyForDependencies,this);c.removeEventListener(b.events.LoaderEvent.DEPENDENCY_COMPLETE,this.onRetrievalComplete,this);c.removeEventListener(b.events.LoaderEvent.LOAD_ERROR,this.onRetrievalFailed,this);c.removeEventListener(b.events.AssetEvent.TEXTURE_SIZE_ERROR,this.onTextureSizeError,this);c.removeEventListener(b.events.AssetEvent.ASSET_COMPLETE,this.onAssetComplete,
this);c.removeEventListener(b.events.AssetEvent.ANIMATION_SET_COMPLETE,this.onAssetComplete,this);c.removeEventListener(b.events.AssetEvent.ANIMATION_STATE_COMPLETE,this.onAssetComplete,this);c.removeEventListener(b.events.AssetEvent.ANIMATION_NODE_COMPLETE,this.onAssetComplete,this);c.removeEventListener(b.events.AssetEvent.STATE_TRANSITION_COMPLETE,this.onAssetComplete,this);c.removeEventListener(b.events.AssetEvent.TEXTURE_COMPLETE,this.onAssetComplete,this);c.removeEventListener(b.events.AssetEvent.CONTAINER_COMPLETE,
this.onAssetComplete,this);c.removeEventListener(b.events.AssetEvent.GEOMETRY_COMPLETE,this.onAssetComplete,this);c.removeEventListener(b.events.AssetEvent.MATERIAL_COMPLETE,this.onAssetComplete,this);c.removeEventListener(b.events.AssetEvent.MESH_COMPLETE,this.onAssetComplete,this);c.removeEventListener(b.events.AssetEvent.ENTITY_COMPLETE,this.onAssetComplete,this);c.removeEventListener(b.events.AssetEvent.SKELETON_COMPLETE,this.onAssetComplete,this);c.removeEventListener(b.events.AssetEvent.SKELETON_POSE_COMPLETE,
this.onAssetComplete,this);c.removeEventListener(b.events.ParserEvent.PARSE_ERROR,this.onParserError,this)};a.prototype.stop=function(){this.dispose()};a.prototype.dispose=function(){this._stack=this._token=this._context=this._parseErrorHandlers=this._errorHandlers=null;this._loadingDependency&&this._loadingDependency._iLoader&&this.removeEventListeners(this._loadingDependency._iLoader);this._loadingDependency=null};a.prototype._iAddParseErrorHandler=function(c){0>this._parseErrorHandlers.indexOf(c)&&
this._parseErrorHandlers.push(c)};a.prototype._iAddErrorHandler=function(c){0>this._errorHandlers.indexOf(c)&&this._errorHandlers.push(c)};return a}(b.events.EventDispatcher);g.AssetLoader=e})(b.loaders||(b.loaders={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(){}d.APPEND_NUM_SUFFIX=new b.library.NumSuffixConflictStrategy;d.IGNORE=new b.library.IgnoreConflictStrategy;d.THROW_ERROR=new b.library.ErrorConflictStrategy;return d}();g.ConflictStrategy=e})(b.library||(b.library={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(a){"undefined"===typeof a&&(a=null);this.method=b.net.URLRequestMethod.GET;this.async=!0;this._url=a}Object.defineProperty(d.prototype,"url",{get:function(){return this._url},set:function(a){this._url=a},enumerable:!0,configurable:!0});d.prototype.dispose=function(){this.async=this.method=this._url=this.data=null};return d}();g.URLRequest=e})(b.net||(b.net={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(c){b.call(this);this._iLoader=c}__extends(a,b);a.prototype.addEventListener=function(c,a,b){this._iLoader.addEventListener(c,a,b)};a.prototype.removeEventListener=function(c,a,b){this._iLoader.removeEventListener(c,a,b)};a.prototype.hasEventListener=function(c,a,b){"undefined"===typeof a&&(a=null);"undefined"===typeof b&&(b=null);return this._iLoader.hasEventListener(c,a,b)};return a}(b.events.EventDispatcher);g.AssetLoaderToken=e})(b.loaders||
(b.loaders={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a){"undefined"===typeof a&&(a=null);d.call(this);this._loaderType=b.loaders.ParserLoaderType.URL_LOADER;a&&(this._loaderType=a);this._materialMode=0;this._dataFormat=c;this._dependencies=[]}__extends(a,d);a.supportsType=function(c){throw new b.errors.AbstractMethodError;};a.prototype.isBitmapDataValid=function(c){(c=b.utils.TextureUtils.isBitmapDataValid(c))||console.log(">> Bitmap loaded is not having power of 2 dimensions or is higher than 2048");return c};
Object.defineProperty(a.prototype,"parsingFailure",{get:function(){return this._parsingFailure},set:function(c){this._parsingFailure=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"parsingPaused",{get:function(){return this._parsingPaused},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"parsingComplete",{get:function(){return this._parsingComplete},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"materialMode",{get:function(){return this._materialMode},
set:function(c){this._materialMode=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"loaderType",{get:function(){return this._loaderType},set:function(c){this._loaderType=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"dataFormat",{get:function(){return this._dataFormat},enumerable:!0,configurable:!0});a.prototype.parseAsync=function(c,a){"undefined"===
typeof a&&(a=30);this._data=c;this.startParsing(a)};Object.defineProperty(a.prototype,"dependencies",{get:function(){return this._dependencies},enumerable:!0,configurable:!0});a.prototype._iResolveDependency=function(c){throw new b.errors.AbstractMethodError;};a.prototype._iResolveDependencyFailure=function(c){throw new b.errors.AbstractMethodError;};a.prototype._iResolveDependencyName=function(c,a){return a.name};a.prototype._iResumeParsingAfterDependencies=function(){this._parsingPaused=!1;this._timer&&
this._timer.start()};a.prototype._pFinalizeAsset=function(c,a){"undefined"===typeof a&&(a=null);var d,h;null!=a&&(c.name=a);switch(c.assetType){case b.library.AssetType.LIGHT_PICKER:h="lightPicker";d=b.events.AssetEvent.LIGHTPICKER_COMPLETE;break;case b.library.AssetType.LIGHT:h="light";d=b.events.AssetEvent.LIGHT_COMPLETE;break;case b.library.AssetType.ANIMATOR:h="animator";d=b.events.AssetEvent.ANIMATOR_COMPLETE;break;case b.library.AssetType.ANIMATION_SET:h="animationSet";d=b.events.AssetEvent.ANIMATION_SET_COMPLETE;
break;case b.library.AssetType.ANIMATION_STATE:h="animationState";d=b.events.AssetEvent.ANIMATION_STATE_COMPLETE;break;case b.library.AssetType.ANIMATION_NODE:h="animationNode";d=b.events.AssetEvent.ANIMATION_NODE_COMPLETE;break;case b.library.AssetType.STATE_TRANSITION:h="stateTransition";d=b.events.AssetEvent.STATE_TRANSITION_COMPLETE;break;case b.library.AssetType.TEXTURE:h="texture";d=b.events.AssetEvent.TEXTURE_COMPLETE;break;case b.library.AssetType.TEXTURE_PROJECTOR:h="textureProjector";d=
b.events.AssetEvent.TEXTURE_PROJECTOR_COMPLETE;break;case b.library.AssetType.CONTAINER:h="container";d=b.events.AssetEvent.CONTAINER_COMPLETE;break;case b.library.AssetType.GEOMETRY:h="geometry";d=b.events.AssetEvent.GEOMETRY_COMPLETE;break;case b.library.AssetType.MATERIAL:h="material";d=b.events.AssetEvent.MATERIAL_COMPLETE;break;case b.library.AssetType.MESH:h="mesh";d=b.events.AssetEvent.MESH_COMPLETE;break;case b.library.AssetType.SKELETON:h="skeleton";d=b.events.AssetEvent.SKELETON_COMPLETE;
break;case b.library.AssetType.SKELETON_POSE:h="skelpose";d=b.events.AssetEvent.SKELETON_POSE_COMPLETE;break;case b.library.AssetType.ENTITY:h="entity";d=b.events.AssetEvent.ENTITY_COMPLETE;break;case b.library.AssetType.SKYBOX:h="skybox";d=b.events.AssetEvent.SKYBOX_COMPLETE;break;case b.library.AssetType.CAMERA:h="camera";d=b.events.AssetEvent.CAMERA_COMPLETE;break;case b.library.AssetType.SEGMENT_SET:h="segmentSet";d=b.events.AssetEvent.SEGMENT_SET_COMPLETE;break;case b.library.AssetType.EFFECTS_METHOD:h=
"effectsMethod";d=b.events.AssetEvent.EFFECTMETHOD_COMPLETE;break;case b.library.AssetType.SHADOW_MAP_METHOD:h="effectsMethod";d=b.events.AssetEvent.SHADOWMAPMETHOD_COMPLETE;break;default:throw new b.errors.Error("Unhandled asset type "+c.assetType+". Report as bug!");}c.name||(c.name=h);this.dispatchEvent(new b.events.AssetEvent(b.events.AssetEvent.ASSET_COMPLETE,c));this.dispatchEvent(new b.events.AssetEvent(d,c))};a.prototype._pProceedParsing=function(){throw new b.errors.AbstractMethodError;};
a.prototype._pDieWithError=function(c){"undefined"===typeof c&&(c="Unknown parsing error");this._timer&&(this._timer.removeEventListener(b.events.TimerEvent.TIMER,this._pOnInterval,this),this._timer.stop(),this._timer=null);this.dispatchEvent(new b.events.ParserEvent(b.events.ParserEvent.PARSE_ERROR,c))};a.prototype._pAddDependency=function(c,a,d,h,f){"undefined"===typeof d&&(d=!1);"undefined"===typeof h&&(h=null);"undefined"===typeof f&&(f=!1);this._dependencies.push(new b.loaders.ResourceDependency(c,
a,h,this,d,f))};a.prototype._pPauseAndRetrieveDependencies=function(){this._timer&&this._timer.stop();this._parsingPaused=!0;this.dispatchEvent(new b.events.ParserEvent(b.events.ParserEvent.READY_FOR_DEPENDENCIES))};a.prototype._pHasTime=function(){return b.utils.getTimer()-this._lastFrameTime<this._frameLimit};a.prototype._pOnInterval=function(c){this._lastFrameTime=b.utils.getTimer();this._pProceedParsing()&&!this._parsingFailure&&this._pFinishParsing()};a.prototype.startParsing=function(c){this._frameLimit=
c;this._timer=new b.utils.Timer(this._frameLimit,0);this._timer.addEventListener(b.events.TimerEvent.TIMER,this._pOnInterval,this);this._timer.start()};a.prototype._pFinishParsing=function(){this._timer&&(this._timer.removeEventListener(b.events.TimerEvent.TIMER,this._pOnInterval,this),this._timer.stop());this._timer=null;this._parsingComplete=!0;this.dispatchEvent(new b.events.ParserEvent(b.events.ParserEvent.PARSE_COMPLETE))};a.prototype._pGetTextData=function(){return b.loaders.ParserUtil.toString(this._data)};
a.prototype._pGetByteData=function(){return b.loaders.ParserUtil.toByteArray(this._data)};a.PARSING_DONE=!0;a.MORE_TO_PARSE=!1;return a}(b.events.EventDispatcher);g.ParserBase=e})(b.loaders||(b.loaders={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(){}b.createUID=function(){var a=Array(36),c=0,k,q;for(k=0;8>k;k++)a[c++]=b.ALPHA_CHAR_CODES[Math.floor(16*Math.random())];for(k=0;3>k;k++)for(a[c++]=45,q=0;4>q;q++)a[c++]=b.ALPHA_CHAR_CODES[Math.floor(16*Math.random())];a[c++]=45;q=("0000000"+(new Date).getTime().toString(16).toUpperCase()).substr(-8);for(k=0;8>k;k++)a[c++]=q.charCodeAt(k);for(k=0;4>k;k++)a[c++]=b.ALPHA_CHAR_CODES[Math.floor(16*Math.random())];return String.fromCharCode.apply(null,
a)};b.ALPHA_CHAR_CODES=[48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70];return b}();b.IDUtil=e})(b.library||(b.library={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(c,a,q,h){"undefined"===typeof a&&(a=null);"undefined"===typeof q&&(q=!1);"undefined"===typeof h&&(h=null);b.call(this,c);this._url=a;this._message=h;this._isDependency=q}__extends(a,b);Object.defineProperty(a.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"message",{get:function(){return this._message},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isDependency",
{get:function(){return this._isDependency},enumerable:!0,configurable:!0});a.prototype.clone=function(){return new a(this.type,this._url,this._isDependency,this._message)};a.LOAD_ERROR="loadError";a.RESOURCE_COMPLETE="resourceComplete";a.DEPENDENCY_COMPLETE="dependencyComplete";return a}(b.events.Event);g.LoaderEvent=e})(b.events||(b.events={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(a){}d.getBundle=function(a){"undefined"===typeof a&&(a="default");return b.library.AssetLibraryBundle.getInstance(a)};d.enableParser=function(a){b.loaders.SingleFileLoader.enableParser(a)};d.enableParsers=function(a){b.loaders.SingleFileLoader.enableParsers(a)};Object.defineProperty(d,"conflictStrategy",{get:function(){return b.library.AssetLibrary.getBundle().conflictStrategy},set:function(a){b.library.AssetLibrary.getBundle().conflictStrategy=
a},enumerable:!0,configurable:!0});Object.defineProperty(d,"conflictPrecedence",{get:function(){return b.library.AssetLibrary.getBundle().conflictPrecedence},set:function(a){b.library.AssetLibrary.getBundle().conflictPrecedence=a},enumerable:!0,configurable:!0});d.createIterator=function(a,c,k){"undefined"===typeof a&&(a=null);"undefined"===typeof c&&(c=null);"undefined"===typeof k&&(k=null);return b.library.AssetLibrary.getBundle().createIterator(a,c,k)};d.load=function(a,c,k,d){"undefined"===typeof c&&
(c=null);"undefined"===typeof k&&(k=null);"undefined"===typeof d&&(d=null);return b.library.AssetLibrary.getBundle().load(a,c,k,d)};d.loadData=function(a,c,k,d){"undefined"===typeof c&&(c=null);"undefined"===typeof k&&(k=null);"undefined"===typeof d&&(d=null);return b.library.AssetLibrary.getBundle().loadData(a,c,k,d)};d.stopLoad=function(){b.library.AssetLibrary.getBundle().stopAllLoadingSessions()};d.getAsset=function(a,c){"undefined"===typeof c&&(c=null);return b.library.AssetLibrary.getBundle().getAsset(a,
c)};d.addEventListener=function(a,c,k){b.library.AssetLibrary.getBundle().addEventListener(a,c,k)};d.removeEventListener=function(a,c,k){b.library.AssetLibrary.getBundle().removeEventListener(a,c,k)};d.addAsset=function(a){b.library.AssetLibrary.getBundle().addAsset(a)};d.removeAsset=function(a,c){"undefined"===typeof c&&(c=!0);b.library.AssetLibrary.getBundle().removeAsset(a,c)};d.removeAssetByName=function(a,c,k){"undefined"===typeof c&&(c=null);"undefined"===typeof k&&(k=!0);return b.library.AssetLibrary.getBundle().removeAssetByName(a,
c,k)};d.removeAllAssets=function(a){"undefined"===typeof a&&(a=!0);b.library.AssetLibrary.getBundle().removeAllAssets(a)};d.removeNamespaceAssets=function(a,c){"undefined"===typeof a&&(a=null);"undefined"===typeof c&&(c=!0);b.library.AssetLibrary.getBundle().removeNamespaceAssets(a,c)};d._iInstances={};return d}();g.AssetLibrary=e})(b.library||(b.library={}))})(away||(away={}));var AssetLibrarySingletonEnforcer=function(){return function(){}}();
(function(b){(function(g){var e=function(d){function a(c){"undefined"===typeof c&&(c="");d.call(this);this._name="";this._loaded=!1;this._name=c;this.initImage()}__extends(a,d);a.prototype.load=function(c){this._loaded=!1;this._request=c;this._crossOrigin&&null!=this._image.crossOrigin&&(this._image.crossOrigin=this._crossOrigin);this._image.src=this._request.url};a.prototype.dispose=function(){this._image&&(this._image.onabort=null,this._image.onerror=null,this._image=this._image.onload=null);this._request&&
(this._request=null)};Object.defineProperty(a.prototype,"image",{get:function(){return this._image},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"loaded",{get:function(){return this._loaded},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"crossOrigin",{get:function(){return this._crossOrigin},set:function(c){this._crossOrigin=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return this._image?this._image.width:null},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._image?this._image.height:null},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"request",{get:function(){return this._request},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"name",{get:function(){return this._image?this._image.name:this._name},set:function(c){this._image&&(this._image.name=c);this._name=c},enumerable:!0,configurable:!0});a.prototype.initImage=
function(){var c=this;this._image||(this._image=new Image,this._image.onabort=function(a){return c.onAbort(a)},this._image.onerror=function(a){return c.onError(a)},this._image.onload=function(a){return c.onLoadComplete(a)},this._image.name=this._name)};a.prototype.onAbort=function(c){this.dispatchEvent(new b.events.Event(b.events.IOErrorEvent.IO_ERROR))};a.prototype.onError=function(c){this.dispatchEvent(new b.events.Event(b.events.IOErrorEvent.IO_ERROR))};a.prototype.onLoadComplete=function(c){this._loaded=
!0;this.dispatchEvent(new b.events.Event(b.events.Event.COMPLETE))};return a}(b.events.EventDispatcher);g.IMGLoader=e})(b.net||(b.net={}))})(away||(away={}));(function(b){(function(g){var e=function(b){function a(c){b.call(this,c)}__extends(a,b);a.IO_ERROR="IOErrorEvent_IO_ERROR";return a}(b.events.Event);g.IOErrorEvent=e})(b.events||(b.events={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(c,a){"undefined"===typeof a&&(a=null);b.call(this,c);this.status=a}__extends(a,b);a.HTTP_STATUS="HTTPStatusEvent_HTTP_STATUS";return a}(b.events.Event);g.HTTPStatusEvent=e})(b.events||(b.events={}))})(away||(away={}));(function(b){(function(g){var e=function(b){function a(c){b.call(this,c)}__extends(a,b);a.PROGRESS="ProgressEvent_progress";return a}(b.events.Event);g.ProgressEvent=e})(b.events||(b.events={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(){}b.TEXT="text";b.VARIABLES="variables";b.BLOB="blob";b.ARRAY_BUFFER="arraybuffer";b.BINARY="binary";return b}();b.URLLoaderDataFormat=e})(b.net||(b.net={}))})(away||(away={}));(function(b){(function(b){var e=function(){function b(){}b.POST="POST";b.GET="GET";return b}();b.URLRequestMethod=e})(b.net||(b.net={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._bytesTotal=this._bytesLoaded=0;this._dataFormat=b.net.URLLoaderDataFormat.TEXT;this._loadError=!1}__extends(a,d);a.prototype.load=function(c){this.initXHR();this._request=c;c.method===b.net.URLRequestMethod.POST?this.postRequest(c):this.getRequest(c)};a.prototype.close=function(){this._XHR.abort();this.disposeXHR()};a.prototype.dispose=function(){this._XHR&&this._XHR.abort();this.disposeXHR();this._request=this._bytesTotal=
this._bytesLoaded=this._dataFormat=this._data=null};Object.defineProperty(a.prototype,"dataFormat",{get:function(){return this._dataFormat},set:function(c){if(c===b.net.URLLoaderDataFormat.BLOB||c===b.net.URLLoaderDataFormat.ARRAY_BUFFER||c===b.net.URLLoaderDataFormat.BINARY||c===b.net.URLLoaderDataFormat.TEXT||c===b.net.URLLoaderDataFormat.VARIABLES)this._dataFormat=c;else throw new b.errors.Error("URLLoader error: incompatible dataFormat");},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"data",{get:function(){return this._data},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"bytesLoaded",{get:function(){return this._bytesLoaded},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"bytesTotal",{get:function(){return this._bytesTotal},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"request",{get:function(){return this._request},enumerable:!0,configurable:!0});a.prototype.setResponseType=function(c,a){switch(a){case b.net.URLLoaderDataFormat.ARRAY_BUFFER:case b.net.URLLoaderDataFormat.BLOB:case b.net.URLLoaderDataFormat.TEXT:c.responseType=
a;break;case b.net.URLLoaderDataFormat.VARIABLES:c.responseType=b.net.URLLoaderDataFormat.TEXT;break;case b.net.URLLoaderDataFormat.BINARY:c.responseType=""}};a.prototype.getRequest=function(c){try{this._XHR.open(c.method,c.url,c.async),this.setResponseType(this._XHR,this._dataFormat),this._XHR.send()}catch(a){this.handleXmlHttpRequestException(a)}};a.prototype.postRequest=function(c){this._loadError=!1;this._XHR.open(c.method,c.url,c.async);if(null!=c.data)if(c.data instanceof b.net.URLVariables){c=
c.data;try{this._XHR.responseType="text",this._XHR.send(c.formData)}catch(a){this.handleXmlHttpRequestException(a)}}else this.setResponseType(this._XHR,this._dataFormat),c.data?this._XHR.send(c.data):this._XHR.send();else this._XHR.send()};a.prototype.handleXmlHttpRequestException=function(c){};a.prototype.initXHR=function(){var c=this;this._XHR||(this._XHR=new XMLHttpRequest,this._XHR.onloadstart=function(a){return c.onLoadStart(a)},this._XHR.onprogress=function(a){return c.onProgress(a)},this._XHR.onabort=
function(a){return c.onAbort(a)},this._XHR.onerror=function(a){return c.onLoadError(a)},this._XHR.onload=function(a){return c.onLoadComplete(a)},this._XHR.ontimeout=function(a){return c.onTimeOut(a)},this._XHR.onloadend=function(a){return c.onLoadEnd(a)},this._XHR.onreadystatechange=function(a){return c.onReadyStateChange(a)})};a.prototype.disposeXHR=function(){null!==this._XHR&&(this._XHR.onloadstart=null,this._XHR.onprogress=null,this._XHR.onabort=null,this._XHR.onerror=null,this._XHR.onload=null,
this._XHR.ontimeout=null,this._XHR=this._XHR.onloadend=null)};a.prototype.decodeURLVariables=function(c){var a={};c=c.split("+").join(" ");for(var b,d=/[?&]?([^=]+)=([^&]*)/g;b=d.exec(c);)a[decodeURIComponent(b[1])]=decodeURIComponent(b[2]);return a};a.prototype.onReadyStateChange=function(c){4==this._XHR.readyState&&(404==this._XHR.status&&(this._loadError=!0,this.dispatchEvent(new b.events.IOErrorEvent(b.events.IOErrorEvent.IO_ERROR))),this.dispatchEvent(new b.events.HTTPStatusEvent(b.events.HTTPStatusEvent.HTTP_STATUS,
this._XHR.status)))};a.prototype.onLoadEnd=function(c){};a.prototype.onTimeOut=function(c){};a.prototype.onAbort=function(c){};a.prototype.onProgress=function(c){this._bytesTotal=c.total;this._bytesLoaded=c.loaded;c=new b.events.ProgressEvent(b.events.ProgressEvent.PROGRESS);c.bytesLoaded=this._bytesLoaded;c.bytesTotal=this._bytesTotal;this.dispatchEvent(c)};a.prototype.onLoadStart=function(c){this.dispatchEvent(new b.events.Event(b.events.Event.OPEN))};a.prototype.onLoadComplete=function(c){if(!0!==
this._loadError){switch(this._dataFormat){case b.net.URLLoaderDataFormat.TEXT:this._data=this._XHR.responseText;break;case b.net.URLLoaderDataFormat.VARIABLES:this._data=this.decodeURLVariables(this._XHR.responseText);break;case b.net.URLLoaderDataFormat.BLOB:case b.net.URLLoaderDataFormat.ARRAY_BUFFER:case b.net.URLLoaderDataFormat.BINARY:this._data=this._XHR.response;break;default:this._data=this._XHR.responseText}this.dispatchEvent(new b.events.Event(b.events.Event.COMPLETE))}};a.prototype.onLoadError=
function(c){this._loadError=!0;this.dispatchEvent(new b.events.IOErrorEvent(b.events.IOErrorEvent.IO_ERROR))};return a}(b.events.EventDispatcher);g.URLLoader=e})(b.net||(b.net={}))})(away||(away={}));(function(b){(function(b){var e=function(){function b(){}b.BINARY="binary";b.PLAIN_TEXT="plainText";b.IMAGE="image";return b}();b.ParserDataFormat=e})(b.loaders||(b.loaders={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this,b.loaders.ParserDataFormat.IMAGE,b.loaders.ParserLoaderType.IMG_LOADER)}__extends(a,d);a.supportsType=function(c){c=c.toLowerCase();return"jpg"==c||"jpeg"==c||"png"==c||"gif"==c};a.supportsData=function(c){if(c instanceof HTMLImageElement)return!0;if(!(c instanceof b.utils.ByteArray))return!1;c.position=0;if(65496==c.readUnsignedShort())return!0;c.position=0;if(16973==c.readShort())return!0;c.position=1;if("PNG"==c.readUTFBytes(3))return!0;
c.position=0;if("GIF"==c.readUTFBytes(3)&&14393==c.readShort()&&97==c.readByte())return!0;c.position=0;return"ATF"==c.readUTFBytes(3)?!0:!1};a.prototype._pProceedParsing=function(){var c,a=!1;this.data instanceof HTMLImageElement?b.utils.TextureUtils.isHTMLImageElementValid(this.data)?(c=new b.textures.HTMLImageElementTexture(this.data,!1),this._pFinalizeAsset(c,this._iFileName)):a=!0:this.data instanceof b.utils.ByteArray&&(this.data.position=0,c=b.loaders.ParserUtil.byteArrayToImage(this.data),
b.utils.TextureUtils.isHTMLImageElementValid(c)?(c=new b.textures.HTMLImageElementTexture(c,!1),this._pFinalizeAsset(c,this._iFileName)):a=!0);!0==a&&(c=new b.textures.BitmapTexture(b.materials.DefaultMaterialManager.createCheckeredBitmapData(),!1),this._pFinalizeAsset(c,this._iFileName),this.dispatchEvent(new b.events.AssetEvent(b.events.AssetEvent.TEXTURE_SIZE_ERROR,c)));return b.loaders.ParserBase.PARSING_DONE};return a}(b.loaders.ParserBase);g.ImageParser=e})(b.loaders||(b.loaders={}))})(away||
(away={}));
(function(b){(function(g){var e=function(d){function a(c){"undefined"===typeof c&&(c=0);d.call(this);this._materialMode=c}__extends(a,d);a.enableParser=function(c){0>a._parsers.indexOf(c)&&a._parsers.push(c)};a.enableParsers=function(c){for(var b=0;b<c.length;b++)a.enableParser(c[b])};Object.defineProperty(a.prototype,"url",{get:function(){return this._req?this._req.url:""},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"loadAsRawData",{get:function(){return this._loadAsRawData},enumerable:!0,configurable:!0});a.prototype.load=function(c,a,d){"undefined"===typeof a&&(a=null);"undefined"===typeof d&&(d=!1);var h,f=b.loaders.ParserLoaderType.URL_LOADER;this._loadAsRawData=d;this._req=c;this.decomposeFilename(this._req.url);if(this._loadAsRawData)h=b.net.URLLoaderDataFormat.BINARY;else if(a&&(this._parser=a),this._parser||(this._parser=this.getParserFromSuffix()),this._parser){switch(this._parser.dataFormat){case b.loaders.ParserDataFormat.BINARY:h=
b.net.URLLoaderDataFormat.ARRAY_BUFFER;break;case b.loaders.ParserDataFormat.PLAIN_TEXT:h=b.net.URLLoaderDataFormat.TEXT}switch(this._parser.loaderType){case b.loaders.ParserLoaderType.IMG_LOADER:f=b.loaders.ParserLoaderType.IMG_LOADER;break;case b.loaders.ParserLoaderType.URL_LOADER:f=b.loaders.ParserLoaderType.URL_LOADER}}else h=b.net.URLLoaderDataFormat.BINARY;a=this.getLoader(f);a.dataFormat=h;a.addEventListener(b.events.Event.COMPLETE,this.handleUrlLoaderComplete,this);a.addEventListener(b.events.IOErrorEvent.IO_ERROR,
this.handleUrlLoaderError,this);a.load(c)};a.prototype.parseData=function(c,a,b){"undefined"===typeof a&&(a=null);"undefined"===typeof b&&(b=null);c.constructor===Function&&(c=new c);a&&(this._parser=a);this._req=b;this.parse(c)};Object.defineProperty(a.prototype,"parser",{get:function(){return this._parser},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"dependencies",{get:function(){return this._parser?this._parser.dependencies:[]},enumerable:!0,configurable:!0});a.prototype.getLoader=
function(c){var a;switch(c){case b.loaders.ParserLoaderType.IMG_LOADER:a=new b.loaders.SingleFileImageLoader;break;case b.loaders.ParserLoaderType.URL_LOADER:a=new b.loaders.SingleFileURLLoader}return a};a.prototype.decomposeFilename=function(c){c=0<c.indexOf("?")?c.split("?")[0]:c;var a=c.lastIndexOf(".");this._fileExtension=c.substr(a+1).toLowerCase();this._fileName=c.substr(0,a)};a.prototype.getParserFromSuffix=function(){for(var c=a._parsers.length-1;0<=c;c--)if(a._parsers[c].supportsType(this._fileExtension),
a._parsers[c].supportsType(this._fileExtension))return new a._parsers[c];return null};a.prototype.getParserFromData=function(c){for(var b=a._parsers.length-1;0<=b;b--)if(a._parsers[b].supportsData(c))return new a._parsers[b];return null};a.prototype.removeListeners=function(c){c.removeEventListener(b.events.Event.COMPLETE,this.handleUrlLoaderComplete,this);c.removeEventListener(b.events.IOErrorEvent.IO_ERROR,this.handleUrlLoaderError,this)};a.prototype.handleUrlLoaderError=function(c){this.removeListeners(c.target);
this.dispatchEvent(new b.events.LoaderEvent(b.events.LoaderEvent.LOAD_ERROR,this._req.url,!0))};a.prototype.handleUrlLoaderComplete=function(c){c=c.target;this.removeListeners(c);this._data=c.data;this._loadAsRawData?this.dispatchEvent(new b.events.LoaderEvent(b.events.LoaderEvent.DEPENDENCY_COMPLETE)):this.parse(this._data)};a.prototype.parse=function(c){this._parser||(this._parser=this.getParserFromData(c));this._parser?(this._parser.addEventListener(b.events.ParserEvent.READY_FOR_DEPENDENCIES,
this.onReadyForDependencies,this),this._parser.addEventListener(b.events.ParserEvent.PARSE_ERROR,this.onParseError,this),this._parser.addEventListener(b.events.ParserEvent.PARSE_COMPLETE,this.onParseComplete,this),this._parser.addEventListener(b.events.AssetEvent.TEXTURE_SIZE_ERROR,this.onTextureSizeError,this),this._parser.addEventListener(b.events.AssetEvent.ASSET_COMPLETE,this.onAssetComplete,this),this._parser.addEventListener(b.events.AssetEvent.ANIMATION_SET_COMPLETE,this.onAssetComplete,this),
this._parser.addEventListener(b.events.AssetEvent.ANIMATION_STATE_COMPLETE,this.onAssetComplete,this),this._parser.addEventListener(b.events.AssetEvent.ANIMATION_NODE_COMPLETE,this.onAssetComplete,this),this._parser.addEventListener(b.events.AssetEvent.STATE_TRANSITION_COMPLETE,this.onAssetComplete,this),this._parser.addEventListener(b.events.AssetEvent.TEXTURE_COMPLETE,this.onAssetComplete,this),this._parser.addEventListener(b.events.AssetEvent.CONTAINER_COMPLETE,this.onAssetComplete,this),this._parser.addEventListener(b.events.AssetEvent.GEOMETRY_COMPLETE,
this.onAssetComplete,this),this._parser.addEventListener(b.events.AssetEvent.MATERIAL_COMPLETE,this.onAssetComplete,this),this._parser.addEventListener(b.events.AssetEvent.MESH_COMPLETE,this.onAssetComplete,this),this._parser.addEventListener(b.events.AssetEvent.ENTITY_COMPLETE,this.onAssetComplete,this),this._parser.addEventListener(b.events.AssetEvent.SKELETON_COMPLETE,this.onAssetComplete,this),this._parser.addEventListener(b.events.AssetEvent.SKELETON_POSE_COMPLETE,this.onAssetComplete,this),
this._req&&this._req.url&&(this._parser._iFileName=this._req.url),this._parser.materialMode=this._materialMode,this._parser.parseAsync(c)):this.dispatchEvent(new b.events.LoaderEvent(b.events.LoaderEvent.LOAD_ERROR,"",!0,"No parser defined. To enable all parsers for auto-detection, use Parsers.enableAllBundled()"))};a.prototype.onParseError=function(c){this.dispatchEvent(c.clone())};a.prototype.onReadyForDependencies=function(c){this.dispatchEvent(c.clone())};a.prototype.onAssetComplete=function(c){this.dispatchEvent(c.clone())};
a.prototype.onTextureSizeError=function(c){this.dispatchEvent(c.clone())};a.prototype.onParseComplete=function(c){this.dispatchEvent(new b.events.LoaderEvent(b.events.LoaderEvent.DEPENDENCY_COMPLETE,this.url));this._parser.removeEventListener(b.events.ParserEvent.READY_FOR_DEPENDENCIES,this.onReadyForDependencies,this);this._parser.removeEventListener(b.events.ParserEvent.PARSE_COMPLETE,this.onParseComplete,this);this._parser.removeEventListener(b.events.ParserEvent.PARSE_ERROR,this.onParseError,
this);this._parser.removeEventListener(b.events.AssetEvent.TEXTURE_SIZE_ERROR,this.onTextureSizeError,this);this._parser.removeEventListener(b.events.AssetEvent.ASSET_COMPLETE,this.onAssetComplete,this);this._parser.removeEventListener(b.events.AssetEvent.ANIMATION_SET_COMPLETE,this.onAssetComplete,this);this._parser.removeEventListener(b.events.AssetEvent.ANIMATION_STATE_COMPLETE,this.onAssetComplete,this);this._parser.removeEventListener(b.events.AssetEvent.ANIMATION_NODE_COMPLETE,this.onAssetComplete,
this);this._parser.removeEventListener(b.events.AssetEvent.STATE_TRANSITION_COMPLETE,this.onAssetComplete,this);this._parser.removeEventListener(b.events.AssetEvent.TEXTURE_COMPLETE,this.onAssetComplete,this);this._parser.removeEventListener(b.events.AssetEvent.CONTAINER_COMPLETE,this.onAssetComplete,this);this._parser.removeEventListener(b.events.AssetEvent.GEOMETRY_COMPLETE,this.onAssetComplete,this);this._parser.removeEventListener(b.events.AssetEvent.MATERIAL_COMPLETE,this.onAssetComplete,this);
this._parser.removeEventListener(b.events.AssetEvent.MESH_COMPLETE,this.onAssetComplete,this);this._parser.removeEventListener(b.events.AssetEvent.ENTITY_COMPLETE,this.onAssetComplete,this);this._parser.removeEventListener(b.events.AssetEvent.SKELETON_COMPLETE,this.onAssetComplete,this);this._parser.removeEventListener(b.events.AssetEvent.SKELETON_POSE_COMPLETE,this.onAssetComplete,this)};a._parsers=Array(b.loaders.ImageParser);return a}(b.events.EventDispatcher);g.SingleFileLoader=e})(b.loaders||
(b.loaders={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this.initLoader()}__extends(a,d);a.prototype.load=function(c){this._loader.load(c)};a.prototype.dispose=function(){this.disposeLoader();this._data=null};Object.defineProperty(a.prototype,"data",{get:function(){return this._loader.image},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"dataFormat",{get:function(){return this._dataFormat},set:function(c){this._dataFormat=c},enumerable:!0,configurable:!0});a.prototype.initLoader=
function(){this._loader||(this._loader=new b.net.IMGLoader,this._loader.addEventListener(b.events.Event.COMPLETE,this.onLoadComplete,this),this._loader.addEventListener(b.events.IOErrorEvent.IO_ERROR,this.onLoadError,this))};a.prototype.disposeLoader=function(){this._loader&&(this._loader.dispose(),this._loader.removeEventListener(b.events.Event.COMPLETE,this.onLoadComplete,this),this._loader.removeEventListener(b.events.IOErrorEvent.IO_ERROR,this.onLoadError,this),this._loader=null)};a.prototype.onLoadComplete=
function(c){this.dispatchEvent(c)};a.prototype.onLoadError=function(c){this.dispatchEvent(c)};return a}(b.events.EventDispatcher);g.SingleFileImageLoader=e})(b.loaders||(b.loaders={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this.initLoader()}__extends(a,d);a.prototype.load=function(c){this._loader.load(c)};a.prototype.dispose=function(){this.disposeLoader();this._data=null};Object.defineProperty(a.prototype,"data",{get:function(){return this._loader.data},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"dataFormat",{get:function(){return this._loader.dataFormat},set:function(c){this._loader.dataFormat=c},enumerable:!0,configurable:!0});
a.prototype.initLoader=function(){this._loader||(this._loader=new b.net.URLLoader,this._loader.addEventListener(b.events.Event.COMPLETE,this.onLoadComplete,this),this._loader.addEventListener(b.events.IOErrorEvent.IO_ERROR,this.onLoadError,this))};a.prototype.disposeLoader=function(){this._loader&&(this._loader.dispose(),this._loader.removeEventListener(b.events.Event.COMPLETE,this.onLoadComplete,this),this._loader.removeEventListener(b.events.IOErrorEvent.IO_ERROR,this.onLoadError,this),this._loader=
null)};a.prototype.onLoadComplete=function(c){this.dispatchEvent(c)};a.prototype.onLoadError=function(c){this.dispatchEvent(c)};return a}(b.events.EventDispatcher);g.SingleFileURLLoader=e})(b.loaders||(b.loaders={}))})(away||(away={}));(function(b){(function(b){var e=function(){function b(){}b.URL_LOADER="ParserLoaderType_URLLoader";b.IMG_LOADER="ParserLoaderType_IMGLoader";return b}();b.ParserLoaderType=e})(b.loaders||(b.loaders={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(){}d.byteArrayToImage=function(a){var c="";a=new Uint8Array(a.arraybytes);for(var b=a.byteLength,d=0;d<b;d++)c+=String.fromCharCode(a[d]);c="data:image/png;base64,"+window.btoa(c);a=new Image;a.src=c;return a};d.toByteArray=function(a){var c=new b.utils.ByteArray;c.setArrayBuffer(a);return c};d.toString=function(a,c){"undefined"===typeof c&&(c=0);return null!=a.substr?a.substr(0,a.length):a instanceof b.utils.ByteArray?(a.position=0,a.readUTFBytes(Math.min(a.getBytesAvailable(),
c))):null};return d}();g.ParserUtil=e})(b.loaders||(b.loaders={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c){"undefined"===typeof c&&(c=1);d.call(this,g.ParserDataFormat.PLAIN_TEXT);this._mtlLibLoaded=!0;this._activeMaterialID="";this._scale=c}__extends(a,d);Object.defineProperty(a.prototype,"scale",{set:function(c){this._scale=c},enumerable:!0,configurable:!0});a.supportsType=function(c){c=c.toLowerCase();return"obj"==c};a.supportsData=function(c){c=b.loaders.ParserUtil.toString(c);var a=!1,d=!1;c&&(a=-1!=c.indexOf("\nv "),d=-1!=c.indexOf("\nf "));
return a&&d};a.prototype._iResolveDependency=function(c){if("mtl"==c.id)c=b.loaders.ParserUtil.toString(c.data),this.parseMtl(c);else{var a;if(1==c.assets.length&&(a=c.assets[0],a.assetType==b.library.AssetType.TEXTURE)){var d=new LoadedMaterial;d.materialID=c.id;d.texture=a;this._materialLoaded.push(d);0<this._meshes.length&&this.applyMaterial(d)}}};a.prototype._iResolveDependencyFailure=function(c){if("mtl"==c.id)this._mtlLibLoaded=this._mtlLib=!1;else{var a=new LoadedMaterial;a.materialID=c.id;
this._materialLoaded.push(a)}0<this._meshes.length&&this.applyMaterial(a)};a.prototype._pProceedParsing=function(){var c,a=String.fromCharCode(10);this._startedParsing||(this._textData=this._pGetTextData(),this._textData=this._textData.replace(/\\[\r\n]+\s*/gm," "));-1==this._textData.indexOf(a)&&(a=String.fromCharCode(13));this._startedParsing||(this._startedParsing=!0,this._vertices=[],this._vertexNormals=[],this._materialIDs=[],this._materialLoaded=[],this._meshes=[],this._uvs=[],this._stringLength=
this._textData.length,this._charIndex=this._textData.indexOf(a,0),this._oldIndex=0,this._objects=[],this._objectIndex=0);for(;this._charIndex<this._stringLength&&this._pHasTime();)if(this._charIndex=this._textData.indexOf(a,this._oldIndex),-1==this._charIndex&&(this._charIndex=this._stringLength),c=this._textData.substring(this._oldIndex,this._charIndex),c=c.split("\r").join(""),c=c.replace("  "," "),c=c.split(" "),this._oldIndex=this._charIndex+1,this.parseLine(c),this.parsingPaused)return b.loaders.ParserBase.MORE_TO_PARSE;
if(this._charIndex>=this._stringLength){if(this._mtlLib&&!this._mtlLibLoaded)return b.loaders.ParserBase.MORE_TO_PARSE;this.translate();this.applyMaterials();return b.loaders.ParserBase.PARSING_DONE}return b.loaders.ParserBase.MORE_TO_PARSE};a.prototype.parseLine=function(c){switch(c[0]){case "mtllib":this._mtlLib=!0;this._mtlLibLoaded=!1;this.loadMtl(c[1]);break;case "g":this.createGroup(c);break;case "o":this.createObject(c);break;case "usemtl":this._mtlLib&&(c[1]||(c[1]="def000"),this._materialIDs.push(c[1]),
this._activeMaterialID=c[1],this._currentGroup&&(this._currentGroup.materialID=this._activeMaterialID));break;case "v":this.parseVertex(c);break;case "vt":this.parseUV(c);break;case "vn":this.parseVertexNormal(c);break;case "f":this.parseFace(c)}};a.prototype.translate=function(){for(var c=0;c<this._objects.length;++c)for(var a=this._objects[c].groups,d=a.length,h,f,l,e,g=0;g<d;++g){l=new b.base.Geometry;h=a[g].materialGroups;f=h.length;for(e=0;e<f;++e)this.translateMaterialGroup(h[e],l);if(0!=l.subGeometries.length){this._pFinalizeAsset(l);
h=2>this.materialMode?new b.materials.TextureMaterial(b.materials.DefaultMaterialManager.getDefaultTexture()):new b.materials.TextureMultiPassMaterial(b.materials.DefaultMaterialManager.getDefaultTexture());l=new b.entities.Mesh(l,h);l.name=this._objects[c].name?this._objects[c].name:a[g].name?a[g].name:"";this._meshes.push(l);h.name=""!=a[g].materialID?a[g].materialID+"~"+l.name:this._lastMtlID+"~"+l.name;if(1<l.subMeshes.length)for(f=1;f<l.subMeshes.length;++f)l.subMeshes[f].material=h;this._pFinalizeAsset(l)}}};
a.prototype.translateMaterialGroup=function(c,a){var d=c.faces,h,f=d.length,l,e=[],g=[],m=[],n=[];this._realIndices=[];this._vertexIndex=0;for(var p,r=0;r<f;++r)for(h=d[r],l=h.indexIds.length-1,p=1;p<l;++p)this.translateVertexData(h,p,e,g,n,m),this.translateVertexData(h,0,e,g,n,m),this.translateVertexData(h,p+1,e,g,n,m);if(0<e.length)for(d=b.utils.GeometryUtils.fromVectors(e,n,g,m,null,null,null),r=0;r<d.length;r++)a.addSubGeometry(d[r])};a.prototype.translateVertexData=function(c,a,b,d,f,l){var e,
g,m;if(this._realIndices[c.indexIds[a]])e=this._realIndices[c.indexIds[a]]-1;else if(e=this._vertexIndex,this._realIndices[c.indexIds[a]]=++this._vertexIndex,g=this._vertices[c.vertexIndices[a]-1],b.push(g.x*this._scale,g.y*this._scale,g.z*this._scale),0<c.normalIndices.length&&(b=this._vertexNormals[c.normalIndices[a]-1],l.push(b.x,b.y,b.z)),0<c.uvIndices.length)try{m=this._uvs[c.uvIndices[a]-1],d.push(m.u,m.v)}catch(n){switch(a){case 0:d.push(0,1);break;case 1:d.push(0.5,0);break;case 2:d.push(1,
1)}}f.push(e)};a.prototype.createObject=function(c){this._currentMaterialGroup=this._currentGroup=null;this._objects.push(this._currentObject=new ObjectGroup);c&&(this._currentObject.name=c[1])};a.prototype.createGroup=function(c){this._currentObject||this.createObject(null);this._currentGroup=new Group;this._currentGroup.materialID=this._activeMaterialID;c&&(this._currentGroup.name=c[1]);this._currentObject.groups.push(this._currentGroup);this.createMaterialGroup(null)};a.prototype.createMaterialGroup=
function(c){this._currentMaterialGroup=new MaterialGroup;c&&(this._currentMaterialGroup.url=c[1]);this._currentGroup.materialGroups.push(this._currentMaterialGroup)};a.prototype.parseVertex=function(c){var a,b;if(4<c.length){var d=[];for(b=1;b<c.length;++b)a=parseFloat(c[b]),isNaN(a)||d.push(a);a=d[0];b=d[1];c=-d[2]}else a=parseFloat(c[1]),b=parseFloat(c[2]),c=-parseFloat(c[3]);this._vertices.push(new Vertex(a,b,c))};a.prototype.parseUV=function(c){if(3<c.length){for(var a=[],b,d=1;d<c.length;++d)b=
parseFloat(c[d]),isNaN(b)||a.push(b);this._uvs.push(new UV(a[0],1-a[1]))}else this._uvs.push(new UV(parseFloat(c[1]),1-parseFloat(c[2])))};a.prototype.parseVertexNormal=function(c){if(4<c.length){for(var a=[],b,d=1;d<c.length;++d)b=parseFloat(c[d]),isNaN(b)||a.push(b);this._vertexNormals.push(new Vertex(a[0],a[1],-a[2]))}else this._vertexNormals.push(new Vertex(parseFloat(c[1]),parseFloat(c[2]),-parseFloat(c[3])))};a.prototype.parseFace=function(c){var a=c.length,b=new FaceData;this._currentGroup||
this.createGroup(null);for(var d,f=1;f<a;++f)""!=c[f]&&(d=c[f].split("/"),b.vertexIndices.push(this.parseIndex(parseInt(d[0]),this._vertices.length)),d[1]&&0<String(d[1]).length&&b.uvIndices.push(this.parseIndex(parseInt(d[1]),this._uvs.length)),d[2]&&0<String(d[2]).length&&b.normalIndices.push(this.parseIndex(parseInt(d[2]),this._vertexNormals.length)),b.indexIds.push(c[f]));this._currentMaterialGroup.faces.push(b)};a.prototype.parseIndex=function(c,a){return 0>c?c+a+1:c};a.prototype.parseMtl=function(c){c=
c.split("newmtl");for(var a,d,h,f,l,e,g,m,n,p,r,t=0;t<c.length;++t){a=c[t].split("\r").join("").split("\n");1==a.length&&(a=c[t].split(String.fromCharCode(13)));e=g=m=16777215;n=0;l=f=!1;p=1;r="";for(h=0;h<a.length;++h)if(a[h]=a[h].replace(/\s+$/,""),"#"!=a[h].substring(0,1)&&(0==h||""!=a[h])){d=a[h].split(" ");if(9==String(d[0]).charCodeAt(0)||32==String(d[0]).charCodeAt(0))d[0]=d[0].substring(1,d[0].length);if(0==h)this._lastMtlID=d.join(""),this._lastMtlID=""==this._lastMtlID?"def000":this._lastMtlID;
else switch(d[0]){case "Ka":d[1]&&(!isNaN(Number(d[1]))&&d[2]&&!isNaN(Number(d[2]))&&d[3]&&!isNaN(Number(d[3])))&&(g=255*d[1]<<16|255*d[2]<<8|255*d[3]);break;case "Ks":d[1]&&(!isNaN(Number(d[1]))&&d[2]&&!isNaN(Number(d[2]))&&d[3]&&!isNaN(Number(d[3])))&&(m=255*d[1]<<16|255*d[2]<<8|255*d[3],f=!0);break;case "Ns":d[1]&&!isNaN(Number(d[1]))&&(n=0.0010*Number(d[1]));0==n&&(f=!1);break;case "Kd":d[1]&&(!isNaN(Number(d[1]))&&d[2]&&!isNaN(Number(d[2]))&&d[3]&&!isNaN(Number(d[3])))&&(e=255*d[1]<<16|255*d[2]<<
8|255*d[3],l=!0);break;case "tr":case "d":d[1]&&!isNaN(Number(d[1]))&&(p=Number(d[1]));break;case "map_Kd":r=this.parseMapKdString(d),r=r.replace(/\\/g,"/")}}""!=r?(f&&(f=new b.materials.BasicSpecularMethod,f.specularColor=m,f.specular=n,m=new SpecularData,m.alpha=p,m.basicSpecularMethod=f,m.materialID=this._lastMtlID,this._materialSpecularData||(this._materialSpecularData=[]),this._materialSpecularData.push(m)),this._pAddDependency(this._lastMtlID,new b.net.URLRequest(r))):l&&!isNaN(e)&&(r=new LoadedMaterial,
r.materialID=this._lastMtlID,0==p&&console.log("Warning: an alpha value of 0 was found in mtl color tag (Tr or d) ref:"+this._lastMtlID+", mesh(es) using it will be invisible!"),2>this.materialMode?(a=e=new b.materials.ColorMaterial(e),a.alpha=p,a.ambientColor=g,a.repeat=!0,f&&(a.specularColor=m,a.specular=n)):(p=e=new b.materials.ColorMultiPassMaterial(e),p.ambientColor=g,p.repeat=!0,f&&(p.specularColor=m,p.specular=n)),r.cm=e,this._materialLoaded.push(r),0<this._meshes.length&&this.applyMaterial(r))}this._mtlLibLoaded=
!0};a.prototype.parseMapKdString=function(c){var a="",b;for(b=1;b<c.length;){switch(c[b]){case "-blendu":case "-blendv":case "-cc":case "-clamp":case "-texres":b+=2;break;case "-mm":b+=3;break;case "-o":case "-s":case "-t":b+=4;continue}break}for(b;b<c.length;b++)a+=c[b],a+=" ";return a=a.replace(/\s+$/,"")};a.prototype.loadMtl=function(c){this._pAddDependency("mtl",new b.net.URLRequest(c),!0);this._pPauseAndRetrieveDependencies()};a.prototype.applyMaterial=function(c){for(var a,b,d,f,l,e=0;e<this._meshes.length;++e)if(b=
this._meshes[e],a=b.material.name.split("~"),a[0]==c.materialID){if(c.cm)b.material&&(b.material=null),b.material=c.cm;else if(c.texture)if(2>this.materialMode){var g=d=b.material;g.texture=c.texture;g.ambientColor=c.ambientColor;g.alpha=c.alpha;g.repeat=!0;if(c.specularMethod)g.specularMethod=null,g.specularMethod=c.specularMethod;else if(this._materialSpecularData)for(f=0;f<this._materialSpecularData.length;++f)if(l=this._materialSpecularData[f],l.materialID==c.materialID){g.specularMethod=null;
g.specularMethod=l.basicSpecularMethod;g.ambientColor=l.ambientColor;g.alpha=l.alpha;break}}else if(g=d=b.material,g.texture=c.texture,g.ambientColor=c.ambientColor,g.repeat=!0,c.specularMethod)g.specularMethod=null,g.specularMethod=c.specularMethod;else if(this._materialSpecularData)for(f=0;f<this._materialSpecularData.length;++f)if(l=this._materialSpecularData[f],l.materialID==c.materialID){g.specularMethod=null;g.specularMethod=l.basicSpecularMethod;g.ambientColor=l.ambientColor;break}b.material.name=
a[1]?a[1]:a[0];this._meshes.splice(e,1);--e}(c.cm||d)&&this._pFinalizeAsset(c.cm||d)};a.prototype.applyMaterials=function(){if(0!=this._materialLoaded.length)for(var c=0;c<this._materialLoaded.length;++c)this.applyMaterial(this._materialLoaded[c])};return a}(b.loaders.ParserBase);g.OBJParser=e})(b.loaders||(b.loaders={}))})(away||(away={}));
var ObjectGroup=function(){return function(){this.groups=[]}}(),Group=function(){return function(){this.materialGroups=[]}}(),MaterialGroup=function(){return function(){this.faces=[]}}(),SpecularData=function(){return function(){this.ambientColor=16777215;this.alpha=1}}(),LoadedMaterial=function(){return function(){this.ambientColor=16777215;this.alpha=1}}(),FaceData=function(){return function(){this.vertexIndices=[];this.uvIndices=[];this.normalIndices=[];this.indexIds=[]}}(),UV=function(){function b(b,
e){"undefined"===typeof b&&(b=0);"undefined"===typeof e&&(e=0);this._u=b;this._v=e}Object.defineProperty(b.prototype,"v",{get:function(){return this._v},set:function(b){this._v=b},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"u",{get:function(){return this._u},set:function(b){this._u=b},enumerable:!0,configurable:!0});b.prototype.clone=function(){return new b(this._u,this._v)};b.prototype.toString=function(){return this._u+","+this._v};return b}(),Vertex=function(){function b(b,
e,d,a){"undefined"===typeof b&&(b=0);"undefined"===typeof e&&(e=0);"undefined"===typeof d&&(d=0);"undefined"===typeof a&&(a=0);this._x=b;this._y=e;this._z=d;this._index=a}Object.defineProperty(b.prototype,"index",{get:function(){return this._index},set:function(b){this._index=b},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"x",{get:function(){return this._x},set:function(b){this._x=b},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"y",{get:function(){return this._y},
set:function(b){this._y=b},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"z",{get:function(){return this._z},set:function(b){this._z=b},enumerable:!0,configurable:!0});b.prototype.clone=function(){return new b(this._x,this._y,this._z)};b.prototype.FaceData=function(){};return b}();
(function(b){(function(g){var e=function(d){function a(){d.call(this,b.loaders.ParserDataFormat.PLAIN_TEXT,b.loaders.ParserLoaderType.URL_LOADER);this.STATE_PARSE_DATA=0;this.STATE_LOAD_IMAGES=1;this.STATE_COMPLETE=2;this._state=-1;this._loadedImageCounter=this._totalImages=this._dependencyCount=0;this._loadedTextures=[];this._state=this.STATE_PARSE_DATA}__extends(a,d);a.supportsType=function(c){c=c.toLowerCase();return"cube"==c};a.supportsData=function(c){try{return JSON.parse(c)?!0:!1}catch(a){return!1}};
a.prototype._iResolveDependency=function(c){};a.prototype._iResolveDependencyFailure=function(c){};a.prototype.parseJson=function(){if(a.supportsData(this.data))try{this._imgLoaderDictionary={};for(var c=JSON.parse(this.data).data,d,q,h=0;h<c.length;h++){d=c[h];q=new b.net.URLRequest(d.image);var f=new b.net.IMGLoader;f.name=d.id;f.load(q);f.addEventListener(b.events.Event.COMPLETE,this.onIMGLoadComplete,this);this._imgLoaderDictionary[f.name]=f}6!=c.length?(this._pDieWithError("CubeTextureParser: Error - cube texture should have exactly 6 images"),
this._state=this.STATE_COMPLETE):this.validateCubeData()?this._state=this.STATE_LOAD_IMAGES:(this._pDieWithError("CubeTextureParser: JSON data error - cubes require id of:   \n"+a.posX+", "+a.negX+",  \n"+a.posY+", "+a.negY+",  \n"+a.posZ+", "+a.negZ),this._state=this.STATE_COMPLETE)}catch(l){this._pDieWithError("CubeTexturePaser Error parsing JSON"),this._state=this.STATE_COMPLETE}};a.prototype.createCubeTexture=function(){var c=new b.textures.HTMLImageElementCubeTexture(this.getHTMLImageElement(a.posX),
this.getHTMLImageElement(a.negX),this.getHTMLImageElement(a.posY),this.getHTMLImageElement(a.negY),this.getHTMLImageElement(a.posZ),this.getHTMLImageElement(a.negZ));c.name=this._iFileName;this._pFinalizeAsset(c,this._iFileName);this._state=this.STATE_COMPLETE};a.prototype.validateCubeData=function(){return null!=this.getHTMLImageElement(a.posX)&&null!=this.getHTMLImageElement(a.negX)&&null!=this.getHTMLImageElement(a.posY)&&null!=this.getHTMLImageElement(a.negY)&&null!=this.getHTMLImageElement(a.posZ)&&
null!=this.getHTMLImageElement(a.negZ)};a.prototype.getHTMLImageElement=function(c){return(c=this._imgLoaderDictionary[c])?c.image:null};a.prototype.onIMGLoadComplete=function(c){this._loadedImageCounter++;6==this._loadedImageCounter&&this.createCubeTexture()};a.prototype._pProceedParsing=function(){switch(this._state){case this.STATE_PARSE_DATA:return this.parseJson(),b.loaders.ParserBase.MORE_TO_PARSE;case this.STATE_COMPLETE:return b.loaders.ParserBase.PARSING_DONE}};a.posX="posX";a.negX="negX";
a.posY="posY";a.negY="negY";a.posZ="posZ";a.negZ="negZ";return a}(b.loaders.ParserBase);g.CubeTextureParser=e})(b.loaders||(b.loaders={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this,b.loaders.ParserDataFormat.BINARY);this._debug=!0;this._startedParsing=!1;this._texture_users={};this._parsed_header=!1;this._blocks=[];this._blocks[0]=new AWDBlock;this._blocks[0].data=null;this.blendModeDic=[];this.blendModeDic.push(b.display.BlendMode.NORMAL);this.blendModeDic.push(b.display.BlendMode.ADD);this.blendModeDic.push(b.display.BlendMode.ALPHA);this.blendModeDic.push(b.display.BlendMode.DARKEN);this.blendModeDic.push(b.display.BlendMode.DIFFERENCE);
this.blendModeDic.push(b.display.BlendMode.ERASE);this.blendModeDic.push(b.display.BlendMode.HARDLIGHT);this.blendModeDic.push(b.display.BlendMode.INVERT);this.blendModeDic.push(b.display.BlendMode.LAYER);this.blendModeDic.push(b.display.BlendMode.LIGHTEN);this.blendModeDic.push(b.display.BlendMode.MULTIPLY);this.blendModeDic.push(b.display.BlendMode.NORMAL);this.blendModeDic.push(b.display.BlendMode.OVERLAY);this.blendModeDic.push(b.display.BlendMode.SCREEN);this.blendModeDic.push(b.display.BlendMode.SHADER);
this.blendModeDic.push(b.display.BlendMode.OVERLAY);this._depthSizeDic=[];this._depthSizeDic.push(256);this._depthSizeDic.push(512);this._depthSizeDic.push(2048);this._depthSizeDic.push(1024);this._version=[]}__extends(a,d);a.supportsType=function(c){c=c.toLowerCase();return"awd"==c};a.supportsData=function(c){return"AWD"==b.loaders.ParserUtil.toString(c,3)};a.prototype._iResolveDependency=function(c){if(1==c.assets.length){var a=c.id.split("#"),d=a[0],h,f;1==a.length&&(h=c.assets[0])&&(f=this._blocks[c.id],
f.data=h,h.resetAssetPath(f.name,null,!0),f.name=h.name,this._pFinalizeAsset(h),this._debug&&(console.log("Successfully loaded Bitmap for texture"),console.log("Parsed texture: Name = "+f.name)));1<a.length&&(c=c.assets[0],this._cubeTextures[a[1]]=c.htmlImageElement,this._texture_users[d].push(1),this._debug&&console.log("Successfully loaded Bitmap "+this._texture_users[d].length+" / 6 for Cubetexture"),this._texture_users[d].length==this._cubeTextures.length&&(h=new b.textures.HTMLImageElementCubeTexture(this._cubeTextures[0],
this._cubeTextures[1],this._cubeTextures[2],this._cubeTextures[3],this._cubeTextures[4],this._cubeTextures[5]),f=this._blocks[d],f.data=h,h.resetAssetPath(f.name,null,!0),f.name=h.name,this._pFinalizeAsset(h),this._debug&&console.log("Parsed CubeTexture: Name = "+f.name)))}};a.prototype._iResolveDependencyFailure=function(c){};a.prototype._iResolveDependencyName=function(c,a){var b=a.name;if(a){var d=this._blocks[parseInt(c.id)];a.resetAssetPath(d.name,null,!0)}d=a.name;a.name=b;return d};a.prototype._pProceedParsing=
function(){this._startedParsing||(this._byteData=this._pGetByteData(),this._startedParsing=!0);if(!this._parsed_header){this.parseHeader();switch(this._compression){case a.DEFLATE:case a.LZMA:this._pDieWithError("Compressed AWD formats not yet supported");break;case a.UNCOMPRESSED:this._body=this._byteData}this._parsed_header=!0}if(this._body){for(;0<this._body.getBytesAvailable()&&!this.parsingPaused;)this.parseNextBlock();return 0==this._body.getBytesAvailable()?(this.dispose(),b.loaders.ParserBase.PARSING_DONE):
b.loaders.ParserBase.MORE_TO_PARSE}switch(this._compression){case a.DEFLATE:case a.LZMA:this._debug&&console.log("(!) AWDParser Error: Compressed AWD formats not yet supported (!)")}return b.loaders.ParserBase.PARSING_DONE};a.prototype.dispose=function(){for(var c in this._blocks)this._blocks[c].dispose()};a.prototype.parseNextBlock=function(){var c,d=!1,q,h;this._cur_block_id=this._body.readUnsignedInt();this._body.readUnsignedByte();q=this._body.readUnsignedByte();c=this._body.readUnsignedByte();
h=this._body.readUnsignedInt();var f=bitFlags.test(c,bitFlags.FLAG4);bitFlags.test(c,bitFlags.FLAG5);this._accuracyOnBlocks&&(this._accuracyMatrix=bitFlags.test(c,bitFlags.FLAG1),this._accuracyGeo=bitFlags.test(c,bitFlags.FLAG2),this._accuracyProps=bitFlags.test(c,bitFlags.FLAG3),this._geoNrType=a.FLOAT32,this._accuracyGeo&&(this._geoNrType=a.FLOAT64),this._matrixNrType=a.FLOAT32,this._accuracyMatrix&&(this._matrixNrType=a.FLOAT64),this._propsNrType=a.FLOAT32,this._accuracyProps&&(this._propsNrType=
a.FLOAT64));var l=this._body.position+h;if(h>this._body.getBytesAvailable())this._pDieWithError("AWD2 block length is bigger than the bytes that are available!"),this._body.position+=this._body.getBytesAvailable();else{this._newBlockBytes=new b.utils.ByteArray;this._body.readBytes(this._newBlockBytes,0,h);f&&this._pDieWithError("Compressed AWD formats not yet supported");this._newBlockBytes.position=0;c=new AWDBlock;c.len=this._newBlockBytes.position+h;c.id=this._cur_block_id;var e=this._newBlockBytes.position+
h;f&&this._pDieWithError("Compressed AWD formats not yet supported");this._debug&&console.log("AWDBlock:  ID = "+this._cur_block_id+" | TypeID = "+q+" | Compression = "+f+" | Matrix-Precision = "+this._accuracyMatrix+" | Geometry-Precision = "+this._accuracyGeo+" | Properties-Precision = "+this._accuracyProps);this._blocks[this._cur_block_id]=c;if(2==this._version[0]&&1==this._version[1])switch(q){case 11:this.parsePrimitves(this._cur_block_id);d=!0;break;case 41:this.parseLight(this._cur_block_id);
d=!0;break;case 42:this.parseCamera(this._cur_block_id);d=!0;break;case 51:this.parseLightPicker(this._cur_block_id);d=!0;break;case 81:this.parseMaterial_v1(this._cur_block_id);d=!0;break;case 83:this.parseCubeTexture(this._cur_block_id);d=!0;break;case 91:this.parseSharedMethodBlock(this._cur_block_id);d=!0;break;case 92:this.parseShadowMethodBlock(this._cur_block_id);d=!0;break;case 253:this.parseCommand(this._cur_block_id),d=!0}if(!1==d)switch(q){case 1:this.parseTriangleGeometrieBlock(this._cur_block_id);
break;case 22:this.parseContainer(this._cur_block_id);break;case 23:this.parseMeshInstance(this._cur_block_id);break;case 81:this.parseMaterial(this._cur_block_id);break;case 82:this.parseTexture(this._cur_block_id);break;case 101:break;case 102:break;case 103:break;case 121:break;case 254:this.parseNameSpace(this._cur_block_id);break;case 255:this.parseMetaData(this._cur_block_id);break;default:this._debug&&console.log("AWDBlock:   Unknown BlockType  (BlockID = "+this._cur_block_id+") - Skip "+h+
" bytes"),this._newBlockBytes.position+=h}d=0;if(this._newBlockBytes.position==e){if(this._debug&&c.errorMessages)for(;d<c.errorMessages.length;)console.log("        (!) Error: "+c.errorMessages[d]+" (!)"),d++;this._debug&&console.log("\n")}else if(this._debug&&(console.log("  (!)(!)(!) Error while reading AWDBlock ID "+this._cur_block_id+" = skip to next block"),c.errorMessages))for(;d<c.errorMessages.length;)console.log("        (!) Error: "+c.errorMessages[d]+" (!)"),d++;this._body.position=l;
this._newBlockBytes=null}};a.prototype.parseTriangleGeometrieBlock=function(c){for(var a=new b.base.Geometry,d=this.parseVarStr(),h=this._newBlockBytes.readUnsignedShort(),f=this.parseProperties({1:this._geoNrType,2:this._geoNrType}),l=f.get(1,1),f=f.get(2,1),e=0;e<h;){var g,m,n,p;g=this._newBlockBytes.readUnsignedInt();m=this._newBlockBytes.position+g;for(g=this.parseProperties({1:this._geoNrType,2:this._geoNrType});this._newBlockBytes.position<m;){var r=0,t,v;t=this._newBlockBytes.readUnsignedByte();
this._newBlockBytes.readUnsignedByte();v=this._newBlockBytes.readUnsignedInt();v=this._newBlockBytes.position+v;var x,u;if(1==t)for(var y=[];this._newBlockBytes.position<v;)t=this.readNumber(this._accuracyGeo),x=this.readNumber(this._accuracyGeo),u=this.readNumber(this._accuracyGeo),y[r++]=t,y[r++]=x,y[r++]=u;else if(2==t)for(var z=[];this._newBlockBytes.position<v;)z[r++]=this._newBlockBytes.readUnsignedShort();else if(3==t)for(var B=[];this._newBlockBytes.position<v;)B[r++]=this.readNumber(this._accuracyGeo);
else if(4==t)for(var A=[];this._newBlockBytes.position<v;)A[r++]=this.readNumber(this._accuracyGeo);else if(6==t)for(n=[];this._newBlockBytes.position<v;)n[r++]=3*this._newBlockBytes.readUnsignedShort();else if(7==t)for(p=[];this._newBlockBytes.position<v;)p[r++]=this.readNumber(this._accuracyGeo);else this._newBlockBytes.position=v}this.parseUserAttributes();m=b.utils.GeometryUtils.fromVectors(y,z,B,A,null,p,n);r=g.get(1,1);v=g.get(2,1);t=!1;if(l!=r||f!=v)t=!0,r=l/r,v=f/v;for(g=0;g<m.length;g++)t&&
m[g].scaleUV(r,v),a.addSubGeometry(m[g]);e++}1==l&&1==f||a.scaleUV(l,f);this.parseUserAttributes();this._pFinalizeAsset(a,d);this._blocks[c].data=a;this._debug&&console.log("Parsed a TriangleGeometry: Name = "+d+"| SubGeometries = "+m.length)};a.prototype.parsePrimitves=function(c){var d,q,h,f;d=this.parseVarStr();h=this._newBlockBytes.readUnsignedByte();f=this.parseProperties({101:this._geoNrType,102:this._geoNrType,103:this._geoNrType,110:this._geoNrType,111:this._geoNrType,301:a.UINT16,302:a.UINT16,
303:a.UINT16,701:a.BOOL,702:a.BOOL,703:a.BOOL,704:a.BOOL});var l="Unsupported Type-ID;PlaneGeometry;CubeGeometry;SphereGeometry;CylinderGeometry;ConeGeometry;CapsuleGeometry;TorusGeometry".split(";");switch(h){case 1:q=new b.primitives.PlaneGeometry(f.get(101,100),f.get(102,100),f.get(301,1),f.get(302,1),f.get(701,!0),f.get(702,!1));break;case 2:q=new b.primitives.CubeGeometry(f.get(101,100),f.get(102,100),f.get(103,100),f.get(301,1),f.get(302,1),f.get(303,1),f.get(701,!0));break;case 3:q=new b.primitives.SphereGeometry(f.get(101,
50),f.get(301,16),f.get(302,12),f.get(701,!0));break;case 4:q=new b.primitives.CylinderGeometry(f.get(101,50),f.get(102,50),f.get(103,100),f.get(301,16),f.get(302,1),!0,!0,!0);f.get(701,!0)||(q.topClosed=!1);f.get(702,!0)||(q.bottomClosed=!1);f.get(703,!0)||(q.yUp=!1);break;case 5:q=new b.primitives.ConeGeometry(f.get(101,50),f.get(102,100),f.get(301,16),f.get(302,1),f.get(701,!0),f.get(702,!0));break;case 6:q=new b.primitives.CapsuleGeometry(f.get(101,50),f.get(102,100),f.get(301,16),f.get(302,15),
f.get(701,!0));break;case 7:q=new b.primitives.TorusGeometry(f.get(101,50),f.get(102,50),f.get(301,16),f.get(302,8),f.get(701,!0));break;default:q=new b.base.Geometry,console.log("ERROR: UNSUPPORTED PRIMITIVE_TYPE")}if(1!=f.get(110,1)||1!=f.get(111,1))q.subGeometries,q.scaleUV(f.get(110,1),f.get(111,1));this.parseUserAttributes();q.name=d;this._pFinalizeAsset(q,d);this._blocks[c].data=q;if(this._debug){if(0>h||7<h)h=0;console.log("Parsed a Primivite: Name = "+d+"| type = "+l[h])}};a.prototype.parseContainer=
function(c){var d,q,h,f;q=this._newBlockBytes.readUnsignedInt();h=this.parseMatrix3D();d=this.parseVarStr();var l="Root (TopLevel)";f=new b.containers.ObjectContainer3D;f.transform=h;h=this.getAssetByID(q,[b.library.AssetType.CONTAINER,b.library.AssetType.LIGHT,b.library.AssetType.MESH,b.library.AssetType.ENTITY,b.library.AssetType.SEGMENT_SET]);h[0]?(h[1].addChild(f),l=h[1].name):0<q&&this._blocks[c].addError("Could not find a parent for this ObjectContainer3D");2==this._version[0]&&1==this._version[1]?
(q=this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:a.UINT8}),f.pivotPoint=new b.geom.Vector3D(q.get(1,0),q.get(2,0),q.get(3,0))):this.parseProperties(null);f.extra=this.parseUserAttributes();this._pFinalizeAsset(f,d);this._blocks[c].data=f;this._debug&&console.log("Parsed a Container: Name = '"+d+"' | Parent-Name = "+l)};a.prototype.parseMeshInstance=function(c){var d,q,h=this._newBlockBytes.readUnsignedInt(),f=this.parseMatrix3D(),l=this.parseVarStr(),e="Root (TopLevel)",
g=this._newBlockBytes.readUnsignedInt(),m;m=this.getAssetByID(g,[b.library.AssetType.GEOMETRY]);m[0]?m=m[1]:(this._blocks[c].addError("Could not find a Geometry for this Mesh. A empty Geometry is created!"),m=new b.base.Geometry);this._blocks[c].geoID=g;var n=[];d=this._newBlockBytes.readUnsignedShort();g=[];q=0;for(var p;q<d;){var r;r=this._newBlockBytes.readUnsignedInt();p=this.getAssetByID(r,[b.library.AssetType.MATERIAL]);!p[0]&&0<r&&this._blocks[c].addError("Could not find Material Nr "+q+" (ID = "+
r+" ) for this Mesh");p=p[1];n.push(p);g.push(p.name);q++}d=new b.entities.Mesh(m,null);d.transform=f;f=this.getAssetByID(h,[b.library.AssetType.CONTAINER,b.library.AssetType.LIGHT,b.library.AssetType.MESH,b.library.AssetType.ENTITY,b.library.AssetType.SEGMENT_SET]);f[0]?(e=f[1],e.addChild(d),e=e.name):0<h&&this._blocks[c].addError("Could not find a parent for this Mesh");if(1<=n.length&&1==d.subMeshes.length)d.material=n[0];else if(1<n.length)for(h=0;h<d.subMeshes.length;h++)d.subMeshes[h].material=
n[Math.min(n.length-1,h)];2==this._version[0]&&1==this._version[1]?(h=this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:a.UINT8,5:a.BOOL}),d.pivotPoint=new b.geom.Vector3D(h.get(1,0),h.get(2,0),h.get(3,0)),d.castsShadows=h.get(5,!0)):this.parseProperties(null);d.extra=this.parseUserAttributes();this._pFinalizeAsset(d,l);this._blocks[c].data=d;this._debug&&console.log("Parsed a Mesh: Name = '"+l+"' | Parent-Name = "+e+"| Geometry-Name = "+m.name+" | SubMeshes = "+
d.subMeshes.length+" | Mat-Names = "+g.toString())};a.prototype.parseLight=function(c){var d,q,h=this._newBlockBytes.readUnsignedInt(),f=this.parseMatrix3D(),l=this.parseVarStr(),e=this._newBlockBytes.readUnsignedByte(),g=this.parseProperties({1:this._propsNrType,2:this._propsNrType,3:a.COLOR,4:this._propsNrType,5:this._propsNrType,6:a.BOOL,7:a.COLOR,8:this._propsNrType,9:a.UINT8,10:a.UINT8,11:this._propsNrType,12:a.UINT16,21:this._matrixNrType,22:this._matrixNrType,23:this._matrixNrType}),m=g.get(9,
0),n="Root (TopLevel)",p=["Unsupported LightType","PointLight","DirectionalLight"],r=["No ShadowMapper","DirectionalShadowMapper","NearDirectionalShadowMapper","CascadeShadowMapper","CubeMapShadowMapper"];1==e&&(d=new b.lights.PointLight,d.radius=g.get(1,9E4),d.fallOff=g.get(2,1E5),0<m&&4==m&&(q=new b.lights.CubeMapShadowMapper),d.transform=f);2==e&&(d=new b.lights.DirectionalLight(g.get(21,0),g.get(22,-1),g.get(23,1)),0<m&&1==m&&(q=new b.lights.DirectionalShadowMapper));d.color=g.get(3,16777215);
d.specular=g.get(4,1);d.diffuse=g.get(5,1);d.ambientColor=g.get(7,16777215);d.ambient=g.get(8,0);q&&(q instanceof b.lights.CubeMapShadowMapper?1!=g.get(10,1)&&(q.depthMapSize=this._depthSizeDic[g.get(10,1)]):2!=g.get(10,2)&&(q.depthMapSize=this._depthSizeDic[g.get(10,2)]),d.shadowMapper=q,d.castsShadows=!0);0!=h&&(q=this.getAssetByID(h,[b.library.AssetType.CONTAINER,b.library.AssetType.LIGHT,b.library.AssetType.MESH,b.library.AssetType.ENTITY,b.library.AssetType.SEGMENT_SET]),q[0]?(q[1].addChild(d),
n=q[1].name):this._blocks[c].addError("Could not find a parent for this Light"));this.parseUserAttributes();this._pFinalizeAsset(d,l);this._blocks[c].data=d;this._debug&&console.log("Parsed a Light: Name = '"+l+"' | Type = "+p[e]+" | Parent-Name = "+n+" | ShadowMapper-Type = "+r[m])};a.prototype.parseCamera=function(c){var d=this._newBlockBytes.readUnsignedInt(),q=this.parseMatrix3D(),h=this.parseVarStr(),f="Root (TopLevel)",l;this._newBlockBytes.readUnsignedByte();this._newBlockBytes.readShort();
l=this._newBlockBytes.readShort();var e=this.parseProperties({101:this._propsNrType,102:this._propsNrType,103:this._propsNrType,104:this._propsNrType});switch(l){case 5001:l=new b.cameras.PerspectiveLens(e.get(101,60));break;case 5002:l=new b.cameras.OrthographicLens(e.get(101,500));break;case 5003:l=new b.cameras.OrthographicOffCenterLens(e.get(101,-400),e.get(102,400),e.get(103,-300),e.get(104,300));break;default:console.log("unsupportedLenstype");return}var g=new b.cameras.Camera3D(l);g.transform=
q;q=this.getAssetByID(d,[b.library.AssetType.CONTAINER,b.library.AssetType.LIGHT,b.library.AssetType.MESH,b.library.AssetType.ENTITY,b.library.AssetType.SEGMENT_SET]);q[0]?(d=q[1],d.addChild(g),f=d.name):0<d&&this._blocks[c].addError("Could not find a parent for this Camera");g.name=h;e=this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:a.UINT8});g.pivotPoint=new b.geom.Vector3D(e.get(1,0),e.get(2,0),e.get(3,0));g.extra=this.parseUserAttributes();this._pFinalizeAsset(g,
h);this._blocks[c].data=g;this._debug&&console.log("Parsed a Camera: Name = '"+h+"' | Lenstype = "+l+" | Parent-Name = "+f)};a.prototype.parseLightPicker=function(c){for(var a=this.parseVarStr(),d=this._newBlockBytes.readUnsignedShort(),h=[],f=0,l=0,e,g=[],f=0;f<d;f++)l=this._newBlockBytes.readUnsignedInt(),e=this.getAssetByID(l,[b.library.AssetType.LIGHT]),e[0]?(h.push(e[1]),g.push(e[1].name)):this._blocks[c].addError("Could not find a Light Nr "+f+" (ID = "+l+" ) for this LightPicker");0==h.length?
(this._blocks[c].addError("Could not create this LightPicker, cause no Light was found."),this.parseUserAttributes()):(d=new b.materials.StaticLightPicker(h),d.name=a,this.parseUserAttributes(),this._pFinalizeAsset(d,a),this._blocks[c].data=d,this._debug&&console.log("Parsed a StaticLightPicker: Name = '"+a+"' | Texture-Name = "+g.toString()))};a.prototype.parseMaterial=function(c){var d,q,h,f,l,e;d=this.parseVarStr();q=this._newBlockBytes.readUnsignedByte();l=this._newBlockBytes.readUnsignedByte();
h=this.parseProperties({1:a.INT32,2:a.BADDR,10:this._propsNrType,11:a.BOOL,12:this._propsNrType,13:a.BOOL});for(e=0;e<l;)this._newBlockBytes.readUnsignedShort(),this.parseProperties(null),this.parseUserAttributes(),e+=1;e="";l=this.parseUserAttributes();1===q?(e+="Parsed a ColorMaterial(SinglePass): Name = '"+d+"' | ",f=h.get(1,13421772),f=2>this.materialMode?new b.materials.ColorMaterial(f,h.get(10,1)):new b.materials.ColorMultiPassMaterial(f)):2===q&&(q=h.get(2,0),f=this.getAssetByID(q,[b.library.AssetType.TEXTURE]),
!f[0]&&0<q&&this._blocks[c].addError("Could not find the DiffsueTexture (ID = "+q+" ) for this Material"),2>this.materialMode?(q=f=new b.materials.TextureMaterial(f[1]),q.alphaBlending=h.get(11,!1),q.alpha=h.get(10,1),e+="Parsed a TextureMaterial(SinglePass): Name = '"+d+"' | Texture-Name = "+f.name):(f=new b.materials.TextureMultiPassMaterial(f[1]),e+="Parsed a TextureMaterial(MultipAss): Name = '"+d+"' | Texture-Name = "+f.name));f.extra=l;f.alphaThreshold=h.get(12,0);f.repeat=h.get(13,!1);this._pFinalizeAsset(f,
d);this._blocks[c].data=f;this._debug&&console.log(e)};a.prototype.parseMaterial_v1=function(c){var d,q,h,f,l=this.parseVarStr();f=this._newBlockBytes.readUnsignedByte();var e=this._newBlockBytes.readUnsignedByte(),g=this.parseProperties({1:a.UINT32,2:a.BADDR,3:a.BADDR,4:a.UINT8,5:a.BOOL,6:a.BOOL,7:a.BOOL,8:a.BOOL,9:a.UINT8,10:this._propsNrType,11:a.BOOL,12:this._propsNrType,13:a.BOOL,15:this._propsNrType,16:a.UINT32,17:a.BADDR,18:this._propsNrType,19:this._propsNrType,20:a.UINT32,21:a.BADDR,22:a.BADDR}),
m=g.get(4,0),n="";if(2<=m)this._blocks[c].addError("Material-spezialType '"+m+"' is not supported, can only be 0:singlePass, 1:MultiPass !");else{1==this.materialMode?m=0:2==this.materialMode&&(m=1);if(2>m){if(1==f)d=g.get(1,13421772),1==m?(d=new b.materials.ColorMultiPassMaterial(d),n+="Parsed a ColorMaterial(MultiPass): Name = '"+l+"' | "):(d=new b.materials.ColorMaterial(d,g.get(10,1)),d.alphaBlending=g.get(11,!1),n+="Parsed a ColorMaterial(SinglePass): Name = '"+l+"' | ");else if(2==f){d=g.get(2,
0);f=this.getAssetByID(d,[b.library.AssetType.TEXTURE]);!f[0]&&0<d&&this._blocks[c].addError("Could not find the DiffuseTexture (ID = "+d+" ) for this TextureMaterial");var p=f[1],r;d=g.get(17,0);f=this.getAssetByID(d,[b.library.AssetType.TEXTURE]);f[0]||0==d||this._blocks[c].addError("Could not find the AmbientTexture (ID = "+d+" ) for this TextureMaterial");f[0]&&(r=f[1]);1==m?(d=new b.materials.TextureMultiPassMaterial(p),n+="Parsed a TextureMaterial(MultiPass): Name = '"+l+"' | Texture-Name = "+
p.name,r&&(d.ambientTexture=r,n+=" | AmbientTexture-Name = "+r.name)):(d=new b.materials.TextureMaterial(p),n+="Parsed a TextureMaterial(SinglePass): Name = '"+l+"' | Texture-Name = "+p.name,r&&(d.ambientTexture=r,n+=" | AmbientTexture-Name = "+r.name),d.alpha=g.get(10,1),d.alphaBlending=g.get(11,!1))}r=g.get(3,0);f=this.getAssetByID(r,[b.library.AssetType.TEXTURE]);f[0]||0==r||this._blocks[c].addError("Could not find the NormalTexture (ID = "+r+" ) for this TextureMaterial");f[0]&&(q=f[1],n+=" | NormalTexture-Name = "+
q.name);r=g.get(21,0);f=this.getAssetByID(r,[b.library.AssetType.TEXTURE]);f[0]||0==r||this._blocks[c].addError("Could not find the SpecularTexture (ID = "+r+" ) for this TextureMaterial");f[0]&&(h=f[1],n+=" | SpecularTexture-Name = "+h.name);r=g.get(22,0);f=this.getAssetByID(r,[b.library.AssetType.LIGHT_PICKER]);!f[0]&&r?this._blocks[c].addError("Could not find the LightPicker (ID = "+r+" ) for this TextureMaterial"):d.lightPicker=f[1];d.smooth=g.get(5,!0);d.mipmap=g.get(6,!0);d.bothSides=g.get(7,
!1);d.alphaPremultiplied=g.get(8,!1);d.blendMode=this.blendModeDic[g.get(9,0)];d.repeat=g.get(13,!1);q&&(d.normalMap=q);h&&(d.specularMap=h);d.alphaThreshold=g.get(12,0);d.ambient=g.get(15,1);d.ambientColor=g.get(16,16777215);d.specular=g.get(18,1);d.gloss=g.get(19,50);d.specularColor=g.get(20,16777215);for(q=0;q<e;){h=this._newBlockBytes.readUnsignedShort();g=this.parseProperties({1:a.BADDR,2:a.BADDR,3:a.BADDR,101:this._propsNrType,102:this._propsNrType,103:this._propsNrType,201:a.UINT32,202:a.UINT32,
301:a.UINT16,302:a.UINT16,401:a.UINT8,402:a.UINT8,601:a.COLOR,602:a.COLOR,701:a.BOOL,702:a.BOOL,801:a.MTX4x4});switch(h){case 999:g=g.get(1,0);f=this.getAssetByID(g,[b.library.AssetType.EFFECTS_METHOD]);f[0]?(0==m&&d.addMethod(f[1]),1==m&&d.addMethod(f[1]),n+=" | EffectMethod-Name = "+f[1].name):this._blocks[c].addError("Could not find the EffectMethod (ID = "+g+" ) for this Material");break;case 998:g=g.get(1,0),f=this.getAssetByID(g,[b.library.AssetType.SHADOW_MAP_METHOD]),f[0]?(0==m&&(d.shadowMethod=
f[1]),1==m&&(d.shadowMethod=f[1]),n+=" | ShadowMethod-Name = "+f[1].name):this._blocks[c].addError("Could not find the ShadowMethod (ID = "+g+" ) for this Material")}this.parseUserAttributes();q+=1}}d.extra=this.parseUserAttributes();this._pFinalizeAsset(d,l);this._blocks[c].data=d;this._debug&&console.log(n)}};a.prototype.parseTexture=function(c){this._blocks[c].name=this.parseVarStr();var a=this._newBlockBytes.readUnsignedByte(),d;this._texture_users[this._cur_block_id.toString()]=[];if(0==a)d=
this._newBlockBytes.readUnsignedInt(),d=this._newBlockBytes.readUTFBytes(d),this._pAddDependency(this._cur_block_id.toString(),new b.net.URLRequest(d),!1,null,!0);else{d=this._newBlockBytes.readUnsignedInt();var h;h=new b.utils.ByteArray;this._newBlockBytes.readBytes(h,0,d);this._pAddDependency(this._cur_block_id.toString(),null,!1,h,!0)}this.parseProperties(null);this._blocks[c].extras=this.parseUserAttributes();this._pPauseAndRetrieveDependencies();this._blocks[c].data=void 0;this._debug&&console.log("Start parsing a "+
["external","embed"][a]+" Bitmap for Texture")};a.prototype.parseCubeTexture=function(c){var a,d;this._cubeTextures=[];this._texture_users[this._cur_block_id.toString()]=[];var h=this._newBlockBytes.readUnsignedByte();this._blocks[c].name=this.parseVarStr();for(d=0;6>d;d++)if(this._texture_users[this._cur_block_id.toString()]=[],this._cubeTextures.push(null),0==h)a=this._newBlockBytes.readUnsignedInt(),a=this._newBlockBytes.readUTFBytes(a),this._pAddDependency(this._cur_block_id.toString()+"#"+d,
new b.net.URLRequest(a),!1,null,!0);else{a=this._newBlockBytes.readUnsignedInt();var f;f=new b.utils.ByteArray;this._newBlockBytes.readBytes(f,0,a);this._pAddDependency(this._cur_block_id.toString()+"#"+d,null,!1,f,!0)}this.parseProperties(null);this._blocks[c].extras=this.parseUserAttributes();this._pPauseAndRetrieveDependencies();this._blocks[c].data=void 0;this._debug&&console.log("Start parsing 6 "+["external","embed"][h]+" Bitmaps for CubeTexture")};a.prototype.parseSharedMethodBlock=function(c){var a;
this._blocks[c].name=this.parseVarStr();a=this.parseSharedMethodList(c);this.parseUserAttributes();this._blocks[c].data=a;this._pFinalizeAsset(a,this._blocks[c].name);this._blocks[c].data=a;this._debug&&console.log("Parsed a EffectMethod: Name = "+a.name+" Type = "+a)};a.prototype.parseShadowMethodBlock=function(c){var a;this._blocks[c].name=this.parseVarStr();a=this._newBlockBytes.readUnsignedInt();var d=this.getAssetByID(a,[b.library.AssetType.LIGHT]);if(d[0]){if(a=this.parseShadowMethodList(d[1],
c))this.parseUserAttributes(),this._pFinalizeAsset(a,this._blocks[c].name),this._blocks[c].data=a,this._debug&&console.log("Parsed a ShadowMapMethodMethod: Name = "+a.name+" | Type = "+a+" | Light-Name = ",d[1].name)}else this._blocks[c].addError("Could not find the TargetLight (ID = "+a+" ) for this ShadowMethod - ShadowMethod not created")};a.prototype.parseCommand=function(c){this._newBlockBytes.readUnsignedByte();var d=this._newBlockBytes.readUnsignedInt(),q=this.parseMatrix3D(),h=this.parseVarStr(),
f,l,d=this.getAssetByID(d,[b.library.AssetType.CONTAINER,b.library.AssetType.LIGHT,b.library.AssetType.MESH,b.library.AssetType.ENTITY,b.library.AssetType.SEGMENT_SET]);d[0]&&(f=d[1]);this._newBlockBytes.readShort();var d=this._newBlockBytes.readShort(),e=this.parseProperties({1:a.BADDR});switch(d){case 1:l=e.get(1,0);d=this.getAssetByID(l,[b.library.AssetType.LIGHT,b.library.AssetType.TEXTURE_PROJECTOR]);if(!d[0]&&0!=l){this._blocks[c].addError("Could not find the light (ID = "+l+" ( for this CommandBock!");
return}l=d[1];f&&f.addChild(l);l.transform=q}l&&(e=this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:a.UINT8}),l.pivotPoint=new b.geom.Vector3D(e.get(1,0),e.get(2,0),e.get(3,0)),l.extra=this.parseUserAttributes());this._blocks[c].data=l;this._debug&&console.log("Parsed a CommandBlock: Name = '"+h)};a.prototype.parseMetaData=function(c){c=this.parseProperties({1:a.UINT32,2:a.AWDSTRING,3:a.AWDSTRING,4:a.AWDSTRING,5:a.AWDSTRING});this._debug&&(console.log("Parsed a MetaDataBlock: TimeStamp         = "+
c.get(1,0)),console.log("                        EncoderName       = "+c.get(2,"unknown")),console.log("                        EncoderVersion    = "+c.get(3,"unknown")),console.log("                        GeneratorName     = "+c.get(4,"unknown")),console.log("                        GeneratorVersion  = "+c.get(5,"unknown")))};a.prototype.parseNameSpace=function(c){c=this._newBlockBytes.readUnsignedByte();var a=this.parseVarStr();this._debug&&console.log("Parsed a NameSpaceBlock: ID = "+c+" | String = "+
a)};a.prototype.parseShadowMethodList=function(c,b){this._newBlockBytes.readUnsignedShort();this.parseProperties({1:a.BADDR,2:a.BADDR,3:a.BADDR,101:this._propsNrType,102:this._propsNrType,103:this._propsNrType,201:a.UINT32,202:a.UINT32,301:a.UINT16,302:a.UINT16,401:a.UINT8,402:a.UINT8,601:a.COLOR,602:a.COLOR,701:a.BOOL,702:a.BOOL,801:a.MTX4x4});this.parseUserAttributes()};a.prototype.parseSharedMethodList=function(c){this._newBlockBytes.readUnsignedShort();this.parseProperties({1:a.BADDR,2:a.BADDR,
3:a.BADDR,101:this._propsNrType,102:this._propsNrType,103:this._propsNrType,104:this._propsNrType,105:this._propsNrType,106:this._propsNrType,107:this._propsNrType,201:a.UINT32,202:a.UINT32,301:a.UINT16,302:a.UINT16,401:a.UINT8,402:a.UINT8,601:a.COLOR,602:a.COLOR,701:a.BOOL,702:a.BOOL});this.parseUserAttributes()};a.prototype.parseUserAttributes=function(){var c,b,d;b=this._newBlockBytes.readUnsignedInt();if(0<b)for(c={},b=this._newBlockBytes.position+b;this._newBlockBytes.position<b;){var h,f,l;
this._newBlockBytes.readUnsignedByte();h=this.parseVarStr();f=this._newBlockBytes.readUnsignedByte();l=this._newBlockBytes.readUnsignedInt();if(this._newBlockBytes.position+l>b){console.log("           Error in reading attribute # "+d+" = skipped to end of attribute-list");this._newBlockBytes.position=b;break}switch(f){case a.AWDSTRING:f=this._newBlockBytes.readUTFBytes(l);break;case a.INT8:f=this._newBlockBytes.readByte();break;case a.INT16:f=this._newBlockBytes.readShort();break;case a.INT32:f=
this._newBlockBytes.readInt();break;case a.BOOL:case a.UINT8:f=this._newBlockBytes.readUnsignedByte();break;case a.UINT16:f=this._newBlockBytes.readUnsignedShort();break;case a.UINT32:case a.BADDR:f=this._newBlockBytes.readUnsignedInt();break;case a.FLOAT32:f=this._newBlockBytes.readFloat();break;case a.FLOAT64:f=this._newBlockBytes.readDouble();break;default:f="unimplemented attribute type "+f,this._newBlockBytes.position+=l}this._debug&&console.log("attribute = name: "+h+"  / value = "+f);c[h]=
f;d+=1}return c};a.prototype.parseProperties=function(c){var a,b=0,d=new AWDProperties;a=this._newBlockBytes.readUnsignedInt();a=this._newBlockBytes.position+a;if(c)for(;this._newBlockBytes.position<a;){var f,l,e;l=this._newBlockBytes.readUnsignedShort();f=this._newBlockBytes.readUnsignedInt();if(this._newBlockBytes.position+f>a){console.log("           Error in reading property # "+b+" = skipped to end of propertie-list");this._newBlockBytes.position=a;break}c.hasOwnProperty(l.toString())?(e=c[l],
d.set(l,this.parseAttrValue(e,f))):this._newBlockBytes.position+=f;b+=1}else this._newBlockBytes.position=a;return d};a.prototype.parseAttrValue=function(c,b){var d,h;switch(c){case a.BOOL:case a.INT8:d=1;h=this._newBlockBytes.readByte;break;case a.INT16:d=2;h=this._newBlockBytes.readShort;break;case a.INT32:d=4;h=this._newBlockBytes.readInt;break;case a.UINT8:d=1;h=this._newBlockBytes.readUnsignedByte;break;case a.UINT16:d=2;h=this._newBlockBytes.readUnsignedShort;break;case a.UINT32:case a.COLOR:case a.BADDR:d=
4;h=this._newBlockBytes.readUnsignedInt;break;case a.FLOAT32:d=4;h=this._newBlockBytes.readFloat;break;case a.FLOAT64:d=8;h=this._newBlockBytes.readDouble;break;case a.AWDSTRING:return this._newBlockBytes.readUTFBytes(b);case a.VECTOR2x1:case a.VECTOR3x1:case a.VECTOR4x1:case a.MTX3x2:case a.MTX3x3:case a.MTX4x3:case a.MTX4x4:d=8,h=this._newBlockBytes.readDouble}if(d<b){var f=[],l=0;for(d=b/d;l<d;)f.push(h.apply(this._newBlockBytes)),l++;return f}return h.apply(this._newBlockBytes)};a.prototype.parseHeader=
function(){var c;this._byteData.position=3;this._version[0]=this._byteData.readUnsignedByte();this._version[1]=this._byteData.readUnsignedByte();c=this._byteData.readUnsignedShort();this._streaming=bitFlags.test(c,bitFlags.FLAG1);2==this._version[0]&&1==this._version[1]&&(this._accuracyMatrix=bitFlags.test(c,bitFlags.FLAG2),this._accuracyGeo=bitFlags.test(c,bitFlags.FLAG3),this._accuracyProps=bitFlags.test(c,bitFlags.FLAG4));this._geoNrType=a.FLOAT32;this._accuracyGeo&&(this._geoNrType=a.FLOAT64);
this._matrixNrType=a.FLOAT32;this._accuracyMatrix&&(this._matrixNrType=a.FLOAT64);this._propsNrType=a.FLOAT32;this._accuracyProps&&(this._propsNrType=a.FLOAT64);this._compression=this._byteData.readUnsignedByte();this._debug&&(console.log("Import AWDFile of version = "+this._version[0]+" - "+this._version[1]),console.log("Global Settings = Compression = "+this._compression+" | Streaming = "+this._streaming+" | Matrix-Precision = "+this._accuracyMatrix+" | Geometry-Precision = "+this._accuracyGeo+
" | Properties-Precision = "+this._accuracyProps));c=this._byteData.readUnsignedInt();this._streaming||c==this._byteData.getBytesAvailable()||this._pDieWithError("AWD2 body length does not match header integrity field")};a.prototype.parseVarStr=function(){var c=this._newBlockBytes.readUnsignedShort();return this._newBlockBytes.readUTFBytes(c)};a.prototype.getAssetByID=function(c,a,d){"undefined"===typeof d&&(d="SingleTexture");var h=[],f=0;if(0<c&&this._blocks[c]&&this._blocks[c].data)for(;f<a.length;){var l=
this._blocks[c].data;if(l.assetType==a[f]&&(a[f]==b.library.AssetType.TEXTURE&&"CubeTexture"==d&&this._blocks[c].data instanceof b.textures.HTMLImageElementCubeTexture||(a[f]!=b.library.AssetType.TEXTURE||"SingleTexture"!=d)||this._blocks[c].data instanceof b.textures.HTMLImageElementTexture))return h.push(!0),h.push(this._blocks[c].data),h;if(a[f]==b.library.AssetType.GEOMETRY&&l.assetType==b.library.AssetType.MESH)return c=this._blocks[c].data,h.push(!0),h.push(c.geometry),h;f++}h.push(!1);h.push(this.getDefaultAsset(a[0],
d));return h};a.prototype.getDefaultAsset=function(c,a){switch(!0){case c==b.library.AssetType.TEXTURE:if("CubeTexture"==a)return this.getDefaultCubeTexture();if("SingleTexture"==a)return this.getDefaultTexture();break;case c==b.library.AssetType.MATERIAL:return this.getDefaultMaterial()}return null};a.prototype.getDefaultMaterial=function(){this._defaultBitmapMaterial||(this._defaultBitmapMaterial=b.materials.DefaultMaterialManager.getDefaultMaterial());return this._defaultBitmapMaterial};a.prototype.getDefaultTexture=
function(){this._defaultTexture||(this._defaultTexture=b.materials.DefaultMaterialManager.getDefaultTexture());return this._defaultTexture};a.prototype.getDefaultCubeTexture=function(){if(!this._defaultCubeTexture){var c=b.materials.DefaultMaterialManager.createCheckeredBitmapData();this._defaultCubeTexture=new b.textures.BitmapCubeTexture(c,c,c,c,c,c);this._defaultCubeTexture.name="defaultTexture"}return this._defaultCubeTexture};a.prototype.readNumber=function(c){"undefined"===typeof c&&(c=!1);
return c?this._newBlockBytes.readDouble():this._newBlockBytes.readFloat()};a.prototype.parseMatrix3D=function(){return new b.geom.Matrix3D(this.parseMatrix43RawData())};a.prototype.parseMatrix32RawData=function(){var c,a=Array(6);for(c=0;6>c;c++)a[c]=this._newBlockBytes.readFloat();return a};a.prototype.parseMatrix43RawData=function(){var c=Array(16);c[0]=this.readNumber(this._accuracyMatrix);c[1]=this.readNumber(this._accuracyMatrix);c[2]=this.readNumber(this._accuracyMatrix);c[3]=0;c[4]=this.readNumber(this._accuracyMatrix);
c[5]=this.readNumber(this._accuracyMatrix);c[6]=this.readNumber(this._accuracyMatrix);c[7]=0;c[8]=this.readNumber(this._accuracyMatrix);c[9]=this.readNumber(this._accuracyMatrix);c[10]=this.readNumber(this._accuracyMatrix);c[11]=0;c[12]=this.readNumber(this._accuracyMatrix);c[13]=this.readNumber(this._accuracyMatrix);c[14]=this.readNumber(this._accuracyMatrix);c[15]=1;isNaN(c[0])&&(c[0]=1,c[1]=0,c[2]=0,c[4]=0,c[5]=1,c[6]=0,c[8]=0,c[9]=0,c[10]=1,c[12]=0,c[13]=0,c[14]=0);return c};a.COMPRESSIONMODE_LZMA=
"lzma";a.UNCOMPRESSED=0;a.DEFLATE=1;a.LZMA=2;a.INT8=1;a.INT16=2;a.INT32=3;a.UINT8=4;a.UINT16=5;a.UINT32=6;a.FLOAT32=7;a.FLOAT64=8;a.BOOL=21;a.COLOR=22;a.BADDR=23;a.AWDSTRING=31;a.AWDBYTEARRAY=32;a.VECTOR2x1=41;a.VECTOR3x1=42;a.VECTOR4x1=43;a.MTX3x2=44;a.MTX3x3=45;a.MTX4x3=46;a.MTX4x4=47;return a}(b.loaders.ParserBase);g.AWDParser=e})(b.loaders||(b.loaders={}))})(away||(away={}));
var AWDBlock=function(){function b(){}b.prototype.dispose=function(){this.uvsForVertexAnimation=this.errorMessages=this.bytes=this.id=null};b.prototype.addError=function(b){this.errorMessages||(this.errorMessages=[]);this.errorMessages.push(b)};return b}(),bitFlags=function(){function b(){}b.test=function(b,e){return(b&e)==e};b.FLAG1=1;b.FLAG2=2;b.FLAG3=4;b.FLAG4=8;b.FLAG5=16;b.FLAG6=32;b.FLAG7=64;b.FLAG8=128;b.FLAG9=256;b.FLAG10=512;b.FLAG11=1024;b.FLAG12=2048;b.FLAG13=4096;b.FLAG14=8192;b.FLAG15=
16384;b.FLAG16=32768;return b}(),AWDProperties=function(){function b(){}b.prototype.set=function(b,e){this[b.toString()]=e};b.prototype.get=function(b,e){console.log("this.hasOwnProperty(key.toString());",b,e,this.hasOwnProperty(b.toString()));return this.hasOwnProperty(b.toString())?this[b.toString()]:e};return b}();
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._format=b.display3D.Context3DTextureFormat.BGRA;this._hasMipmaps=!0;this._textures=Array(8);this._dirty=Array(8)}__extends(a,d);Object.defineProperty(a.prototype,"hasMipMaps",{get:function(){return this._hasMipmaps},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"format",{get:function(){return this._format},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"assetType",{get:function(){return b.library.AssetType.TEXTURE},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return this._pWidth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._pHeight},enumerable:!0,configurable:!0});a.prototype.getTextureForStage3D=function(c){var a=c._iStage3DIndex,b=this._textures[a];c=c._iContext3D;b&&this._dirty[a]==c||(this._textures[a]=b=this.pCreateTexture(c),this._dirty[a]=c,this.pUploadContent(b));return b};a.prototype.pUploadContent=
function(c){throw new b.errors.AbstractMethodError;};a.prototype.pSetSize=function(c,a){this._pWidth==c&&this._pHeight==a||this.pInvalidateSize();this._pWidth=c;this._pHeight=a};a.prototype.invalidateContent=function(){for(var c=0;8>c;++c)this._dirty[c]=null};a.prototype.pInvalidateSize=function(){for(var c,a=0;8>a;++a)if(c=this._textures[a])c.dispose(),this._textures[a]=null,this._dirty[a]=null};a.prototype.pCreateTexture=function(c){throw new b.errors.AbstractMethodError;};a.prototype.dispose=function(){for(var c=
0;8>c;++c)this._textures[c]&&this._textures[c].dispose()};return a}(b.library.NamedAssetBase);g.TextureProxyBase=e})(b.textures||(b.textures={}))})(away||(away={}));(function(b){(function(g){var e=function(d){function a(){d.call(this)}__extends(a,d);a.prototype.pCreateTexture=function(c){return c.createTexture(this.width,this.height,b.display3D.Context3DTextureFormat.BGRA,!1)};return a}(b.textures.TextureProxyBase);g.Texture2DBase=e})(b.textures||(b.textures={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a){"undefined"===typeof a&&(a=!0);d.call(this);this._htmlImageElement=c;this._generateMipmaps=a}__extends(a,d);Object.defineProperty(a.prototype,"htmlImageElement",{get:function(){return this._htmlImageElement},set:function(c){if(c!=this._htmlImageElement){if(!b.utils.TextureUtils.isHTMLImageElementValid(c))throw new b.errors.Error("Invalid bitmapData: Width and height must be power of 2 and cannot exceed 2048");this.invalidateContent();this.pSetSize(c.width,
c.height);this._htmlImageElement=c;this._generateMipmaps&&this.getMipMapHolder()}},enumerable:!0,configurable:!0});a.prototype.pUploadContent=function(c){this._generateMipmaps?b.materials.MipmapGenerator.generateHTMLImageElementMipMaps(this._htmlImageElement,c,this._mipMapHolder,!0):c.uploadFromHTMLImageElement(this._htmlImageElement,0)};a.prototype.getMipMapHolder=function(){var c=this._htmlImageElement.width,d=this._htmlImageElement.height;if(this._mipMapHolder){if(this._mipMapHolder.width==c&&
this._htmlImageElement.height==d)return;this.freeMipMapHolder()}a._mipMaps[c]||(a._mipMaps[c]=[],a._mipMapUses[c]=[]);a._mipMaps[c][d]?(a._mipMapUses[c][d]+=1,this._mipMapHolder=a._mipMaps[c][d]):(this._mipMapHolder=a._mipMaps[c][d]=new b.display.BitmapData(c,d,!0),a._mipMapUses[c][d]=1)};a.prototype.freeMipMapHolder=function(){var c=this._mipMapHolder.width,b=this._mipMapHolder.height;0==--a._mipMapUses[c][b]&&(a._mipMaps[c][b].dispose(),a._mipMaps[c][b]=null)};a.prototype.dispose=function(){d.prototype.dispose.call(this);
this._mipMapHolder&&this.freeMipMapHolder()};a._mipMaps=[];a._mipMapUses=[];return a}(b.textures.Texture2DBase);g.HTMLImageElementTexture=e})(b.textures||(b.textures={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a){"undefined"===typeof a&&(a=!0);d.call(this);this.bitmapData=c;this._generateMipmaps=a}__extends(a,d);Object.defineProperty(a.prototype,"bitmapData",{get:function(){return this._bitmapData},set:function(c){if(c!=this._bitmapData){if(!b.utils.TextureUtils.isBitmapDataValid(c))throw Error("Invalid bitmapData: Width and height must be power of 2 and cannot exceed 2048");this.invalidateContent();this.pSetSize(c.width,c.height);this._bitmapData=
c;this._generateMipmaps&&this.getMipMapHolder()}},enumerable:!0,configurable:!0});a.prototype.pUploadContent=function(c){this._generateMipmaps?b.materials.MipmapGenerator.generateMipMaps(this._bitmapData,c,this._mipMapHolder,!0):c.uploadFromBitmapData(this._bitmapData,0)};a.prototype.getMipMapHolder=function(){var c,d;c=this._bitmapData.width;d=this._bitmapData.height;if(this._mipMapHolder){if(this._mipMapHolder.width==c&&this._bitmapData.height==d)return;this.freeMipMapHolder()}a._mipMaps[c]||(a._mipMaps[c]=
[],a._mipMapUses[c]=[]);a._mipMaps[c][d]?(a._mipMapUses[c][d]+=1,this._mipMapHolder=a._mipMaps[c][d]):(this._mipMapHolder=a._mipMaps[c][d]=new b.display.BitmapData(c,d,!0),a._mipMapUses[c][d]=1)};a.prototype.freeMipMapHolder=function(){var c=this._mipMapHolder.width,b=this._mipMapHolder.height;0==--a._mipMapUses[c][b]&&(a._mipMaps[c][b].dispose(),a._mipMaps[c][b]=null)};a.prototype.dispose=function(){d.prototype.dispose.call(this);this._mipMapHolder&&this.freeMipMapHolder()};a._mipMaps=[];a._mipMapUses=
[];return a}(b.textures.Texture2DBase);g.BitmapTexture=e})(b.textures||(b.textures={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this)}__extends(a,d);Object.defineProperty(a.prototype,"size",{get:function(){return this.width},enumerable:!0,configurable:!0});a.prototype.pCreateTexture=function(c){return c.createCubeTexture(this.width,b.display3D.Context3DTextureFormat.BGRA,!1)};return a}(b.textures.TextureProxyBase);g.CubeTextureBase=e})(b.textures||(b.textures={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a){d.call(this);this.pSetSize(c,a)}__extends(a,d);Object.defineProperty(a.prototype,"width",{set:function(c){if(c!=this._pWidth){if(!b.utils.TextureUtils.isDimensionValid(c))throw Error("Invalid size: Width and height must be power of 2 and cannot exceed 2048");this.invalidateContent();this.pSetSize(c,this._pHeight)}},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{set:function(c){if(c!=this._pHeight){if(!b.utils.TextureUtils.isDimensionValid(c))throw Error("Invalid size: Width and height must be power of 2 and cannot exceed 2048");
this.invalidateContent();this.pSetSize(this._pWidth,c)}},enumerable:!0,configurable:!0});a.prototype.pUploadContent=function(c){var a=new b.display.BitmapData(this.width,this.height,!1,16711680);b.materials.MipmapGenerator.generateMipMaps(a,c);a.dispose()};a.prototype.pCreateTexture=function(c){return c.createTexture(this.width,this.height,b.display3D.Context3DTextureFormat.BGRA,!0)};return a}(b.textures.Texture2DBase);g.RenderTexture=e})(b.textures||(b.textures={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a,b,h,f,l){d.call(this);this._useMipMaps=!1;this._bitmapDatas=Array(6);this.testSize(this._bitmapDatas[0]=c);this.testSize(this._bitmapDatas[1]=a);this.testSize(this._bitmapDatas[2]=b);this.testSize(this._bitmapDatas[3]=h);this.testSize(this._bitmapDatas[4]=f);this.testSize(this._bitmapDatas[5]=l);this.pSetSize(c.width,c.height)}__extends(a,d);Object.defineProperty(a.prototype,"positiveX",{get:function(){return this._bitmapDatas[0]},set:function(c){this.testSize(c);
this.invalidateContent();this.pSetSize(c.width,c.height);this._bitmapDatas[0]=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"negativeX",{get:function(){return this._bitmapDatas[1]},set:function(c){this.testSize(c);this.invalidateContent();this.pSetSize(c.width,c.height);this._bitmapDatas[1]=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"positiveY",{get:function(){return this._bitmapDatas[2]},set:function(c){this.testSize(c);this.invalidateContent();this.pSetSize(c.width,
c.height);this._bitmapDatas[2]=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"negativeY",{get:function(){return this._bitmapDatas[3]},set:function(c){this.testSize(c);this.invalidateContent();this.pSetSize(c.width,c.height);this._bitmapDatas[3]=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"positiveZ",{get:function(){return this._bitmapDatas[4]},set:function(c){this.testSize(c);this.invalidateContent();this.pSetSize(c.width,c.height);this._bitmapDatas[4]=
c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"negativeZ",{get:function(){return this._bitmapDatas[5]},set:function(c){this.testSize(c);this.invalidateContent();this.pSetSize(c.width,c.height);this._bitmapDatas[5]=c},enumerable:!0,configurable:!0});a.prototype.testSize=function(c){if(c.width!=c.height)throw Error("BitmapData should have equal width and height!");if(!b.utils.TextureUtils.isHTMLImageElementValid(c))throw Error("Invalid bitmapData: Width and height must be power of 2 and cannot exceed 2048");
};a.prototype.pUploadContent=function(c){for(var a=0;6>a;++a)this._useMipMaps||c.uploadFromHTMLImageElement(this._bitmapDatas[a],a,0)};return a}(g.CubeTextureBase);g.HTMLImageElementCubeTexture=e})(b.textures||(b.textures={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a,b,h,f,l){d.call(this);this._useMipMaps=!1;this._bitmapDatas=Array(6);this.testSize(this._bitmapDatas[0]=c);this.testSize(this._bitmapDatas[1]=a);this.testSize(this._bitmapDatas[2]=b);this.testSize(this._bitmapDatas[3]=h);this.testSize(this._bitmapDatas[4]=f);this.testSize(this._bitmapDatas[5]=l);this.pSetSize(c.width,c.height)}__extends(a,d);Object.defineProperty(a.prototype,"positiveX",{get:function(){return this._bitmapDatas[0]},set:function(c){this.testSize(c);
this.invalidateContent();this.pSetSize(c.width,c.height);this._bitmapDatas[0]=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"negativeX",{get:function(){return this._bitmapDatas[1]},set:function(c){this.testSize(c);this.invalidateContent();this.pSetSize(c.width,c.height);this._bitmapDatas[1]=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"positiveY",{get:function(){return this._bitmapDatas[2]},set:function(c){this.testSize(c);this.invalidateContent();this.pSetSize(c.width,
c.height);this._bitmapDatas[2]=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"negativeY",{get:function(){return this._bitmapDatas[3]},set:function(c){this.testSize(c);this.invalidateContent();this.pSetSize(c.width,c.height);this._bitmapDatas[3]=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"positiveZ",{get:function(){return this._bitmapDatas[4]},set:function(c){this.testSize(c);this.invalidateContent();this.pSetSize(c.width,c.height);this._bitmapDatas[4]=
c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"negativeZ",{get:function(){return this._bitmapDatas[5]},set:function(c){this.testSize(c);this.invalidateContent();this.pSetSize(c.width,c.height);this._bitmapDatas[5]=c},enumerable:!0,configurable:!0});a.prototype.testSize=function(c){if(c.width!=c.height)throw Error("BitmapData should have equal width and height!");if(!b.utils.TextureUtils.isBitmapDataValid(c))throw Error("Invalid bitmapData: Width and height must be power of 2 and cannot exceed 2048");
};a.prototype.pUploadContent=function(c){for(var a=0;6>a;++a)this._useMipMaps||c.uploadFromBitmapData(this._bitmapDatas[a],a,0)};return a}(g.CubeTextureBase);g.BitmapCubeTexture=e})(b.textures||(b.textures={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(){}b.isBitmapDataValid=function(a){return null==a?!0:b.isDimensionValid(a.width)&&b.isDimensionValid(a.height)};b.isHTMLImageElementValid=function(a){return null==a?!0:b.isDimensionValid(a.width)&&b.isDimensionValid(a.height)};b.isDimensionValid=function(a){return 1<=a&&a<=b.MAX_SIZE&&b.isPowerOfTwo(a)};b.isPowerOfTwo=function(a){return a?(a&-a)==a:!1};b.getBestPowerOf2=function(a){for(var c=1;c<a;)c<<=1;c>b.MAX_SIZE&&(c=b.MAX_SIZE);return c};
b.MAX_SIZE=2048;return b}();b.TextureUtils=e})(b.utils||(b.utils={}))})(away||(away={}));(function(b){(function(g){var e=function(b){function a(c){b.call(this,c)}__extends(a,b);a.TIMER="timer";a.TIMER_COMPLETE="timerComplete";return a}(b.events.Event);g.TimerEvent=e})(b.events||(b.events={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a){"undefined"===typeof a&&(a="");d.call(this,c);this._message=a}__extends(a,d);Object.defineProperty(a.prototype,"message",{get:function(){return this._message},enumerable:!0,configurable:!0});a.prototype.clone=function(){return new b.events.ParserEvent(this.type,this.message)};a.PARSE_COMPLETE="parseComplete";a.PARSE_ERROR="parseError";a.READY_FOR_DEPENDENCIES="readyForDependencies";return a}(b.events.Event);g.ParserEvent=e})(b.events||(b.events=
{}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(a,c,d,q,h,f){"undefined"===typeof h&&(h=!1);"undefined"===typeof f&&(f=!1);this._id=a;this._req=c;this._parentParser=q;this._data=d;this._retrieveAsRawData=h;this._suppressAssetEvents=f;this._assets=[];this._dependencies=[]}Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"assets",{get:function(){return this._assets},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"dependencies",{get:function(){return this._dependencies},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"request",{get:function(){return this._req},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"retrieveAsRawData",{get:function(){return this._retrieveAsRawData},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"suppresAssetEvents",{get:function(){return this._suppressAssetEvents},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"data",{get:function(){return this._data},enumerable:!0,configurable:!0});b.prototype._iSetData=function(a){this._data=a};Object.defineProperty(b.prototype,"parentParser",{get:function(){return this._parentParser},enumerable:!0,configurable:!0});b.prototype.resolve=function(){this._parentParser&&this._parentParser._iResolveDependency(this)};b.prototype.resolveFailure=function(){this._parentParser&&this._parentParser._iResolveDependencyFailure(this)};b.prototype.resolveName=function(a){return this._parentParser?
this._parentParser._iResolveDependencyName(this,a):a.name};return b}();b.ResourceDependency=e})(b.loaders||(b.loaders={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a){"undefined"===typeof a&&(a=0);d.call(this);this._currentCount=this._repeatCount=0;this._running=!1;this._delay=c;this._repeatCount=a;if(isNaN(c)||0>c)throw new b.errors.Error("Delay is negative or not a number");}__extends(a,d);Object.defineProperty(a.prototype,"currentCount",{get:function(){return this._currentCount},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"delay",{get:function(){return this._delay},set:function(c){this._delay=
c;this._running&&(this.stop(),this.start())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"repeatCount",{get:function(){return this._repeatCount},set:function(c){this._repeatCount=c},enumerable:!0,configurable:!0});a.prototype.reset=function(){this._running&&this.stop();this._currentCount=0};Object.defineProperty(a.prototype,"running",{get:function(){return this._running},enumerable:!0,configurable:!0});a.prototype.start=function(){var c=this;this._running=!0;clearInterval(this._iid);
this._iid=setInterval(function(){return c.tick()},this._delay)};a.prototype.stop=function(){this._running=!1;clearInterval(this._iid)};a.prototype.tick=function(){this._currentCount++;0<this._repeatCount&&this._currentCount>=this._repeatCount?(this.stop(),this.dispatchEvent(new b.events.TimerEvent(b.events.TimerEvent.TIMER)),this.dispatchEvent(new b.events.TimerEvent(b.events.TimerEvent.TIMER_COMPLETE))):this.dispatchEvent(new b.events.TimerEvent(b.events.TimerEvent.TIMER))};return a}(b.events.EventDispatcher);
g.Timer=e})(b.utils||(b.utils={}))})(away||(away={}));(function(b){(function(b){b.getTimer=function(){return Date.now()}})(b.utils||(b.utils={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c){d.call(this,c);this._iAllowedToPropagate=!0}__extends(a,d);Object.defineProperty(a.prototype,"bubbles",{get:function(){var c=this._iAllowedToPropagate;this._iAllowedToPropagate=!0;return c},enumerable:!0,configurable:!0});a.prototype.stopPropagation=function(){this._iAllowedToPropagate=!1;this._iParentEvent&&this._iParentEvent.stopPropagation()};a.prototype.stopImmediatePropagation=function(){this._iAllowedToPropagate=!1;this._iParentEvent&&
this._iParentEvent.stopImmediatePropagation()};a.prototype.clone=function(){var c=new b.events.MouseEvent3D(this.type);c.screenX=this.screenX;c.screenY=this.screenY;c.view=this.view;c.object=this.object;c.renderable=this.renderable;c.material=this.material;c.uv=this.uv;c.localPosition=this.localPosition;c.localNormal=this.localNormal;c.index=this.index;c.subGeometryIndex=this.subGeometryIndex;c.delta=this.delta;c.ctrlKey=this.ctrlKey;c.shiftKey=this.shiftKey;c._iParentEvent=this;c._iAllowedToPropagate=
this._iAllowedToPropagate;return c};Object.defineProperty(a.prototype,"scenePosition",{get:function(){return this.object instanceof b.containers.ObjectContainer3D?this.object.sceneTransform.transformVector(this.localPosition):this.localPosition},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sceneNormal",{get:function(){if(this.object instanceof b.containers.ObjectContainer3D){var c=this.object.sceneTransform.deltaTransformVector(this.localNormal);c.normalize();return c}return this.localNormal},
enumerable:!0,configurable:!0});a.MOUSE_OVER="mouseOver3d";a.MOUSE_OUT="mouseOut3d";a.MOUSE_UP="mouseUp3d";a.MOUSE_DOWN="mouseDown3d";a.MOUSE_MOVE="mouseMove3d";a.CLICK="click3d";a.DOUBLE_CLICK="doubleClick3d";a.MOUSE_WHEEL="mouseWheel3d";return a}(g.Event);g.MouseEvent3D=e})(b.events||(b.events={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a,q,h,f){"undefined"===typeof h&&(h=!1);d.call(this);this._iStage3DIndex=-1;this._antiAlias=0;this._renderTarget=null;this._renderSurfaceSelector=0;this._iStage3DIndex=c;this._stage3D=a;this._stage3D.x=0;this._stage3D.y=0;this._stage3D.visible=!0;this._stage3DManager=q;this._viewPort=new b.geom.Rectangle;this._enableDepthAndStencil=!0;this._stage3D.addEventListener(b.events.Event.CONTEXT3D_CREATE,this.onContext3DUpdate,this);this.requestContext(h,
this.profile)}__extends(a,d);a.prototype.notifyViewportUpdated=function(){this._viewportDirty||(this._viewportDirty=!0,this._viewportUpdated=new b.events.Stage3DEvent(b.events.Stage3DEvent.VIEWPORT_UPDATED),this.dispatchEvent(this._viewportUpdated))};a.prototype.notifyEnterFrame=function(){this._enterFrame||(this._enterFrame=new b.events.Event(b.events.Event.ENTER_FRAME));this.dispatchEvent(this._enterFrame)};a.prototype.notifyExitFrame=function(){this._exitFrame||(this._exitFrame=new b.events.Event(b.events.Event.EXIT_FRAME));
this.dispatchEvent(this._exitFrame)};Object.defineProperty(a.prototype,"profile",{get:function(){return this._profile},enumerable:!0,configurable:!0});a.prototype.dispose=function(){this._stage3DManager.iRemoveStage3DProxy(this);this._stage3D.removeEventListener(b.events.Event.CONTEXT3D_CREATE,this.onContext3DUpdate,this);this.freeContext3D();this._stage3DManager=this._stage3D=null;this._iStage3DIndex=-1};a.prototype.configureBackBuffer=function(c,a,b,d){var f=this._backBufferWidth,l=this._backBufferHeight;
this._backBufferWidth=this._viewPort.width=c;this._backBufferHeight=this._viewPort.height=a;f==this._backBufferWidth&&l==this._backBufferHeight||this.notifyViewportUpdated();this._antiAlias=b;this._enableDepthAndStencil=d;this._iContext3D&&this._iContext3D.configureBackBuffer(c,a,b,d);this._stage3D.width=c;this._stage3D.height=a};Object.defineProperty(a.prototype,"enableDepthAndStencil",{get:function(){return this._enableDepthAndStencil},set:function(c){this._enableDepthAndStencil=c;this._backBufferDirty=
!0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"renderTarget",{get:function(){return this._renderTarget},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"renderSurfaceSelector",{get:function(){return this._renderSurfaceSelector},enumerable:!0,configurable:!0});a.prototype.setRenderTarget=function(c,a,d){"undefined"===typeof a&&(a=!1);"undefined"===typeof d&&(d=0);if(this._renderTarget!==c||d!=this._renderSurfaceSelector||this._enableDepthAndStencil!=a)this._renderTarget=
c,this._renderSurfaceSelector=d,this._enableDepthAndStencil=a,b.Debug.throwPIR("Stage3DProxy","setRenderTarget","away.display3D.Context3D: setRenderToTexture , setRenderToBackBuffer")};a.prototype.clear=function(){this._iContext3D&&(this._backBufferDirty&&(this.configureBackBuffer(this._backBufferWidth,this._backBufferHeight,this._antiAlias,this._enableDepthAndStencil),this._backBufferDirty=!1),this._iContext3D.clear((this._color&4278190080)>>>24,(this._color&16711680)>>>16,(this._color&65280)>>>
8,this._color&255),this._bufferClear=!0)};a.prototype.present=function(){this._iContext3D&&(this._iContext3D.present(),this._activeProgram3D=null,this._mouse3DManager&&this._mouse3DManager.fireMouseEvents())};a.prototype.addEventListener=function(c,a,b){d.prototype.addEventListener.call(this,c,a,b)};a.prototype.removeEventListener=function(c,a,b){d.prototype.removeEventListener.call(this,c,a,b)};Object.defineProperty(a.prototype,"scissorRect",{get:function(){return this._scissorRect},set:function(c){this._scissorRect=
c;this._iContext3D.setScissorRectangle(this._scissorRect)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"stage3DIndex",{get:function(){return this._iStage3DIndex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"stage3D",{get:function(){return this._stage3D},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"context3D",{get:function(){return this._iContext3D},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"usesSoftwareRendering",
{get:function(){return this._usesSoftwareRendering},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"x",{get:function(){return this._stage3D.x},set:function(c){this._viewPort.x!=c&&(this._stage3D.x=this._viewPort.x=c,this.notifyViewportUpdated())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"y",{get:function(){return this._stage3D.y},set:function(c){this._viewPort.y!=c&&(this._stage3D.y=this._viewPort.y=c,this.notifyViewportUpdated())},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"canvas",{get:function(){return this._stage3D.canvas},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return this._backBufferWidth},set:function(c){this._viewPort.width!=c&&(this._stage3D.width=this._backBufferWidth=this._viewPort.width=c,this._backBufferDirty=!0,this.notifyViewportUpdated())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._backBufferHeight},set:function(c){this._viewPort.height!=
c&&(this._stage3D.height=this._backBufferHeight=this._viewPort.height=c,this._backBufferDirty=!0,this.notifyViewportUpdated())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"antiAlias",{get:function(){return this._antiAlias},set:function(c){this._antiAlias=c;this._backBufferDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"viewPort",{get:function(){this._viewportDirty=!1;return this._viewPort},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"color",{get:function(){return this._color},set:function(c){this._color=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"visible",{get:function(){return this._stage3D.visible},set:function(c){this._stage3D.visible=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"bufferClear",{get:function(){return this._bufferClear},set:function(c){this._bufferClear=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"mouse3DManager",{get:function(){return this._mouse3DManager},
set:function(c){this._mouse3DManager=c},enumerable:!0,configurable:!0});a.prototype.freeContext3D=function(){this._iContext3D&&(this._iContext3D.dispose(),this.dispatchEvent(new b.events.Stage3DEvent(b.events.Stage3DEvent.CONTEXT3D_DISPOSED)));this._iContext3D=null};a.prototype.onContext3DUpdate=function(c){if(this._stage3D.context3D)c=null!=this._iContext3D,this._iContext3D=this._stage3D.context3D,this._backBufferWidth&&this._backBufferHeight&&this._iContext3D.configureBackBuffer(this._backBufferWidth,
this._backBufferHeight,this._antiAlias,this._enableDepthAndStencil),this.dispatchEvent(new b.events.Stage3DEvent(c?b.events.Stage3DEvent.CONTEXT3D_RECREATED:b.events.Stage3DEvent.CONTEXT3D_CREATED));else throw Error("Rendering context lost!");};a.prototype.requestContext=function(c,a){"undefined"===typeof c&&(c=!1);"undefined"===typeof a&&(a="baseline");null!=this._usesSoftwareRendering&&(this._usesSoftwareRendering=c);this._profile=a;this._stage3D.requestContext(!0)};a.prototype.onEnterFrame=function(c){this._iContext3D&&
(this.clear(),this.notifyEnterFrame(),this.present(),this.notifyExitFrame())};a.prototype.recoverFromDisposal=function(){return this._iContext3D?!0:!1};a.prototype.clearDepthBuffer=function(){this._iContext3D&&this._iContext3D.clear(0,0,0,1,1,0,b.display3D.Context3DClearMask.DEPTH)};return a}(b.events.EventDispatcher);g.Stage3DProxy=e})(b.managers||(b.managers={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a){"undefined"===typeof c&&(c=640);"undefined"===typeof a&&(a=480);d.call(this);if(!document)throw new b.errors.DocumentError("A root document object does not exist.");this.initStage3DObjects();this.resize(c,a)}__extends(a,d);a.prototype.resize=function(c,d){this._stageHeight=d;this._stageWidth=c;for(var q,h=0;h<a.STAGE3D_MAX_QUANTITY;++h)q=this.stage3Ds[h],q.width=c,q.height=d,q.x=0,q.y=0;this.dispatchEvent(new b.events.Event(b.events.Event.RESIZE))};
a.prototype.getStage3DAt=function(c){if(0<=c&&c<a.STAGE3D_MAX_QUANTITY)return this.stage3Ds[c];throw new b.errors.ArgumentError("Index is out of bounds [0.."+a.STAGE3D_MAX_QUANTITY+"]");};a.prototype.initStage3DObjects=function(){this.stage3Ds=[];for(var c=0;c<a.STAGE3D_MAX_QUANTITY;++c){var d=this.createHTMLCanvasElement(),d=new b.display.Stage3D(d);d.addEventListener(b.events.Event.CONTEXT3D_CREATE,this.onContextCreated,this);this.stage3Ds.push(d)}};a.prototype.onContextCreated=function(c){this.addChildHTMLElement(c.target.canvas)};
a.prototype.createHTMLCanvasElement=function(){return document.createElement("canvas")};a.prototype.addChildHTMLElement=function(c){document.body.appendChild(c)};Object.defineProperty(a.prototype,"stageWidth",{get:function(){return this._stageWidth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"stageHeight",{get:function(){return this._stageHeight},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"rect",{get:function(){return new b.geom.Rectangle(0,0,this._stageWidth,
this._stageHeight)},enumerable:!0,configurable:!0});a.STAGE3D_MAX_QUANTITY=8;return a}(b.events.EventDispatcher);g.Stage=e})(b.display||(b.display={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(){this._updateDirty=!0;this._nullVector=new b.geom.Vector3D;this._mousePicker=b.pick.PickingType.RAYCAST_FIRST_ENCOUNTERED;this._childDepth=0;d._view3Ds||(d._view3Ds={},d._view3DLookup=[])}d.prototype.updateCollider=function(a){throw new b.errors.PartialImplementationError("stage3DProxy");};d.prototype.fireMouseEvents=function(){throw new b.errors.PartialImplementationError("View3D().layeredView");};d.prototype.addViewLayer=function(a){throw new b.errors.PartialImplementationError("Stage3DProxy, Stage, DisplayObjectContainer ( as3 / native ) ");
};d.prototype.enableMouseListeners=function(a){throw new b.errors.PartialImplementationError("MouseEvent ( as3 / native ) as3 <> JS Conversion");};d.prototype.disableMouseListeners=function(a){throw new b.errors.PartialImplementationError("MouseEvent ( as3 / native ) as3 <> JS Conversion");};d.prototype.dispose=function(){this._mousePicker.dispose()};d.prototype.queueDispatch=function(a,c,d){throw new b.errors.PartialImplementationError("MouseEvent ( as3 / native ) as3 <> JS Conversion");};d.prototype.reThrowEvent=
function(a){throw new b.errors.PartialImplementationError("MouseEvent - AS3 <> JS Conversion");};d.prototype.hasKey=function(a){for(var c in d._view3Ds)if(c===a)return!0;return!1};d.prototype.traverseDisplayObjects=function(a){throw new b.errors.PartialImplementationError("DisplayObjectContainer ( as3 / native ) as3 <> JS Conversion");};d.prototype.onMouseMove=function(a){throw new b.errors.PartialImplementationError("MouseEvent ( as3 / native ) as3 <> JS Conversion");};d.prototype.onMouseOut=function(a){this._activeView=
null;d._pCollidingObject&&this.queueDispatch(d._mouseOut,a,d._pCollidingObject);this._updateDirty=!0;throw new b.errors.PartialImplementationError("MouseEvent ( as3 / native ) as3 <> JS Conversion");};d.prototype.onMouseOver=function(a){throw new b.errors.PartialImplementationError("MouseEvent ( as3 / native ) as3 <> JS Conversion");};d.prototype.onClick=function(a){throw new b.errors.PartialImplementationError("MouseEvent ( as3 / native ) as3 <> JS Conversion");};d.prototype.onDoubleClick=function(a){d._pCollidingObject?
this.queueDispatch(d._mouseDoubleClick,a):this.reThrowEvent(a);this._updateDirty=!0};d.prototype.onMouseDown=function(a){throw new b.errors.PartialImplementationError("MouseEvent ( as3 / native ) as3 <> JS Conversion");};d.prototype.onMouseUp=function(a){throw new b.errors.PartialImplementationError("MouseEvent ( as3 / native ) as3 <> JS Conversion");};d.prototype.onMouseWheel=function(a){throw new b.errors.PartialImplementationError("MouseEvent ( as3 / native ) as3 <> JS Conversion");};Object.defineProperty(d.prototype,
"forceMouseMove",{get:function(){return this._forceMouseMove},set:function(a){this._forceMouseMove=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"mousePicker",{get:function(){return this._mousePicker},set:function(a){this._mousePicker=a},enumerable:!0,configurable:!0});d._viewCount=0;d._queuedEvents=[];d._mouseUp=new b.events.MouseEvent3D(b.events.MouseEvent3D.MOUSE_UP);d._mouseClick=new b.events.MouseEvent3D(b.events.MouseEvent3D.CLICK);d._mouseOut=new b.events.MouseEvent3D(b.events.MouseEvent3D.MOUSE_OUT);
d._mouseDown=new b.events.MouseEvent3D(b.events.MouseEvent3D.MOUSE_DOWN);d._mouseMove=new b.events.MouseEvent3D(b.events.MouseEvent3D.MOUSE_MOVE);d._mouseOver=new b.events.MouseEvent3D(b.events.MouseEvent3D.MOUSE_OVER);d._mouseWheel=new b.events.MouseEvent3D(b.events.MouseEvent3D.MOUSE_WHEEL);d._mouseDoubleClick=new b.events.MouseEvent3D(b.events.MouseEvent3D.DOUBLE_CLICK);d._previousCollidingView=-1;d._collidingView=-1;return d}();g.Mouse3DManager=e})(b.managers||(b.managers={}))})(away||(away={}));
(function(b){(function(b){var e=function(b){function a(c){b.call(this,c)}__extends(a,b);a.CONTEXT3D_CREATED="Context3DCreated";a.CONTEXT3D_DISPOSED="Context3DDisposed";a.CONTEXT3D_RECREATED="Context3DRecreated";a.VIEWPORT_UPDATED="ViewportUpdated";return a}(b.Event);b.Stage3DEvent=e})(b.events||(b.events={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(a,c){if(!c)throw Error("This class is a multiton and cannot be instantiated manually. Use Stage3DManager.getInstance instead.");this._stage=a;d._stageProxies||(d._stageProxies=Array(this._stage.stage3Ds.length))}d.getInstance=function(a){var c=d.getStage3DManagerByStageRef(a);if(null==c){var c=new b.managers.Stage3DManager(a,new Stage3DManagerSingletonEnforcer),k=new Stage3DManagerInstanceData;k.stage=a;k.stage3DManager=c;d._instances.push(k)}return c};
d.getStage3DManagerByStageRef=function(a){null==d._instances&&(d._instances=[]);for(var c=d._instances.length,b,q=0;q<c;q++)if(b=d._instances[q],b.stage==a)return b.stage3DManager;return null};d.prototype.getStage3DProxy=function(a,c,k){"undefined"===typeof c&&(c=!1);"undefined"===typeof k&&(k="baseline");d._stageProxies[a]||(d._numStageProxies++,d._stageProxies[a]=new b.managers.Stage3DProxy(a,this._stage.stage3Ds[a],this,c,k));return d._stageProxies[a]};d.prototype.iRemoveStage3DProxy=function(a){d._numStageProxies--;
d._stageProxies[a._iStage3DIndex]=null};d.prototype.getFreeStage3DProxy=function(a,c){"undefined"===typeof a&&(a=!1);"undefined"===typeof c&&(c="baseline");for(var b=0,q=d._stageProxies.length;b<q;){if(!d._stageProxies[b])return this.getStage3DProxy(b,a,c),d._stageProxies[b].width=this._stage.stageWidth,d._stageProxies[b].height=this._stage.stageHeight,d._stageProxies[b];++b}throw Error("Too many Stage3D instances used!");};Object.defineProperty(d.prototype,"hasFreeStage3DProxy",{get:function(){return d._numStageProxies<
d._stageProxies.length?!0:!1},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"numProxySlotsFree",{get:function(){return d._stageProxies.length-d._numStageProxies},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"numProxySlotsUsed",{get:function(){return d._numStageProxies},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"numProxySlotsTotal",{get:function(){return d._stageProxies.length},enumerable:!0,configurable:!0});d._numStageProxies=0;return d}();
g.Stage3DManager=e})(b.managers||(b.managers={}))})(away||(away={}));var Stage3DManagerInstanceData=function(){return function(){}}(),Stage3DManagerSingletonEnforcer=function(){return function(){}}();
(function(b){(function(g){var e=function(){function d(a,c){if(!c)throw Error("This class is a multiton and cannot be instantiated manually. Use Stage3DManager.getInstance instead.");this._stage3DProxy=a;this._program3Ds={};this._ids={};this._usages={};this._keys={}}d.getInstance=function(a){var c=a._iStage3DIndex;null==d._instances&&(d._instances=Array(8));d._instances[c]||(d._instances[c]=new d(a,new AGALProgram3DCacheSingletonEnforcer),a.addEventListener(b.events.Stage3DEvent.CONTEXT3D_DISPOSED,
d.onContext3DDisposed,d),a.addEventListener(b.events.Stage3DEvent.CONTEXT3D_CREATED,d.onContext3DDisposed,d),a.addEventListener(b.events.Stage3DEvent.CONTEXT3D_RECREATED,d.onContext3DDisposed,d));return d._instances[c]};d.getInstanceFromIndex=function(a){if(!d._instances[a])throw Error("Instance not created yet!");return d._instances[a]};d.onContext3DDisposed=function(a){a=a.target;var c=a._iStage3DIndex;d._instances[c].dispose();d._instances[c]=null;a.removeEventListener(b.events.Stage3DEvent.CONTEXT3D_DISPOSED,
d.onContext3DDisposed,d);a.removeEventListener(b.events.Stage3DEvent.CONTEXT3D_CREATED,d.onContext3DDisposed,d);a.removeEventListener(b.events.Stage3DEvent.CONTEXT3D_RECREATED,d.onContext3DDisposed,d)};d.prototype.dispose=function(){for(var a in this._program3Ds)this.destroyProgram(a);this._usages=this._program3Ds=this._keys=null};d.prototype.setProgram3D=function(a,c,k){var q=this._stage3DProxy._iStage3DIndex,h,f=this.getKey(c,k);if(null==this._program3Ds[f]){this._keys[d._currentId]=f;this._usages[d._currentId]=
0;this._ids[f]=d._currentId;++d._currentId;h=this._stage3DProxy._iContext3D.createProgram();var l=new aglsl.AGLSLCompiler,e=new aglsl.AGLSLCompiler,l=l.compile(b.display3D.Context3DProgramType.VERTEX,c),e=e.compile(b.display3D.Context3DProgramType.FRAGMENT,k);console.log("===GLSL=========================================================");console.log("vertString");console.log(l);console.log("fragString");console.log(e);console.log("===AGAL=========================================================");
console.log("vertexCode");console.log(c);console.log("fragmentCode");console.log(k);h.upload(l,e);this._program3Ds[f]=h}c=a._iProgram3Dids[q];k=this._ids[f];c!=k&&(0<=c&&this.freeProgram3D(c),this._usages[k]++);a._iProgram3Dids[q]=k;a._iProgram3Ds[q]=this._program3Ds[f]};d.prototype.freeProgram3D=function(a){this._usages[a]--;0==this._usages[a]&&this.destroyProgram(this._keys[a])};d.prototype.destroyProgram=function(a){this._program3Ds[a].dispose();this._program3Ds[a]=null;delete this._program3Ds[a];
this._ids[a]=-1};d.prototype.getKey=function(a,c){return a+"---"+c};d._currentId=0;return d}();g.AGALProgram3DCache=e})(b.managers||(b.managers={}))})(away||(away={}));var AGALProgram3DCacheSingletonEnforcer=function(){return function(){}}();
(function(b){(function(g){var e=function(){function d(){}d.generateHTMLImageElementMipMaps=function(a,c,k,q,h){"undefined"===typeof k&&(k=null);"undefined"===typeof q&&(q=!1);d._rect.width=a.width;d._rect.height=a.height;d._source=new b.display.BitmapData(a.width,a.height,q);d._source.drawImage(a,d._rect,d._rect);d.generateMipMaps(d._source,c,k);d._source.dispose();d._source=null};d.generateMipMaps=function(a,c,k,q,h){"undefined"===typeof k&&(k=null);"undefined"===typeof q&&(q=!1);h=a.width;var f=
a.height,l=null!=k,e;k||(k=new b.display.BitmapData(h,f,q));d._rect.width=h;d._rect.height=f;for(var g;1<=h||1<=f;)q&&k.fillRect(d._rect,0),d._matrix.a=d._rect.width/a.width,d._matrix.d=d._rect.height/a.height,k.width=d._rect.width,k.height=d._rect.height,k.copyPixels(a,a.rect,d._rect),c instanceof b.display3D.Texture?(g=c,g.uploadFromBitmapData(k,e++)):b.Debug.throwPIR("MipMapGenerator","generateMipMaps","Dependency: CubeTexture"),h>>=1,f>>=1,d._rect.width=1<h?h:1,d._rect.height=1<f?f:1;l||k.dispose()};
d._matrix=new b.geom.Matrix;d._rect=new b.geom.Rectangle;return d}();g.MipmapGenerator=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(a){"undefined"===typeof a&&(a=null);this._variables={};null!==a&&this.decode(a)}b.prototype.decode=function(a){a=a.split("+").join(" ");for(var c,b=/[?&]?([^=]+)=([^&]*)/g;c=b.exec(a);)this._variables[decodeURIComponent(c[1])]=decodeURIComponent(c[2])};b.prototype.toString=function(){return""};Object.defineProperty(b.prototype,"variables",{get:function(){return this._variables},set:function(a){this._variables=a},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"formData",{get:function(){var a=new FormData,c;for(c in this._variables)a.append(c,this._variables[c]);return a},enumerable:!0,configurable:!0});return b}();b.URLVariables=e})(b.net||(b.net={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(c){"undefined"===typeof c&&(c=null);b.call(this,c)}__extends(a,b);a.prototype.perspectiveFieldOfViewLH=function(c,a,b,d){c=1/Math.tan(c/2);this.copyRawDataFrom([c/a,0,0,0,0,c,0,0,0,0,d/(d-b),1,0,0,b*d/(b-d),0])};return a}(b.geom.Matrix3D);g.PerspectiveMatrix3D=e})(b.utils||(b.utils={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(a,c){var d=this;this._active=!1;this._argsArray=[];this._getTimer=b.utils.getTimer;this.setCallback(a,c);this._rafUpdateFunction=function(){d._active&&d._tick()};this._argsArray.push(this._dt)}d.prototype.setCallback=function(a,c){this._callback=a;this._callbackContext=c};d.prototype.start=function(){this._prevTime=this._getTimer();this._active=!0;window.mozRequestAnimationFrame?window.requestAnimationFrame=window.mozRequestAnimationFrame:window.webkitRequestAnimationFrame?
window.requestAnimationFrame=window.webkitRequestAnimationFrame:window.oRequestAnimationFrame&&(window.requestAnimationFrame=window.oRequestAnimationFrame);window.requestAnimationFrame&&window.requestAnimationFrame(this._rafUpdateFunction)};d.prototype.stop=function(){this._active=!1};Object.defineProperty(d.prototype,"active",{get:function(){return this._active},enumerable:!0,configurable:!0});d.prototype._tick=function(){this._currentTime=this._getTimer();this._dt=this._currentTime-this._prevTime;
this._argsArray[0]=this._dt;this._callback.apply(this._callbackContext,this._argsArray);window.requestAnimationFrame(this._rafUpdateFunction);this._prevTime=this._currentTime};return d}();g.RequestAnimationFrame=e})(b.utils||(b.utils={}))})(away||(away={}));
(function(b){var g=function(){function e(){}e.breakpoint=function(){b.Debug["break"]()};e.throwPIROnKeyWordOnly=function(d,a){"undefined"===typeof a&&(a=!0);b.Debug.keyword=a?d:null};e.throwPIR=function(d,a,c){e.logPIR("PartialImplementationError "+d,a,c);if(e.THROW_ERRORS&&(!b.Debug.keyword||-1!=(d+a+c).indexOf(b.Debug.keyword)))throw new b.errors.PartialImplementationError(d+"."+a+": "+c);};e.logPIR=function(b,a,c){"undefined"===typeof c&&(c="");e.LOG_PI_ERRORS&&console.log(b+"."+a+": "+c)};e.log=
function(){for(var b=0;b<arguments.length-0;b++);e.ENABLE_LOG&&console.log.apply(console,arguments)};e.THROW_ERRORS=!0;e.ENABLE_LOG=!0;e.LOG_PI_ERRORS=!0;e.keyword=null;return e}();b.Debug=g})(away||(away={}));
(function(b){(function(g){var e=function(){function d(){this._faceTangentsDirty=this._faceNormalsDirty=!0;this._indexBuffer=Array(8);this._indexBufferContext=Array(8);this._indicesInvalid=Array(8);this._autoDeriveVertexTangents=this._autoDeriveVertexNormals=!0;this._useFaceWeights=this._autoGenerateUVs=!1;this._vertexTangentsDirty=this._vertexNormalsDirty=!0;this._scaleV=this._scaleU=1;this._uvsDirty=!0}Object.defineProperty(d.prototype,"autoGenerateDummyUVs",{get:function(){return this._autoGenerateUVs},
set:function(a){this._uvsDirty=this._autoGenerateUVs=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"autoDeriveVertexNormals",{get:function(){return this._autoDeriveVertexNormals},set:function(a){this._vertexNormalsDirty=this._autoDeriveVertexNormals=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"useFaceWeights",{get:function(){return this._useFaceWeights},set:function(a){this._useFaceWeights=a;this._autoDeriveVertexNormals&&(this._vertexNormalsDirty=!0);
this._autoDeriveVertexTangents&&(this._vertexTangentsDirty=!0);this._faceNormalsDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"numTriangles",{get:function(){return this._numTriangles},enumerable:!0,configurable:!0});d.prototype.getIndexBuffer=function(a){var c=a._iStage3DIndex;a=a._iContext3D;this._indexBuffer[c]&&this._indexBufferContext[c]==a||(this._indexBuffer[c]=a.createIndexBuffer(this._numIndices),this._indexBufferContext[c]=a,this._indicesInvalid[c]=!0);this._indicesInvalid[c]&&
(this._indexBuffer[c].uploadFromArray(this._indices,0,this._numIndices),this._indicesInvalid[c]=!1);return this._indexBuffer[c]};d.prototype.pUpdateFaceTangents=function(){var a=0,c,b,d,h=this._indices.length,f,l,e,g,m,n,p,r=this._vertexData,t=this.UVData,v=this.vertexStride,x=this.vertexOffset,u=this.UVStride,y=this.UVOffset;null==this._faceTangents&&(this._faceTangents=Array(this._indices.length));for(;a<h;)c=this._indices[a],b=this._indices[a+1],d=this._indices[a+2],f=y+c*u+1,l=t[f],f=y+b*u+1,
e=t[f]-l,f=y+d*u+1,f=t[f]-l,l=x+c*v,g=r[l],m=r[l+1],n=r[l+2],l=x+b*v,p=r[l]-g,c=r[l+1]-m,b=r[l+2]-n,l=x+d*v,d=r[l]-g,m=r[l+1]-m,l=r[l+2]-n,d=f*p-e*d,c=f*c-e*m,f=f*b-e*l,e=1/Math.sqrt(d*d+c*c+f*f),this._faceTangents[a++]=e*d,this._faceTangents[a++]=e*c,this._faceTangents[a++]=e*f;this._faceTangentsDirty=!1};d.prototype.updateFaceNormals=function(){var a=0,c=0,b=0,d,h=this._indices.length,f,l,e,g,m,n,p,r,t=this._vertexData,v=this.vertexStride,x=this.vertexOffset;null==this._faceNormals&&(this._faceNormals=
Array(h));this._useFaceWeights&&null==this._faceWeights&&(this._faceWeights=Array(h/3));for(;a<h;)d=x+this._indices[a++]*v,f=t[d],g=t[d+1],p=t[d+2],d=x+this._indices[a++]*v,l=t[d],m=t[d+1],r=t[d+2],d=x+this._indices[a++]*v,e=t[d],n=t[d+1],d=t[d+2],e-=f,n-=g,d-=p,f=l-f,g=m-g,r-=p,p=d*g-n*r,r=e*r-d*f,e=n*f-e*g,n=Math.sqrt(p*p+r*r+e*e),this._useFaceWeights&&(g=1E4*n,1>g&&(g=1),this._faceWeights[b++]=g),n=1/n,this._faceNormals[c++]=p*n,this._faceNormals[c++]=r*n,this._faceNormals[c++]=e*n;this._faceNormalsDirty=
!1};d.prototype.pUpdateVertexNormals=function(a){this._faceNormalsDirty&&this.updateFaceNormals();var c,b=0,d=1,h=2,f=this._vertexData.length,l=this.vertexNormalStride,e=this.vertexNormalOffset;null==a&&(a=Array(f));for(c=e;c<f;)a[c]=0,a[c+1]=0,a[c+2]=0,c+=l;for(var g=c=0,m=this._indices.length,n,p;c<m;)p=this._useFaceWeights?this._faceWeights[g++]:1,n=e+this._indices[c++]*l,a[n++]+=this._faceNormals[b]*p,a[n++]+=this._faceNormals[d]*p,a[n]+=this._faceNormals[h]*p,n=e+this._indices[c++]*l,a[n++]+=
this._faceNormals[b]*p,a[n++]+=this._faceNormals[d]*p,a[n]+=this._faceNormals[h]*p,n=e+this._indices[c++]*l,a[n++]+=this._faceNormals[b]*p,a[n++]+=this._faceNormals[d]*p,a[n]+=this._faceNormals[h]*p,b+=3,d+=3,h+=3;for(c=e;c<f;)b=a[c],d=a[c+1],h=a[c+2],e=1/Math.sqrt(b*b+d*d+h*h),a[c]=b*e,a[c+1]=d*e,a[c+2]=h*e,c+=l;this._vertexNormalsDirty=!1;return a};d.prototype.pUpdateVertexTangents=function(a){this._faceTangentsDirty&&this.pUpdateFaceTangents();var c,b=this._vertexData.length,d=this.vertexTangentStride,
h=this.vertexTangentOffset;null==a&&(a=Array(b));for(c=h;c<b;)a[c]=0,a[c+1]=0,a[c+2]=0,c+=d;var f=0,l=this._indices.length,e,g,m=0,n=1,p=2;for(c=0;c<l;)g=this._useFaceWeights?this._faceWeights[f++]:1,e=h+this._indices[c++]*d,a[e++]+=this._faceTangents[m]*g,a[e++]+=this._faceTangents[n]*g,a[e]+=this._faceTangents[p]*g,e=h+this._indices[c++]*d,a[e++]+=this._faceTangents[m]*g,a[e++]+=this._faceTangents[n]*g,a[e]+=this._faceTangents[p]*g,e=h+this._indices[c++]*d,a[e++]+=this._faceTangents[m]*g,a[e++]+=
this._faceTangents[n]*g,a[e]+=this._faceTangents[p]*g,m+=3,n+=3,p+=3;for(c=h;c<b;)h=a[c],f=a[c+1],l=a[c+2],e=1/Math.sqrt(h*h+f*f+l*l),a[c]=h*e,a[c+1]=f*e,a[c+2]=l*e,c+=d;this._vertexTangentsDirty=!1;return a};d.prototype.dispose=function(){this.pDisposeIndexBuffers(this._indexBuffer);this._vertexData=this._faceTangents=this._faceWeights=this._faceNormals=this._indexBufferContext=this._indices=null};Object.defineProperty(d.prototype,"indexData",{get:function(){return this._indices},enumerable:!0,configurable:!0});
d.prototype.updateIndexData=function(a){this._indices=a;this._numIndices=a.length;a=this._numIndices/3;this._numTriangles!=a&&this.pDisposeIndexBuffers(this._indexBuffer);this._numTriangles=a;this.pInvalidateBuffers(this._indicesInvalid);this._faceNormalsDirty=!0;this._autoDeriveVertexNormals&&(this._vertexNormalsDirty=!0);this._autoDeriveVertexTangents&&(this._vertexTangentsDirty=!0)};d.prototype.pDisposeIndexBuffers=function(a){for(var c=0;8>c;++c)a[c]&&(a[c].dispose(),a[c]=null)};d.prototype.pDisposeVertexBuffers=
function(a){for(var c=0;8>c;++c)a[c]&&(a[c].dispose(),a[c]=null)};Object.defineProperty(d.prototype,"autoDeriveVertexTangents",{get:function(){return this._autoDeriveVertexTangents},set:function(a){this._vertexTangentsDirty=this._autoDeriveVertexTangents=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"faceNormals",{get:function(){this._faceNormalsDirty&&this.updateFaceNormals();return this._faceNormals},enumerable:!0,configurable:!0});d.prototype.pInvalidateBuffers=function(a){for(var c=
0;8>c;++c)a[c]=!0};Object.defineProperty(d.prototype,"UVStride",{get:function(){throw new b.errors.AbstractMethodError;},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"vertexData",{get:function(){throw new b.errors.AbstractMethodError;},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"vertexPositionData",{get:function(){throw new b.errors.AbstractMethodError;},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"vertexNormalData",{get:function(){throw new b.errors.AbstractMethodError;
},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"vertexTangentData",{get:function(){throw new b.errors.AbstractMethodError;},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"UVData",{get:function(){throw new b.errors.AbstractMethodError;},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"vertexStride",{get:function(){throw new b.errors.AbstractMethodError;},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"vertexNormalStride",
{get:function(){throw new b.errors.AbstractMethodError;},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"vertexTangentStride",{get:function(){throw new b.errors.AbstractMethodError;},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"vertexOffset",{get:function(){throw new b.errors.AbstractMethodError;},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"vertexNormalOffset",{get:function(){throw new b.errors.AbstractMethodError;},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"vertexTangentOffset",{get:function(){throw new b.errors.AbstractMethodError;},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"UVOffset",{get:function(){throw new b.errors.AbstractMethodError;},enumerable:!0,configurable:!0});d.prototype.pInvalidateBounds=function(){this._parentGeometry&&this._parentGeometry.iInvalidateBounds(this)};Object.defineProperty(d.prototype,"parentGeometry",{get:function(){return this._parentGeometry},set:function(a){this._parentGeometry=
a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"scaleU",{get:function(){return this._scaleU},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"scaleV",{get:function(){return this._scaleV},enumerable:!0,configurable:!0});d.prototype.scaleUV=function(a,c){"undefined"===typeof a&&(a=1);"undefined"===typeof c&&(c=1);for(var b=this.UVStride,d=this.UVData,h=d.length,f=a/this._scaleU,l=c/this._scaleV,e=this.UVOffset;e<h;e+=b)d[e]*=f,d[e+1]*=l;this._scaleU=a;this._scaleV=
c};d.prototype.scale=function(a){for(var c=this.UVData,b=c.length,d=this.vertexStride,h=this.vertexOffset;h<b;h+=d)c[h]*=a,c[h+1]*=a,c[h+2]*=a};d.prototype.applyTransformation=function(a){var c=this._vertexData,d=this.vertexNormalData,q=this.vertexTangentData,h=this.vertexStride,f=this.vertexNormalStride,l=this.vertexTangentStride,e=this.vertexOffset,g=this.vertexNormalOffset,m=this.vertexTangentOffset,n=c.length/h,p,r,t=new b.geom.Vector3D,v=null!=d,x=null!=q,u;if(v||x)u=a.clone(),u.invert(),u.transpose();
for(var y=m,m=0;m<n;++m)p=e+1,r=e+2,t.x=c[e],t.y=c[p],t.z=c[r],t=a.transformVector(t),c[e]=t.x,c[p]=t.y,c[r]=t.z,e+=h,v&&(p=g+1,r=g+2,t.x=d[g],t.y=d[p],t.z=d[r],t=u.deltaTransformVector(t),t.normalize(),d[g]=t.x,d[p]=t.y,d[r]=t.z,g+=f),x&&(p=y+1,r=y+2,t.x=q[y],t.y=q[p],t.z=q[r],t=u.deltaTransformVector(t),t.normalize(),q[y]=t.x,q[p]=t.y,q[r]=t.z,y+=l)};d.prototype.pUpdateDummyUVs=function(a){this._uvsDirty=!1;var c,b;c=this.UVStride;var d=c-2,h=this._vertexData.length/this.vertexStride*c;a||(a=[]);
a.length=h;c=this.UVOffset;for(b=0;c<h;)a[c++]=0.5*b,a[c++]=1-(b&1),c+=d,3==++b&&(b=0);return a};return d}();g.SubGeometryBase=e})(b.base||(b.base={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(c,a){"undefined"===typeof a&&(a=null);b.call(this,c);this._subGeometry=a}__extends(a,b);Object.defineProperty(a.prototype,"subGeometry",{get:function(){return this._subGeometry},enumerable:!0,configurable:!0});a.prototype.clone=function(){return new a(this.type,this._subGeometry)};a.SUB_GEOMETRY_ADDED="SubGeometryAdded";a.SUB_GEOMETRY_REMOVED="SubGeometryRemoved";a.BOUNDS_INVALID="BoundsInvalid";return a}(b.events.Event);g.GeometryEvent=e})(b.events||
(b.events={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._pVertexDataInvalid=Array(8);this._vertexBuffer=Array(8);this._bufferContext=Array(8);this._autoDeriveVertexTangents=this._autoDeriveVertexNormals=!1}__extends(a,d);Object.defineProperty(a.prototype,"numVertices",{get:function(){return this._pNumVertices},enumerable:!0,configurable:!0});a.prototype.updateData=function(c){this._autoDeriveVertexNormals&&(this._vertexNormalsDirty=!0);this._autoDeriveVertexTangents&&(this._vertexTangentsDirty=
!0);this._isolatedVertexPositionDataDirty=this._faceTangentsDirty=this._faceNormalsDirty=!0;this._vertexData=c;c=this._vertexData.length/13;c!=this._pNumVertices&&this.pDisposeVertexBuffers(this._vertexBuffer);this._pNumVertices=c;if(0==this._pNumVertices)throw Error("Bad data: geometry can't have zero triangles");this.pInvalidateBuffers(this._pVertexDataInvalid);this.pInvalidateBounds()};a.prototype.activateVertexBuffer=function(c,a){var d=a._iStage3DIndex,h=a._iContext3D;d!=this._contextIndex&&
this.pUpdateActiveBuffer(d);this._pActiveBuffer&&this._activeContext==h||this.pCreateBuffer(d,h);this._pActiveDataInvalid&&this.pUploadData(d);h.setVertexBufferAt(c,this._pActiveBuffer,0,b.display3D.Context3DVertexBufferFormat.FLOAT_3)};a.prototype.activateUVBuffer=function(c,a){var d=a._iStage3DIndex,h=a._iContext3D;this._uvsDirty&&this._autoGenerateUVs&&(this._vertexData=this.pUpdateDummyUVs(this._vertexData),this.pInvalidateBuffers(this._pVertexDataInvalid));d!=this._contextIndex&&this.pUpdateActiveBuffer(d);
this._pActiveBuffer&&this._activeContext==h||this.pCreateBuffer(d,h);this._pActiveDataInvalid&&this.pUploadData(d);h.setVertexBufferAt(c,this._pActiveBuffer,9,b.display3D.Context3DVertexBufferFormat.FLOAT_2)};a.prototype.activateSecondaryUVBuffer=function(c,a){var d=a._iStage3DIndex,h=a._iContext3D;d!=this._contextIndex&&this.pUpdateActiveBuffer(d);this._pActiveBuffer&&this._activeContext==h||this.pCreateBuffer(d,h);this._pActiveDataInvalid&&this.pUploadData(d);h.setVertexBufferAt(c,this._pActiveBuffer,
11,b.display3D.Context3DVertexBufferFormat.FLOAT_2)};a.prototype.pUploadData=function(c){this._pActiveBuffer.uploadFromArray(this._vertexData,0,this._pNumVertices);this._pVertexDataInvalid[c]=this._pActiveDataInvalid=!1};a.prototype.activateVertexNormalBuffer=function(c,a){var d=a._iStage3DIndex,h=a._iContext3D;d!=this._contextIndex&&this.pUpdateActiveBuffer(d);this._pActiveBuffer&&this._activeContext==h||this.pCreateBuffer(d,h);this._pActiveDataInvalid&&this.pUploadData(d);h.setVertexBufferAt(c,
this._pActiveBuffer,3,b.display3D.Context3DVertexBufferFormat.FLOAT_3)};a.prototype.activateVertexTangentBuffer=function(c,a){var d=a._iStage3DIndex,h=a._iContext3D;d!=this._contextIndex&&this.pUpdateActiveBuffer(d);this._pActiveBuffer&&this._activeContext==h||this.pCreateBuffer(d,h);this._pActiveDataInvalid&&this.pUploadData(d);h.setVertexBufferAt(c,this._pActiveBuffer,6,b.display3D.Context3DVertexBufferFormat.FLOAT_3)};a.prototype.pCreateBuffer=function(c,a){this._vertexBuffer[c]=this._pActiveBuffer=
a.createVertexBuffer(this._pNumVertices,13);this._bufferContext[c]=this._activeContext=a;this._pVertexDataInvalid[c]=this._pActiveDataInvalid=!0};a.prototype.pUpdateActiveBuffer=function(c){this._contextIndex=c;this._pActiveDataInvalid=this._pVertexDataInvalid[c];this._pActiveBuffer=this._vertexBuffer[c];this._activeContext=this._bufferContext[c]};Object.defineProperty(a.prototype,"vertexData",{get:function(){this._autoDeriveVertexNormals&&this._vertexNormalsDirty&&(this._vertexData=this.pUpdateVertexNormals(this._vertexData));
this._autoDeriveVertexTangents&&this._vertexTangentsDirty&&(this._vertexData=this.pUpdateVertexTangents(this._vertexData));this._uvsDirty&&this._autoGenerateUVs&&(this._vertexData=this.pUpdateDummyUVs(this._vertexData));return this._vertexData},enumerable:!0,configurable:!0});a.prototype.pUpdateVertexNormals=function(c){this.pInvalidateBuffers(this._pVertexDataInvalid);return d.prototype.pUpdateVertexNormals.call(this,c)};a.prototype.pUpdateVertexTangents=function(c){this._vertexNormalsDirty&&(this._vertexData=
this.pUpdateVertexNormals(this._vertexData));this.pInvalidateBuffers(this._pVertexDataInvalid);return d.prototype.pUpdateVertexTangents.call(this,c)};Object.defineProperty(a.prototype,"vertexNormalData",{get:function(){this._autoDeriveVertexNormals&&this._vertexNormalsDirty&&(this._vertexData=this.pUpdateVertexNormals(this._vertexData));return this._vertexData},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexTangentData",{get:function(){this._autoDeriveVertexTangents&&this._vertexTangentsDirty&&
(this._vertexData=this.pUpdateVertexTangents(this._vertexData));return this._vertexData},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"UVData",{get:function(){this._uvsDirty&&this._autoGenerateUVs&&(this._vertexData=this.pUpdateDummyUVs(this._vertexData),this.pInvalidateBuffers(this._pVertexDataInvalid));return this._vertexData},enumerable:!0,configurable:!0});a.prototype.applyTransformation=function(c){d.prototype.applyTransformation.call(this,c);this.pInvalidateBuffers(this._pVertexDataInvalid)};
a.prototype.scale=function(c){d.prototype.scale.call(this,c);this.pInvalidateBuffers(this._pVertexDataInvalid)};a.prototype.clone=function(){var c=new b.base.CompactSubGeometry;c._autoDeriveVertexNormals=this._autoDeriveVertexNormals;c._autoDeriveVertexTangents=this._autoDeriveVertexTangents;c.updateData(this._vertexData.concat());c.updateIndexData(this._indices.concat());return c};a.prototype.scaleUV=function(c,a){"undefined"===typeof c&&(c=1);"undefined"===typeof a&&(a=1);d.prototype.scaleUV.call(this,
c,a);this.pInvalidateBuffers(this._pVertexDataInvalid)};Object.defineProperty(a.prototype,"vertexStride",{get:function(){return 13},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexNormalStride",{get:function(){return 13},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexTangentStride",{get:function(){return 13},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"UVStride",{get:function(){return 13},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"secondaryUVStride",{get:function(){return 13},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexOffset",{get:function(){return 0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexNormalOffset",{get:function(){return 3},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexTangentOffset",{get:function(){return 6},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"UVOffset",{get:function(){return 9},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"secondaryUVOffset",{get:function(){return 11},enumerable:!0,configurable:!0});a.prototype.dispose=function(){d.prototype.dispose.call(this);this.pDisposeVertexBuffers(this._vertexBuffer);this._vertexBuffer=null};a.prototype.pDisposeVertexBuffers=function(c){d.prototype.pDisposeVertexBuffers.call(this,c);this._pActiveBuffer=null};a.prototype.pInvalidateBuffers=function(c){d.prototype.pInvalidateBuffers.call(this,c);this._pActiveDataInvalid=!0};a.prototype.cloneWithSeperateBuffers=
function(){var c=new b.base.SubGeometry;c.updateVertexData(this._isolatedVertexPositionData?this._isolatedVertexPositionData:this._isolatedVertexPositionData=this.stripBuffer(0,3));c.autoDeriveVertexNormals=this._autoDeriveVertexNormals;c.autoDeriveVertexTangents=this._autoDeriveVertexTangents;this._autoDeriveVertexNormals||c.updateVertexNormalData(this.stripBuffer(3,3));this._autoDeriveVertexTangents||c.updateVertexTangentData(this.stripBuffer(6,3));c.updateUVData(this.stripBuffer(9,2));c.updateSecondaryUVData(this.stripBuffer(11,
2));c.updateIndexData(this.indexData.concat());return c};Object.defineProperty(a.prototype,"vertexPositionData",{get:function(){if(this._isolatedVertexPositionDataDirty||!this._isolatedVertexPositionData)this._isolatedVertexPositionData=this.stripBuffer(0,3),this._isolatedVertexPositionDataDirty=!1;return this._isolatedVertexPositionData},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"strippedUVData",{get:function(){return this.stripBuffer(9,2)},enumerable:!0,configurable:!0});
a.prototype.stripBuffer=function(c,a){for(var b=Array(this._pNumVertices*a),d=0,f=c,l=13-a,e=0;e<this._pNumVertices;++e){for(var g=0;g<a;++g)b[d++]=this._vertexData[f++];f+=l}return b};a.prototype.fromVectors=function(c,a,b,d){for(var f=13*(c.length/3),l=0,e=0,g=0,m=0,n=0,p=Array(f);l<f;)p[l++]=c[e++],p[l++]=c[e++],p[l++]=c[e++],b&&b.length?(p[l++]=b[g++],p[l++]=b[g++],p[l++]=b[g++]):(p[l++]=0,p[l++]=0,p[l++]=0),d&&d.length?(p[l++]=d[m++],p[l++]=d[m++],p[l++]=d[m++]):(p[l++]=0,p[l++]=0,p[l++]=0),
a&&a.length?(p[l++]=a[n],p[l++]=a[n+1],p[l++]=a[n++],p[l++]=a[n++]):(p[l++]=0,p[l++]=0,p[l++]=0,p[l++]=0);this.autoDeriveVertexNormals=!(b&&b.length);this.autoDeriveVertexTangents=!(d&&d.length);this.autoGenerateDummyUVs=!(a&&a.length);this.updateData(p)};return a}(b.base.SubGeometryBase);g.CompactSubGeometry=e})(b.base||(b.base={}))})(away||(away={}));
(function(b){(function(b){var e=function(b){function a(c){b.call(this);this._jointWeightsBuffer=Array(8);this._jointIndexBuffer=Array(8);this._jointWeightsInvalid=Array(8);this._jointIndicesInvalid=Array(8);this._jointWeightContext=Array(8);this._jointIndexContext=Array(8);this._jointsPerVertex=c;this._bufferFormat="float"+this._jointsPerVertex}__extends(a,b);Object.defineProperty(a.prototype,"condensedIndexLookUp",{get:function(){return this._condensedIndexLookUp},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"numCondensedJoints",{get:function(){return this._numCondensedJoints},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"animatedData",{get:function(){return this._animatedData||this._vertexData.concat()},enumerable:!0,configurable:!0});a.prototype.updateAnimatedData=function(c){this._animatedData=c;this.pInvalidateBuffers(this._pVertexDataInvalid)};a.prototype.activateJointWeightsBuffer=function(c,a){var b=a._iStage3DIndex,d=a._iContext3D;this._jointWeightContext[b]==
d&&this._jointWeightsBuffer[b]||(this._jointWeightsBuffer[b]=d.createVertexBuffer(this._pNumVertices,this._jointsPerVertex),this._jointWeightContext[b]=d,this._jointWeightsInvalid[b]=!0);this._jointWeightsInvalid[b]&&(this._jointWeightsBuffer[b].uploadFromArray(this._jointWeightsData,0,this._jointWeightsData.length/this._jointsPerVertex),this._jointWeightsInvalid[b]=!1);d.setVertexBufferAt(c,this._jointWeightsBuffer[b],0,this._bufferFormat)};a.prototype.activateJointIndexBuffer=function(c,a){var b=
a._iStage3DIndex,d=a._iContext3D;this._jointIndexContext[b]==d&&this._jointIndexBuffer[b]||(this._jointIndexBuffer[b]=d.createVertexBuffer(this._pNumVertices,this._jointsPerVertex),this._jointIndexContext[b]=d,this._jointIndicesInvalid[b]=!0);this._jointIndicesInvalid[b]&&(this._jointIndexBuffer[b].uploadFromArray(0<this._numCondensedJoints?this._condensedJointIndexData:this._jointIndexData,0,this._jointIndexData.length/this._jointsPerVertex),this._jointIndicesInvalid[b]=!1);d.setVertexBufferAt(c,
this._jointIndexBuffer[b],0,this._bufferFormat)};a.prototype.pUploadData=function(c){this._animatedData?(this._pActiveBuffer.uploadFromArray(this._animatedData,0,this._pNumVertices),this._pVertexDataInvalid[c]=this._pActiveDataInvalid=!1):b.prototype.pUploadData.call(this,c)};a.prototype.clone=function(){var c=new a(this._jointsPerVertex);c.updateData(this._vertexData.concat());c.updateIndexData(this._indices.concat());c.iUpdateJointIndexData(this._jointIndexData.concat());c.iUpdateJointWeightsData(this._jointWeightsData.concat());
c._autoDeriveVertexNormals=this._autoDeriveVertexNormals;c._autoDeriveVertexTangents=this._autoDeriveVertexTangents;c._numCondensedJoints=this._numCondensedJoints;c._condensedIndexLookUp=this._condensedIndexLookUp;c._condensedJointIndexData=this._condensedJointIndexData;return c};a.prototype.dispose=function(){b.prototype.dispose.call(this);this.pDisposeVertexBuffers(this._jointWeightsBuffer);this.pDisposeVertexBuffers(this._jointIndexBuffer)};a.prototype.iCondenseIndexData=function(){var c=this._jointIndexData.length,
a,b=0,d={};this._condensedJointIndexData=Array(c);this._condensedIndexLookUp=[];for(var f=0;f<c;++f)a=this._jointIndexData[f],void 0==d[a]&&(d[a]=b,this._condensedIndexLookUp[b++]=a,this._condensedIndexLookUp[b++]=a+1,this._condensedIndexLookUp[b++]=a+2),this._condensedJointIndexData[f]=d[a];this._numCondensedJoints=b/3;this.pInvalidateBuffers(this._jointIndicesInvalid)};Object.defineProperty(a.prototype,"iJointWeightsData",{get:function(){return this._jointWeightsData},enumerable:!0,configurable:!0});
a.prototype.iUpdateJointWeightsData=function(c){this._numCondensedJoints=0;this._condensedJointIndexData=this._condensedIndexLookUp=null;this._jointWeightsData=c;this.pInvalidateBuffers(this._jointWeightsInvalid)};Object.defineProperty(a.prototype,"iJointIndexData",{get:function(){return this._jointIndexData},enumerable:!0,configurable:!0});a.prototype.iUpdateJointIndexData=function(c){this._jointIndexData=c;this.pInvalidateBuffers(this._jointIndicesInvalid)};return a}(b.CompactSubGeometry);b.SkinnedSubGeometry=
e})(b.base||(b.base={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._subGeometries=[]}__extends(a,d);Object.defineProperty(a.prototype,"assetType",{get:function(){return b.library.AssetType.GEOMETRY},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"subGeometries",{get:function(){return this._subGeometries},enumerable:!0,configurable:!0});a.prototype.getSubGeometries=function(){return this._subGeometries};a.prototype.applyTransformation=function(c){for(var a=this._subGeometries.length,
b=0;b<a;++b)this._subGeometries[b].applyTransformation(c)};a.prototype.addSubGeometry=function(c){this._subGeometries.push(c);c.parentGeometry=this;this.dispatchEvent(new b.events.GeometryEvent(b.events.GeometryEvent.SUB_GEOMETRY_ADDED,c));this.iInvalidateBounds(c)};a.prototype.removeSubGeometry=function(c){this._subGeometries.splice(this._subGeometries.indexOf(c),1);c.parentGeometry=null;this.dispatchEvent(new b.events.GeometryEvent(b.events.GeometryEvent.SUB_GEOMETRY_REMOVED,c));this.iInvalidateBounds(c)};
a.prototype.clone=function(){for(var c=new a,b=this._subGeometries.length,d=0;d<b;++d)c.addSubGeometry(this._subGeometries[d].clone());return c};a.prototype.scale=function(c){for(var a=this._subGeometries.length,b=0;b<a;++b)this._subGeometries[b].scale(c)};a.prototype.dispose=function(){for(var c=this._subGeometries.length,a=0;a<c;++a){var b=this._subGeometries[0];this.removeSubGeometry(b);b.dispose()}};a.prototype.scaleUV=function(c,a){"undefined"===typeof c&&(c=1);"undefined"===typeof a&&(a=1);
for(var b=this._subGeometries.length,d=0;d<b;++d)this._subGeometries[d].scaleUV(c,a)};a.prototype.convertToSeparateBuffers=function(){for(var c,a=this._subGeometries.length,d=[],h=0;h<a;++h)c=this._subGeometries[h],c instanceof b.base.SubGeometry||(d.push(c),this.addSubGeometry(c.cloneWithSeperateBuffers()));c=d.length;for(h=0;h<c;h++)a=d[h],this.removeSubGeometry(a),a.dispose()};a.prototype.iValidate=function(){};a.prototype.iInvalidateBounds=function(c){this.dispatchEvent(new b.events.GeometryEvent(b.events.GeometryEvent.BOUNDS_INVALID,
c))};return a}(b.library.NamedAssetBase);g.Geometry=e})(b.base||(b.base={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._verticesInvalid=Array(8);this._uvsInvalid=Array(8);this._secondaryUvsInvalid=Array(8);this._normalsInvalid=Array(8);this._tangentsInvalid=Array(8);this._vertexBuffer=Array(8);this._uvBuffer=Array(8);this._secondaryUvBuffer=Array(8);this._vertexNormalBuffer=Array(8);this._vertexTangentBuffer=Array(8);this._vertexBufferContext=Array(8);this._uvBufferContext=Array(8);this._secondaryUvBufferContext=Array(8);this._vertexNormalBufferContext=
Array(8);this._vertexTangentBufferContext=Array(8)}__extends(a,d);Object.defineProperty(a.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0});a.prototype.activateVertexBuffer=function(c,a){var d=a._iStage3DIndex,h=a._iContext3D;this._vertexBuffer[d]&&this._vertexBufferContext[d]==h||(this._vertexBuffer[d]=h.createVertexBuffer(this._numVertices,3),this._vertexBufferContext[d]=h,this._verticesInvalid[d]=!0);this._verticesInvalid[d]&&(this._vertexBuffer[d].uploadFromArray(this._vertexData,
0,this._numVertices),this._verticesInvalid[d]=!1);h.setVertexBufferAt(c,this._vertexBuffer[d],0,b.display3D.Context3DVertexBufferFormat.FLOAT_3)};a.prototype.activateUVBuffer=function(c,a){var d=a._iStage3DIndex,h=a._iContext3D;this._autoGenerateUVs&&this._uvsDirty&&(this._uvs=this.pUpdateDummyUVs(this._uvs));this._uvBuffer[d]&&this._uvBufferContext[d]==h||(this._uvBuffer[d]=h.createVertexBuffer(this._numVertices,2),this._uvBufferContext[d]=h,this._uvsInvalid[d]=!0);this._uvsInvalid[d]&&(this._uvBuffer[d].uploadFromArray(this._uvs,
0,this._numVertices),this._uvsInvalid[d]=!1);h.setVertexBufferAt(c,this._uvBuffer[d],0,b.display3D.Context3DVertexBufferFormat.FLOAT_2)};a.prototype.activateSecondaryUVBuffer=function(c,a){var d=a._iStage3DIndex,h=a._iContext3D;this._secondaryUvBuffer[d]&&this._secondaryUvBufferContext[d]==h||(this._secondaryUvBuffer[d]=h.createVertexBuffer(this._numVertices,2),this._secondaryUvBufferContext[d]=h,this._secondaryUvsInvalid[d]=!0);this._secondaryUvsInvalid[d]&&(this._secondaryUvBuffer[d].uploadFromArray(this._secondaryUvs,
0,this._numVertices),this._secondaryUvsInvalid[d]=!1);h.setVertexBufferAt(c,this._secondaryUvBuffer[d],0,b.display3D.Context3DVertexBufferFormat.FLOAT_2)};a.prototype.activateVertexNormalBuffer=function(c,a){var d=a._iStage3DIndex,h=a._iContext3D;this._autoDeriveVertexNormals&&this._vertexNormalsDirty&&(this._vertexNormals=this.pUpdateVertexNormals(this._vertexNormals));this._vertexNormalBuffer[d]&&this._vertexNormalBufferContext[d]==h||(this._vertexNormalBuffer[d]=h.createVertexBuffer(this._numVertices,
3),this._vertexNormalBufferContext[d]=h,this._normalsInvalid[d]=!0);this._normalsInvalid[d]&&(this._vertexNormalBuffer[d].uploadFromArray(this._vertexNormals,0,this._numVertices),this._normalsInvalid[d]=!1);h.setVertexBufferAt(c,this._vertexNormalBuffer[d],0,b.display3D.Context3DVertexBufferFormat.FLOAT_3)};a.prototype.activateVertexTangentBuffer=function(c,a){var d=a._iStage3DIndex,h=a._iContext3D;this._vertexTangentsDirty&&(this._vertexTangents=this.pUpdateVertexTangents(this._vertexTangents));
this._vertexTangentBuffer[d]&&this._vertexTangentBufferContext[d]==h||(this._vertexTangentBuffer[d]=h.createVertexBuffer(this._numVertices,3),this._vertexTangentBufferContext[d]=h,this._tangentsInvalid[d]=!0);this._tangentsInvalid[d]&&(this._vertexTangentBuffer[d].uploadFromArray(this._vertexTangents,0,this._numVertices),this._tangentsInvalid[d]=!1);h.setVertexBufferAt(c,this._vertexTangentBuffer[d],0,b.display3D.Context3DVertexBufferFormat.FLOAT_3)};a.prototype.applyTransformation=function(c){d.prototype.applyTransformation.call(this,
c);this.pInvalidateBuffers(this._verticesInvalid);this.pInvalidateBuffers(this._normalsInvalid);this.pInvalidateBuffers(this._tangentsInvalid)};a.prototype.clone=function(){var c=new b.base.SubGeometry;c.updateVertexData(this._vertexData.concat());c.updateUVData(this._uvs.concat());c.updateIndexData(this._indices.concat());this._secondaryUvs&&c.updateSecondaryUVData(this._secondaryUvs.concat());this._autoDeriveVertexNormals||c.updateVertexNormalData(this._vertexNormals.concat());this._autoDeriveVertexTangents||
c.updateVertexTangentData(this._vertexTangents.concat());return c};a.prototype.scale=function(c){d.prototype.scale.call(this,c);this.pInvalidateBuffers(this._verticesInvalid)};a.prototype.scaleUV=function(c,a){"undefined"===typeof c&&(c=1);"undefined"===typeof a&&(a=1);d.prototype.scaleUV.call(this,c,a);this.pInvalidateBuffers(this._uvsInvalid)};a.prototype.dispose=function(){d.prototype.dispose.call(this);this.pDisposeAllVertexBuffers();this._vertexTangentBufferContext=this._vertexNormalBufferContext=
this._secondaryUvBufferContext=this._uvBufferContext=this._vertexBufferContext=this._vertexTangents=this._vertexNormals=this._secondaryUvs=this._uvs=this._indexBuffer=this._vertexTangentBuffer=this._secondaryUvBuffer=this._uvBuffer=this._vertexNormalBuffer=this._vertexBuffer=null};a.prototype.pDisposeAllVertexBuffers=function(){this.pDisposeVertexBuffers(this._vertexBuffer);this.pDisposeVertexBuffers(this._vertexNormalBuffer);this.pDisposeVertexBuffers(this._uvBuffer);this.pDisposeVertexBuffers(this._secondaryUvBuffer);
this.pDisposeVertexBuffers(this._vertexTangentBuffer)};Object.defineProperty(a.prototype,"vertexData",{get:function(){return this._vertexData},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexPositionData",{get:function(){return this._vertexData},enumerable:!0,configurable:!0});a.prototype.updateVertexData=function(c){this._autoDeriveVertexNormals&&(this._vertexNormalsDirty=!0);this._autoDeriveVertexTangents&&(this._vertexTangentsDirty=!0);this._faceNormalsDirty=!0;this._vertexData=
c;c=c.length/3;c!=this._numVertices&&this.pDisposeAllVertexBuffers();this._numVertices=c;this.pInvalidateBuffers(this._verticesInvalid);this.pInvalidateBounds()};Object.defineProperty(a.prototype,"UVData",{get:function(){this._uvsDirty&&this._autoGenerateUVs&&(this._uvs=this.pUpdateDummyUVs(this._uvs));return this._uvs},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"secondaryUVData",{get:function(){return this._secondaryUvs},enumerable:!0,configurable:!0});a.prototype.updateUVData=
function(c){this._autoDeriveVertexTangents&&(this._vertexTangentsDirty=!0);this._faceTangentsDirty=!0;this._uvs=c;this.pInvalidateBuffers(this._uvsInvalid)};a.prototype.updateSecondaryUVData=function(c){this._secondaryUvs=c;this.pInvalidateBuffers(this._secondaryUvsInvalid)};Object.defineProperty(a.prototype,"vertexNormalData",{get:function(){this._autoDeriveVertexNormals&&this._vertexNormalsDirty&&(this._vertexNormals=this.pUpdateVertexNormals(this._vertexNormals));return this._vertexNormals},enumerable:!0,
configurable:!0});a.prototype.updateVertexNormalData=function(c){this._vertexNormalsDirty=!1;this._autoDeriveVertexNormals=null==c;this._vertexNormals=c;this.pInvalidateBuffers(this._normalsInvalid)};Object.defineProperty(a.prototype,"vertexTangentData",{get:function(){this._autoDeriveVertexTangents&&this._vertexTangentsDirty&&(this._vertexTangents=this.pUpdateVertexTangents(this._vertexTangents));return this._vertexTangents},enumerable:!0,configurable:!0});a.prototype.updateVertexTangentData=function(c){this._vertexTangentsDirty=
!1;this._autoDeriveVertexTangents=null==c;this._vertexTangents=c;this.pInvalidateBuffers(this._tangentsInvalid)};a.prototype.fromVectors=function(c,a,b,d){this.updateVertexData(c);this.updateUVData(a);this.updateVertexNormalData(b);this.updateVertexTangentData(d)};a.prototype.pUpdateVertexNormals=function(c){this.pInvalidateBuffers(this._normalsInvalid);return d.prototype.pUpdateVertexNormals.call(this,c)};a.prototype.pUpdateVertexTangents=function(c){this._vertexNormalsDirty&&(this._vertexNormals=
this.pUpdateVertexNormals(this._vertexNormals));this.pInvalidateBuffers(this._tangentsInvalid);return d.prototype.pUpdateVertexTangents.call(this,c)};a.prototype.pUpdateDummyUVs=function(c){this.pInvalidateBuffers(this._uvsInvalid);return d.prototype.pUpdateDummyUVs.call(this,c)};a.prototype.pDisposeForStage3D=function(c){c=c._iStage3DIndex;this._vertexBuffer[c]&&(this._vertexBuffer[c].dispose(),this._vertexBuffer[c]=null);this._uvBuffer[c]&&(this._uvBuffer[c].dispose(),this._uvBuffer[c]=null);this._secondaryUvBuffer[c]&&
(this._secondaryUvBuffer[c].dispose(),this._secondaryUvBuffer[c]=null);this._vertexNormalBuffer[c]&&(this._vertexNormalBuffer[c].dispose(),this._vertexNormalBuffer[c]=null);this._vertexTangentBuffer[c]&&(this._vertexTangentBuffer[c].dispose(),this._vertexTangentBuffer[c]=null);this._indexBuffer[c]&&(this._indexBuffer[c].dispose(),this._indexBuffer[c]=null)};Object.defineProperty(a.prototype,"vertexStride",{get:function(){return 3},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"vertexTangentStride",{get:function(){return 3},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexNormalStride",{get:function(){return 3},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"UVStride",{get:function(){return 2},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"secondaryUVStride",{get:function(){return 2},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexOffset",{get:function(){return 0},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"vertexNormalOffset",{get:function(){return 0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexTangentOffset",{get:function(){return 0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"UVOffset",{get:function(){return 0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"secondaryUVOffset",{get:function(){return 0},enumerable:!0,configurable:!0});a.prototype.cloneWithSeperateBuffers=function(){return this.clone()};
return a}(b.base.SubGeometryBase);g.SubGeometry=e})(b.base||(b.base={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(a){"undefined"===typeof a&&(a=null);this._pAutoUpdate=!0;this.targetObject=a}d.prototype.pNotifyUpdate=function(){this._pTargetObject&&(this._pTargetObject.iGetImplicitPartition()&&this._pAutoUpdate)&&this._pTargetObject.iGetImplicitPartition().iMarkForUpdate(this._pTargetObject)};Object.defineProperty(d.prototype,"targetObject",{get:function(){return this._pTargetObject},set:function(a){this._pTargetObject!=a&&(this._pTargetObject&&this._pAutoUpdate&&
(this._pTargetObject._iController=null),(this._pTargetObject=a)&&this._pAutoUpdate&&(this._pTargetObject._iController=this),this.pNotifyUpdate())},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"autoUpdate",{get:function(){return this._pAutoUpdate},set:function(a){this._pAutoUpdate!=a&&(this._pAutoUpdate=a,this._pTargetObject&&(this._pTargetObject._iController=this._pTargetObject?this:null))},enumerable:!0,configurable:!0});d.prototype.update=function(a){throw new b.errors.AbstractMethodError;
};return d}();g.ControllerBase=e})(b.controllers||(b.controllers={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a){"undefined"===typeof c&&(c=null);"undefined"===typeof a&&(a=null);d.call(this,c);this._pOrigin=new b.geom.Vector3D(0,0,0);a?this.lookAtObject=a:this.lookAtPosition=new b.geom.Vector3D}__extends(a,d);Object.defineProperty(a.prototype,"lookAtPosition",{get:function(){return this._pLookAtPosition},set:function(c){this._pLookAtObject&&(this._pLookAtObject.removeEventListener(b.events.Object3DEvent.SCENETRANSFORM_CHANGED,this.onLookAtObjectChanged,
this),this._pLookAtObject=null);this._pLookAtPosition=c;this.pNotifyUpdate()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"lookAtObject",{get:function(){return this._pLookAtObject},set:function(c){this._pLookAtPosition&&(this._pLookAtPosition=null);this._pLookAtObject!=c&&(this._pLookAtObject&&this._pLookAtObject.removeEventListener(b.events.Object3DEvent.SCENETRANSFORM_CHANGED,this.onLookAtObjectChanged,this),(this._pLookAtObject=c)&&this._pLookAtObject.addEventListener(b.events.Object3DEvent.SCENETRANSFORM_CHANGED,
this.onLookAtObjectChanged,this),this.pNotifyUpdate())},enumerable:!0,configurable:!0});a.prototype.update=function(c){this._pTargetObject&&(this._pLookAtPosition?this._pTargetObject.lookAt(this._pLookAtPosition):this._pLookAtObject&&this._pTargetObject.lookAt(this._pLookAtObject.scene?this._pLookAtObject.scenePosition:this._pLookAtObject.position))};a.prototype.onLookAtObjectChanged=function(c){this.pNotifyUpdate()};return a}(b.controllers.ControllerBase);g.LookAtController=e})(b.controllers||(b.controllers=
{}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a,b,h,f,l,e,g,m,n,p,r){"undefined"===typeof c&&(c=null);"undefined"===typeof a&&(a=null);"undefined"===typeof b&&(b=0);"undefined"===typeof h&&(h=90);"undefined"===typeof f&&(f=1E3);"undefined"===typeof l&&(l=-90);"undefined"===typeof e&&(e=90);"undefined"===typeof g&&(g=NaN);"undefined"===typeof m&&(m=NaN);"undefined"===typeof n&&(n=8);"undefined"===typeof p&&(p=2);"undefined"===typeof r&&(r=!1);d.call(this,c,a);this._iCurrentPanAngle=0;this._iCurrentTiltAngle=
90;this._panAngle=0;this._tiltAngle=90;this._distance=1E3;this._minPanAngle=-Infinity;this._maxPanAngle=Infinity;this._minTiltAngle=-90;this._maxTiltAngle=90;this._steps=8;this._yFactor=2;this._wrapPanAngle=!1;this.distance=f;this.panAngle=b;this.tiltAngle=h;this.minPanAngle=g||-Infinity;this.maxPanAngle=m||Infinity;this.minTiltAngle=l;this.maxTiltAngle=e;this.steps=n;this.yFactor=p;this.wrapPanAngle=r;this._iCurrentPanAngle=this._panAngle;this._iCurrentTiltAngle=this._tiltAngle}__extends(a,d);Object.defineProperty(a.prototype,
"steps",{get:function(){return this._steps},set:function(c){c=1>c?1:c;this._steps!=c&&(this._steps=c,this.pNotifyUpdate())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"panAngle",{get:function(){return this._panAngle},set:function(c){c=Math.max(this._minPanAngle,Math.min(this._maxPanAngle,c));this._panAngle!=c&&(this._panAngle=c,this.pNotifyUpdate())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"tiltAngle",{get:function(){return this._tiltAngle},set:function(c){c=
Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,c));this._tiltAngle!=c&&(this._tiltAngle=c,this.pNotifyUpdate())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"distance",{get:function(){return this._distance},set:function(c){this._distance!=c&&(this._distance=c,this.pNotifyUpdate())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"minPanAngle",{get:function(){return this._minPanAngle},set:function(c){this._minPanAngle!=c&&(this._minPanAngle=c,this.panAngle=
Math.max(this._minPanAngle,Math.min(this._maxPanAngle,this._panAngle)))},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxPanAngle",{get:function(){return this._maxPanAngle},set:function(c){this._maxPanAngle!=c&&(this._maxPanAngle=c,this.panAngle=Math.max(this._minPanAngle,Math.min(this._maxPanAngle,this._panAngle)))},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"minTiltAngle",{get:function(){return this._minTiltAngle},set:function(c){this._minTiltAngle!=
c&&(this._minTiltAngle=c,this.tiltAngle=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle)))},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxTiltAngle",{get:function(){return this._maxTiltAngle},set:function(c){this._maxTiltAngle!=c&&(this._maxTiltAngle=c,this.tiltAngle=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle)))},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"yFactor",{get:function(){return this._yFactor},
set:function(c){this._yFactor!=c&&(this._yFactor=c,this.pNotifyUpdate())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"wrapPanAngle",{get:function(){return this._wrapPanAngle},set:function(c){this._wrapPanAngle!=c&&(this._wrapPanAngle=c,this.pNotifyUpdate())},enumerable:!0,configurable:!0});a.prototype.update=function(c){"undefined"===typeof c&&(c=!0);if(this._tiltAngle!=this._iCurrentTiltAngle||this._panAngle!=this._iCurrentPanAngle){this.pNotifyUpdate();if(this._wrapPanAngle){0>
this._panAngle?(this._iCurrentPanAngle+=this._panAngle%360+360-this._panAngle,this._panAngle=this._panAngle%360+360):(this._iCurrentPanAngle+=this._panAngle%360-this._panAngle,this._panAngle%=360);for(;-180>this._panAngle-this._iCurrentPanAngle;)this._iCurrentPanAngle-=360;for(;180<this._panAngle-this._iCurrentPanAngle;)this._iCurrentPanAngle+=360}c?(this._iCurrentTiltAngle+=(this._tiltAngle-this._iCurrentTiltAngle)/(this.steps+1),this._iCurrentPanAngle+=(this._panAngle-this._iCurrentPanAngle)/(this.steps+
1)):(this._iCurrentPanAngle=this._panAngle,this._iCurrentTiltAngle=this._tiltAngle);0.01>Math.abs(this.tiltAngle-this._iCurrentTiltAngle)&&0.01>Math.abs(this._panAngle-this._iCurrentPanAngle)&&(this._iCurrentTiltAngle=this._tiltAngle,this._iCurrentPanAngle=this._panAngle)}c=this.lookAtObject?this.lookAtObject.position:this.lookAtPosition?this.lookAtPosition:this._pOrigin;this.targetObject.x=c.x+this.distance*Math.sin(this._iCurrentPanAngle*b.math.MathConsts.DEGREES_TO_RADIANS)*Math.cos(this._iCurrentTiltAngle*
b.math.MathConsts.DEGREES_TO_RADIANS);this.targetObject.z=c.z+this.distance*Math.cos(this._iCurrentPanAngle*b.math.MathConsts.DEGREES_TO_RADIANS)*Math.cos(this._iCurrentTiltAngle*b.math.MathConsts.DEGREES_TO_RADIANS);this.targetObject.y=c.y+this.distance*Math.sin(this._iCurrentTiltAngle*b.math.MathConsts.DEGREES_TO_RADIANS)*this.yFactor;d.prototype.update.call(this)};return a}(b.controllers.LookAtController);g.HoverController=e})(b.controllers||(b.controllers={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a,b,h,f,l,e){"undefined"===typeof c&&(c=null);"undefined"===typeof a&&(a=0);"undefined"===typeof b&&(b=90);"undefined"===typeof h&&(h=-90);"undefined"===typeof f&&(f=90);"undefined"===typeof l&&(l=8);"undefined"===typeof e&&(e=!1);d.call(this,c);this._iCurrentPanAngle=0;this._iCurrentTiltAngle=90;this._panAngle=0;this._tiltAngle=90;this._minTiltAngle=-90;this._maxTiltAngle=90;this._steps=8;this._strafeIncrement=this._walkIncrement=0;this.fly=
this._wrapPanAngle=!1;this.panAngle=a;this.tiltAngle=b;this.minTiltAngle=h;this.maxTiltAngle=f;this.steps=l;this.wrapPanAngle=e;this._iCurrentPanAngle=this._panAngle;this._iCurrentTiltAngle=this._tiltAngle}__extends(a,d);Object.defineProperty(a.prototype,"steps",{get:function(){return this._steps},set:function(c){c=1>c?1:c;this._steps!=c&&(this._steps=c,this.pNotifyUpdate())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"panAngle",{get:function(){return this._panAngle},set:function(c){this._panAngle!=
c&&(this._panAngle=c,this.pNotifyUpdate())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"tiltAngle",{get:function(){return this._tiltAngle},set:function(c){c=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,c));this._tiltAngle!=c&&(this._tiltAngle=c,this.pNotifyUpdate())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"minTiltAngle",{get:function(){return this._minTiltAngle},set:function(c){this._minTiltAngle!=c&&(this._minTiltAngle=c,this.tiltAngle=
Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle)))},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxTiltAngle",{get:function(){return this._maxTiltAngle},set:function(c){this._maxTiltAngle!=c&&(this._maxTiltAngle=c,this.tiltAngle=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle)))},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"wrapPanAngle",{get:function(){return this._wrapPanAngle},set:function(c){this._wrapPanAngle!=
c&&(this._wrapPanAngle=c,this.pNotifyUpdate())},enumerable:!0,configurable:!0});a.prototype.update=function(c){"undefined"===typeof c&&(c=!0);if(this._tiltAngle!=this._iCurrentTiltAngle||this._panAngle!=this._iCurrentPanAngle){this.pNotifyUpdate();if(this._wrapPanAngle){0>this._panAngle?(this._iCurrentPanAngle+=this._panAngle%360+360-this._panAngle,this._panAngle=this._panAngle%360+360):(this._iCurrentPanAngle+=this._panAngle%360-this._panAngle,this._panAngle%=360);for(;-180>this._panAngle-this._iCurrentPanAngle;)this._iCurrentPanAngle-=
360;for(;180<this._panAngle-this._iCurrentPanAngle;)this._iCurrentPanAngle+=360}c?(this._iCurrentTiltAngle+=(this._tiltAngle-this._iCurrentTiltAngle)/(this.steps+1),this._iCurrentPanAngle+=(this._panAngle-this._iCurrentPanAngle)/(this.steps+1)):(this._iCurrentTiltAngle=this._tiltAngle,this._iCurrentPanAngle=this._panAngle);0.01>Math.abs(this.tiltAngle-this._iCurrentTiltAngle)&&0.01>Math.abs(this._panAngle-this._iCurrentPanAngle)&&(this._iCurrentTiltAngle=this._tiltAngle,this._iCurrentPanAngle=this._panAngle)}this.targetObject.rotationX=
this._iCurrentTiltAngle;this.targetObject.rotationY=this._iCurrentPanAngle;this._walkIncrement&&(this.fly?this.targetObject.moveForward(this._walkIncrement):(this.targetObject.x+=this._walkIncrement*Math.sin(this._panAngle*b.math.MathConsts.DEGREES_TO_RADIANS),this.targetObject.z+=this._walkIncrement*Math.cos(this._panAngle*b.math.MathConsts.DEGREES_TO_RADIANS)),this._walkIncrement=0);this._strafeIncrement&&(this.targetObject.moveRight(this._strafeIncrement),this._strafeIncrement=0)};a.prototype.incrementWalk=
function(c){0!=c&&(this._walkIncrement+=c,this.pNotifyUpdate())};a.prototype.incrementStrafe=function(c){0!=c&&(this._strafeIncrement+=c,this.pNotifyUpdate())};return a}(b.controllers.ControllerBase);g.FirstPersonController=e})(b.controllers||(b.controllers={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(c,a,q,h){"undefined"===typeof c&&(c=null);"undefined"===typeof a&&(a=null);"undefined"===typeof q&&(q=45);"undefined"===typeof h&&(h=700);b.call(this,c,a,0,q,h)}__extends(a,b);a.prototype.update=function(c){this.lookAtObject&&(this.panAngle=this._pLookAtObject.rotationY-180,b.prototype.update.call(this))};return a}(b.controllers.HoverController);g.FollowController=e})(b.controllers||(b.controllers={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a,q,h,f){"undefined"===typeof c&&(c=null);"undefined"===typeof a&&(a=null);"undefined"===typeof q&&(q=1);"undefined"===typeof h&&(h=40);"undefined"===typeof f&&(f=4);d.call(this,c,a);this.positionOffset=new b.geom.Vector3D(0,500,-1E3);this.stiffness=q;this.damping=f;this.mass=h;this._velocity=new b.geom.Vector3D;this._dv=new b.geom.Vector3D;this._stretch=new b.geom.Vector3D;this._force=new b.geom.Vector3D;this._acceleration=new b.geom.Vector3D;
this._desiredPosition=new b.geom.Vector3D}__extends(a,d);a.prototype.update=function(c){this._pLookAtObject&&this._pTargetObject&&(c=this._pLookAtObject.transform.deltaTransformVector(this.positionOffset),this._desiredPosition.x=this._pLookAtObject.x+c.x,this._desiredPosition.y=this._pLookAtObject.y+c.y,this._desiredPosition.z=this._pLookAtObject.z+c.z,this._stretch.x=this._pTargetObject.x-this._desiredPosition.x,this._stretch.y=this._pTargetObject.y-this._desiredPosition.y,this._stretch.z=this._pTargetObject.z-
this._desiredPosition.z,this._stretch.scaleBy(-this.stiffness),this._dv.copyFrom(this._velocity),this._dv.scaleBy(this.damping),this._force.x=this._stretch.x-this._dv.x,this._force.y=this._stretch.y-this._dv.y,this._force.z=this._stretch.z-this._dv.z,this._acceleration.copyFrom(this._force),this._acceleration.scaleBy(1/this.mass),this._velocity.x+=this._acceleration.x,this._velocity.y+=this._acceleration.y,this._velocity.z+=this._acceleration.z,this._pTargetObject.x+=this._velocity.x,this._pTargetObject.y+=
this._velocity.y,this._pTargetObject.z+=this._velocity.z,d.prototype.update.call(this))};return a}(g.LookAtController);g.SpringController=e})(b.controllers||(b.controllers={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._color=16777215;this._colorB=this._colorG=this._colorR=1;this._ambientColor=16777215;this._iAmbientB=this._iAmbientG=this._iAmbientR=this._ambient=0;this._iDiffuseB=this._iDiffuseG=this._iDiffuseR=this._diffuse=this._iSpecularB=this._iSpecularG=this._iSpecularR=this._specular=1;this._castsShadows=!1}__extends(a,d);Object.defineProperty(a.prototype,"castsShadows",{get:function(){return this._castsShadows},set:function(c){this._castsShadows!=
c&&((this._castsShadows=c)?(null==this._shadowMapper&&(this._shadowMapper=this.pCreateShadowMapper()),this._shadowMapper.light=this):(this._shadowMapper.dispose(),this._shadowMapper=null),this.dispatchEvent(new b.events.LightEvent(b.events.LightEvent.CASTS_SHADOW_CHANGE)))},enumerable:!0,configurable:!0});a.prototype.pCreateShadowMapper=function(){throw new b.errors.AbstractMethodError;};Object.defineProperty(a.prototype,"specular",{get:function(){return this._specular},set:function(c){0>c&&(c=0);
this._specular=c;this.updateSpecular()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"diffuse",{get:function(){return this._diffuse},set:function(c){0>c&&(c=0);this._diffuse=c;this.updateDiffuse()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"color",{get:function(){return this._color},set:function(c){this._color=c;this._colorR=(this._color>>16&255)/255;this._colorG=(this._color>>8&255)/255;this._colorB=(this._color&255)/255;this.updateDiffuse();this.updateSpecular()},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"ambient",{get:function(){return this._ambient},set:function(c){0>c?c=0:1<c&&(c=1);this._ambient=c;this.updateAmbient()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"ambientColor",{get:function(){return this._ambientColor},set:function(c){this._ambientColor=c;this.updateAmbient()},enumerable:!0,configurable:!0});a.prototype.updateAmbient=function(){this._iAmbientR=(this._ambientColor>>16&255)/255*this._ambient;
this._iAmbientG=(this._ambientColor>>8&255)/255*this._ambient;this._iAmbientB=(this._ambientColor&255)/255*this._ambient};a.prototype.iGetObjectProjectionMatrix=function(c,a){throw new b.errors.AbstractMethodError;};a.prototype.pCreateEntityPartitionNode=function(){return new b.partition.LightNode(this)};Object.defineProperty(a.prototype,"assetType",{get:function(){return b.library.AssetType.LIGHT},enumerable:!0,configurable:!0});a.prototype.updateSpecular=function(){this._iSpecularR=this._colorR*
this._specular;this._iSpecularG=this._colorG*this._specular;this._iSpecularB=this._colorB*this._specular};a.prototype.updateDiffuse=function(){this._iDiffuseR=this._colorR*this._diffuse;this._iDiffuseG=this._colorG*this._diffuse;this._iDiffuseB=this._colorB*this._diffuse};Object.defineProperty(a.prototype,"shadowMapper",{get:function(){return this._shadowMapper},set:function(c){this._shadowMapper=c;this._shadowMapper.light=this},enumerable:!0,configurable:!0});return a}(b.entities.Entity);g.LightBase=
e})(b.lights||(b.lights={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._pRadius=9E4;this._pFallOff=1E5;this._pFallOffFactor=1/(this._pFallOff*this._pFallOff-this._pRadius*this._pRadius)}__extends(a,d);a.prototype.pCreateShadowMapper=function(){return new b.lights.CubeMapShadowMapper};a.prototype.pCreateEntityPartitionNode=function(){return new b.partition.PointLightNode(this)};Object.defineProperty(a.prototype,"radius",{get:function(){return this._pRadius},set:function(c){this._pRadius=c;0>this._pRadius?
this._pRadius=0:this._pRadius>this._pFallOff&&(this._pFallOff=this._pRadius,this.pInvalidateBounds());this._pFallOffFactor=1/(this._pFallOff*this._pFallOff-this._pRadius*this._pRadius)},enumerable:!0,configurable:!0});a.prototype.iFallOffFactor=function(){return this._pFallOffFactor};Object.defineProperty(a.prototype,"fallOff",{get:function(){return this._pFallOff},set:function(c){this._pFallOff=c;0>this._pFallOff&&(this._pFallOff=0);this._pFallOff<this._pRadius&&(this._pRadius=this._pFallOff);this._pFallOffFactor=
1/(this._pFallOff*this._pFallOff-this._pRadius*this._pRadius);this.pInvalidateBounds()},enumerable:!0,configurable:!0});a.prototype.pUpdateBounds=function(){this._pBounds.fromSphere(new b.geom.Vector3D,this._pFallOff);this._pBoundsInvalid=!1};a.prototype.pGetDefaultBoundingVolume=function(){return new b.bounds.BoundingSphere};a.prototype.iGetObjectProjectionMatrix=function(c,a){"undefined"===typeof a&&(a=null);var d=[],h=c.sourceEntity.bounds,f=new b.geom.Matrix3D;f.copyFrom(c.sceneTransform);f.append(this._pParent.inverseSceneTransform);
this.lookAt(f.position);f.copyFrom(c.sceneTransform);f.append(this.inverseSceneTransform);f.copyColumnTo(3,this._pPos);var l=f.deltaTransformVector(h.min),e=f.deltaTransformVector(h.max),h=this._pPos.z,l=l.x*l.x+l.y*l.y+l.z*l.z,e=e.x*e.x+e.y*e.y+e.z*e.z,l=Math.sqrt(l>e?l:e),e=h-l,h=h+l;d[5]=d[0]=e/l;d[10]=h/(h-e);d[11]=1;d[1]=d[2]=d[3]=d[4]=d[6]=d[7]=d[8]=d[9]=d[12]=d[13]=d[15]=0;d[14]=-e*d[10];a||(a=new b.geom.Matrix3D);a.copyRawDataFrom(d);a.prepend(f);return a};return a}(b.lights.LightBase);g.PointLight=
e})(b.lights||(b.lights={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a,q){"undefined"===typeof c&&(c=0);"undefined"===typeof a&&(a=-1);"undefined"===typeof q&&(q=1);d.call(this);this.direction=new b.geom.Vector3D(c,a,q);this._sceneDirection=new b.geom.Vector3D}__extends(a,d);a.prototype.pCreateEntityPartitionNode=function(){return new b.partition.DirectionalLightNode(this)};Object.defineProperty(a.prototype,"sceneDirection",{get:function(){this._pSceneTransformDirty&&this.pUpdateSceneTransform();return this._sceneDirection},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"direction",{get:function(){return this._direction},set:function(c){this._direction=c;this._tmpLookAt||(this._tmpLookAt=new b.geom.Vector3D);this._tmpLookAt.x=this.x+this._direction.x;this._tmpLookAt.y=this.y+this._direction.y;this._tmpLookAt.z=this.z+this._direction.z;this.lookAt(this._tmpLookAt)},enumerable:!0,configurable:!0});a.prototype.pGetDefaultBoundingVolume=function(){return new b.bounds.NullBounds};a.prototype.pUpdateBounds=
function(){};a.prototype.pUpdateSceneTransform=function(){d.prototype.pUpdateSceneTransform.call(this);this.sceneTransform.copyColumnTo(2,this._sceneDirection);this._sceneDirection.normalize()};a.prototype.pCreateShadowMapper=function(){return new b.lights.DirectionalShadowMapper};a.prototype.iGetObjectProjectionMatrix=function(c,a){"undefined"===typeof a&&(a=null);var d=[],h=c.sourceEntity.bounds,f=new b.geom.Matrix3D;f.copyFrom(c.sceneTransform);f.append(this.inverseSceneTransform);this._projAABBPoints||
(this._projAABBPoints=[]);f.transformVectors(h.aabbPoints,this._projAABBPoints);for(var h=Infinity,l=-Infinity,e=Infinity,g=-Infinity,m=Infinity,n=-Infinity,p,r=0;24>r;)p=this._projAABBPoints[r++],p<h&&(h=p),p>l&&(l=p),p=this._projAABBPoints[r++],p<e&&(e=p),p>g&&(g=p),p=this._projAABBPoints[r++],p<m&&(m=p),p>n&&(n=p);p=1/(l-h);r=1/(g-e);n=1/(n-m);d[0]=2*p;d[5]=2*r;d[10]=n;d[12]=-(l+h)*p;d[13]=-(g+e)*r;d[14]=-m*n;d[1]=d[2]=d[3]=d[4]=d[6]=d[7]=d[8]=d[9]=d[11]=0;d[15]=1;a||(a=new b.geom.Matrix3D);a.copyRawDataFrom(d);
a.prepend(f);return a};return a}(b.lights.LightBase);g.DirectionalLight=e})(b.lights||(b.lights={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(c,a){"undefined"===typeof a&&(a=null);d.call(this);this._diffuseMap=c;this._specularMap=a}__extends(a,d);a.prototype.pCreateEntityPartitionNode=function(){return new b.partition.LightProbeNode(this)};Object.defineProperty(a.prototype,"diffuseMap",{get:function(){return this._diffuseMap},set:function(c){this._diffuseMap=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"specularMap",{get:function(){return this._specularMap},
set:function(c){this._specularMap=c},enumerable:!0,configurable:!0});a.prototype.pUpdateBounds=function(){this._pBoundsInvalid=!1};a.prototype.pGetDefaultBoundingVolume=function(){return new b.bounds.NullBounds};a.prototype.iGetObjectProjectionMatrix=function(c,a){throw new b.errors.Error("Object projection matrices are not supported for LightProbe objects!");};return a}(b.lights.LightBase);g.LightProbe=e})(b.lights||(b.lights={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(){this._pDepthMapSize=2048;this._autoUpdateShadows=!0;this._pCasterCollector=this.pCreateCasterCollector()}d.prototype.pCreateCasterCollector=function(){return new b.traverse.ShadowCasterCollector};Object.defineProperty(d.prototype,"autoUpdateShadows",{get:function(){return this._autoUpdateShadows},set:function(a){this._autoUpdateShadows=a},enumerable:!0,configurable:!0});d.prototype.updateShadows=function(){this._iShadowsInvalid=!0};d.prototype.iSetDepthMap=
function(a){this._depthMap!=a&&(this._depthMap&&!this._explicitDepthMap&&this._depthMap.dispose(),(this._depthMap=a)?(this._explicitDepthMap=!0,this._pDepthMapSize=this._depthMap.width):this._explicitDepthMap=!1)};Object.defineProperty(d.prototype,"light",{get:function(){return this._pLight},set:function(a){this._pLight=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"depthMap",{get:function(){this._depthMap||(this._depthMap=this.pCreateDepthTexture());return this._depthMap},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"depthMapSize",{get:function(){return this._pDepthMapSize},set:function(a){if(a!=this._pDepthMapSize){this._pDepthMapSize=a;if(this._explicitDepthMap)throw Error("Cannot set depth map size for the current renderer.");this._depthMap&&(this._depthMap.dispose(),this._depthMap=null)}},enumerable:!0,configurable:!0});d.prototype.dispose=function(){this._pCasterCollector=null;this._depthMap&&!this._explicitDepthMap&&this._depthMap.dispose();
this._depthMap=null};d.prototype.pCreateDepthTexture=function(){return new b.textures.RenderTexture(this._pDepthMapSize,this._pDepthMapSize)};d.prototype.iRenderDepthMap=function(a,c,b){this._iShadowsInvalid=!1;this.pUpdateDepthProjection(c.camera);this._depthMap||(this._depthMap=this.pCreateDepthTexture());this.pDrawDepthMap(this._depthMap.getTextureForStage3D(a),c.scene,b)};d.prototype.pUpdateDepthProjection=function(a){throw new b.errors.AbstractMethodError;};d.prototype.pDrawDepthMap=function(a,
c,d){throw new b.errors.AbstractMethodError;};return d}();g.ShadowMapperBase=e})(b.lights||(b.lights={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._pDepthMapSize=512;this._needsRender=[];this.initCameras()}__extends(a,d);a.prototype.initCameras=function(){this._depthCameras=[];this._lenses=[];this.addCamera(0,90,0);this.addCamera(0,-90,0);this.addCamera(-90,0,0);this.addCamera(90,0,0);this.addCamera(0,0,0);this.addCamera(0,180,0)};a.prototype.addCamera=function(c,a,d){var h=new b.cameras.Camera3D;h.rotationX=c;h.rotationY=a;h.rotationZ=d;h.lens.near=0.01;c=h.lens;c.fieldOfView=
90;this._lenses.push(c);h.lens.iAspectRatio=1;this._depthCameras.push(h)};a.prototype.pCreateDepthTexture=function(){throw new b.errors.PartialImplementationError;};a.prototype.pUpdateDepthProjection=function(c){c=this._pLight._pFallOff;for(var a=this._pLight.scenePosition,b=0;6>b;++b)this._lenses[b].far=c,this._depthCameras[b].position=a,this._needsRender[b]=!0};a.prototype.pDrawDepthMap=function(c,a,b){for(var d=0;6>d;++d)this._needsRender[d]&&(this._pCasterCollector.camera=this._depthCameras[d],
this._pCasterCollector.clear(),a.traversePartitions(this._pCasterCollector),b.iRender(this._pCasterCollector,c,null,d),this._pCasterCollector.cleanUp())};return a}(b.lights.ShadowMapperBase);g.CubeMapShadowMapper=e})(b.lights||(b.lights={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._pLightOffset=1E4;this._pSnap=64;this._pCullPlanes=[];this._pOverallDepthLens=new b.cameras.FreeMatrixLens;this._pOverallDepthCamera=new b.cameras.Camera3D(this._pOverallDepthLens);this._pLocalFrustum=[];this._pMatrix=new b.geom.Matrix3D}__extends(a,d);Object.defineProperty(a.prototype,"snap",{get:function(){return this._pSnap},set:function(c){this._pSnap=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"lightOffset",{get:function(){return this._pLightOffset},set:function(c){this._pLightOffset=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"iDepthProjection",{get:function(){return this._pOverallDepthCamera.viewProjection},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"depth",{get:function(){return this._pMaxZ-this._pMinZ},enumerable:!0,configurable:!0});a.prototype.pDrawDepthMap=function(c,a,b){this._pCasterCollector.camera=this._pOverallDepthCamera;this._pCasterCollector.cullPlanes=
this._pCullPlanes;this._pCasterCollector.clear();a.traversePartitions(this._pCasterCollector);b.iRender(this._pCasterCollector,c);this._pCasterCollector.cleanUp()};a.prototype.pUpdateCullPlanes=function(c){var a=this._pOverallDepthCamera.frustumPlanes;c=c.frustumPlanes;this._pCullPlanes.length=4;this._pCullPlanes[0]=a[0];this._pCullPlanes[1]=a[1];this._pCullPlanes[2]=a[2];this._pCullPlanes[3]=a[3];for(var b=this._pLight.sceneDirection,a=b.x,d=b.y,b=b.z,f=4,l=0;6>l;++l){var e=c[l];0>e.a*a+e.b*d+e.c*
b&&(this._pCullPlanes[f++]=e)}};a.prototype.pUpdateDepthProjection=function(c){this.pUpdateProjectionFromFrustumCorners(c,c.lens.frustumCorners,this._pMatrix);this._pOverallDepthLens.matrix=this._pMatrix;this.pUpdateCullPlanes(c)};a.prototype.pUpdateProjectionFromFrustumCorners=function(c,a,b){var d=[],f,l,e,g,m,n;f=this._pLight.sceneDirection;this._pOverallDepthCamera.transform=this._pLight.sceneTransform;l=Math.floor((c.x-f.x*this._pLightOffset)/this._pSnap)*this._pSnap;e=Math.floor((c.y-f.y*this._pLightOffset)/
this._pSnap)*this._pSnap;g=Math.floor((c.z-f.z*this._pLightOffset)/this._pSnap)*this._pSnap;this._pOverallDepthCamera.x=l;this._pOverallDepthCamera.y=e;this._pOverallDepthCamera.z=g;this._pMatrix.copyFrom(this._pOverallDepthCamera.inverseSceneTransform);this._pMatrix.prepend(c.sceneTransform);this._pMatrix.transformVectors(a,this._pLocalFrustum);c=f=this._pLocalFrustum[0];a=m=this._pLocalFrustum[1];this._pMaxZ=this._pLocalFrustum[2];for(n=3;24>n;)l=this._pLocalFrustum[n],e=this._pLocalFrustum[n+1],
g=this._pLocalFrustum[n+2],l<c&&(c=l),l>f&&(f=l),e<a&&(a=e),e>m&&(m=e),g>this._pMaxZ&&(this._pMaxZ=g),n+=3;this._pMinZ=1;l=f-c;e=m-a;g=1/(this._pMaxZ-this._pMinZ);0>c&&(c-=this._pSnap);0>a&&(a-=this._pSnap);c=Math.floor(c/this._pSnap)*this._pSnap;a=Math.floor(a/this._pSnap)*this._pSnap;f=2*this._pSnap;l=Math.floor(l/f+2)*f;e=Math.floor(e/f+2)*f;f=c+l;m=a+e;l=1/l;e=1/e;d[0]=2*l;d[5]=2*e;d[10]=g;d[12]=-(f+c)*l;d[13]=-(m+a)*e;d[14]=-this._pMinZ*g;d[15]=1;d[1]=d[2]=d[3]=d[4]=d[6]=d[7]=d[8]=d[9]=d[11]=
0;b.copyRawDataFrom(d)};return a}(b.lights.ShadowMapperBase);g.DirectionalShadowMapper=e})(b.lights||(b.lights={}))})(away||(away={}));(function(b){(function(b){var e=function(){return function(){}}();b.RenderableListItem=e})(b.data||(b.data={}))})(away||(away={}));(function(b){(function(b){var e=function(){return function(){}}();b.EntityListItem=e})(b.data||(b.data={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(){this._poolSize=this._index=0;this._pool=[]}d.prototype.getItem=function(){var a;this._index==this._poolSize?(a=new b.data.EntityListItem,this._pool[this._index++]=a,++this._poolSize):a=this._pool[this._index++];return a};d.prototype.freeAll=function(){this._index=0};d.prototype.dispose=function(){this._pool.length=0};return d}();g.EntityListItemPool=e})(b.data||(b.data={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(){this._poolSize=this._index=0;this._pool=[]}d.prototype.getItem=function(){if(this._index==this._poolSize){var a=new b.data.RenderableListItem;this._pool[this._index++]=a;++this._poolSize;return a}return this._pool[this._index++]};d.prototype.freeAll=function(){this._index=0};d.prototype.dispose=function(){this._pool.length=0};return d}();g.RenderableListItemPool=e})(b.data||(b.data={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(){}d.prototype.enterNode=function(a){return!0};d.prototype.applySkyBox=function(a){throw new b.errors.AbstractMethodError;};d.prototype.applyRenderable=function(a){throw new b.errors.AbstractMethodError;};d.prototype.applyUnknownLight=function(a){throw new b.errors.AbstractMethodError;};d.prototype.applyDirectionalLight=function(a){throw new b.errors.AbstractMethodError;};d.prototype.applyPointLight=function(a){throw new b.errors.AbstractMethodError;
};d.prototype.applyLightProbe=function(a){throw new b.errors.AbstractMethodError;};d.prototype.applyEntity=function(a){throw new b.errors.AbstractMethodError;};Object.defineProperty(d.prototype,"entryPoint",{get:function(){return this._iEntryPoint},enumerable:!0,configurable:!0});d._iCollectionMark=0;return d}();g.PartitionTraverser=e})(b.traverse||(b.traverse={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._numCullPlanes=this._numLightProbes=this._numPointLights=this._numDirectionalLights=this._pNumMouseEnableds=this._pNumTriangles=this._pNumLights=this._pNumEntities=0;this.init()}__extends(a,d);a.prototype.init=function(){this._pLights=[];this._directionalLights=[];this._pointLights=[];this._lightProbes=[];this._pRenderableListItemPool=new b.data.RenderableListItemPool;this._pEntityListItemPool=new b.data.EntityListItemPool};
Object.defineProperty(a.prototype,"camera",{get:function(){return this._pCamera},set:function(c){this._pCamera=c;this._iEntryPoint=this._pCamera.scenePosition;this._pCameraForward=this._pCamera.forwardVector;this._cullPlanes=this._pCamera.frustumPlanes},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"cullPlanes",{get:function(){return this._customCullPlanes},set:function(c){this._customCullPlanes=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"numMouseEnableds",
{get:function(){return this._pNumMouseEnableds},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"skyBox",{get:function(){return this._pSkyBox},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"opaqueRenderableHead",{get:function(){return this._pOpaqueRenderableHead},set:function(c){this._pOpaqueRenderableHead=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"blendedRenderableHead",{get:function(){return this._pBlendedRenderableHead},set:function(c){this._pBlendedRenderableHead=
c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"entityHead",{get:function(){return this._entityHead},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"lights",{get:function(){return this._pLights},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"directionalLights",{get:function(){return this._directionalLights},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"pointLights",{get:function(){return this._pointLights},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"lightProbes",{get:function(){return this._lightProbes},enumerable:!0,configurable:!0});a.prototype.clear=function(){this._numCullPlanes=(this._cullPlanes=this._customCullPlanes?this._customCullPlanes:this._pCamera?this._pCamera.frustumPlanes:null)?this._cullPlanes.length:0;this._pNumTriangles=this._pNumMouseEnableds=0;this._entityHead=this._pOpaqueRenderableHead=this._pBlendedRenderableHead=null;this._pRenderableListItemPool.freeAll();this._pEntityListItemPool.freeAll();
this._pSkyBox=null;0<this._pNumLights&&(this._pLights.length=this._pNumLights=0);0<this._numDirectionalLights&&(this._directionalLights.length=this._numDirectionalLights=0);0<this._numPointLights&&(this._pointLights.length=this._numPointLights=0);0<this._numLightProbes&&(this._lightProbes.length=this._numLightProbes=0)};a.prototype.enterNode=function(c){var a=b.traverse.PartitionTraverser._iCollectionMark!=c._iCollectionMark&&c.isInFrustum(this._cullPlanes,this._numCullPlanes);c._iCollectionMark=
b.traverse.PartitionTraverser._iCollectionMark;return a};a.prototype.applySkyBox=function(c){this._pSkyBox=c};a.prototype.applyRenderable=function(c){var a,b=c.sourceEntity;c.mouseEnabled&&++this._pNumMouseEnableds;this._pNumTriangles+=c.numTriangles;if(a=c.material){var d=this._pRenderableListItemPool.getItem();d.renderable=c;d.materialId=a._iUniqueId;d.renderOrderId=a._iRenderOrderId;d.cascaded=!1;d.zIndex=(this._iEntryPoint.x-b.x)*this._pCameraForward.x+(this._iEntryPoint.y-b.y)*this._pCameraForward.y+
(this._iEntryPoint.z-b.z)*this._pCameraForward.z+b.zOffset;d.renderSceneTransform=c.getRenderSceneTransform(this._pCamera);a.requiresBlending?(d.next=this._pBlendedRenderableHead,this._pBlendedRenderableHead=d):(d.next=this._pOpaqueRenderableHead,this._pOpaqueRenderableHead=d)}};a.prototype.applyEntity=function(c){++this._pNumEntities;var a=this._pEntityListItemPool.getItem();a.entity=c;a.next=this._entityHead;this._entityHead=a};a.prototype.applyUnknownLight=function(c){this._pLights[this._pNumLights++]=
c};a.prototype.applyDirectionalLight=function(c){this._pLights[this._pNumLights++]=c;this._directionalLights[this._numDirectionalLights++]=c};a.prototype.applyPointLight=function(c){this._pLights[this._pNumLights++]=c;this._pointLights[this._numPointLights++]=c};a.prototype.applyLightProbe=function(c){this._pLights[this._pNumLights++]=c;this._lightProbes[this._numLightProbes++]=c};a.prototype.cleanUp=function(){};return a}(b.traverse.PartitionTraverser);g.EntityCollector=e})(b.traverse||(b.traverse=
{}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(){b.call(this)}__extends(a,b);a.prototype.applyRenderable=function(c){var a=c.material,b=c.sourceEntity;if(c.castsShadows&&a){var d=this._pRenderableListItemPool.getItem();d.renderable=c;d.next=this._pOpaqueRenderableHead;d.cascaded=!1;d.zIndex=(this._iEntryPoint.x-b.x)*this._pCameraForward.x+(this._iEntryPoint.y-b.y)*this._pCameraForward.y+(this._iEntryPoint.z-b.z)*this._pCameraForward.z;d.renderSceneTransform=c.getRenderSceneTransform(this._pCamera);d.renderOrderId=
a._iDepthPassId;this._pOpaqueRenderableHead=d}};a.prototype.applyUnknownLight=function(c){};a.prototype.applyDirectionalLight=function(c){};a.prototype.applyPointLight=function(c){};a.prototype.applyLightProbe=function(c){};a.prototype.applySkyBox=function(c){};return a}(b.traverse.EntityCollector);g.ShadowCasterCollector=e})(b.traverse||(b.traverse={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._rayPosition=new b.geom.Vector3D;this._rayDirection=new b.geom.Vector3D}__extends(a,d);Object.defineProperty(a.prototype,"rayPosition",{get:function(){return this._rayPosition},set:function(c){this._rayPosition=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"rayDirection",{get:function(){return this._rayDirection},set:function(c){this._rayDirection=c},enumerable:!0,configurable:!0});a.prototype.enterNode=
function(c){return c.isIntersectingRay(this._rayPosition,this._rayDirection)};a.prototype.applySkyBox=function(c){};a.prototype.applyRenderable=function(c){};a.prototype.applyUnknownLight=function(c){};return a}(b.traverse.EntityCollector);g.RaycastCollector=e})(b.traverse||(b.traverse={}))})(away||(away={}));
(function(b){(function(b){var e=function(b){function a(c){b.call(this,c);this._renderable=c}__extends(a,b);a.prototype.acceptTraverser=function(c){c.enterNode(this)&&(b.prototype.acceptTraverser.call(this,c),c.applyRenderable(this._renderable))};return a}(b.EntityNode);b.RenderableNode=e})(b.partition||(b.partition={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(){this._onlyMouseEnabled=!0;this._interactives=[];this._localHitPosition=new b.geom.Vector3D;this._hitUV=new b.geom.Point;this._localHitNormal=new b.geom.Vector3D;this._rayPos=new b.geom.Vector3D;this._rayDir=new b.geom.Vector3D;this._id=Array(4);this._viewportData=Array(4);this._boundOffsetScale=Array(8);this._boundOffsetScale[3]=0;this._boundOffsetScale[7]=1}Object.defineProperty(d.prototype,"onlyMouseEnabled",{get:function(){return this._onlyMouseEnabled},
set:function(a){this._onlyMouseEnabled=a},enumerable:!0,configurable:!0});d.prototype.getViewCollision=function(a,c,d){b.Debug.throwPIR("ShaderPicker","getViewCollision","implement");return null};d.prototype.getSceneCollision=function(a,c,b){return null};d.prototype.pDraw=function(a,c){var k=a.camera;this._context.clear(0,0,0,1);this._stage3DProxy.scissorRect=d.MOUSE_SCISSOR_RECT;this._interactives.length=this._interactiveId=0;this._objectProgram3D||this.initObjectProgram3D();this._context.setBlendFactors(b.display3D.Context3DBlendFactor.ONE,
b.display3D.Context3DBlendFactor.ZERO);this._context.setDepthTest(!0,b.display3D.Context3DCompareMode.LESS);this._context.setProgram(this._objectProgram3D);this._context.setProgramConstantsFromArray(b.display3D.Context3DProgramType.VERTEX,4,this._viewportData,1);this.drawRenderables(a.opaqueRenderableHead,k);this.drawRenderables(a.blendedRenderableHead,k)};d.prototype.drawRenderables=function(a,c){b.Debug.throwPIR("ShaderPicker","drawRenderables","implement");for(var d=b.math.Matrix3DUtils.CALCULATION_MATRIX,
q,h=c.viewProjection;a;)q=a.renderable,!q.sourceEntity.scene||!q.mouseEnabled&&this._onlyMouseEnabled||(this._potentialFound=!0,this._context.setCulling(q.material.bothSides?b.display3D.Context3DTriangleFace.NONE:b.display3D.Context3DTriangleFace.BACK),this._interactives[this._interactiveId++]=q,this._id[1]=(this._interactiveId>>8)/255,this._id[2]=(this._interactiveId&255)/255,d.copyFrom(q.getRenderSceneTransform(c)),d.append(h),this._context.setProgramConstantsFromMatrix(b.display3D.Context3DProgramType.VERTEX,
0,d,!0),this._context.setProgramConstantsFromArray(b.display3D.Context3DProgramType.FRAGMENT,0,this._id,1),q.activateVertexBuffer(0,this._stage3DProxy),this._context.drawTriangles(q.getIndexBuffer(this._stage3DProxy),0,q.numTriangles)),a=a.next};d.prototype.updateRay=function(a){this._rayPos=a.scenePosition;this._rayDir=a.getRay(this._projX,this._projY,1);this._rayDir.normalize()};d.prototype.initObjectProgram3D=function(){this._objectProgram3D=this._context.createProgram();b.Debug.throwPIR("ShaderPicker",
"initTriangleProgram3D","Dependency: initObjectProgram3D")};d.prototype.initTriangleProgram3D=function(){this._triangleProgram3D=this._context.createProgram();var a=new aglsl.AGLSLCompiler,c=new aglsl.AGLSLCompiler,a=a.compile(b.display3D.Context3DProgramType.VERTEX,"add vt0, va0, vc5 \t\t\t\nmul vt0, vt0, vc6 \t\t\t\nmov v0, vt0\t\t\t\t\nm44 vt0, va0, vc0\t\t\t\nmul vt1.xy, vt0.w, vc4.zw\t\nadd vt0.xy, vt0.xy, vt1.xy\t\nmul vt0.xy, vt0.xy, vc4.xy\t\nmov op, vt0\t\n"),c=c.compile(b.display3D.Context3DProgramType.FRAGMENT,
"mov oc, v0");this._triangleProgram3D.upload(a,c)};d.prototype.getHitDetails=function(a){this.getApproximatePosition(a);this.getPreciseDetails(a)};d.prototype.getApproximatePosition=function(a){var c=this._hitRenderable.sourceEntity,k,q,h,f,e;k=b.math.Matrix3DUtils.CALCULATION_MATRIX;k.copyFrom(this._hitRenderable.getRenderSceneTransform(a));k.append(a.viewProjection);this._triangleProgram3D||this.initTriangleProgram3D();this._boundOffsetScale[4]=1/(a=c.maxX-c.minX);this._boundOffsetScale[5]=1/(q=
c.maxY-c.minY);this._boundOffsetScale[6]=1/(h=c.maxZ-c.minZ);this._boundOffsetScale[0]=f=-c.minX;this._boundOffsetScale[1]=e=-c.minY;this._boundOffsetScale[2]=c=-c.minZ;this._context.setProgram(this._triangleProgram3D);this._context.clear(0,0,0,0,1,0,b.display3D.Context3DClearMask.DEPTH);this._context.setScissorRectangle(d.MOUSE_SCISSOR_RECT);this._context.setProgramConstantsFromMatrix(b.display3D.Context3DProgramType.VERTEX,0,k,!0);this._context.setProgramConstantsFromArray(b.display3D.Context3DProgramType.VERTEX,
5,this._boundOffsetScale,2);this._hitRenderable.activateVertexBuffer(0,this._stage3DProxy);this._context.drawTriangles(this._hitRenderable.getIndexBuffer(this._stage3DProxy),0,this._hitRenderable.numTriangles);this._context.drawToBitmapData(this._bitmapData);k=this._bitmapData.getPixel(0,0);this._localHitPosition.x=(k>>16&255)*a/255-f;this._localHitPosition.y=(k>>8&255)*q/255-e;this._localHitPosition.z=(k&255)*h/255-c};d.prototype.getPreciseDetails=function(a){var c=this._hitRenderable,d=c.subGeometry,
q=d.indexData,h=d.vertexData,f=q.length,e,g,s,m,n,p,r,t=0,v=1,x=2,u,y,z,B,A,C,E,D,F,J,G,H,I,K,L=d.UVData,M=d.faceNormals,O=this._localHitPosition.x,N=this._localHitPosition.y,P=this._localHitPosition.z,Q=d.vertexStride,R=d.vertexOffset;for(this.updateRay(a);t<f;){d=R+q[t]*Q;u=R+q[v]*Q;y=R+q[x]*Q;e=h[d];a=h[d+1];d=h[d+2];g=h[u];s=h[u+1];m=h[u+2];n=h[y];p=h[y+1];r=h[y+2];if(!(O<e&&O<g&&O<n||N<a&&N<s&&N<p||P<d&&P<m&&P<r||O>e&&O>g&&O>n||N>a&&N>s&&N>p||P>d&&P>m&&P>r)&&(y=n-e,u=p-a,z=r-d,B=g-e,A=s-a,C=
m-d,E=O-e,D=N-a,F=P-d,J=y*y+u*u+z*z,G=y*B+u*A+z*C,H=y*E+u*D+z*F,I=B*B+A*A+C*C,D=B*E+A*D+C*F,K=1/(J*I-G*G),E=(I*H-G*D)*K,D=(J*D-G*H)*K,0<=E&&0<=D&&1>=E+D)){this.getPrecisePosition(this._hitRenderable.inverseSceneTransform,M[t],M[t+1],M[t+2],e,a,d);E=this._localHitPosition.x-e;D=this._localHitPosition.y-a;F=this._localHitPosition.z-d;h=g-e;f=s-a;M=m-d;e=n-e;a=p-a;d=r-d;this._localHitNormal.x=f*d-M*a;this._localHitNormal.y=M*e-h*d;this._localHitNormal.z=h*a-f*e;a=1/Math.sqrt(this._localHitNormal.x*this._localHitNormal.x+
this._localHitNormal.y*this._localHitNormal.y+this._localHitNormal.z*this._localHitNormal.z);this._localHitNormal.x*=a;this._localHitNormal.y*=a;this._localHitNormal.z*=a;H=y*E+u*D+z*F;D=B*E+A*D+C*F;E=(I*H-G*D)*K;D=(J*D-G*H)*K;a=q[t]<<1;v=q[v]<<1;x=q[x]<<1;q=L[a];a=L[a+1];this._hitUV.x=q+D*(L[v]-q)+E*(L[x]-q);this._hitUV.y=a+D*(L[v+1]-a)+E*(L[x+1]-a);this._faceIndex=t;this._subGeometryIndex=b.utils.GeometryUtils.getMeshSubMeshIndex(c);break}t+=3;v+=3;x+=3}};d.prototype.getPrecisePosition=function(a,
c,d,q,h,f,e){var g,s,m,n,p,r=b.math.Matrix3DUtils.RAW_DATA_CONTAINER,t=this._rayPos.x,v=this._rayPos.y,x=this._rayPos.z;m=this._rayDir.x;n=this._rayDir.y;p=this._rayDir.z;a.copyRawDataTo(r);a=r[0]*m+r[4]*n+r[8]*p;g=r[1]*m+r[5]*n+r[9]*p;s=r[2]*m+r[6]*n+r[10]*p;m=r[0]*t+r[4]*v+r[8]*x+r[12];n=r[1]*t+r[5]*v+r[9]*x+r[13];p=r[2]*t+r[6]*v+r[10]*x+r[14];c=((h-m)*c+(f-n)*d+(e-p)*q)/(a*c+g*d+s*q);this._localHitPosition.x=m+a*c;this._localHitPosition.y=n+g*c;this._localHitPosition.z=p+s*c};d.prototype.dispose=
function(){this._bitmapData.dispose();this._triangleProgram3D&&this._triangleProgram3D.dispose();this._objectProgram3D&&this._objectProgram3D.dispose();this._hitEntity=this._hitRenderable=this._bitmapData=this._objectProgram3D=this._triangleProgram3D=null};d.MOUSE_SCISSOR_RECT=new b.geom.Rectangle(0,0,1,1);return d}();g.ShaderPicker=e})(b.pick||(b.pick={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(a){this._raycastCollector=new b.traverse.RaycastCollector;this._ignoredEntities=[];this._onlyMouseEnabled=!0;this._numEntities=0;this._findClosestCollision=a;this._entities=[]}Object.defineProperty(d.prototype,"onlyMouseEnabled",{get:function(){return this._onlyMouseEnabled},set:function(a){this._onlyMouseEnabled=a},enumerable:!0,configurable:!0});d.prototype.getViewCollision=function(a,c,b){var d=b.iEntityCollector;if(0==d.numMouseEnableds)return null;
var h=b.unproject(a,c,0);a=b.unproject(a,c,1);a=a.subtract(h);this._numEntities=0;for(d=d.entityHead;d;)c=d.entity,this.isIgnored(c)||c._iIsVisible&&c.isIntersectingRay(h,a)&&(this._entities[this._numEntities++]=c),d=d.next;return this._numEntities?this.getPickingCollisionVO():null};d.prototype.getSceneCollision=function(a,c,b){this._raycastCollector.clear();this._raycastCollector.rayPosition=a;this._raycastCollector.rayDirection=c;b.traversePartitions(this._raycastCollector);this._numEntities=0;
for(a=this._raycastCollector.entityHead;a;)c=a.entity,this.isIgnored(c)||(this._entities[this._numEntities++]=c),a=a.next;return this._numEntities?this.getPickingCollisionVO():null};d.prototype.getEntityCollision=function(a,c,b){this._numEntities=0;for(var d,h=b.length,f=0;f<h;f++)d=b[f],d.isIntersectingRay(a,c)&&(this._entities[this._numEntities++]=d);return this.getPickingCollisionVO()};d.prototype.setIgnoreList=function(a){this._ignoredEntities=a};d.prototype.isIgnored=function(a){if(this._onlyMouseEnabled&&
(!a._iAncestorsAllowMouseEnabled||!a.mouseEnabled))return!0;for(var c,b=this._ignoredEntities.length,d=0;d<b;d++)if(c=this._ignoredEntities[d],c==a)return!0;return!1};d.prototype.sortOnNearT=function(a,c){return a.pickingCollisionVO.rayEntryDistance>c.pickingCollisionVO.rayEntryDistance?1:-1};d.prototype.getPickingCollisionVO=function(){this._entities.length=this._numEntities;this._entities=this._entities.sort(this.sortOnNearT);var a=Number.MAX_VALUE,c,b,d,h;for(h=0;h<this._numEntities;++h)if(d=this._entities[h],
b=d._iPickingCollisionVO,d.pickingCollider){if((null==c||b.rayEntryDistance<c.rayEntryDistance)&&d.iCollidesBefore(a,this._findClosestCollision)&&(a=b.rayEntryDistance,c=b,!this._findClosestCollision))return this.updateLocalPosition(b),b}else if((null==c||b.rayEntryDistance<c.rayEntryDistance)&&!b.rayOriginIsInsideBounds)return this.updateLocalPosition(b),b;return c};d.prototype.updateLocalPosition=function(a){var c=null==a.localPosition?new b.geom.Vector3D:a.localPosition,d=a.localRayDirection,q=
a.localRayPosition;a=a.rayEntryDistance;c.x=q.x+a*d.x;c.y=q.y+a*d.y;c.z=q.z+a*d.z};d.prototype.dispose=function(){};return d}();g.RaycastPicker=e})(b.pick||(b.pick={}))})(away||(away={}));(function(b){(function(g){var e=function(){function d(){}d.SHADER=new b.pick.ShaderPicker;d.RAYCAST_FIRST_ENCOUNTERED=new b.pick.RaycastPicker(!1);d.RAYCAST_BEST_HIT=new b.pick.RaycastPicker(!0);return d}();g.PickingType=e})(b.pick||(b.pick={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._uvDirty=this._geomDirty=!0;this._subGeometry=new b.base.CompactSubGeometry;this._subGeometry.autoGenerateDummyUVs=!1;this.addSubGeometry(this._subGeometry)}__extends(a,d);Object.defineProperty(a.prototype,"subGeometries",{get:function(){this._geomDirty&&this.updateGeometry();this._uvDirty&&this.updateUVs();return d.prototype.getSubGeometries.call(this)},enumerable:!0,configurable:!0});a.prototype.clone=function(){this._geomDirty&&
this.updateGeometry();this._uvDirty&&this.updateUVs();return d.prototype.clone.call(this)};a.prototype.scale=function(c){this._geomDirty&&this.updateGeometry();d.prototype.scale.call(this,c)};a.prototype.scaleUV=function(c,a){"undefined"===typeof c&&(c=1);"undefined"===typeof a&&(a=1);this._uvDirty&&this.updateUVs();d.prototype.scaleUV.call(this,c,a)};a.prototype.applyTransformation=function(c){this._geomDirty&&this.updateGeometry();d.prototype.applyTransformation.call(this,c)};a.prototype.pBuildGeometry=
function(c){throw new b.errors.AbstractMethodError;};a.prototype.pBuildUVs=function(c){throw new b.errors.AbstractMethodError;};a.prototype.pInvalidateGeometry=function(){this._geomDirty=!0};a.prototype.pInvalidateUVs=function(){this._uvDirty=!0};a.prototype.updateGeometry=function(){this.pBuildGeometry(this._subGeometry);this._geomDirty=!1};a.prototype.updateUVs=function(){this.pBuildUVs(this._subGeometry);this._uvDirty=!1};a.prototype.iValidate=function(){this._geomDirty&&this.updateGeometry();
this._uvDirty&&this.updateUVs()};return a}(b.base.Geometry);g.PrimitiveBase=e})(b.primitives||(b.primitives={}))})(away||(away={}));(function(b){(function(g){var e=function(b){function a(c,a,q,h,f){"undefined"===typeof q&&(q=3355443);"undefined"===typeof h&&(h=3355443);"undefined"===typeof f&&(f=1);b.call(this,c,a,null,q,h,f);this.TYPE="line"}__extends(a,b);return a}(b.primitives.Segment);g.LineSegment=e})(b.primitives||(b.primitives={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(c,a,q,h,f){"undefined"===typeof c&&(c=50);"undefined"===typeof a&&(a=50);"undefined"===typeof q&&(q=16);"undefined"===typeof h&&(h=8);"undefined"===typeof f&&(f=!0);b.call(this);this._numVertices=this._currentTriangleIndex=this._currentIndex=this._nextVertexIndex=0;this._radius=c;this._tubeRadius=a;this._segmentsR=q;this._segmentsT=h;this._yUp=f}__extends(a,b);a.prototype.addVertex=function(c,a,b,d,f,e,g,s,m){var n=this._vertexOffset+this._nextVertexIndex*
this._vertexStride;this._rawVertexData[n++]=c;this._rawVertexData[n++]=a;this._rawVertexData[n++]=b;this._rawVertexData[n++]=d;this._rawVertexData[n++]=f;this._rawVertexData[n++]=e;this._rawVertexData[n++]=g;this._rawVertexData[n++]=s;this._rawVertexData[n]=m;this._nextVertexIndex++};a.prototype.addTriangleClockWise=function(c,a,b){this._rawIndices[this._currentIndex++]=c;this._rawIndices[this._currentIndex++]=a;this._rawIndices[this._currentIndex++]=b;this._currentTriangleIndex++};a.prototype.pBuildGeometry=
function(c){var a,b,d,f,e,g,s,m;this._currentTriangleIndex=this._currentIndex=this._nextVertexIndex=this._numVertices=0;this._vertexStride=c.vertexStride;this._vertexOffset=c.vertexOffset;this._numVertices=(this._segmentsT+1)*(this._segmentsR+1);a=2*this._segmentsT*this._segmentsR;this._numVertices==c.numVertices?(this._rawVertexData=c.vertexData,this._rawIndices=null==c.indexData?Array(3*a):c.indexData):(this._rawVertexData=Array(this._numVertices*this._vertexStride),this._rawIndices=Array(3*a),
this.pInvalidateUVs());var n=2*Math.PI/this._segmentsR,p=2*Math.PI/this._segmentsT,r,t,v,x,u,y;for(b=0;b<=this._segmentsT;++b)for(u=this._vertexOffset+this._nextVertexIndex*this._vertexStride,a=0;a<=this._segmentsR;++a)f=a*n,d=b*p,y=Math.cos(d),g=y*Math.cos(f),s=y*Math.sin(f),m=Math.sin(d),d=this._radius*Math.cos(f)+this._tubeRadius*g,f=this._radius*Math.sin(f)+this._tubeRadius*s,e=b==this._segmentsT?0:this._tubeRadius*m,this._yUp?(v=-m,x=s,r=0,t=y?g/y:d/this._radius,m=-e,e=f):(v=s,x=m,r=y?g/y:d/
this._radius,t=0,m=f),a==this._segmentsR?this.addVertex(d,this._rawVertexData[u+1],this._rawVertexData[u+2],g,v,x,-(y?s/y:f/this._radius),r,t):this.addVertex(d,m,e,g,v,x,-(y?s/y:f/this._radius),r,t),0<a&&0<b&&(g=this._nextVertexIndex-1,s=this._nextVertexIndex-2,y=s-this._segmentsR-1,d=g-this._segmentsR-1,this.addTriangleClockWise(g,s,y),this.addTriangleClockWise(g,y,d));c.updateData(this._rawVertexData);c.updateIndexData(this._rawIndices)};a.prototype.pBuildUVs=function(c){var a,b,d;a=c.UVOffset;
var f=c.UVStride-2;d=this._numVertices*c.UVStride;c.UVData&&d==c.UVData.length?d=c.UVData:(d=Array(d),this.pInvalidateGeometry());var e=a;for(b=0;b<=this._segmentsT;++b)for(a=0;a<=this._segmentsR;++a)d[e++]=a/this._segmentsR*c.scaleU,d[e++]=b/this._segmentsT*c.scaleV,e+=f;c.updateData(d)};Object.defineProperty(a.prototype,"radius",{get:function(){return this._radius},set:function(c){this._radius=c;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"tubeRadius",
{get:function(){return this._tubeRadius},set:function(c){this._tubeRadius=c;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"segmentsR",{get:function(){return this._segmentsR},set:function(c){this._segmentsR=c;this.pInvalidateGeometry();this.pInvalidateUVs()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"segmentsT",{get:function(){return this._segmentsT},set:function(c){this._segmentsT=c;this.pInvalidateGeometry();this.pInvalidateUVs()},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"yUp",{get:function(){return this._yUp},set:function(c){this._yUp=c;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});return a}(b.primitives.PrimitiveBase);g.TorusGeometry=e})(b.primitives||(b.primitives={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(c,a,q,h,f,e,g){"undefined"===typeof c&&(c=100);"undefined"===typeof a&&(a=100);"undefined"===typeof q&&(q=100);"undefined"===typeof h&&(h=1);"undefined"===typeof f&&(f=1);"undefined"===typeof e&&(e=1);"undefined"===typeof g&&(g=!0);b.call(this);this._width=c;this._height=a;this._depth=q;this._segmentsW=h;this._segmentsH=f;this._segmentsD=e;this._tile6=g}__extends(a,b);Object.defineProperty(a.prototype,"width",{get:function(){return this._width},
set:function(c){this._width=c;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._height},set:function(c){this._height=c;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"depth",{get:function(){return this._depth},set:function(c){this._depth=c;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"tile6",{get:function(){return this._tile6},
set:function(c){this._tile6=c;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"segmentsW",{get:function(){return this._segmentsW},set:function(c){this._segmentsW=c;this.pInvalidateGeometry();this.pInvalidateUVs()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"segmentsH",{get:function(){return this._segmentsH},set:function(c){this._segmentsH=c;this.pInvalidateGeometry();this.pInvalidateUVs()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"segmentsD",{get:function(){return this._segmentsD},set:function(c){this._segmentsD=c;this.pInvalidateGeometry();this.pInvalidateUVs()},enumerable:!0,configurable:!0});a.prototype.pBuildGeometry=function(c){var a,b,d,f,e,g,s,m,n=0,p,r,t,v,x,u,y,z,B;a=2*((this._segmentsW+1)*(this._segmentsH+1)+(this._segmentsW+1)*(this._segmentsD+1)+(this._segmentsH+1)*(this._segmentsD+1));b=c.vertexStride;var A=b-9;a==c.numVertices?(a=c.vertexData,b=c.indexData?c.indexData:Array(12*(this._segmentsW*this._segmentsH+
this._segmentsW*this._segmentsD+this._segmentsH*this._segmentsD))):(a=Array(a*b),b=Array(12*(this._segmentsW*this._segmentsH+this._segmentsW*this._segmentsD+this._segmentsH*this._segmentsD)),this.pInvalidateUVs());p=c.vertexOffset;r=0;t=this._width/2;v=this._height/2;x=this._depth/2;u=this._width/this._segmentsW;y=this._height/this._segmentsH;z=this._depth/this._segmentsD;for(s=0;s<=this._segmentsW;s++)for(B=-t+s*u,m=0;m<=this._segmentsH;m++)a[p++]=B,a[p++]=-v+m*y,a[p++]=-x,a[p++]=0,a[p++]=0,a[p++]=
-1,a[p++]=1,a[p++]=0,a[p++]=0,p+=A,a[p++]=B,a[p++]=-v+m*y,a[p++]=x,a[p++]=0,a[p++]=0,a[p++]=1,a[p++]=-1,a[p++]=0,a[p++]=0,p+=A,s&&m&&(d=2*((s-1)*(this._segmentsH+1)+(m-1)),f=2*(s*(this._segmentsH+1)+(m-1)),e=d+2,g=f+2,b[r++]=d,b[r++]=e,b[r++]=g,b[r++]=d,b[r++]=g,b[r++]=f,b[r++]=f+1,b[r++]=g+1,b[r++]=e+1,b[r++]=f+1,b[r++]=e+1,b[r++]=d+1);n+=2*(this._segmentsW+1)*(this._segmentsH+1);for(s=0;s<=this._segmentsW;s++)for(B=-t+s*u,m=0;m<=this._segmentsD;m++)a[p++]=B,a[p++]=v,a[p++]=-x+m*z,a[p++]=0,a[p++]=
1,a[p++]=0,a[p++]=1,a[p++]=0,a[p++]=0,p+=A,a[p++]=B,a[p++]=-v,a[p++]=-x+m*z,a[p++]=0,a[p++]=-1,a[p++]=0,a[p++]=1,a[p++]=0,a[p++]=0,p+=A,s&&m&&(d=n+2*((s-1)*(this._segmentsD+1)+(m-1)),f=n+2*(s*(this._segmentsD+1)+(m-1)),e=d+2,g=f+2,b[r++]=d,b[r++]=e,b[r++]=g,b[r++]=d,b[r++]=g,b[r++]=f,b[r++]=f+1,b[r++]=g+1,b[r++]=e+1,b[r++]=f+1,b[r++]=e+1,b[r++]=d+1);n+=2*(this._segmentsW+1)*(this._segmentsD+1);for(s=0;s<=this._segmentsD;s++)for(B=x-s*z,m=0;m<=this._segmentsH;m++)a[p++]=-t,a[p++]=-v+m*y,a[p++]=B,a[p++]=
-1,a[p++]=0,a[p++]=0,a[p++]=0,a[p++]=0,a[p++]=-1,p+=A,a[p++]=t,a[p++]=-v+m*y,a[p++]=B,a[p++]=1,a[p++]=0,a[p++]=0,a[p++]=0,a[p++]=0,a[p++]=1,p+=A,s&&m&&(d=n+2*((s-1)*(this._segmentsH+1)+(m-1)),f=n+2*(s*(this._segmentsH+1)+(m-1)),e=d+2,g=f+2,b[r++]=d,b[r++]=e,b[r++]=g,b[r++]=d,b[r++]=g,b[r++]=f,b[r++]=f+1,b[r++]=g+1,b[r++]=e+1,b[r++]=f+1,b[r++]=e+1,b[r++]=d+1);c.updateData(a);c.updateIndexData(b)};a.prototype.pBuildUVs=function(c){var a,b,d,f,e,g,s,m,n,p,r,t,v,x,u=c.UVStride;a=2*((this._segmentsW+1)*
(this._segmentsH+1)+(this._segmentsW+1)*(this._segmentsD+1)+(this._segmentsH+1)*(this._segmentsD+1))*u;u-=2;c.UVData&&a==c.UVData.length?f=c.UVData:(f=Array(a),this.pInvalidateGeometry());this._tile6?(e=s=1/3,g=m=0.5):(e=g=1,s=m=0);d=c.UVOffset;n=1*s;p=1*m;r=2*s;t=0*m;v=e/this._segmentsW;x=g/this._segmentsH;for(a=0;a<=this._segmentsW;a++)for(b=0;b<=this._segmentsH;b++)f[d++]=(n+a*v)*c.scaleU,f[d++]=(p+(g-b*x))*c.scaleV,d+=u,f[d++]=(r+(e-a*v))*c.scaleU,f[d++]=(t+(g-b*x))*c.scaleV,d+=u;n=1*s;p=0*m;
r=0*s;t=0*m;v=e/this._segmentsW;x=g/this._segmentsD;for(a=0;a<=this._segmentsW;a++)for(b=0;b<=this._segmentsD;b++)f[d++]=(n+a*v)*c.scaleU,f[d++]=(p+(g-b*x))*c.scaleV,d+=u,f[d++]=(r+a*v)*c.scaleU,f[d++]=(t+b*x)*c.scaleV,d+=u;n=0*s;p=1*m;r=2*s;t=1*m;v=e/this._segmentsD;x=g/this._segmentsH;for(a=0;a<=this._segmentsD;a++)for(b=0;b<=this._segmentsH;b++)f[d++]=(n+a*v)*c.scaleU,f[d++]=(p+(g-b*x))*c.scaleV,d+=u,f[d++]=(r+(e-a*v))*c.scaleU,f[d++]=(t+(g-b*x))*c.scaleV,d+=u;c.updateData(f)};return a}(b.primitives.PrimitiveBase);
g.CubeGeometry=e})(b.primitives||(b.primitives={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(c,a,q,h,f,e){"undefined"===typeof c&&(c=100);"undefined"===typeof a&&(a=100);"undefined"===typeof q&&(q=1);"undefined"===typeof h&&(h=1);"undefined"===typeof f&&(f=!0);"undefined"===typeof e&&(e=!1);b.call(this);this._segmentsW=q;this._segmentsH=h;this._yUp=f;this._width=c;this._height=a;this._doubleSided=e}__extends(a,b);Object.defineProperty(a.prototype,"segmentsW",{get:function(){return this._segmentsW},set:function(c){this._segmentsW=c;this.pInvalidateGeometry();
this.pInvalidateUVs()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"segmentsH",{get:function(){return this._segmentsH},set:function(c){this._segmentsH=c;this.pInvalidateGeometry();this.pInvalidateUVs()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"yUp",{get:function(){return this._yUp},set:function(c){this._yUp=c;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"doubleSided",{get:function(){return this._doubleSided},
set:function(c){this._doubleSided=c;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return this._width},set:function(c){this._width=c;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._height},set:function(c){this._height=c;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});a.prototype.pBuildGeometry=function(c){var a,b,d,f,e,g=this._segmentsW+
1;a=(this._segmentsH+1)*g;var s=c.vertexStride,m=s-9;this._doubleSided&&(a*=2);e=6*this._segmentsH*this._segmentsW;this._doubleSided&&(e<<=1);a==c.numVertices?(a=c.vertexData,b=null==b?Array(e):c.indexData):(a=Array(a*s),b=Array(e),this.pInvalidateUVs());e=0;for(var n=c.vertexOffset,p=0;p<=this._segmentsH;++p)for(var r=0;r<=this._segmentsW;++r){d=(r/this._segmentsW-0.5)*this._width;f=(p/this._segmentsH-0.5)*this._height;a[n++]=d;this._yUp?(a[n++]=0,a[n++]=f):(a[n++]=f,a[n++]=0);a[n++]=0;this._yUp?
(a[n++]=1,a[n++]=0):(a[n++]=0,a[n++]=-1);a[n++]=1;a[n++]=0;a[n++]=0;n+=m;if(this._doubleSided){for(d=0;3>d;++d)a[n]=a[n-s],++n;for(d=0;3>d;++d)a[n]=-a[n-s],++n;for(d=0;3>d;++d)a[n]=-a[n-s],++n;n+=m}r!=this._segmentsW&&p!=this._segmentsH&&(d=r+p*g,f=this._doubleSided?2:1,b[e++]=d*f,b[e++]=(d+g)*f,b[e++]=(d+g+1)*f,b[e++]=d*f,b[e++]=(d+g+1)*f,b[e++]=(d+1)*f,this._doubleSided&&(b[e++]=(d+g+1)*f+1,b[e++]=(d+g)*f+1,b[e++]=d*f+1,b[e++]=(d+1)*f+1,b[e++]=(d+g+1)*f+1,b[e++]=d*f+1))}c.updateData(a);c.updateIndexData(b)};
a.prototype.pBuildUVs=function(c){var a,b=c.UVStride;a=(this._segmentsH+1)*(this._segmentsW+1)*b;b-=2;this._doubleSided&&(a*=2);c.UVData&&a==c.UVData.length?a=c.UVData:(a=Array(a),this.pInvalidateGeometry());for(var d=c.UVOffset,f=0;f<=this._segmentsH;++f)for(var e=0;e<=this._segmentsW;++e)a[d++]=e/this._segmentsW*c.scaleU,a[d++]=(1-f/this._segmentsH)*c.scaleV,d+=b,this._doubleSided&&(a[d++]=e/this._segmentsW*c.scaleU,a[d++]=(1-f/this._segmentsH)*c.scaleV,d+=b);c.updateData(a)};return a}(b.primitives.PrimitiveBase);
g.PlaneGeometry=e})(b.primitives||(b.primitives={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(c,a,q,h,f){"undefined"===typeof c&&(c=50);"undefined"===typeof a&&(a=100);"undefined"===typeof q&&(q=16);"undefined"===typeof h&&(h=15);"undefined"===typeof f&&(f=!0);b.call(this);this._radius=c;this._height=a;this._segmentsW=q;this._segmentsH=0==h%2?h+1:h;this._yUp=f}__extends(a,b);a.prototype.pBuildGeometry=function(c){var a,b,d,f,e=0;a=(this._segmentsH+1)*(this._segmentsW+1);b=c.vertexStride;var g=b-9,s=0,m,n,p,r,t;a==c.numVertices?(a=c.vertexData,
b=c.indexData?c.indexData:Array(6*(this._segmentsH-1)*this._segmentsW)):(a=Array(a*b),b=Array(6*(this._segmentsH-1)*this._segmentsW),this.pInvalidateUVs());for(f=0;f<=this._segmentsH;++f){d=Math.PI*f/this._segmentsH;var v=-this._radius*Math.cos(d),x=this._radius*Math.sin(d);m=s;for(d=0;d<=this._segmentsW;++d){n=2*Math.PI*d/this._segmentsW;var u=x*Math.cos(n),y=f>this._segmentsH/2?this._height/2:-this._height/2,z=x*Math.sin(n),B=1/Math.sqrt(u*u+z*z+v*v),A=Math.sqrt(z*z+u*u);this._yUp?(r=0,t=0.0070<
A?u/A:0,n=-v,p=z):(r=0.0070<A?u/A:0,t=0,n=z,p=v);d==this._segmentsW?(a[s++]=a[m],a[s++]=a[m+1],a[s++]=a[m+2],a[s++]=0.5*(a[m+3]+u*B),a[s++]=0.5*(a[m+4]+n*B),a[s++]=0.5*(a[m+5]+p*B),a[s++]=0.5*(a[m+6]+(0.0070<A?-z/A:1)),a[s++]=0.5*(a[m+7]+r),a[s++]=0.5*(a[m+8]+t)):(a[s++]=u,a[s++]=this._yUp?n-y:n,a[s++]=this._yUp?p:p+y,a[s++]=u*B,a[s++]=n*B,a[s++]=p*B,a[s++]=0.0070<A?-z/A:1,a[s++]=r,a[s++]=t);0<d&&0<f&&(u=(this._segmentsW+1)*f+d,y=(this._segmentsW+1)*f+d-1,n=(this._segmentsW+1)*(f-1)+d-1,p=(this._segmentsW+
1)*(f-1)+d,f==this._segmentsH?(a[s-9]=a[m],a[s-8]=a[m+1],a[s-7]=a[m+2],b[e++]=u,b[e++]=n,b[e++]=p):1==f?(b[e++]=u,b[e++]=y,b[e++]=n):(b[e++]=u,b[e++]=y,b[e++]=n,b[e++]=u,b[e++]=n,b[e++]=p));s+=g}}c.updateData(a);c.updateIndexData(b)};a.prototype.pBuildUVs=function(a){var b,d,h,f,e=a.UVStride;b=(this._segmentsH+1)*(this._segmentsW+1)*e;e-=2;a.UVData&&b==a.UVData.length?f=a.UVData:(f=Array(b),this.pInvalidateGeometry());h=a.UVOffset;for(d=0;d<=this._segmentsH;++d)for(b=0;b<=this._segmentsW;++b)f[h++]=
b/this._segmentsW*a.scaleU,f[h++]=d/this._segmentsH*a.scaleV,h+=e;a.updateData(f)};Object.defineProperty(a.prototype,"radius",{get:function(){return this._radius},set:function(a){this._radius=a;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"segmentsW",{get:function(){return this._segmentsW},
set:function(a){this._segmentsW=a;this.pInvalidateGeometry();this.pInvalidateUVs()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"segmentsH",{get:function(){return this._segmentsH},set:function(a){this._segmentsH=0==a%2?a+1:a;this.pInvalidateGeometry();this.pInvalidateUVs()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"yUp",{get:function(){return this._yUp},set:function(a){this._yUp=a;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});return a}(b.primitives.PrimitiveBase);
g.CapsuleGeometry=e})(b.primitives||(b.primitives={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(a,k,q,h,f,e,g,s,m){"undefined"===typeof a&&(a=50);"undefined"===typeof k&&(k=50);"undefined"===typeof q&&(q=100);"undefined"===typeof h&&(h=16);"undefined"===typeof f&&(f=1);"undefined"===typeof e&&(e=!0);"undefined"===typeof g&&(g=!0);"undefined"===typeof s&&(s=!0);"undefined"===typeof m&&(m=!0);b.call(this);this._numVertices=this._currentIndex=0;this._topRadius=a;this._pBottomRadius=k;this._height=q;this._pSegmentsW=h;this._pSegmentsH=f;this._topClosed=
e;this._bottomClosed=g;this._surfaceClosed=s;this._yUp=m}__extends(a,b);a.prototype.addVertex=function(a,b,d,h,f,e,g,s,m){var n=this._vertexOffset+this._nextVertexIndex*this._stride;this._rawData[n++]=a;this._rawData[n++]=b;this._rawData[n++]=d;this._rawData[n++]=h;this._rawData[n++]=f;this._rawData[n++]=e;this._rawData[n++]=g;this._rawData[n++]=s;this._rawData[n++]=m;this._nextVertexIndex++};a.prototype.addTriangleClockWise=function(a,b,d){this._rawIndices[this._currentIndex++]=a;this._rawIndices[this._currentIndex++]=
b;this._rawIndices[this._currentIndex++]=d;this._currentTriangleIndex++};a.prototype.pBuildGeometry=function(a){var b,d,h,f,e,g,s,m,n,p;m=n=0;var r,t;this._stride=a.vertexStride;this._vertexOffset=a.vertexOffset;this._currentTriangleIndex=this._currentIndex=this._nextVertexIndex=this._numVertices=0;this._surfaceClosed&&(this._numVertices+=(this._pSegmentsH+1)*(this._pSegmentsW+1),n+=2*this._pSegmentsH*this._pSegmentsW);this._topClosed&&(this._numVertices+=2*(this._pSegmentsW+1),n+=this._pSegmentsW);
this._bottomClosed&&(this._numVertices+=2*(this._pSegmentsW+1),n+=this._pSegmentsW);this._numVertices==a.numVertices?(this._rawData=a.vertexData,this._rawIndices=a.indexData?a.indexData:Array(3*n)):(this._rawData=Array(this._numVertices*this._stride),this._rawIndices=Array(3*n));var v=2*Math.PI/this._pSegmentsW;if(this._topClosed&&0<this._topRadius)for(e=-0.5*this._height,b=0;b<=this._pSegmentsW;++b)this._yUp?(r=1,t=0,s=-e,f=0):(r=0,t=-1,s=0,f=e),this.addVertex(0,s,f,0,r,t,1,0,0),s=b*v,h=this._topRadius*
Math.cos(s),f=this._topRadius*Math.sin(s),this._yUp?s=-e:(s=f,f=e),b==this._pSegmentsW?this.addVertex(this._rawData[m+this._stride],this._rawData[m+this._stride+1],this._rawData[m+this._stride+2],0,r,t,1,0,0):this.addVertex(h,s,f,0,r,t,1,0,0),0<b&&this.addTriangleClockWise(this._nextVertexIndex-1,this._nextVertexIndex-3,this._nextVertexIndex-2);if(this._bottomClosed&&0<this._pBottomRadius)for(e=0.5*this._height,m=this._vertexOffset+this._nextVertexIndex*this._stride,b=0;b<=this._pSegmentsW;++b)this._yUp?
(r=-1,t=0,s=-e,f=0):(r=0,t=1,s=0,f=e),this.addVertex(0,s,f,0,r,t,1,0,0),s=b*v,h=this._pBottomRadius*Math.cos(s),f=this._pBottomRadius*Math.sin(s),this._yUp?s=-e:(s=f,f=e),b==this._pSegmentsW?this.addVertex(h,this._rawData[m+1],this._rawData[m+2],0,r,t,1,0,0):this.addVertex(h,s,f,0,r,t,1,0,0),0<b&&this.addTriangleClockWise(this._nextVertexIndex-2,this._nextVertexIndex-3,this._nextVertexIndex-1);m=this._pBottomRadius-this._topRadius;n=m/this._height;p=0==n?1:this._height/m;if(this._surfaceClosed){var x,
u,y,z;for(d=0;d<=this._pSegmentsH;++d)for(g=this._topRadius-d/this._pSegmentsH*(this._topRadius-this._pBottomRadius),e=-(this._height/2)+d/this._pSegmentsH*this._height,m=this._vertexOffset+this._nextVertexIndex*this._stride,b=0;b<=this._pSegmentsW;++b)s=b*v,h=g*Math.cos(s),f=g*Math.sin(s),x=p*Math.cos(s),u=p*Math.sin(s),this._yUp?(r=0,t=-x,s=-e,y=n,z=u):(r=-x,t=0,s=f,f=e,y=u,z=n),b==this._pSegmentsW?this.addVertex(this._rawData[m],this._rawData[m+1],this._rawData[m+2],x,n,u,u,r,t):this.addVertex(h,
s,f,x,y,z,-u,r,t),0<b&&0<d&&(h=this._nextVertexIndex-1,r=this._nextVertexIndex-2,t=r-this._pSegmentsW-1,x=h-this._pSegmentsW-1,this.addTriangleClockWise(h,r,t),this.addTriangleClockWise(h,t,x))}a.updateData(this._rawData);a.updateIndexData(this._rawIndices)};a.prototype.pBuildUVs=function(a){var b,d,h;b=a.UVStride;var f=b-2,e;b*=this._numVertices;a.UVData&&b==a.UVData.length?e=a.UVData:(e=Array(b),this.pInvalidateGeometry());var g=2*Math.PI/this._pSegmentsW,s=a.UVOffset;if(this._topClosed)for(b=0;b<=
this._pSegmentsW;++b)h=b*g,d=0.5+0.5*-Math.cos(h),h=0.5+0.5*Math.sin(h),e[s++]=0.5*a.scaleU,e[s++]=0.5*a.scaleV,s+=f,e[s++]=d*a.scaleU,e[s++]=h*a.scaleV,s+=f;if(this._bottomClosed)for(b=0;b<=this._pSegmentsW;++b)h=b*g,d=0.5+0.5*Math.cos(h),h=0.5+0.5*Math.sin(h),e[s++]=0.5*a.scaleU,e[s++]=0.5*a.scaleV,s+=f,e[s++]=d*a.scaleU,e[s++]=h*a.scaleV,s+=f;if(this._surfaceClosed)for(d=0;d<=this._pSegmentsH;++d)for(b=0;b<=this._pSegmentsW;++b)e[s++]=b/this._pSegmentsW*a.scaleU,e[s++]=d/this._pSegmentsH*a.scaleV,
s+=f;a.updateData(e)};Object.defineProperty(a.prototype,"topRadius",{get:function(){return this._topRadius},set:function(a){this._topRadius=a;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"bottomRadius",{get:function(){return this._pBottomRadius},set:function(a){this._pBottomRadius=a;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._height},set:function(a){this._height=
a;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"segmentsW",{get:function(){return this._pSegmentsW},set:function(a){this.setSegmentsW(a)},enumerable:!0,configurable:!0});a.prototype.setSegmentsW=function(a){this._pSegmentsW=a;this.pInvalidateGeometry();this.pInvalidateUVs()};Object.defineProperty(a.prototype,"segmentsH",{get:function(){return this._pSegmentsH},set:function(a){this.setSegmentsH(a)},enumerable:!0,configurable:!0});a.prototype.setSegmentsH=
function(a){this._pSegmentsH=a;this.pInvalidateGeometry();this.pInvalidateUVs()};Object.defineProperty(a.prototype,"topClosed",{get:function(){return this._topClosed},set:function(a){this._topClosed=a;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"bottomClosed",{get:function(){return this._bottomClosed},set:function(a){this._bottomClosed=a;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"yUp",{get:function(){return this._yUp},
set:function(a){this._yUp=a;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});return a}(b.primitives.PrimitiveBase);g.CylinderGeometry=e})(b.primitives||(b.primitives={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(a,k,e,h,f,g){"undefined"===typeof a&&(a=50);"undefined"===typeof k&&(k=100);"undefined"===typeof e&&(e=16);"undefined"===typeof h&&(h=1);"undefined"===typeof f&&(f=!0);"undefined"===typeof g&&(g=!0);b.call(this,0,a,k,e,h,!1,f,!0,g)}__extends(a,b);Object.defineProperty(a.prototype,"radius",{get:function(){return this._pBottomRadius},set:function(a){this._pBottomRadius=a;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});return a}(b.primitives.CylinderGeometry);
g.ConeGeometry=e})(b.primitives||(b.primitives={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(a,k,e){"undefined"===typeof a&&(a=100);"undefined"===typeof k&&(k=16);"undefined"===typeof e&&(e=!0);b.call(this,a,0,0,k,1,!0,!1,!1,e)}__extends(a,b);Object.defineProperty(a.prototype,"radius",{get:function(){return this._pBottomRadius},set:function(a){this._pBottomRadius=a;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sides",{get:function(){return this._pSegmentsW},set:function(a){this.setSegmentsW(a)},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"subdivisions",{get:function(){return this._pSegmentsH},set:function(a){this.setSegmentsH(a)},enumerable:!0,configurable:!0});return a}(b.primitives.CylinderGeometry);g.RegularPolygonGeometry=e})(b.primitives||(b.primitives={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(a,k,e,h){"undefined"===typeof a&&(a=50);"undefined"===typeof k&&(k=16);"undefined"===typeof e&&(e=12);"undefined"===typeof h&&(h=!0);b.call(this);this._radius=a;this._segmentsW=k;this._segmentsH=e;this._yUp=h}__extends(a,b);a.prototype.pBuildGeometry=function(a){var b,d,h,f,e=0;b=(this._segmentsH+1)*(this._segmentsW+1);d=a.vertexStride;var g=d-9;b==a.numVertices?(b=a.vertexData,d=a.indexData?a.indexData:Array(6*(this._segmentsH-1)*this._segmentsW)):
(b=Array(b*d),d=Array(6*(this._segmentsH-1)*this._segmentsW),this.pInvalidateGeometry());var s,m=a.vertexOffset,n,p,r,t;for(f=0;f<=this._segmentsH;++f){s=m;h=Math.PI*f/this._segmentsH;var v=-this._radius*Math.cos(h),x=this._radius*Math.sin(h);for(h=0;h<=this._segmentsW;++h){n=2*Math.PI*h/this._segmentsW;var u=x*Math.cos(n),y=x*Math.sin(n),z=1/Math.sqrt(u*u+y*y+v*v),B=Math.sqrt(y*y+u*u);this._yUp?(r=0,t=0.0070<B?u/B:0,n=-v,p=y):(r=0.0070<B?u/B:0,t=0,n=y,p=v);h==this._segmentsW?(b[m++]=b[s],b[m++]=
b[s+1],b[m++]=b[s+2],b[m++]=b[s+3]+0.5*u*z,b[m++]=b[s+4]+0.5*n*z,b[m++]=b[s+5]+0.5*p*z):(b[m++]=u,b[m++]=n,b[m++]=p,b[m++]=u*z,b[m++]=n*z,b[m++]=p*z);b[m++]=0.0070<B?-y/B:1;b[m++]=r;b[m++]=t;0<h&&0<f&&(u=(this._segmentsW+1)*f+h,n=(this._segmentsW+1)*f+h-1,p=(this._segmentsW+1)*(f-1)+h-1,r=(this._segmentsW+1)*(f-1)+h,f==this._segmentsH?(b[m-9]=b[s],b[m-8]=b[s+1],b[m-7]=b[s+2],d[e++]=u,d[e++]=p,d[e++]=r):1==f?(d[e++]=u,d[e++]=n,d[e++]=p):(d[e++]=u,d[e++]=n,d[e++]=p,d[e++]=u,d[e++]=p,d[e++]=r));m+=g}}a.updateData(b);
a.updateIndexData(d)};a.prototype.pBuildUVs=function(a){var b,d,h=a.UVStride;b=(this._segmentsH+1)*(this._segmentsW+1)*h;var f,h=h-2;a.UVData&&b==a.UVData.length?f=a.UVData:(f=Array(b),this.pInvalidateGeometry());var e=a.UVOffset;for(d=0;d<=this._segmentsH;++d)for(b=0;b<=this._segmentsW;++b)f[e++]=b/this._segmentsW*a.scaleU,f[e++]=d/this._segmentsH*a.scaleV,e+=h;a.updateData(f)};Object.defineProperty(a.prototype,"radius",{get:function(){return this._radius},set:function(a){this._radius=a;this.pInvalidateGeometry()},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"segmentsW",{get:function(){return this._segmentsW},set:function(a){this._segmentsW=a;this.pInvalidateGeometry();this.pInvalidateUVs()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"segmentsH",{get:function(){return this._segmentsH},set:function(a){this._segmentsH=a;this.pInvalidateGeometry();this.pInvalidateUVs()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"yUp",{get:function(){return this._yUp},
set:function(a){this._yUp=a;this.pInvalidateGeometry()},enumerable:!0,configurable:!0});return a}(b.primitives.PrimitiveBase);g.SphereGeometry=e})(b.primitives||(b.primitives={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(){}b.float32ColorToARGB=function(a){return[(a&4278190080)>>>24,(a&16711680)>>>16,(a&65280)>>>8,a&255]};b.componentToHex=function(a){a=a.toString(16);return 1==a.length?"0"+a:a};b.RGBToHexString=function(a){return"#"+b.componentToHex(a[1])+b.componentToHex(a[2])+b.componentToHex(a[3])};b.ARGBToHexString=function(a){return"#"+b.componentToHex(a[0])+b.componentToHex(a[1])+b.componentToHex(a[2])+b.componentToHex(a[3])};return b}();b.ColorUtils=e})(b.utils||
(b.utils={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(a,c,b,d,h,f,e,g){"undefined"===typeof a&&(a=1);"undefined"===typeof c&&(c=1);"undefined"===typeof b&&(b=1);"undefined"===typeof d&&(d=1);"undefined"===typeof h&&(h=0);"undefined"===typeof f&&(f=0);"undefined"===typeof e&&(e=0);"undefined"===typeof g&&(g=0);this.redMultiplier=a;this.greenMultiplier=c;this.blueMultiplier=b;this.alphaMultiplier=d;this.redOffset=h;this.greenOffset=f;this.blueOffset=e;this.alphaOffset=g}d.prototype.concat=function(a){this.redMultiplier+=
a.redMultiplier;this.greenMultiplier+=a.greenMultiplier;this.blueMultiplier+=a.blueMultiplier;this.alphaMultiplier+=a.alphaMultiplier};Object.defineProperty(d.prototype,"color",{get:function(){return this.redOffset<<16|this.greenOffset<<8|this.blueOffset},set:function(a){a=b.utils.ColorUtils.float32ColorToARGB(a);this.redOffset=a[1];this.greenOffset=a[2];this.blueOffset=a[3];this.blueMultiplier=this.greenMultiplier=this.redMultiplier=0},enumerable:!0,configurable:!0});return d}();g.ColorTransform=
e})(b.geom||(b.geom={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this)}__extends(a,d);Object.defineProperty(a.prototype,"stateClass",{get:function(){return this._stateClass},enumerable:!0,configurable:!0});a.prototype.dispose=function(){};Object.defineProperty(a.prototype,"assetType",{get:function(){return b.library.AssetType.ANIMATION_NODE},enumerable:!0,configurable:!0});return a}(b.library.NamedAssetBase);g.AnimationNodeBase=e})(b.animators||(b.animators={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(){}d.fromVectors=function(a,c,b,e,h,f,g,w){"undefined"===typeof w&&(w=0);var s=[];b&&!b.length&&(b=null);e&&!e.length&&(e=null);h&&!h.length&&(h=null);f&&!f.length&&(f=null);g&&!g.length&&(g=null);if(983025<=c.length||196605<=a.length){var m,n,p,r,t=[],v=[],x=null!=b?[]:null,u=null!=e?[]:null,y=null!=h?[]:null,z=null!=f?[]:null,B=null!=g?[]:null,A=Array(a.length/3);for(m=A.length;0<m--;)A[m]=-1;var C,E,D,F,J,G,H,I,K,L,M,O;p=0;n=c.length;for(m=
0;m<n;m+=3){E=t.length+6;if(983025<=p+2||196605<=E){s.push(d.constructSubGeometry(t,v,x,u,y,z,B,w));t=[];v=[];x=null!=b?[]:null;u=null!=e?[]:null;y=null!=h?[]:null;z=null!=f?[]:null;B=null!=g?[]:null;for(r=A.length;0<r--;)A[r]=-1;p=0}for(r=0;3>r;r++)C=c[m+r],0<=A[C]?E=A[C]:(D=3*C+0,F=3*C+1,J=3*C+2,E=t.length/3,G=3*E+0,H=3*E+1,I=3*E+2,t[G]=a[D],t[H]=a[F],t[I]=a[J],b&&(K=2*E+0,M=2*E+1,L=2*C+0,O=2*C+1,x[K]=b[L],x[M]=b[O]),e&&(u[G]=e[D],u[H]=e[F],u[I]=e[J]),h&&(y[G]=h[D],y[H]=h[F],y[I]=h[J]),f&&(z[G]=
f[D],z[H]=f[F],z[I]=f[J]),g&&(B[G]=g[D],B[H]=g[F],B[I]=g[J]),A[C]=E),v[p+r]=E;p+=3}0<t.length&&s.push(d.constructSubGeometry(t,v,x,u,y,z,B,w))}else s.push(d.constructSubGeometry(a,c,b,e,h,f,g,w));return s};d.constructSubGeometry=function(a,c,d,e,h,f,g,w){f&&g?(b.Debug.throwPIR("GeometryUtils","constructSubGeometry","Dependency: SkinnedSubGeometry"),f=new b.base.SkinnedSubGeometry(f.length/(a.length/3))):f=new b.base.CompactSubGeometry;f.updateIndexData(c);f.fromVectors(a,d,e,h);return f};d.interleaveBuffers=
function(a,c,b,d,h,f){"undefined"===typeof c&&(c=null);"undefined"===typeof b&&(b=null);"undefined"===typeof d&&(d=null);"undefined"===typeof h&&(h=null);"undefined"===typeof f&&(f=null);var e,g,s,m,n;n=[];for(e=0;e<a;++e)s=2*e,g=3*e,m=13*e,n[m]=c?c[g]:0,n[m+1]=c?c[g+1]:0,n[m+2]=c?c[g+2]:0,n[m+3]=b?b[g]:0,n[m+4]=b?b[g+1]:0,n[m+5]=b?b[g+2]:0,n[m+6]=d?d[g]:0,n[m+7]=d?d[g+1]:0,n[m+8]=d?d[g+2]:0,n[m+9]=h?h[s]:0,n[m+10]=h?h[s+1]:0,n[m+11]=f?f[s]:0,n[m+12]=f?f[s+1]:0;return n};d.getMeshSubgeometryIndex=
function(a){for(var c,b=a.parentGeometry.subGeometries,d=0;d<b.length;++d)if(b[d]==a){c=d;break}return c};d.getMeshSubMeshIndex=function(a){for(var c,b=a.iParentMesh.subMeshes,d=0;d<b.length;++d)if(b[d]==a){c=d;break}return c};return d}();g.GeometryUtils=e})(b.utils||(b.utils={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(a,c){this._rootDelta=new b.geom.Vector3D;this._positionDeltaDirty=!0;this._animator=a;this._animationNode=c}Object.defineProperty(d.prototype,"positionDelta",{get:function(){this._positionDeltaDirty&&this.pUpdatePositionDelta();return this._rootDelta},enumerable:!0,configurable:!0});d.prototype.offset=function(a){this._startTime=a;this._positionDeltaDirty=!0};d.prototype.update=function(a){this._time!=a-this._startTime&&this.pUpdateTime(a)};d.prototype.phase=
function(a){};d.prototype.pUpdateTime=function(a){this._time=a-this._startTime;this._positionDeltaDirty=!0};d.prototype.pUpdatePositionDelta=function(){};return d}();g.AnimationStateBase=e})(b.animators||(b.animators={}))})(away||(away={}));(function(b){(function(g){var e=function(b){function a(a){b.call(this,a)}__extends(a,b);a.SHADER_INVALIDATED="ShaderInvalidated";return a}(b.events.Event);g.ShadingMethodEvent=e})(b.events||(b.events={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(a){"undefined"===typeof a&&(a=!1);d.call(this);this._iProgram3Ds=Array(8);this._iProgram3Dids=[-1,-1,-1,-1,-1,-1,-1,-1];this._context3Ds=Array(8);this._pSmooth=!0;this._pRepeat=!1;this._pMipmap=!0;this._depthCompareMode=b.display3D.Context3DCompareMode.LESS_EQUAL;this._blendFactorSource=b.display3D.Context3DBlendFactor.ONE;this._blendFactorDest=b.display3D.Context3DBlendFactor.ZERO;this._pEnableBlending=!1;this._pAnimatableAttributes=["va0"];
this._pAnimationTargetRegisters=["vt0"];this._pShadedTarget="ft0";this._defaultCulling=b.display3D.Context3DTriangleFace.BACK;this._pAlphaPremultiplied=!1;this._writeDepth=!0;this._renderToTexture=a;this._pNumUsedStreams=1;this._pNumUsedVertexConstants=5}__extends(a,d);Object.defineProperty(a.prototype,"material",{get:function(){return this._pMaterial},set:function(a){this._pMaterial=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"writeDepth",{get:function(){return this._writeDepth},
set:function(a){this._writeDepth=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"mipmap",{get:function(){return this._pMipmap},set:function(a){this.setMipMap(a)},enumerable:!0,configurable:!0});a.prototype.setMipMap=function(a){this._pMipmap!=a&&(this._pMipmap=a,this.iInvalidateShaderProgram())};Object.defineProperty(a.prototype,"smooth",{get:function(){return this._pSmooth},set:function(a){this._pSmooth!=a&&(this._pSmooth=a,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"repeat",{get:function(){return this._pRepeat},set:function(a){this._pRepeat!=a&&(this._pRepeat=a,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"bothSides",{get:function(){return this._pBothSides},set:function(a){this._pBothSides=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"depthCompareMode",{get:function(){return this._depthCompareMode},set:function(a){this._depthCompareMode=a},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"animationSet",{get:function(){return this._animationSet},set:function(a){this._animationSet!=a&&(this._animationSet=a,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"renderToTexture",{get:function(){return this._renderToTexture},enumerable:!0,configurable:!0});a.prototype.dispose=function(){this._pLightPicker&&this._pLightPicker.removeEventListener(b.events.Event.CHANGE,this.onLightsChange,this);
for(var a=0;8>a;++a)this._iProgram3Ds[a]&&(b.managers.AGALProgram3DCache.getInstanceFromIndex(a).freeProgram3D(this._iProgram3Dids[a]),this._iProgram3Ds[a]=null)};Object.defineProperty(a.prototype,"numUsedStreams",{get:function(){return this._pNumUsedStreams},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"numUsedVertexConstants",{get:function(){return this._pNumUsedVertexConstants},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"numUsedVaryings",{get:function(){return this._pNumUsedVaryings},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"numUsedFragmentConstants",{get:function(){return this._pNumUsedFragmentConstants},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"needFragmentAnimation",{get:function(){return this._pNeedFragmentAnimation},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"needUVAnimation",{get:function(){return this._pNeedUVAnimation},enumerable:!0,configurable:!0});a.prototype.iUpdateAnimationState=function(a,b,
d){a.animator.setRenderState(b,a,this._pNumUsedVertexConstants,this._pNumUsedStreams,d)};a.prototype.iRender=function(a,d,e,h){throw new b.errors.AbstractMethodError;};a.prototype.iGetVertexCode=function(){throw new b.errors.AbstractMethodError;};a.prototype.iGetFragmentCode=function(a){throw new b.errors.AbstractMethodError;};a.prototype.setBlendMode=function(a){switch(a){case b.display.BlendMode.NORMAL:this._blendFactorSource=b.display3D.Context3DBlendFactor.ONE;this._blendFactorDest=b.display3D.Context3DBlendFactor.ZERO;
this._pEnableBlending=!1;break;case b.display.BlendMode.LAYER:this._blendFactorSource=b.display3D.Context3DBlendFactor.SOURCE_ALPHA;this._blendFactorDest=b.display3D.Context3DBlendFactor.ONE_MINUS_SOURCE_ALPHA;this._pEnableBlending=!0;break;case b.display.BlendMode.MULTIPLY:this._blendFactorSource=b.display3D.Context3DBlendFactor.ZERO;this._blendFactorDest=b.display3D.Context3DBlendFactor.SOURCE_COLOR;this._pEnableBlending=!0;break;case b.display.BlendMode.ADD:this._blendFactorSource=b.display3D.Context3DBlendFactor.SOURCE_ALPHA;
this._blendFactorDest=b.display3D.Context3DBlendFactor.ONE;this._pEnableBlending=!0;break;case b.display.BlendMode.ALPHA:this._blendFactorSource=b.display3D.Context3DBlendFactor.ZERO;this._blendFactorDest=b.display3D.Context3DBlendFactor.SOURCE_ALPHA;this._pEnableBlending=!0;break;default:throw new b.errors.ArgumentError("Unsupported blend mode!");}};a.prototype.iActivate=function(c,d){var e=c._iStage3DIndex,h=c._iContext3D;h.setDepthTest(this._writeDepth&&!this._pEnableBlending,this._depthCompareMode);
this._pEnableBlending&&h.setBlendFactors(this._blendFactorSource,this._blendFactorDest);this._context3Ds[e]==h&&this._iProgram3Ds[e]||(this._context3Ds[e]=h,this.iUpdateProgram(c),this.dispatchEvent(new b.events.Event(b.events.Event.CHANGE)));var f=a._previousUsedStreams[e],g;for(g=this._pNumUsedStreams;g<f;++g)h.setVertexBufferAt(g,null);f=a._previousUsedTexs[e];for(g=this._pNumUsedTextures;g<f;++g)h.setTextureAt(g,null);this._animationSet&&!this._animationSet.usesCPU&&this._animationSet.activate(c,
this);h.setProgram(this._iProgram3Ds[e]);h.setCulling(this._pBothSides?b.display3D.Context3DTriangleFace.NONE:this._defaultCulling);this._renderToTexture&&(this._oldTarget=c.renderTarget,this._oldSurface=c.renderSurfaceSelector,this._oldDepthStencil=c.enableDepthAndStencil,this._oldRect=c.scissorRect)};a.prototype.iDeactivate=function(c){var d=c._iStage3DIndex;a._previousUsedStreams[d]=this._pNumUsedStreams;a._previousUsedTexs[d]=this._pNumUsedTextures;this._animationSet&&!this._animationSet.usesCPU&&
this._animationSet.deactivate(c,this);this._renderToTexture&&(c.setRenderTarget(this._oldTarget,this._oldDepthStencil,this._oldSurface),c.scissorRect=this._oldRect);c._iContext3D.setDepthTest(!0,b.display3D.Context3DCompareMode.LESS_EQUAL)};a.prototype.iInvalidateShaderProgram=function(a){"undefined"===typeof a&&(a=!0);for(var b=0;8>b;++b)this._iProgram3Ds[b]=null;this._pMaterial&&a&&this._pMaterial.iInvalidatePasses(this)};a.prototype.iUpdateProgram=function(a){var d="",e="",h="",f=this.iGetVertexCode();
if(this._animationSet&&!this._animationSet.usesCPU)d=this._animationSet.getAGALVertexCode(this,this._pAnimatableAttributes,this._pAnimationTargetRegisters,a.profile),this._pNeedFragmentAnimation&&(h=this._animationSet.getAGALFragmentCode(this,this._pShadedTarget,a.profile)),this._pNeedUVAnimation&&(e=this._animationSet.getAGALUVCode(this,this._pUVSource,this._pUVTarget)),this._animationSet.doneAGALCode(this);else{for(var g=this._pAnimatableAttributes.length,w=0;w<g;++w)d+="mov "+this._pAnimationTargetRegisters[w]+
", "+this._pAnimatableAttributes[w]+"\n";this._pNeedUVAnimation&&(e="mov "+this._pUVTarget+","+this._pUVSource+"\n")}f=d+e+f;d=this.iGetFragmentCode(h);b.managers.AGALProgram3DCache.getInstance(a).setProgram3D(this,f,d)};Object.defineProperty(a.prototype,"lightPicker",{get:function(){return this._pLightPicker},set:function(a){this._pLightPicker&&this._pLightPicker.removeEventListener(b.events.Event.CHANGE,this.onLightsChange,this);(this._pLightPicker=a)&&this._pLightPicker.addEventListener(b.events.Event.CHANGE,
this.onLightsChange,this);this.pUpdateLights()},enumerable:!0,configurable:!0});a.prototype.onLightsChange=function(a){this.pUpdateLights()};a.prototype.pUpdateLights=function(){};Object.defineProperty(a.prototype,"alphaPremultiplied",{get:function(){return this._pAlphaPremultiplied},set:function(a){this._pAlphaPremultiplied=a;this.iInvalidateShaderProgram(!1)},enumerable:!0,configurable:!0});a._previousUsedStreams=[0,0,0,0,0,0,0,0];a._previousUsedTexs=[0,0,0,0,0,0,0,0];return a}(b.events.EventDispatcher);
g.MaterialPassBase=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(a){d.call(this);this._pSpecularLightSources=1;this._pDiffuseLightSources=3;this._pVertexConstantData=[];this._pFragmentConstantData=[];this._preserveAlpha=!0;this._animateUVs=!1;this._enableLightFallOff=!0;this._forceSeparateMVP=!1;this._pMaterial=a;this.init()}__extends(a,d);Object.defineProperty(a.prototype,"enableLightFallOff",{get:function(){return this._enableLightFallOff},set:function(a){a!=this._enableLightFallOff&&this.iInvalidateShaderProgram(!0);
this._enableLightFallOff=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"forceSeparateMVP",{get:function(){return this._forceSeparateMVP},set:function(a){this._forceSeparateMVP=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"iNumPointLights",{get:function(){return this._pNumPointLights},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"iNumDirectionalLights",{get:function(){return this._pNumDirectionalLights},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"iNumLightProbes",{get:function(){return this._pNumLightProbes},enumerable:!0,configurable:!0});a.prototype.iUpdateProgram=function(a){this.reset(a.profile);d.prototype.iUpdateProgram.call(this,a)};a.prototype.reset=function(a){this.iInitCompiler(a);this.pUpdateShaderProperties();this.initConstantData();this.pCleanUp()};a.prototype.updateUsedOffsets=function(){this._pNumUsedVertexConstants=this._pCompiler.numUsedVertexConstants;this._pNumUsedFragmentConstants=this._pCompiler.numUsedFragmentConstants;
this._pNumUsedStreams=this._pCompiler.numUsedStreams;this._pNumUsedTextures=this._pCompiler.numUsedTextures;this._pNumUsedVaryings=this._pCompiler.numUsedVaryings;this._pNumUsedFragmentConstants=this._pCompiler.numUsedFragmentConstants};a.prototype.initConstantData=function(){this._pVertexConstantData.length=4*this._pNumUsedVertexConstants;this._pFragmentConstantData.length=4*this._pNumUsedFragmentConstants;this.pInitCommonsData();0<=this._uvTransformIndex&&this.pInitUVTransformData();0<=this._pCameraPositionIndex&&
(this._pVertexConstantData[this._pCameraPositionIndex+3]=1);this.pUpdateMethodConstants()};a.prototype.iInitCompiler=function(a){this._pCompiler=this.pCreateCompiler(a);this._pCompiler.forceSeperateMVP=this._forceSeparateMVP;this._pCompiler.numPointLights=this._pNumPointLights;this._pCompiler.numDirectionalLights=this._pNumDirectionalLights;this._pCompiler.numLightProbes=this._pNumLightProbes;this._pCompiler.methodSetup=this._pMethodSetup;this._pCompiler.diffuseLightSources=this._pDiffuseLightSources;
this._pCompiler.specularLightSources=this._pSpecularLightSources;this._pCompiler.setTextureSampling(this._pSmooth,this._pRepeat,this._pMipmap);this._pCompiler.setConstantDataBuffers(this._pVertexConstantData,this._pFragmentConstantData);this._pCompiler.animateUVs=this._animateUVs;this._pCompiler.alphaPremultiplied=this._pAlphaPremultiplied&&this._pEnableBlending;this._pCompiler.preserveAlpha=this._preserveAlpha&&this._pEnableBlending;this._pCompiler.enableLightFallOff=this._enableLightFallOff;this._pCompiler.compile()};
a.prototype.pCreateCompiler=function(a){throw new b.errors.AbstractMethodError;};a.prototype.pUpdateShaderProperties=function(){this._pAnimatableAttributes=this._pCompiler.animatableAttributes;this._pAnimationTargetRegisters=this._pCompiler.animationTargetRegisters;this._vertexCode=this._pCompiler.vertexCode;this._fragmentLightCode=this._pCompiler.fragmentLightCode;this._framentPostLightCode=this._pCompiler.fragmentPostLightCode;this._pShadedTarget=this._pCompiler.shadedTarget;this._usingSpecularMethod=
this._pCompiler.usingSpecularMethod;this._usesNormals=this._pCompiler.usesNormals;this._pNeedUVAnimation=this._pCompiler.needUVAnimation;this._pUVSource=this._pCompiler.UVSource;this._pUVTarget=this._pCompiler.UVTarget;this.pUpdateRegisterIndices();this.updateUsedOffsets()};a.prototype.pUpdateRegisterIndices=function(){this._uvBufferIndex=this._pCompiler.uvBufferIndex;this._uvTransformIndex=this._pCompiler.uvTransformIndex;this._secondaryUVBufferIndex=this._pCompiler.secondaryUVBufferIndex;this._normalBufferIndex=
this._pCompiler.normalBufferIndex;this._tangentBufferIndex=this._pCompiler.tangentBufferIndex;this._pLightFragmentConstantIndex=this._pCompiler.lightFragmentConstantIndex;this._pCameraPositionIndex=this._pCompiler.cameraPositionIndex;this._commonsDataIndex=this._pCompiler.commonsDataIndex;this._sceneMatrixIndex=this._pCompiler.sceneMatrixIndex;this._sceneNormalMatrixIndex=this._pCompiler.sceneNormalMatrixIndex;this._pProbeWeightsIndex=this._pCompiler.probeWeightsIndex;this._pLightProbeDiffuseIndices=
this._pCompiler.lightProbeDiffuseIndices;this._pLightProbeSpecularIndices=this._pCompiler.lightProbeSpecularIndices};Object.defineProperty(a.prototype,"preserveAlpha",{get:function(){return this._preserveAlpha},set:function(a){this._preserveAlpha!=a&&(this._preserveAlpha=a,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"animateUVs",{get:function(){return this._animateUVs},set:function(a){((this._animateUVs=a)&&!this._animateUVs||!a&&this._animateUVs)&&
this.iInvalidateShaderProgram()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"mipmap",{set:function(a){this._pMipmap!=a&&d.prototype.setMipMap.call(this,a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"normalMap",{get:function(){return this._pMethodSetup._iNormalMethod.normalMap},set:function(a){this._pMethodSetup._iNormalMethod.normalMap=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"normalMethod",{get:function(){return this._pMethodSetup.normalMethod},
set:function(a){this._pMethodSetup.normalMethod=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"ambientMethod",{get:function(){return this._pMethodSetup.ambientMethod},set:function(a){this._pMethodSetup.ambientMethod=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"shadowMethod",{get:function(){return this._pMethodSetup.shadowMethod},set:function(a){this._pMethodSetup.shadowMethod=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"diffuseMethod",
{get:function(){return this._pMethodSetup.diffuseMethod},set:function(a){this._pMethodSetup.diffuseMethod=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"specularMethod",{get:function(){return this._pMethodSetup.specularMethod},set:function(a){this._pMethodSetup.specularMethod=a},enumerable:!0,configurable:!0});a.prototype.init=function(){this._pMethodSetup=new b.materials.ShaderMethodSetup;this._pMethodSetup.addEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,this.onShaderInvalidated,
this)};a.prototype.dispose=function(){d.prototype.dispose.call(this);this._pMethodSetup.removeEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,this.onShaderInvalidated,this);this._pMethodSetup.dispose();this._pMethodSetup=null};a.prototype.iInvalidateShaderProgram=function(a){"undefined"===typeof a&&(a=!0);var b=this._iPasses;this._iPasses=[];this._pMethodSetup&&this.pAddPassesFromMethods();if(b&&this._iPasses.length==b.length){for(var e=0;e<this._iPasses.length;++e)if(this._iPasses[e]!=
b[e]){this._iPassesDirty=!0;return}d.prototype.iInvalidateShaderProgram.call(this,a)}else this._iPassesDirty=!0};a.prototype.pAddPassesFromMethods=function(){this._pMethodSetup._iNormalMethod&&this._pMethodSetup._iNormalMethod.iHasOutput&&this.pAddPasses(this._pMethodSetup._iNormalMethod.passes);this._pMethodSetup._iAmbientMethod&&this.pAddPasses(this._pMethodSetup._iAmbientMethod.passes);this._pMethodSetup._iShadowMethod&&this.pAddPasses(this._pMethodSetup._iShadowMethod.passes);this._pMethodSetup._iDiffuseMethod&&
this.pAddPasses(this._pMethodSetup._iDiffuseMethod.passes);this._pMethodSetup._iSpecularMethod&&this.pAddPasses(this._pMethodSetup._iSpecularMethod.passes)};a.prototype.pAddPasses=function(a){if(a)for(var b=a.length,d=0;d<b;++d)a[d].material=this.material,a[d].lightPicker=this._pLightPicker,this._iPasses.push(a[d])};a.prototype.pInitUVTransformData=function(){this._pVertexConstantData[this._uvTransformIndex]=1;this._pVertexConstantData[this._uvTransformIndex+1]=0;this._pVertexConstantData[this._uvTransformIndex+
2]=0;this._pVertexConstantData[this._uvTransformIndex+3]=0;this._pVertexConstantData[this._uvTransformIndex+4]=0;this._pVertexConstantData[this._uvTransformIndex+5]=1;this._pVertexConstantData[this._uvTransformIndex+6]=0;this._pVertexConstantData[this._uvTransformIndex+7]=0};a.prototype.pInitCommonsData=function(){this._pFragmentConstantData[this._commonsDataIndex]=0.5;this._pFragmentConstantData[this._commonsDataIndex+1]=0;this._pFragmentConstantData[this._commonsDataIndex+2]=1/255;this._pFragmentConstantData[this._commonsDataIndex+
3]=1};a.prototype.pCleanUp=function(){this._pCompiler.dispose();this._pCompiler=null};a.prototype.pUpdateMethodConstants=function(){this._pMethodSetup._iNormalMethod&&this._pMethodSetup._iNormalMethod.iInitConstants(this._pMethodSetup._iNormalMethodVO);this._pMethodSetup._iDiffuseMethod&&this._pMethodSetup._iDiffuseMethod.iInitConstants(this._pMethodSetup._iDiffuseMethodVO);this._pMethodSetup._iAmbientMethod&&this._pMethodSetup._iAmbientMethod.iInitConstants(this._pMethodSetup._iAmbientMethodVO);
this._usingSpecularMethod&&this._pMethodSetup._iSpecularMethod.iInitConstants(this._pMethodSetup._iSpecularMethodVO);this._pMethodSetup._iShadowMethod&&this._pMethodSetup._iShadowMethod.iInitConstants(this._pMethodSetup._iShadowMethodVO)};a.prototype.pUpdateLightConstants=function(){};a.prototype.pUpdateProbes=function(a){};a.prototype.onShaderInvalidated=function(a){this.iInvalidateShaderProgram()};a.prototype.iGetVertexCode=function(){return this._vertexCode};a.prototype.iGetFragmentCode=function(a){return this._fragmentLightCode+
a+this._framentPostLightCode};a.prototype.iActivate=function(a,b){d.prototype.iActivate.call(this,a,b);this._usesNormals&&this._pMethodSetup._iNormalMethod.iActivate(this._pMethodSetup._iNormalMethodVO,a);this._pMethodSetup._iAmbientMethod.iActivate(this._pMethodSetup._iAmbientMethodVO,a);this._pMethodSetup._iShadowMethod&&this._pMethodSetup._iShadowMethod.iActivate(this._pMethodSetup._iShadowMethodVO,a);this._pMethodSetup._iDiffuseMethod.iActivate(this._pMethodSetup._iDiffuseMethodVO,a);this._usingSpecularMethod&&
this._pMethodSetup._iSpecularMethod.iActivate(this._pMethodSetup._iSpecularMethodVO,a)};a.prototype.iRender=function(a,d,e,h){var f=d._iContext3D;0<=this._uvBufferIndex&&a.activateUVBuffer(this._uvBufferIndex,d);0<=this._secondaryUVBufferIndex&&a.activateSecondaryUVBuffer(this._secondaryUVBufferIndex,d);0<=this._normalBufferIndex&&a.activateVertexNormalBuffer(this._normalBufferIndex,d);0<=this._tangentBufferIndex&&a.activateVertexTangentBuffer(this._tangentBufferIndex,d);if(this._animateUVs){var g=
a.uvTransform;g?(this._pVertexConstantData[this._uvTransformIndex]=g.a,this._pVertexConstantData[this._uvTransformIndex+1]=g.b,this._pVertexConstantData[this._uvTransformIndex+3]=g.tx,this._pVertexConstantData[this._uvTransformIndex+4]=g.c,this._pVertexConstantData[this._uvTransformIndex+5]=g.d,this._pVertexConstantData[this._uvTransformIndex+7]=g.ty):(this._pVertexConstantData[this._uvTransformIndex]=1,this._pVertexConstantData[this._uvTransformIndex+1]=0,this._pVertexConstantData[this._uvTransformIndex+
3]=0,this._pVertexConstantData[this._uvTransformIndex+4]=0,this._pVertexConstantData[this._uvTransformIndex+5]=1,this._pVertexConstantData[this._uvTransformIndex+7]=0)}this._pAmbientLightR=this._pAmbientLightG=this._pAmbientLightB=0;this.pUsesLights()&&this.pUpdateLightConstants();this.pUsesProbes()&&this.pUpdateProbes(d);0<=this._sceneMatrixIndex?(a.getRenderSceneTransform(e).copyRawDataTo(this._pVertexConstantData,this._sceneMatrixIndex,!0),h.copyRawDataTo(this._pVertexConstantData,0,!0)):(g=b.math.Matrix3DUtils.CALCULATION_MATRIX,
g.copyFrom(a.getRenderSceneTransform(e)),g.append(h),g.copyRawDataTo(this._pVertexConstantData,0,!0));0<=this._sceneNormalMatrixIndex&&a.inverseSceneTransform.copyRawDataTo(this._pVertexConstantData,this._sceneNormalMatrixIndex,!1);this._usesNormals&&this._pMethodSetup._iNormalMethod.iSetRenderState(this._pMethodSetup._iNormalMethodVO,a,d,e);h=this._pMethodSetup._iAmbientMethod;h._iLightAmbientR=this._pAmbientLightR;h._iLightAmbientG=this._pAmbientLightG;h._iLightAmbientB=this._pAmbientLightB;h.iSetRenderState(this._pMethodSetup._iAmbientMethodVO,
a,d,e);this._pMethodSetup._iShadowMethod&&this._pMethodSetup._iShadowMethod.iSetRenderState(this._pMethodSetup._iShadowMethodVO,a,d,e);this._pMethodSetup._iDiffuseMethod.iSetRenderState(this._pMethodSetup._iDiffuseMethodVO,a,d,e);this._usingSpecularMethod&&this._pMethodSetup._iSpecularMethod.iSetRenderState(this._pMethodSetup._iSpecularMethodVO,a,d,e);this._pMethodSetup._iColorTransformMethod&&this._pMethodSetup._iColorTransformMethod.iSetRenderState(this._pMethodSetup._iColorTransformMethodVO,a,
d,e);var g=this._pMethodSetup._iMethods,w=g.length;for(h=0;h<w;++h){var s=g[h];s.method.iSetRenderState(s.data,a,d,e)}f.setProgramConstantsFromArray(b.display3D.Context3DProgramType.VERTEX,0,this._pVertexConstantData,this._pNumUsedVertexConstants);f.setProgramConstantsFromArray(b.display3D.Context3DProgramType.FRAGMENT,0,this._pFragmentConstantData,this._pNumUsedFragmentConstants);a.activateVertexBuffer(0,d);f.drawTriangles(a.getIndexBuffer(d),0,a.numTriangles)};a.prototype.pUsesProbes=function(){return 0<
this._pNumLightProbes&&0!=((this._pDiffuseLightSources|this._pSpecularLightSources)&b.materials.LightSources.PROBES)};a.prototype.pUsesLights=function(){return(0<this._pNumPointLights||0<this._pNumDirectionalLights)&&0!=((this._pDiffuseLightSources|this._pSpecularLightSources)&b.materials.LightSources.LIGHTS)};a.prototype.iDeactivate=function(a){d.prototype.iDeactivate.call(this,a);this._usesNormals&&this._pMethodSetup._iNormalMethod.iDeactivate(this._pMethodSetup._iNormalMethodVO,a);this._pMethodSetup._iAmbientMethod.iDeactivate(this._pMethodSetup._iAmbientMethodVO,
a);this._pMethodSetup._iShadowMethod&&this._pMethodSetup._iShadowMethod.iDeactivate(this._pMethodSetup._iShadowMethodVO,a);this._pMethodSetup._iDiffuseMethod.iDeactivate(this._pMethodSetup._iDiffuseMethodVO,a);this._usingSpecularMethod&&this._pMethodSetup._iSpecularMethod.iDeactivate(this._pMethodSetup._iSpecularMethodVO,a)};Object.defineProperty(a.prototype,"specularLightSources",{get:function(){return this._pSpecularLightSources},set:function(a){this._pSpecularLightSources=a},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"diffuseLightSources",{get:function(){return this._pDiffuseLightSources},set:function(a){this._pDiffuseLightSources=a},enumerable:!0,configurable:!0});return a}(b.materials.MaterialPassBase);g.CompiledPass=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(a){d.call(this,a);this._pNeedFragmentAnimation=this._includeCasters=!0}__extends(a,d);a.prototype.pCreateCompiler=function(a){return new b.materials.SuperShaderCompiler(a)};Object.defineProperty(a.prototype,"includeCasters",{get:function(){return this._includeCasters},set:function(a){this._includeCasters!=a&&(this._includeCasters=a,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"colorTransform",
{get:function(){return this._pMethodSetup._iColorTransformMethod?this._pMethodSetup._iColorTransformMethod.colorTransform:null},set:function(a){a?(null==this.colorTransformMethod&&(this.colorTransformMethod=new b.materials.ColorTransformMethod),this._pMethodSetup._iColorTransformMethod.colorTransform=a):a||(this._pMethodSetup._iColorTransformMethod&&(this.colorTransformMethod=null),this.colorTransformMethod=this._pMethodSetup._iColorTransformMethod=null)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"colorTransformMethod",{get:function(){return this._pMethodSetup._iColorTransformMethod},set:function(a){this._pMethodSetup.iColorTransformMethod=a},enumerable:!0,configurable:!0});a.prototype.addMethod=function(a){this._pMethodSetup.addMethod(a)};Object.defineProperty(a.prototype,"numMethods",{get:function(){return this._pMethodSetup.numMethods},enumerable:!0,configurable:!0});a.prototype.hasMethod=function(a){return this._pMethodSetup.hasMethod(a)};a.prototype.getMethodAt=function(a){return this._pMethodSetup.getMethodAt(a)};
a.prototype.addMethodAt=function(a,b){this._pMethodSetup.addMethodAt(a,b)};a.prototype.removeMethod=function(a){this._pMethodSetup.removeMethod(a)};a.prototype.pUpdateLights=function(){this._pLightPicker&&!this._ignoreLights?(this._pNumPointLights=this._pLightPicker.numPointLights,this._pNumDirectionalLights=this._pLightPicker.numDirectionalLights,this._pNumLightProbes=this._pLightPicker.numLightProbes,this._includeCasters&&(this._pNumPointLights+=this._pLightPicker.numCastingPointLights,this._pNumDirectionalLights+=
this._pLightPicker.numCastingDirectionalLights)):this._pNumLightProbes=this._pNumDirectionalLights=this._pNumPointLights=0;this.iInvalidateShaderProgram()};a.prototype.iActivate=function(a,b){d.prototype.iActivate.call(this,a,b);this._pMethodSetup._iColorTransformMethod&&this._pMethodSetup._iColorTransformMethod.iActivate(this._pMethodSetup._iColorTransformMethodVO,a);for(var e=this._pMethodSetup._iMethods,h=e.length,f=0;f<h;++f){var g=e[f];g.method.iActivate(g.data,a)}0<=this._pCameraPositionIndex&&
(e=b.scenePosition,this._pVertexConstantData[this._pCameraPositionIndex]=e.x,this._pVertexConstantData[this._pCameraPositionIndex+1]=e.y,this._pVertexConstantData[this._pCameraPositionIndex+2]=e.z)};a.prototype.iDeactivate=function(a){d.prototype.iDeactivate.call(this,a);this._pMethodSetup._iColorTransformMethod&&this._pMethodSetup._iColorTransformMethod.iDeactivate(this._pMethodSetup._iColorTransformMethodVO,a);for(var b,e=this._pMethodSetup._iMethods,h=e.length,f=0;f<h;++f)b=e[f],b.method.iDeactivate(b.data,
a)};a.prototype.pAddPassesFromMethods=function(){d.prototype.pAddPassesFromMethods.call(this);this._pMethodSetup._iColorTransformMethod&&this.pAddPasses(this._pMethodSetup._iColorTransformMethod.passes);for(var a=this._pMethodSetup._iMethods,b=0;b<a.length;++b)this.pAddPasses(a[b].method.passes)};a.prototype.usesProbesForSpecular=function(){return 0<this._pNumLightProbes&&0!=(this._pSpecularLightSources&b.materials.LightSources.PROBES)};a.prototype.usesProbesForDiffuse=function(){return 0<this._pNumLightProbes&&
0!=(this._pDiffuseLightSources&b.materials.LightSources.PROBES)};a.prototype.pUpdateMethodConstants=function(){d.prototype.pUpdateMethodConstants.call(this);this._pMethodSetup._iColorTransformMethod&&this._pMethodSetup._iColorTransformMethod.iInitConstants(this._pMethodSetup._iColorTransformMethodVO);for(var a=this._pMethodSetup._iMethods,b=a.length,e=0;e<b;++e)a[e].method.iInitConstants(a[e].data)};a.prototype.pUpdateLightConstants=function(){var a,b,d,h,f,e=0,g=this._includeCasters?2:1;d=this._pLightFragmentConstantIndex;
for(var s=0;s<g;++s){var m=s?this._pLightPicker.castingDirectionalLights:this._pLightPicker.directionalLights;h=m.length;e+=h;for(b=0;b<h;++b)a=m[b],f=a.sceneDirection,this._pAmbientLightR+=a._iAmbientR,this._pAmbientLightG+=a._iAmbientG,this._pAmbientLightB+=a._iAmbientB,this._pFragmentConstantData[d++]=-f.x,this._pFragmentConstantData[d++]=-f.y,this._pFragmentConstantData[d++]=-f.z,this._pFragmentConstantData[d++]=1,this._pFragmentConstantData[d++]=a._iDiffuseR,this._pFragmentConstantData[d++]=
a._iDiffuseG,this._pFragmentConstantData[d++]=a._iDiffuseB,this._pFragmentConstantData[d++]=1,this._pFragmentConstantData[d++]=a._iSpecularR,this._pFragmentConstantData[d++]=a._iSpecularG,this._pFragmentConstantData[d++]=a._iSpecularB,this._pFragmentConstantData[d++]=1}if(this._pNumDirectionalLights>e)for(b=d+12*(this._pNumDirectionalLights-e);d<b;)this._pFragmentConstantData[d++]=0;for(s=e=0;s<g;++s)for(m=s?this._pLightPicker.castingPointLights:this._pLightPicker.pointLights,h=m.length,b=0;b<h;++b)a=
m[b],f=a.scenePosition,this._pAmbientLightR+=a._iAmbientR,this._pAmbientLightG+=a._iAmbientG,this._pAmbientLightB+=a._iAmbientB,this._pFragmentConstantData[d++]=f.x,this._pFragmentConstantData[d++]=f.y,this._pFragmentConstantData[d++]=f.z,this._pFragmentConstantData[d++]=1,this._pFragmentConstantData[d++]=a._iDiffuseR,this._pFragmentConstantData[d++]=a._iDiffuseG,this._pFragmentConstantData[d++]=a._iDiffuseB,this._pFragmentConstantData[d++]=a._pRadius*a._pRadius,this._pFragmentConstantData[d++]=a._iSpecularR,
this._pFragmentConstantData[d++]=a._iSpecularG,this._pFragmentConstantData[d++]=a._iSpecularB,this._pFragmentConstantData[d++]=a._pFallOffFactor;if(this._pNumPointLights>e)for(b=d+12*(e-this._pNumPointLights);d<b;++d)this._pFragmentConstantData[d]=0};a.prototype.pUpdateProbes=function(a){var b,d=this._pLightPicker.lightProbes,h=this._pLightPicker.lightProbeWeights,f=d.length,e=this.usesProbesForDiffuse(),g=this._pMethodSetup._iSpecularMethod&&this.usesProbesForSpecular(),s=a._iContext3D;if(e||g){for(var m=
0;m<f;++m)b=d[m],e&&s.setTextureAt(this._pLightProbeSpecularIndices[m],b.diffuseMap.getTextureForStage3D(a)),g&&s.setTextureAt(this._pLightProbeSpecularIndices[m],b.specularMap.getTextureForStage3D(a));this._pFragmentConstantData[this._pProbeWeightsIndex]=h[0];this._pFragmentConstantData[this._pProbeWeightsIndex+1]=h[1];this._pFragmentConstantData[this._pProbeWeightsIndex+2]=h[2];this._pFragmentConstantData[this._pProbeWeightsIndex+3]=h[3]}};Object.defineProperty(a.prototype,"iIgnoreLights",{get:function(){return this._ignoreLights},
set:function(a){this._ignoreLights=a},enumerable:!0,configurable:!0});return a}(b.materials.CompiledPass);g.SuperShaderPass=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._alphaThreshold=0;this._data=[1,255,65025,16581375,1/255,1/255,1/255,0,0,0,0,0]}__extends(a,d);Object.defineProperty(a.prototype,"alphaThreshold",{get:function(){return this._alphaThreshold},set:function(a){0>a?a=0:1<a&&(a=1);a!=this._alphaThreshold&&(0!=a&&0!=this._alphaThreshold||this.iInvalidateShaderProgram(),this._alphaThreshold=a,this._data[8]=this._alphaThreshold)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"alphaMask",{get:function(){return this._alphaMask},set:function(a){this._alphaMask=a},enumerable:!0,configurable:!0});a.prototype.iGetVertexCode=function(){var a="",a="m44 vt1, vt0, vc0\t\t\nmov op, vt1\t\n";0<this._alphaThreshold?(this._pNumUsedTextures=1,this._pNumUsedStreams=2,a+="mov v0, vt1\nmov v1, va1\n"):(this._pNumUsedTextures=0,this._pNumUsedStreams=1,a+="mov v0, vt1\n");return a};a.prototype.iGetFragmentCode=function(a){a=this._pRepeat?"wrap":"clamp";var d;d=this._pSmooth?this._pMipmap?
"linear,miplinear":"linear":this._pMipmap?"nearest,mipnearest":"nearest";var e="div ft2, v0, v0.w\t\t\nmul ft0, fc0, ft2.z\t\nfrc ft0, ft0\t\t\t\nmul ft1, ft0.yzww, fc1\t\n";if(0<this._alphaThreshold){var h;switch(this._alphaMask.format){case b.display3D.Context3DTextureFormat.COMPRESSED:h="dxt1,";break;case "compressedAlpha":h="dxt5,";break;default:h=""}e+="tex ft3, v1, fs0 <2d,"+d+","+h+a+">\nsub ft3.w, ft3.w, fc2.x\nkil ft3.w\n"}return e+"sub oc, ft0, ft1\t\t\n"};a.prototype.iRender=function(a,
d,e,h){0<this._alphaThreshold&&a.activateUVBuffer(1,d);var f=d._iContext3D,g=b.math.Matrix3DUtils.CALCULATION_MATRIX;g.copyFrom(a.getRenderSceneTransform(e));g.append(h);f.setProgramConstantsFromMatrix(b.display3D.Context3DProgramType.VERTEX,0,g,!0);a.activateVertexBuffer(0,d);f.drawTriangles(a.getIndexBuffer(d),0,a.numTriangles)};a.prototype.iActivate=function(a,k){var e=a._iContext3D;d.prototype.iActivate.call(this,a,k);0<this._alphaThreshold?(e.setTextureAt(0,this._alphaMask.getTextureForStage3D(a)),
e.setProgramConstantsFromArray(b.display3D.Context3DProgramType.FRAGMENT,0,this._data,3)):e.setProgramConstantsFromArray(b.display3D.Context3DProgramType.FRAGMENT,0,this._data,2)};return a}(b.materials.MaterialPassBase);g.DepthMapPass=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._fragmentData=[1,255,65025,16581375,1/255,1/255,1/255,0,0,0,0,0];this._vertexData=Array(4);this._vertexData[3]=1;this._pNumUsedVertexConstants=9}__extends(a,d);Object.defineProperty(a.prototype,"alphaThreshold",{get:function(){return this._alphaThreshold},set:function(a){0>a?a=0:1<a&&(a=1);a!=this._alphaThreshold&&(0!=a&&0!=this._alphaThreshold||this.iInvalidateShaderProgram(),this._alphaThreshold=a,this._fragmentData[8]=this._alphaThreshold)},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"alphaMask",{get:function(){return this._alphaMask},set:function(a){this._alphaMask=a},enumerable:!0,configurable:!0});a.prototype.iGetVertexCode=function(){var a;a="m44 op, vt0, vc0\t\t\nm44 vt1, vt0, vc5\t\t\nsub v0, vt1, vc9\t\t\n";0<this._alphaThreshold?(a+="mov v1, va1\n",this._pNumUsedTextures=1,this._pNumUsedStreams=2):(this._pNumUsedTextures=0,this._pNumUsedStreams=1);return a};a.prototype.iGetFragmentCode=function(a){var d=
this._pRepeat?"wrap":"clamp",e;e=this._pSmooth?this._pMipmap?"linear,miplinear":"linear":this._pMipmap?"nearest,mipnearest":"nearest";a="dp3 ft2.z, v0.xyz, v0.xyz\t\nmul ft0, fc0, ft2.z\t\nfrc ft0, ft0\t\t\t\nmul ft1, ft0.yzww, fc1\t\n";if(0<this._alphaThreshold){var h;switch(this._alphaMask.format){case b.display3D.Context3DTextureFormat.COMPRESSED:h="dxt1,";break;case "compressedAlpha":h="dxt5,";break;default:h=""}a+="tex ft3, v1, fs0 <2d,"+e+","+h+d+">\nsub ft3.w, ft3.w, fc2.x\nkil ft3.w\n"}return a+
"sub oc, ft0, ft1\t\t\n"};a.prototype.iRender=function(a,d,e,h){var f=d._iContext3D,g=e.scenePosition;this._vertexData[0]=g.x;this._vertexData[1]=g.y;this._vertexData[2]=g.z;this._vertexData[3]=1;e=a.getRenderSceneTransform(e);f.setProgramConstantsFromMatrix(b.display3D.Context3DProgramType.VERTEX,5,e,!0);f.setProgramConstantsFromArray(b.display3D.Context3DProgramType.VERTEX,9,this._vertexData,1);0<this._alphaThreshold&&a.activateUVBuffer(1,d);g=b.math.Matrix3DUtils.CALCULATION_MATRIX;g.copyFrom(e);
g.append(h);f.setProgramConstantsFromMatrix(b.display3D.Context3DProgramType.VERTEX,0,g,!0);a.activateVertexBuffer(0,d);f.drawTriangles(a.getIndexBuffer(d),0,a.numTriangles)};a.prototype.iActivate=function(a,k){var e=a._iContext3D;d.prototype.iActivate.call(this,a,k);var h=k.lens.far,h=1/(2*h*h);this._fragmentData[0]=1*h;this._fragmentData[1]=255*h;this._fragmentData[2]=65025*h;this._fragmentData[3]=16581375*h;0<this._alphaThreshold?(e.setTextureAt(0,this._alphaMask.getTextureForStage3D(a)),e.setProgramConstantsFromArray(b.display3D.Context3DProgramType.FRAGMENT,
0,this._fragmentData,3)):e.setProgramConstantsFromArray(b.display3D.Context3DProgramType.FRAGMENT,0,this._fragmentData,2)};return a}(b.materials.MaterialPassBase);g.DistanceMapPass=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(a){d.call(this,a);this._includeCasters=!0;this._inverseSceneMatrix=[];this._maxLights=3}__extends(a,d);Object.defineProperty(a.prototype,"directionalLightsOffset",{get:function(){return this._directionalLightsOffset},set:function(a){this._directionalLightsOffset=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"pointLightsOffset",{get:function(){return this._pointLightsOffset},set:function(a){this._pointLightsOffset=a},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"lightProbesOffset",{get:function(){return this._lightProbesOffset},set:function(a){this._lightProbesOffset=a},enumerable:!0,configurable:!0});a.prototype.pCreateCompiler=function(a){this._maxLights="baselineConstrained"==a?1:3;return new b.materials.LightingShaderCompiler(a)};Object.defineProperty(a.prototype,"includeCasters",{get:function(){return this._includeCasters},set:function(a){this._includeCasters!=a&&(this._includeCasters=a,this.iInvalidateShaderProgram())},
enumerable:!0,configurable:!0});a.prototype.pUpdateLights=function(){d.prototype.pUpdateLights.call(this);var a,b=0,e=0;this._pLightPicker?(a=this.calculateNumDirectionalLights(this._pLightPicker.numDirectionalLights),b=this.calculateNumPointLights(this._pLightPicker.numPointLights),e=this.calculateNumProbes(this._pLightPicker.numLightProbes),this._includeCasters&&(b+=this._pLightPicker.numCastingPointLights,a+=this._pLightPicker.numCastingDirectionalLights)):e=b=a=0;if(b!=this._pNumPointLights||
a!=this._pNumDirectionalLights||e!=this._pNumLightProbes)this._pNumPointLights=b,this._pNumDirectionalLights=a,this._pNumLightProbes=e,this.iInvalidateShaderProgram()};a.prototype.calculateNumDirectionalLights=function(a){return Math.min(a-this._directionalLightsOffset,this._maxLights)};a.prototype.calculateNumPointLights=function(a){return Math.min(a-this._pointLightsOffset,this._maxLights-this._pNumDirectionalLights)};a.prototype.calculateNumProbes=function(a){var d=0;0!=(this._pSpecularLightSources&
b.materials.LightSources.PROBES)&&++d;0!=(this._pDiffuseLightSources&b.materials.LightSources.PROBES)&&++d;return Math.min(a-this._lightProbesOffset,4/d|0)};a.prototype.pUpdateShaderProperties=function(){d.prototype.pUpdateShaderProperties.call(this);this._tangentSpace=this._pCompiler.tangentSpace};a.prototype.pUpdateRegisterIndices=function(){d.prototype.pUpdateRegisterIndices.call(this);this._lightVertexConstantIndex=this._pCompiler.lightVertexConstantIndex};a.prototype.iRender=function(a,b,e,h){a.inverseSceneTransform.copyRawDataTo(this._inverseSceneMatrix);
if(this._tangentSpace&&0<=this._pCameraPositionIndex){var f=e.scenePosition,g=f.x,w=f.y,f=f.z;this._pVertexConstantData[this._pCameraPositionIndex]=this._inverseSceneMatrix[0]*g+this._inverseSceneMatrix[4]*w+this._inverseSceneMatrix[8]*f+this._inverseSceneMatrix[12];this._pVertexConstantData[this._pCameraPositionIndex+1]=this._inverseSceneMatrix[1]*g+this._inverseSceneMatrix[5]*w+this._inverseSceneMatrix[9]*f+this._inverseSceneMatrix[13];this._pVertexConstantData[this._pCameraPositionIndex+2]=this._inverseSceneMatrix[2]*
g+this._inverseSceneMatrix[6]*w+this._inverseSceneMatrix[10]*f+this._inverseSceneMatrix[14]}d.prototype.iRender.call(this,a,b,e,h)};a.prototype.iActivate=function(a,b){d.prototype.iActivate.call(this,a,b);if(!this._tangentSpace&&0<=this._pCameraPositionIndex){var e=b.scenePosition;this._pVertexConstantData[this._pCameraPositionIndex]=e.x;this._pVertexConstantData[this._pCameraPositionIndex+1]=e.y;this._pVertexConstantData[this._pCameraPositionIndex+2]=e.z}};a.prototype.usesProbesForSpecular=function(){return 0<
this._pNumLightProbes&&0!=(this._pSpecularLightSources&b.materials.LightSources.PROBES)};a.prototype.usesProbesForDiffuse=function(){return 0<this._pNumLightProbes&&0!=(this._pDiffuseLightSources&b.materials.LightSources.PROBES)};a.prototype.pUpdateLightConstants=function(){var a,b=0,d=0,e,f,g=0,w=this._includeCasters?2:1,s,m;s=this._lightVertexConstantIndex;var d=this._pLightFragmentConstantIndex,n=0,p=this._pLightPicker.directionalLights;m=this._directionalLightsOffset;e=this._pLightPicker.directionalLights.length;
m>e&&(n=1,m-=e);for(;n<w;++n)for(n&&(p=this._pLightPicker.castingDirectionalLights),e=p.length,e>this._pNumDirectionalLights&&(e=this._pNumDirectionalLights),b=0;b<e;++b){a=p[m+b];f=a.sceneDirection;this._pAmbientLightR+=a._iAmbientR;this._pAmbientLightG+=a._iAmbientG;this._pAmbientLightB+=a._iAmbientB;if(this._tangentSpace){var r=-f.x,t=-f.y;f=-f.z;this._pVertexConstantData[s++]=this._inverseSceneMatrix[0]*r+this._inverseSceneMatrix[4]*t+this._inverseSceneMatrix[8]*f;this._pVertexConstantData[s++]=
this._inverseSceneMatrix[1]*r+this._inverseSceneMatrix[5]*t+this._inverseSceneMatrix[9]*f;this._pVertexConstantData[s++]=this._inverseSceneMatrix[2]*r+this._inverseSceneMatrix[6]*t+this._inverseSceneMatrix[10]*f;this._pVertexConstantData[s++]=1}else this._pFragmentConstantData[d++]=-f.x,this._pFragmentConstantData[d++]=-f.y,this._pFragmentConstantData[d++]=-f.z,this._pFragmentConstantData[d++]=1;this._pFragmentConstantData[d++]=a._iDiffuseR;this._pFragmentConstantData[d++]=a._iDiffuseG;this._pFragmentConstantData[d++]=
a._iDiffuseB;this._pFragmentConstantData[d++]=1;this._pFragmentConstantData[d++]=a._iSpecularR;this._pFragmentConstantData[d++]=a._iSpecularG;this._pFragmentConstantData[d++]=a._iSpecularB;this._pFragmentConstantData[d++]=1;++g==this._pNumDirectionalLights&&(b=e,n=w)}if(this._pNumDirectionalLights>g)for(b=d+12*(this._pNumDirectionalLights-g);d<b;)this._pFragmentConstantData[d++]=0;g=0;p=this._pLightPicker.pointLights;m=this._pointLightsOffset;e=this._pLightPicker.pointLights.length;m>e?(n=1,m-=e):
n=0;for(;n<w;++n)for(n&&(p=this._pLightPicker.castingPointLights),e=p.length,b=0;b<e;++b)a=p[m+b],f=a.scenePosition,this._pAmbientLightR+=a._iAmbientR,this._pAmbientLightG+=a._iAmbientG,this._pAmbientLightB+=a._iAmbientB,this._tangentSpace?(r=f.x,t=f.y,f=f.z,this._pVertexConstantData[s++]=this._inverseSceneMatrix[0]*r+this._inverseSceneMatrix[4]*t+this._inverseSceneMatrix[8]*f+this._inverseSceneMatrix[12],this._pVertexConstantData[s++]=this._inverseSceneMatrix[1]*r+this._inverseSceneMatrix[5]*t+this._inverseSceneMatrix[9]*
f+this._inverseSceneMatrix[13],this._pVertexConstantData[s++]=this._inverseSceneMatrix[2]*r+this._inverseSceneMatrix[6]*t+this._inverseSceneMatrix[10]*f+this._inverseSceneMatrix[14]):(this._pVertexConstantData[s++]=f.x,this._pVertexConstantData[s++]=f.y,this._pVertexConstantData[s++]=f.z),this._pVertexConstantData[s++]=1,this._pFragmentConstantData[d++]=a._iDiffuseR,this._pFragmentConstantData[d++]=a._iDiffuseG,this._pFragmentConstantData[d++]=a._iDiffuseB,r=a._pRadius,this._pFragmentConstantData[d++]=
r*r,this._pFragmentConstantData[d++]=a._iSpecularR,this._pFragmentConstantData[d++]=a._iSpecularG,this._pFragmentConstantData[d++]=a._iSpecularB,this._pFragmentConstantData[d++]=a._pFallOffFactor,++g==this._pNumPointLights&&(b=e,n=w);if(this._pNumPointLights>g)for(b=d+12*(g-this._pNumPointLights);d<b;++d)this._pFragmentConstantData[d]=0};a.prototype.pUpdateProbes=function(a){var b=a._iContext3D,d,e=this._pLightPicker.lightProbes,f=this._pLightPicker.lightProbeWeights,g=e.length-this._lightProbesOffset,
w=this.usesProbesForDiffuse(),s=this._pMethodSetup._iSpecularMethod&&this.usesProbesForSpecular();if(w||s){g>this._pNumLightProbes&&(g=this._pNumLightProbes);for(var m=0;m<g;++m)d=e[this._lightProbesOffset+m],w&&b.setTextureAt(this._pLightProbeDiffuseIndices[m],d.diffuseMap.getTextureForStage3D(a)),s&&b.setTextureAt(this._pLightProbeSpecularIndices[m],d.specularMap.getTextureForStage3D(a));for(m=0;m<g;++m)this._pFragmentConstantData[this._pProbeWeightsIndex+m]=f[this._lightProbesOffset+m]}};return a}(b.materials.CompiledPass);
g.LightingPass=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(a){d.call(this,a);this._inverseSceneMatrix=[]}__extends(a,d);a.prototype.pCreateCompiler=function(a){return new b.materials.LightingShaderCompiler(a)};a.prototype.pUpdateLights=function(){d.prototype.pUpdateLights.call(this);var a=0,b=0;this._pLightPicker?(a=0<this._pLightPicker.numCastingPointLights?1:0,b=0<this._pLightPicker.numCastingDirectionalLights?1:0):b=a=0;this._pNumLightProbes=0;if(1<a+b)throw Error("Must have exactly one light!");if(a!=
this._pNumPointLights||b!=this._pNumDirectionalLights)this._pNumPointLights=a,this._pNumDirectionalLights=b,this.iInvalidateShaderProgram()};a.prototype.pUpdateShaderProperties=function(){d.prototype.pUpdateShaderProperties.call(this);this._tangentSpace=this._pCompiler.tangentSpace};a.prototype.pUpdateRegisterIndices=function(){d.prototype.pUpdateRegisterIndices.call(this);this._lightVertexConstantIndex=this._pCompiler.lightVertexConstantIndex};a.prototype.iRender=function(a,b,e,h){a.inverseSceneTransform.copyRawDataTo(this._inverseSceneMatrix);
if(this._tangentSpace&&0<=this._pCameraPositionIndex){var f=e.scenePosition,g=f.x,w=f.y,f=f.z;this._pVertexConstantData[this._pCameraPositionIndex]=this._inverseSceneMatrix[0]*g+this._inverseSceneMatrix[4]*w+this._inverseSceneMatrix[8]*f+this._inverseSceneMatrix[12];this._pVertexConstantData[this._pCameraPositionIndex+1]=this._inverseSceneMatrix[1]*g+this._inverseSceneMatrix[5]*w+this._inverseSceneMatrix[9]*f+this._inverseSceneMatrix[13];this._pVertexConstantData[this._pCameraPositionIndex+2]=this._inverseSceneMatrix[2]*
g+this._inverseSceneMatrix[6]*w+this._inverseSceneMatrix[10]*f+this._inverseSceneMatrix[14]}d.prototype.iRender.call(this,a,b,e,h)};a.prototype.iActivate=function(a,b){d.prototype.iActivate.call(this,a,b);if(!this._tangentSpace&&0<=this._pCameraPositionIndex){var e=b.scenePosition;this._pVertexConstantData[this._pCameraPositionIndex]=e.x;this._pVertexConstantData[this._pCameraPositionIndex+1]=e.y;this._pVertexConstantData[this._pCameraPositionIndex+2]=e.z}};a.prototype.pUpdateLightConstants=function(){var a,
b=0,d=0,e,d=this._lightVertexConstantIndex,b=this._pLightFragmentConstantIndex;if(0<this._pNumDirectionalLights){a=this._pLightPicker.castingDirectionalLights[0];e=a.sceneDirection;this._pAmbientLightR+=a._iAmbientR;this._pAmbientLightG+=a._iAmbientG;this._pAmbientLightB+=a._iAmbientB;if(this._tangentSpace){var f=-e.x,g=-e.y;e=-e.z;this._pVertexConstantData[d++]=this._inverseSceneMatrix[0]*f+this._inverseSceneMatrix[4]*g+this._inverseSceneMatrix[8]*e;this._pVertexConstantData[d++]=this._inverseSceneMatrix[1]*
f+this._inverseSceneMatrix[5]*g+this._inverseSceneMatrix[9]*e;this._pVertexConstantData[d++]=this._inverseSceneMatrix[2]*f+this._inverseSceneMatrix[6]*g+this._inverseSceneMatrix[10]*e;this._pVertexConstantData[d++]=1}else this._pFragmentConstantData[b++]=-e.x,this._pFragmentConstantData[b++]=-e.y,this._pFragmentConstantData[b++]=-e.z,this._pFragmentConstantData[b++]=1;this._pFragmentConstantData[b++]=a._iDiffuseR;this._pFragmentConstantData[b++]=a._iDiffuseG;this._pFragmentConstantData[b++]=a._iDiffuseB;
this._pFragmentConstantData[b++]=1;this._pFragmentConstantData[b++]=a._iSpecularR;this._pFragmentConstantData[b++]=a._iSpecularG;this._pFragmentConstantData[b++]=a._iSpecularB;this._pFragmentConstantData[b++]=1}else 0<this._pNumPointLights&&(a=this._pLightPicker.castingPointLights[0],e=a.scenePosition,this._pAmbientLightR+=a._iAmbientR,this._pAmbientLightG+=a._iAmbientG,this._pAmbientLightB+=a._iAmbientB,this._tangentSpace?(f=e.x,g=e.y,e=e.z,this._pVertexConstantData[d++]=this._inverseSceneMatrix[0]*
f+this._inverseSceneMatrix[4]*g+this._inverseSceneMatrix[8]*e+this._inverseSceneMatrix[12],this._pVertexConstantData[d++]=this._inverseSceneMatrix[1]*f+this._inverseSceneMatrix[5]*g+this._inverseSceneMatrix[9]*e+this._inverseSceneMatrix[13],this._pVertexConstantData[d++]=this._inverseSceneMatrix[2]*f+this._inverseSceneMatrix[6]*g+this._inverseSceneMatrix[10]*e+this._inverseSceneMatrix[14]):(this._pVertexConstantData[d++]=e.x,this._pVertexConstantData[d++]=e.y,this._pVertexConstantData[d++]=e.z),this._pVertexConstantData[d++]=
1,this._pFragmentConstantData[b++]=a._iDiffuseR,this._pFragmentConstantData[b++]=a._iDiffuseG,this._pFragmentConstantData[b++]=a._iDiffuseB,this._pFragmentConstantData[b++]=a._pRadius*a._pRadius,this._pFragmentConstantData[b++]=a._iSpecularR,this._pFragmentConstantData[b++]=a._iSpecularG,this._pFragmentConstantData[b++]=a._iSpecularB,this._pFragmentConstantData[b++]=a._pFallOffFactor)};a.prototype.pUsesProbes=function(){return!1};a.prototype.pUsesLights=function(){return!0};a.prototype.pUpdateProbes=
function(a){};return a}(b.materials.CompiledPass);g.ShadowCasterPass=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(a){d.call(this);this._constants=[0,0,0,0];this._calcMatrix=new b.geom.Matrix3D;this._thickness=a;this._constants[1]=1/255}__extends(a,d);a.prototype.iGetVertexCode=function(){return"m44 vt0, va0, vc8\t\t\t\nm44 vt1, va1, vc8\t\t\t\nsub vt2, vt1, vt0 \t\t\t\nslt vt5.x, vt0.z, vc7.z\t\t\t\nsub vt5.y, vc5.x, vt5.x\t\t\t\nadd vt4.x, vt0.z, vc7.z\t\t\t\nsub vt4.y, vt0.z, vt1.z\t\t\t\nseq vt4.z, vt4.y vc6.x\t\t\t\nadd vt4.y, vt4.y, vt4.z\t\t\t\ndiv vt4.z, vt4.x, vt4.y\t\t\t\nmul vt4.xyz, vt4.zzz, vt2.xyz\t\nadd vt3.xyz, vt0.xyz, vt4.xyz\t\nmov vt3.w, vc5.x\t\t\t\nmul vt0, vt0, vt5.yyyy\t\t\t\nmul vt3, vt3, vt5.xxxx\t\t\t\nadd vt0, vt0, vt3\t\t\t\t\nsub vt2, vt1, vt0 \t\t\t\nnrm vt2.xyz, vt2.xyz\t\t\t\nnrm vt5.xyz, vt0.xyz\t\t\t\nmov vt5.w, vc5.x\t\t\t\t\ncrs vt3.xyz, vt2, vt5\t\t\t\nnrm vt3.xyz, vt3.xyz\t\t\t\nmul vt3.xyz, vt3.xyz, va2.xxx\t\nmov vt3.w, vc5.x\t\t\t\ndp3 vt4.x, vt0, vc6\t\t\t\nmul vt4.x, vt4.x, vc7.x\t\t\t\nmul vt3.xyz, vt3.xyz, vt4.xxx\t\nadd vt0.xyz, vt0.xyz, vt3.xyz\t\nm44 op, vt0, vc0\t\t\t\nmov v0, va3\t\t\t\t\n"};a.prototype.iGetFragmentCode=
function(a){return"mov oc, v0\n"};a.prototype.iRender=function(a,d,e,h){h=d._iContext3D;this._calcMatrix.copyFrom(a.sourceEntity.sceneTransform);this._calcMatrix.append(e.inverseSceneTransform);e=a.iSubSetCount;if(a.hasData)for(var f=0;f<e;++f)a.activateVertexBuffer(f,d),h.setProgramConstantsFromMatrix(b.display3D.Context3DProgramType.VERTEX,8,this._calcMatrix,!0),h.drawTriangles(a.getIndexBuffer(d),0,a.numTriangles)};a.prototype.iActivate=function(c,e){var g=c._iContext3D;d.prototype.iActivate.call(this,
c,e);this._constants[0]=c.scissorRect?this._thickness/Math.min(c.scissorRect.width,c.scissorRect.height):this._thickness/Math.min(c.width,c.height);this._constants[2]=e.lens.near;g.setProgramConstantsFromArray(b.display3D.Context3DProgramType.VERTEX,5,a.pONE_VECTOR,1);g.setProgramConstantsFromArray(b.display3D.Context3DProgramType.VERTEX,6,a.pFRONT_VECTOR,1);g.setProgramConstantsFromArray(b.display3D.Context3DProgramType.VERTEX,7,this._constants,1);g.setProgramConstantsFromMatrix(b.display3D.Context3DProgramType.VERTEX,
0,e.lens.matrix,!0)};a.prototype.pDeactivate=function(a){a=a._iContext3D;a.setVertexBufferAt(0,null);a.setVertexBufferAt(1,null);a.setVertexBufferAt(2,null);a.setVertexBufferAt(3,null)};a.pONE_VECTOR=[1,1,1,1];a.pFRONT_VECTOR=[0,0,-1,0];return a}(g.MaterialPassBase);g.SegmentPass=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this.mipmap=!1;this._pNumUsedTextures=1;this._vertexData=[0,0,0,0,1,1,1,1]}__extends(a,d);Object.defineProperty(a.prototype,"cubeTexture",{get:function(){return this._cubeTexture},set:function(a){this._cubeTexture=a},enumerable:!0,configurable:!0});a.prototype.iGetVertexCode=function(){return"mul vt0, va0, vc5\t\t\nadd vt0, vt0, vc4\t\t\nm44 op, vt0, vc0\t\t\nmov v0, va0\n"};a.prototype.iGetFragmentCode=function(a){switch(this._cubeTexture.format){case b.display3D.Context3DTextureFormat.COMPRESSED:a=
"dxt1,";break;case "compressedAlpha":a="dxt5,";break;default:a=""}var d=",mipnone";this._cubeTexture.hasMipMaps&&(d=",miplinear");return"tex ft0, v0, fs0 <cube,"+a+"linear,clamp"+d+">\t\nmov oc, ft0\t\t\t\t\t\t\t\n"};a.prototype.iRender=function(a,d,e,h){var f=d._iContext3D,g=e.scenePosition;this._vertexData[0]=g.x;this._vertexData[1]=g.y;this._vertexData[2]=g.z;this._vertexData[4]=this._vertexData[5]=this._vertexData[6]=e.lens.far/Math.sqrt(3);f.setProgramConstantsFromMatrix(b.display3D.Context3DProgramType.VERTEX,
0,h,!0);f.setProgramConstantsFromArray(b.display3D.Context3DProgramType.VERTEX,4,this._vertexData,2);a.activateVertexBuffer(0,d);f.drawTriangles(a.getIndexBuffer(d),0,a.numTriangles)};a.prototype.iActivate=function(a,e){d.prototype.iActivate.call(this,a,e);var g=a._iContext3D;g.setDepthTest(!1,b.display3D.Context3DCompareMode.LESS);g.setTextureAt(0,this._cubeTexture.getTextureForStage3D(a))};return a}(b.materials.MaterialPassBase);g.SkyBoxPass=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._alphaBlending=!1;this.pAddPass(this._pScreenPass=new b.materials.SuperShaderPass(this))}__extends(a,d);Object.defineProperty(a.prototype,"enableLightFallOff",{get:function(){return this._pScreenPass.enableLightFallOff},set:function(a){this._pScreenPass.enableLightFallOff=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"alphaThreshold",{get:function(){return this._pScreenPass.diffuseMethod.alphaThreshold},
set:function(a){this._pScreenPass.diffuseMethod.alphaThreshold=a;this._pDepthPass.alphaThreshold=a;this._pDistancePass.alphaThreshold=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"blendMode",{set:function(a){d.prototype.setBlendMode.call(this,a);this._pScreenPass.setBlendMode(this._pBlendMode==b.display.BlendMode.NORMAL&&this.requiresBlending?b.display.BlendMode.LAYER:this._pBlendMode)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"depthCompareMode",{set:function(a){this._pDepthCompareMode=
a;this._pScreenPass.depthCompareMode=a},enumerable:!0,configurable:!0});a.prototype.iActivateForDepth=function(a,b,e){"undefined"===typeof e&&(e=!1);e?this._pDistancePass.alphaMask=this._pScreenPass.diffuseMethod.texture:this._pDepthPass.alphaMask=this._pScreenPass.diffuseMethod.texture;d.prototype.iActivateForDepth.call(this,a,b,e)};Object.defineProperty(a.prototype,"specularLightSources",{get:function(){return this._pScreenPass.specularLightSources},set:function(a){this._pScreenPass.specularLightSources=
a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"diffuseLightSources",{get:function(){return this._pScreenPass.diffuseLightSources},set:function(a){this._pScreenPass.diffuseLightSources=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"requiresBlending",{get:function(){return this.getRequiresBlending()},enumerable:!0,configurable:!0});a.prototype.getRequiresBlending=function(){var a=this._pScreenPass.colorTransform;return a?this._pBlendMode!=b.display.BlendMode.NORMAL||
this._alphaBlending||1>a.alphaMultiplier:this._pBlendMode!=b.display.BlendMode.NORMAL||this._alphaBlending};Object.defineProperty(a.prototype,"colorTransform",{get:function(){return this._pScreenPass.colorTransform},set:function(a){this.setColorTransform(a)},enumerable:!0,configurable:!0});a.prototype.setColorTransform=function(a){this._pScreenPass.colorTransform=a};Object.defineProperty(a.prototype,"ambientMethod",{get:function(){return this._pScreenPass.ambientMethod},set:function(a){this._pScreenPass.ambientMethod=
a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"shadowMethod",{get:function(){return this._pScreenPass.shadowMethod},set:function(a){this._pScreenPass.shadowMethod=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"diffuseMethod",{get:function(){return this._pScreenPass.diffuseMethod},set:function(a){this._pScreenPass.diffuseMethod=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"normalMethod",{get:function(){return this._pScreenPass.normalMethod},
set:function(a){this._pScreenPass.normalMethod=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"specularMethod",{get:function(){return this._pScreenPass.specularMethod},set:function(a){this._pScreenPass.specularMethod=a},enumerable:!0,configurable:!0});a.prototype.addMethod=function(a){this._pScreenPass.addMethod(a)};Object.defineProperty(a.prototype,"numMethods",{get:function(){return this._pScreenPass.numMethods},enumerable:!0,configurable:!0});a.prototype.hasMethod=function(a){return this._pScreenPass.hasMethod(a)};
a.prototype.getMethodAt=function(a){return this._pScreenPass.getMethodAt(a)};a.prototype.addMethodAt=function(a,b){this._pScreenPass.addMethodAt(a,b)};a.prototype.removeMethod=function(a){this._pScreenPass.removeMethod(a)};Object.defineProperty(a.prototype,"mipmap",{set:function(a){this._pMipmap!=a&&this.setMipMap(a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"normalMap",{get:function(){return this._pScreenPass.normalMap},set:function(a){this._pScreenPass.normalMap=a},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"specularMap",{get:function(){return this._pScreenPass.specularMethod.texture},set:function(a){if(this._pScreenPass.specularMethod)this._pScreenPass.specularMethod.texture=a;else throw new b.errors.Error("No specular method was set to assign the specularGlossMap to");},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"gloss",{get:function(){return this._pScreenPass.specularMethod?this._pScreenPass.specularMethod.gloss:0},set:function(a){this._pScreenPass.specularMethod&&
(this._pScreenPass.specularMethod.gloss=a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"ambient",{get:function(){return this._pScreenPass.ambientMethod.ambient},set:function(a){this._pScreenPass.ambientMethod.ambient=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"specular",{get:function(){return this._pScreenPass.specularMethod?this._pScreenPass.specularMethod.specular:0},set:function(a){this._pScreenPass.specularMethod&&(this._pScreenPass.specularMethod.specular=
a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"ambientColor",{get:function(){return this._pScreenPass.ambientMethod.ambientColor},set:function(a){this._pScreenPass.ambientMethod.ambientColor=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"specularColor",{get:function(){return this._pScreenPass.specularMethod.specularColor},set:function(a){this._pScreenPass.specularMethod.specularColor=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"alphaBlending",{get:function(){return this._alphaBlending},set:function(a){this._alphaBlending=a;this._pScreenPass.setBlendMode(this.getBlendMode()==b.display.BlendMode.NORMAL&&this.requiresBlending?b.display.BlendMode.LAYER:this.getBlendMode());this._pScreenPass.preserveAlpha=this.requiresBlending},enumerable:!0,configurable:!0});a.prototype.iUpdateMaterial=function(a){if(this._pScreenPass._iPassesDirty){this.pClearPasses();if(this._pScreenPass._iPasses){a=this._pScreenPass._iPasses.length;for(var b=
0;b<a;++b)this.pAddPass(this._pScreenPass._iPasses[b])}this.pAddPass(this._pScreenPass);this._pScreenPass._iPassesDirty=!1}};Object.defineProperty(a.prototype,"lightPicker",{set:function(a){d.prototype.setLightPicker.call(this,a);this._pScreenPass.lightPicker=a},enumerable:!0,configurable:!0});return a}(b.materials.MaterialBase);g.SinglePassMaterialBase=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._alphaThreshold=0;this._specularLightSources=1;this._diffuseLightSources=3;this._ambientMethod=new b.materials.BasicAmbientMethod;this._diffuseMethod=new b.materials.BasicDiffuseMethod;this._normalMethod=new b.materials.BasicNormalMethod;this._specularMethod=new b.materials.BasicSpecularMethod;this._enableLightFallOff=this._screenPassesInvalid=!0}__extends(a,d);Object.defineProperty(a.prototype,"enableLightFallOff",{get:function(){return this._enableLightFallOff},
set:function(a){this._enableLightFallOff!=a&&this.pInvalidateScreenPasses();this._enableLightFallOff=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"alphaThreshold",{get:function(){return this._alphaThreshold},set:function(a){this._alphaThreshold=a;this._diffuseMethod.alphaThreshold=a;this._pDepthPass.alphaThreshold=a;this._pDistancePass.alphaThreshold=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"depthCompareMode",{set:function(a){d.prototype.setDepthCompareMode.call(this,
a);this.pInvalidateScreenPasses()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"blendMode",{set:function(a){d.prototype.setBlendMode.call(this,a);this.pInvalidateScreenPasses()},enumerable:!0,configurable:!0});a.prototype.iActivateForDepth=function(a,b,e){"undefined"===typeof e&&(e=!1);e?this._pDistancePass.alphaMask=this._diffuseMethod.texture:this._pDepthPass.alphaMask=this._diffuseMethod.texture;d.prototype.iActivateForDepth.call(this,a,b,e)};Object.defineProperty(a.prototype,
"specularLightSources",{get:function(){return this._specularLightSources},set:function(a){this._specularLightSources=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"diffuseLightSources",{get:function(){return this._diffuseLightSources},set:function(a){this._diffuseLightSources=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"lightPicker",{set:function(a){this._pLightPicker&&this._pLightPicker.removeEventListener(b.events.Event.CHANGE,this.onLightsChange,
this);d.prototype.setLightPicker.call(this,a);this._pLightPicker&&this._pLightPicker.addEventListener(b.events.Event.CHANGE,this.onLightsChange,this);this.pInvalidateScreenPasses()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"requiresBlending",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"ambientMethod",{get:function(){return this._ambientMethod},set:function(a){a.copyFrom(this._ambientMethod);this._ambientMethod=a;this.pInvalidateScreenPasses()},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"shadowMethod",{get:function(){return this._shadowMethod},set:function(a){a&&this._shadowMethod&&a.copyFrom(this._shadowMethod);this._shadowMethod=a;this.pInvalidateScreenPasses()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"diffuseMethod",{get:function(){return this._diffuseMethod},set:function(a){a.copyFrom(this._diffuseMethod);this._diffuseMethod=a;this.pInvalidateScreenPasses()},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"specularMethod",{get:function(){return this._specularMethod},set:function(a){a&&this._specularMethod&&a.copyFrom(this._specularMethod);this._specularMethod=a;this.pInvalidateScreenPasses()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"normalMethod",{get:function(){return this._normalMethod},set:function(a){a.copyFrom(this._normalMethod);this._normalMethod=a;this.pInvalidateScreenPasses()},enumerable:!0,configurable:!0});a.prototype.addMethod=
function(a){null==this._pEffectsPass&&(this._pEffectsPass=new b.materials.SuperShaderPass(this));this._pEffectsPass.addMethod(a);this.pInvalidateScreenPasses()};Object.defineProperty(a.prototype,"numMethods",{get:function(){return this._pEffectsPass?this._pEffectsPass.numMethods:0},enumerable:!0,configurable:!0});a.prototype.hasMethod=function(a){return this._pEffectsPass?this._pEffectsPass.hasMethod(a):!1};a.prototype.getMethodAt=function(a){return this._pEffectsPass.getMethodAt(a)};a.prototype.addMethodAt=
function(a,d){null==this._pEffectsPass&&(this._pEffectsPass=new b.materials.SuperShaderPass(this));this._pEffectsPass.addMethodAt(a,d);this.pInvalidateScreenPasses()};a.prototype.removeMethod=function(a){this._pEffectsPass||(this._pEffectsPass.removeMethod(a),0==this._pEffectsPass.numMethods&&this.pInvalidateScreenPasses())};Object.defineProperty(a.prototype,"mipmap",{set:function(a){this._pMipmap!=a&&d.prototype.setMipMap.call(this,a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"normalMap",{get:function(){return this._normalMethod.normalMap},set:function(a){this._normalMethod.normalMap=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"specularMap",{get:function(){return this._specularMethod.texture},set:function(a){if(this._specularMethod)this._specularMethod.texture=a;else throw Error("No specular method was set to assign the specularGlossMap to");},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"gloss",{get:function(){return this._specularMethod?
this._specularMethod.gloss:0},set:function(a){this._specularMethod&&(this._specularMethod.gloss=a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"ambient",{get:function(){return this._ambientMethod.ambient},set:function(a){this._ambientMethod.ambient=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"specular",{get:function(){return this._specularMethod?this._specularMethod.specular:0},set:function(a){this._specularMethod&&(this._specularMethod.specular=a)},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"ambientColor",{get:function(){return this._ambientMethod.ambientColor},set:function(a){this._ambientMethod.ambientColor=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"specularColor",{get:function(){return this._specularMethod.specularColor},set:function(a){this._specularMethod.specularColor=a},enumerable:!0,configurable:!0});a.prototype.iUpdateMaterial=function(a){var b;this._screenPassesInvalid&&(this.pUpdateScreenPasses(),
b=!0);if(b||this.isAnyScreenPassInvalid()){this.pClearPasses();this.addChildPassesFor(this._casterLightPass);if(this._nonCasterLightPasses)for(a=0;a<this._nonCasterLightPasses.length;++a)this.addChildPassesFor(this._nonCasterLightPasses[a]);this.addChildPassesFor(this._pEffectsPass);this.addScreenPass(this._casterLightPass);if(this._nonCasterLightPasses)for(a=0;a<this._nonCasterLightPasses.length;++a)this.addScreenPass(this._nonCasterLightPasses[a]);this.addScreenPass(this._pEffectsPass)}};a.prototype.addScreenPass=
function(a){a&&(this.pAddPass(a),a._iPassesDirty=!1)};a.prototype.isAnyScreenPassInvalid=function(){if(this._casterLightPass&&this._casterLightPass._iPassesDirty||this._pEffectsPass&&this._pEffectsPass._iPassesDirty)return!0;if(this._nonCasterLightPasses)for(var a=0;a<this._nonCasterLightPasses.length;++a)if(this._nonCasterLightPasses[a]._iPassesDirty)return!0;return!1};a.prototype.addChildPassesFor=function(a){if(a&&a._iPasses)for(var b=a._iPasses.length,d=0;d<b;++d)this.pAddPass(a._iPasses[d])};
a.prototype.iActivatePass=function(a,e,g){0==a&&e._iContext3D.setBlendFactors(b.display3D.Context3DBlendFactor.ONE,b.display3D.Context3DBlendFactor.ZERO);d.prototype.iActivatePass.call(this,a,e,g)};a.prototype.iDeactivate=function(a){d.prototype.iDeactivate.call(this,a);a._iContext3D.setBlendFactors(b.display3D.Context3DBlendFactor.ONE,b.display3D.Context3DBlendFactor.ZERO)};a.prototype.pUpdateScreenPasses=function(){this.initPasses();this.setBlendAndCompareModes();this._screenPassesInvalid=!1};a.prototype.initPasses=
function(){0==this.numLights||0<this.numMethods?this.initEffectsPass():this._pEffectsPass&&0==this.numMethods&&this.removeEffectsPass();this._shadowMethod?this.initCasterLightPass():this.removeCasterLightPass();0<this.numNonCasters?this.initNonCasterLightPasses():this.removeNonCasterLightPasses()};a.prototype.setBlendAndCompareModes=function(){var a=this._casterLightPass||this._pEffectsPass;this._casterLightPass&&(this._casterLightPass.setBlendMode(b.display.BlendMode.NORMAL),this._casterLightPass.depthCompareMode=
this._pDepthCompareMode,this._casterLightPass.forceSeparateMVP=a);if(this._nonCasterLightPasses){var d=0;this._casterLightPass||(this._nonCasterLightPasses[0].forceSeparateMVP=a,this._nonCasterLightPasses[0].setBlendMode(b.display.BlendMode.NORMAL),this._nonCasterLightPasses[0].depthCompareMode=this._pDepthCompareMode,d=1);for(;d<this._nonCasterLightPasses.length;++d)this._nonCasterLightPasses[d].forceSeparateMVP=a,this._nonCasterLightPasses[d].setBlendMode(b.display.BlendMode.ADD),this._nonCasterLightPasses[d].depthCompareMode=
b.display3D.Context3DCompareMode.LESS_EQUAL}this._casterLightPass||this._nonCasterLightPasses?this._pEffectsPass&&(this._pEffectsPass.iIgnoreLights=!0,this._pEffectsPass.depthCompareMode=b.display3D.Context3DCompareMode.LESS_EQUAL,this._pEffectsPass.setBlendMode(b.display.BlendMode.LAYER),this._pEffectsPass.forceSeparateMVP=a):this._pEffectsPass&&(this._pEffectsPass.iIgnoreLights=!1,this._pEffectsPass.depthCompareMode=this._pDepthCompareMode,this.depthCompareMode,this._pEffectsPass.setBlendMode(b.display.BlendMode.NORMAL),
this._pEffectsPass.forceSeparateMVP=!1)};a.prototype.initCasterLightPass=function(){null==this._casterLightPass&&(this._casterLightPass=new b.materials.ShadowCasterPass(this));this._casterLightPass.diffuseMethod=null;this._casterLightPass.ambientMethod=null;this._casterLightPass.normalMethod=null;this._casterLightPass.specularMethod=null;this._casterLightPass.shadowMethod=null;this._casterLightPass.enableLightFallOff=this._enableLightFallOff;this._casterLightPass.lightPicker=new b.materials.StaticLightPicker([this._shadowMethod.castingLight]);
this._casterLightPass.shadowMethod=this._shadowMethod;this._casterLightPass.diffuseMethod=this._diffuseMethod;this._casterLightPass.ambientMethod=this._ambientMethod;this._casterLightPass.normalMethod=this._normalMethod;this._casterLightPass.specularMethod=this._specularMethod;this._casterLightPass.diffuseLightSources=this._diffuseLightSources;this._casterLightPass.specularLightSources=this._specularLightSources};a.prototype.removeCasterLightPass=function(){this._casterLightPass&&(this._casterLightPass.dispose(),
this.pRemovePass(this._casterLightPass),this._casterLightPass=null)};a.prototype.initNonCasterLightPasses=function(){this.removeNonCasterLightPasses();var a,b=this._pLightPicker.numDirectionalLights,d=this._pLightPicker.numPointLights,e=this._pLightPicker.numLightProbes,f=0,l=0,w=0;this._casterLightPass||(b+=this._pLightPicker.numCastingDirectionalLights,d+=this._pLightPicker.numCastingPointLights);for(this._nonCasterLightPasses=[];f<b||l<d||w<e;)a=new g.LightingPass(this),a.enableLightFallOff=this._enableLightFallOff,
a.includeCasters=null==this._shadowMethod,a.directionalLightsOffset=f,a.pointLightsOffset=l,a.lightProbesOffset=w,a.diffuseMethod=null,a.ambientMethod=null,a.normalMethod=null,a.specularMethod=null,a.lightPicker=this._pLightPicker,a.diffuseMethod=this._diffuseMethod,a.ambientMethod=this._ambientMethod,a.normalMethod=this._normalMethod,a.specularMethod=this._specularMethod,a.diffuseLightSources=this._diffuseLightSources,a.specularLightSources=this._specularLightSources,this._nonCasterLightPasses.push(a),
f+=a.iNumDirectionalLights,l+=a.iNumPointLights,w+=a.iNumLightProbes};a.prototype.removeNonCasterLightPasses=function(){if(this._nonCasterLightPasses){for(var a=0;a<this._nonCasterLightPasses.length;++a)this.pRemovePass(this._nonCasterLightPasses[a]),this._nonCasterLightPasses[a].dispose();this._nonCasterLightPasses=null}};a.prototype.removeEffectsPass=function(){this._pEffectsPass.diffuseMethod!=this._diffuseMethod&&this._pEffectsPass.diffuseMethod.dispose();this.pRemovePass(this._pEffectsPass);
this._pEffectsPass.dispose();this._pEffectsPass=null};a.prototype.initEffectsPass=function(){null==this._pEffectsPass&&(this._pEffectsPass=new b.materials.SuperShaderPass(this));this._pEffectsPass.enableLightFallOff=this._enableLightFallOff;0==this.numLights?(this._pEffectsPass.diffuseMethod=null,this._pEffectsPass.diffuseMethod=this._diffuseMethod):(this._pEffectsPass.diffuseMethod=null,this._pEffectsPass.diffuseMethod=new b.materials.BasicDiffuseMethod,this._pEffectsPass.diffuseMethod.diffuseColor=
0,this._pEffectsPass.diffuseMethod.diffuseAlpha=0);this._pEffectsPass.preserveAlpha=!1;this._pEffectsPass.normalMethod=null;this._pEffectsPass.normalMethod=this._normalMethod;return this._pEffectsPass};Object.defineProperty(a.prototype,"numLights",{get:function(){return this._pLightPicker?this._pLightPicker.numLightProbes+this._pLightPicker.numDirectionalLights+this._pLightPicker.numPointLights+this._pLightPicker.numCastingDirectionalLights+this._pLightPicker.numCastingPointLights:0},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"numNonCasters",{get:function(){return this._pLightPicker?this._pLightPicker.numLightProbes+this._pLightPicker.numDirectionalLights+this._pLightPicker.numPointLights:0},enumerable:!0,configurable:!0});a.prototype.pInvalidateScreenPasses=function(){this._screenPassesInvalid=!0};a.prototype.onLightsChange=function(a){this.pInvalidateScreenPasses()};return a}(b.materials.MaterialBase);g.MultiPassMaterialBase=e})(b.materials||(b.materials={}))})(away||
(away={}));
(function(b){(function(g){var e=function(b){function a(a,e,g,h){"undefined"===typeof a&&(a=null);"undefined"===typeof e&&(e=!0);"undefined"===typeof g&&(g=!1);"undefined"===typeof h&&(h=!0);b.call(this);this._animateUVs=!1;this.texture=a;this.smooth=e;this.repeat=g;this.mipmap=h}__extends(a,b);Object.defineProperty(a.prototype,"animateUVs",{get:function(){return this._animateUVs},set:function(a){this._animateUVs=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"texture",{get:function(){return this.diffuseMethod.texture},
set:function(a){this.diffuseMethod.texture=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"ambientTexture",{get:function(){return this.ambientMethod.texture},set:function(a){this.ambientMethod.texture=a;this.diffuseMethod.iUseAmbientTexture=null!=a},enumerable:!0,configurable:!0});a.prototype.pUpdateScreenPasses=function(){b.prototype.pUpdateScreenPasses.call(this);this._pEffectsPass&&(this._pEffectsPass.animateUVs=this._animateUVs)};return a}(b.materials.MultiPassMaterialBase);
g.TextureMultiPassMaterial=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(a){"undefined"===typeof a&&(a=13421772);b.call(this);this.color=a}__extends(a,b);Object.defineProperty(a.prototype,"color",{get:function(){return this.diffuseMethod.diffuseColor},set:function(a){this.diffuseMethod.diffuseColor=a},enumerable:!0,configurable:!0});return a}(b.materials.MultiPassMaterialBase);g.ColorMultiPassMaterial=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(){this.useLightFallOff=!0}b.prototype.reset=function(){this.fragmentConstantsIndex=this.vertexConstantsIndex=this.texturesIndex=-1;this.useSmoothTextures=this.useMipmapping=!0;this.needsGlobalFragmentPos=this.needsGlobalVertexPos=this.needsSecondaryUV=this.needsUV=this.needsTangents=this.needsNormals=this.needsView=this.needsProjection=this.repeatTextures=!1;this.numLights=0;this.useLightFallOff=!0};return b}();b.MethodVO=e})(b.materials||(b.materials=
{}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this)}__extends(a,d);a.prototype.iInitVO=function(a){};a.prototype.iInitConstants=function(a){};Object.defineProperty(a.prototype,"iSharedRegisters",{get:function(){return this._sharedRegisters},set:function(a){this._sharedRegisters=a},enumerable:!0,configurable:!0});a.prototype.setISharedRegisters=function(a){this._sharedRegisters=a};Object.defineProperty(a.prototype,"passes",{get:function(){return this._passes},enumerable:!0,configurable:!0});
a.prototype.dispose=function(){};a.prototype.iCreateMethodVO=function(){return new b.materials.MethodVO};a.prototype.iReset=function(){this.iCleanCompilationData()};a.prototype.iCleanCompilationData=function(){};a.prototype.iGetVertexCode=function(a,b){return""};a.prototype.iActivate=function(a,b){};a.prototype.iSetRenderState=function(a,b,d,e){};a.prototype.iDeactivate=function(a,b){};a.prototype.pGetTex2DSampleCode=function(a,b,d,e,f,g){"undefined"===typeof f&&(f=null);"undefined"===typeof g&&(g=
null);g=g||(a.repeatTextures?"wrap":"clamp");var w=this.getFormatStringForTexture(e);e=a.useMipmapping&&e.hasMipMaps;a=a.useSmoothTextures?e?"linear,miplinear":"linear":e?"nearest,mipnearest":"nearest";null==f&&(f=this._sharedRegisters.uvVarying);return"tex "+b.toString()+", "+f.toString()+", "+d.toString()+" <2d,"+a+","+w+g+">\n"};a.prototype.pGetTexCubeSampleCode=function(a,b,d,e,f){var g=this.getFormatStringForTexture(e);e=a.useMipmapping&&e.hasMipMaps;return"tex "+b.toString()+", "+f.toString()+
", "+d.toString()+" <cube,"+g+(a.useSmoothTextures?e?"linear,miplinear":"linear":e?"nearest,mipnearest":"nearest")+">\n"};a.prototype.getFormatStringForTexture=function(a){switch(a.format){case b.display3D.Context3DTextureFormat.COMPRESSED:return"dxt1,";case "compressedAlpha":return"dxt5,";default:return""}};a.prototype.iInvalidateShaderProgram=function(){this.dispatchEvent(new b.events.ShadingMethodEvent(b.events.ShadingMethodEvent.SHADER_INVALIDATED))};a.prototype.copyFrom=function(a){};return a}(b.library.NamedAssetBase);
g.ShadingMethodBase=e})(b.materials||(b.materials={}))})(away||(away={}));(function(b){(function(g){var e=function(d){function a(){d.call(this)}__extends(a,d);Object.defineProperty(a.prototype,"assetType",{get:function(){return b.library.AssetType.EFFECTS_METHOD},enumerable:!0,configurable:!0});a.prototype.iGetFragmentCode=function(a,d,e){throw new b.errors.AbstractMethodError;};return a}(b.materials.ShadingMethodBase);g.EffectMethodBase=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(b){var e=function(){return function(b){this.method=b;this.data=b.iCreateMethodVO()}}();b.MethodVOSet=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._iMethods=[];this._iNormalMethod=new b.materials.BasicNormalMethod;this._iAmbientMethod=new b.materials.BasicAmbientMethod;this._iDiffuseMethod=new b.materials.BasicDiffuseMethod;this._iSpecularMethod=new b.materials.BasicSpecularMethod;this._iNormalMethod.addEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,this.onShaderInvalidated,this);this._iDiffuseMethod.addEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,
this.onShaderInvalidated,this);this._iSpecularMethod.addEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,this.onShaderInvalidated,this);this._iAmbientMethod.addEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,this.onShaderInvalidated,this);this._iNormalMethodVO=this._iNormalMethod.iCreateMethodVO();this._iAmbientMethodVO=this._iAmbientMethod.iCreateMethodVO();this._iDiffuseMethodVO=this._iDiffuseMethod.iCreateMethodVO();this._iSpecularMethodVO=this._iSpecularMethod.iCreateMethodVO()}
__extends(a,d);a.prototype.onShaderInvalidated=function(a){this.invalidateShaderProgram()};a.prototype.invalidateShaderProgram=function(){this.dispatchEvent(new b.events.ShadingMethodEvent(b.events.ShadingMethodEvent.SHADER_INVALIDATED))};Object.defineProperty(a.prototype,"normalMethod",{get:function(){return this._iNormalMethod},set:function(a){this._iNormalMethod&&this._iNormalMethod.removeEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,this.onShaderInvalidated,this);a&&(this._iNormalMethod&&
a.copyFrom(this._iNormalMethod),this._iNormalMethodVO=a.iCreateMethodVO(),a.addEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,this.onShaderInvalidated,this));(this._iNormalMethod=a)&&this.invalidateShaderProgram()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"ambientMethod",{get:function(){return this._iAmbientMethod},set:function(a){this._iAmbientMethod&&this._iAmbientMethod.removeEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,this.onShaderInvalidated,
this);a&&(this._iAmbientMethod&&a.copyFrom(this._iAmbientMethod),a.addEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,this.onShaderInvalidated,this),this._iAmbientMethodVO=a.iCreateMethodVO());(this._iAmbientMethod=a)&&this.invalidateShaderProgram()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"shadowMethod",{get:function(){return this._iShadowMethod},set:function(a){this._iShadowMethod&&this._iShadowMethod.removeEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,
this.onShaderInvalidated,this);(this._iShadowMethod=a)?(this._iShadowMethod.addEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,this.onShaderInvalidated,this),this._iShadowMethodVO=this._iShadowMethod.iCreateMethodVO()):this._iShadowMethodVO=null;this.invalidateShaderProgram()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"diffuseMethod",{get:function(){return this._iDiffuseMethod},set:function(a){this._iDiffuseMethod&&this._iDiffuseMethod.removeEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,
this.onShaderInvalidated,this);a&&(this._iDiffuseMethod&&a.copyFrom(this._iDiffuseMethod),a.addEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,this.onShaderInvalidated,this),this._iDiffuseMethodVO=a.iCreateMethodVO());(this._iDiffuseMethod=a)&&this.invalidateShaderProgram()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"specularMethod",{get:function(){return this._iSpecularMethod},set:function(a){this._iSpecularMethod&&(this._iSpecularMethod.removeEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,
this.onShaderInvalidated,this),a&&a.copyFrom(this._iSpecularMethod));(this._iSpecularMethod=a)?(this._iSpecularMethod.addEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,this.onShaderInvalidated,this),this._iSpecularMethodVO=this._iSpecularMethod.iCreateMethodVO()):this._iSpecularMethodVO=null;this.invalidateShaderProgram()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"iColorTransformMethod",{get:function(){return this._iColorTransformMethod},set:function(a){this._iColorTransformMethod!=
a&&(this._iColorTransformMethod&&this._iColorTransformMethod.removeEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,this.onShaderInvalidated,this),this._iColorTransformMethod&&a||this.invalidateShaderProgram(),(this._iColorTransformMethod=a)?(this._iColorTransformMethod.addEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,this.onShaderInvalidated,this),this._iColorTransformMethodVO=this._iColorTransformMethod.iCreateMethodVO()):this._iColorTransformMethodVO=null)},enumerable:!0,
configurable:!0});a.prototype.dispose=function(){this.clearListeners(this._iNormalMethod);this.clearListeners(this._iDiffuseMethod);this.clearListeners(this._iShadowMethod);this.clearListeners(this._iAmbientMethod);this.clearListeners(this._iSpecularMethod);for(var a=0;a<this._iMethods.length;++a)this.clearListeners(this._iMethods[a].method);this._iMethods=null};a.prototype.clearListeners=function(a){a&&a.removeEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,this.onShaderInvalidated,
this)};a.prototype.addMethod=function(a){this._iMethods.push(new b.materials.MethodVOSet(a));a.addEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,this.onShaderInvalidated,this);this.invalidateShaderProgram()};a.prototype.hasMethod=function(a){return null!=this.getMethodSetForMethod(a)};a.prototype.addMethodAt=function(a,d){this._iMethods.splice(d,0,new b.materials.MethodVOSet(a));a.addEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,this.onShaderInvalidated,this);this.invalidateShaderProgram()};
a.prototype.getMethodAt=function(a){return a>this._iMethods.length-1?null:this._iMethods[a].method};Object.defineProperty(a.prototype,"numMethods",{get:function(){return this._iMethods.length},enumerable:!0,configurable:!0});a.prototype.removeMethod=function(a){var d=this.getMethodSetForMethod(a);null!=d&&(d=this._iMethods.indexOf(d),this._iMethods.splice(d,1),a.removeEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,this.onShaderInvalidated,this),this.invalidateShaderProgram())};a.prototype.getMethodSetForMethod=
function(a){for(var b=this._iMethods.length,d=0;d<b;++d)if(this._iMethods[d].method==a)return this._iMethods[d];return null};return a}(b.events.EventDispatcher);g.ShaderMethodSetup=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(){b.call(this)}__extends(a,b);a.prototype.iGetFragmentPreLightingCode=function(a,b){return""};a.prototype.iGetFragmentCodePerLight=function(a,b,d,e){return""};a.prototype.iGetFragmentCodePerProbe=function(a,b,d,e){return""};a.prototype.iGetFragmentPostLightingCode=function(a,b,d){return""};return a}(b.materials.ShadingMethodBase);g.LightingMethodBase=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(a){d.call(this);this._epsilon=0.02;this._alpha=1;this._castingLight=a;a.castsShadows=!0;this._shadowMapper=a.shadowMapper}__extends(a,d);Object.defineProperty(a.prototype,"assetType",{get:function(){return b.library.AssetType.SHADOW_MAP_METHOD},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"alpha",{get:function(){return this._alpha},set:function(a){this._alpha=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"castingLight",{get:function(){return this._castingLight},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"epsilon",{get:function(){return this._epsilon},set:function(a){this._epsilon=a},enumerable:!0,configurable:!0});a.prototype.iGetFragmentCode=function(a,d,e){throw new b.errors.AbstractMethodError;};return a}(b.materials.ShadingMethodBase);g.ShadowMapMethodBase=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(a,b,e,h){"undefined"===typeof a&&(a=null);"undefined"===typeof b&&(b=!0);"undefined"===typeof e&&(e=!1);"undefined"===typeof h&&(h=!1);d.call(this);this.texture=a;this.smooth=b;this.repeat=e;this.mipmap=h}__extends(a,d);Object.defineProperty(a.prototype,"animateUVs",{get:function(){return this._pScreenPass.animateUVs},set:function(a){this._pScreenPass.animateUVs=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"alpha",{get:function(){return this._pScreenPass.colorTransform?
this._pScreenPass.colorTransform.alphaMultiplier:1},set:function(a){1<a?a=1:0>a&&(a=0);null==this.colorTransform&&(this.colorTransform=new b.geom.ColorTransform);this.colorTransform.alphaMultiplier=a;this._pScreenPass.preserveAlpha=this.getRequiresBlending();this._pScreenPass.setBlendMode(this.getBlendMode()==b.display.BlendMode.NORMAL&&this.getRequiresBlending()?b.display.BlendMode.LAYER:this.getBlendMode())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"texture",{get:function(){return this._pScreenPass.diffuseMethod.texture},
set:function(a){this._pScreenPass.diffuseMethod.texture=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"ambientTexture",{get:function(){return this._pScreenPass.ambientMethod.texture},set:function(a){this._pScreenPass.ambientMethod.texture=a;this._pScreenPass.diffuseMethod.iUseAmbientTexture=null!=a},enumerable:!0,configurable:!0});return a}(b.materials.SinglePassMaterialBase);g.TextureMaterial=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._pNumLightProbes=this._pNumCastingDirectionalLights=this._pNumCastingPointLights=this._pNumDirectionalLights=this._pNumPointLights=0}__extends(a,d);a.prototype.dispose=function(){};Object.defineProperty(a.prototype,"assetType",{get:function(){return b.library.AssetType.LIGHT_PICKER},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"numDirectionalLights",{get:function(){return this._pNumDirectionalLights},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"numPointLights",{get:function(){return this._pNumPointLights},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"numCastingDirectionalLights",{get:function(){return this._pNumCastingDirectionalLights},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"numCastingPointLights",{get:function(){return this._pNumCastingPointLights},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"numLightProbes",{get:function(){return this._pNumLightProbes},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"pointLights",{get:function(){return this._pPointLights},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"directionalLights",{get:function(){return this._pDirectionalLights},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"castingPointLights",{get:function(){return this._pCastingPointLights},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"castingDirectionalLights",{get:function(){return this._pCastingDirectionalLights},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"lightProbes",{get:function(){return this._pLightProbes},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"lightProbeWeights",{get:function(){return this._pLightProbeWeights},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"allPickedLights",{get:function(){return this._pAllPickedLights},enumerable:!0,configurable:!0});a.prototype.collectLights=function(a,b){this.updateProbeWeights(a)};a.prototype.updateProbeWeights=
function(a){var b=a.sourceEntity.scenePosition,d;a=b.x;var e=b.y,b=b.z,f,g,w=0,s;for(s=0;s<this._pNumLightProbes;++s)d=this._pLightProbes[s].scenePosition,f=a-d.x,g=e-d.y,d=b-d.z,f=f*f+g*g+d*d,f=1E-5<f?1/f:5E7,this._pLightProbeWeights[s]=f,w+=f;w=1/w;for(s=0;s<this._pNumLightProbes;++s)this._pLightProbeWeights[s]*=w};return a}(b.library.NamedAssetBase);g.LightPickerBase=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(a){d.call(this);this.lights=a}__extends(a,d);Object.defineProperty(a.prototype,"lights",{get:function(){return this._lights},set:function(a){var d=0,e=0,h=0,f=0,g=0,w;this._lights&&this.clearListeners();this._pAllPickedLights=this._lights=a;this._pPointLights=[];this._pCastingPointLights=[];this._pDirectionalLights=[];this._pCastingDirectionalLights=[];this._pLightProbes=[];for(var s=a.length,m=0;m<s;++m)w=a[m],w.addEventListener(b.events.LightEvent.CASTS_SHADOW_CHANGE,
this.onCastShadowChange,this),w instanceof b.lights.PointLight?w.castsShadows?this._pCastingPointLights[h++]=w:this._pPointLights[d++]=w:w instanceof b.lights.DirectionalLight?w.castsShadows?this._pCastingDirectionalLights[f++]=w:this._pDirectionalLights[e++]=w:w instanceof b.lights.LightProbe&&(this._pLightProbes[g++]=w);if(this._pNumDirectionalLights!=e||this._pNumPointLights!=d||this._pNumLightProbes!=g||this._pNumCastingPointLights!=h||this._pNumCastingDirectionalLights!=f)this._pNumDirectionalLights=
e,this._pNumCastingDirectionalLights=f,this._pNumPointLights=d,this._pNumCastingPointLights=h,this._pNumLightProbes=g,this._pLightProbeWeights=Array(4*Math.ceil(g/4)),this.dispatchEvent(new b.events.Event(b.events.Event.CHANGE))},enumerable:!0,configurable:!0});a.prototype.clearListeners=function(){for(var a=this._lights.length,d=0;d<a;++d)this._lights[d].removeEventListener(b.events.LightEvent.CASTS_SHADOW_CHANGE,this.onCastShadowChange,this)};a.prototype.onCastShadowChange=function(a){a=a.target;
a instanceof b.lights.PointLight?this.updatePointCasting(a):a instanceof b.lights.DirectionalLight&&this.updateDirectionalCasting(a);this.dispatchEvent(new b.events.Event(b.events.Event.CHANGE))};a.prototype.updateDirectionalCasting=function(a){a.castsShadows?(--this._pNumDirectionalLights,++this._pNumCastingDirectionalLights,this._pDirectionalLights.splice(this._pDirectionalLights.indexOf(a),1),this._pCastingDirectionalLights.push(a)):(++this._pNumDirectionalLights,--this._pNumCastingDirectionalLights,
this._pCastingDirectionalLights.splice(this._pCastingDirectionalLights.indexOf(a),1),this._pDirectionalLights.push(a))};a.prototype.updatePointCasting=function(a){a.castsShadows?(--this._pNumPointLights,++this._pNumCastingPointLights,this._pPointLights.splice(this._pPointLights.indexOf(a),1),this._pCastingPointLights.push(a)):(++this._pNumPointLights,--this._pNumCastingPointLights,this._pCastingPointLights.splice(this._pCastingPointLights.indexOf(a),1),this._pPointLights.push(a))};return a}(g.LightPickerBase);
g.StaticLightPicker=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function d(a){this._numUsedVaryings=this._numUsedTextures=this._numUsedStreams=this._numUsedFragmentConstants=this._numUsedVertexConstants=0;this._profile=a}d.prototype.reset=function(){this._fragmentTempCache=new b.RegisterPool("ft",8,!1);this._vertexTempCache=new b.RegisterPool("vt",8,!1);this._varyingCache=new b.RegisterPool("v",8);this._textureCache=new b.RegisterPool("fs",8);this._vertexAttributesCache=new b.RegisterPool("va",8);this._fragmentConstantsCache=
new b.RegisterPool("fc",28);this._vertexConstantsCache=new b.RegisterPool("vc",128);this._fragmentOutputRegister=new b.ShaderRegisterElement("oc",-1);this._vertexOutputRegister=new b.ShaderRegisterElement("op",-1);this._numUsedFragmentConstants=this._numUsedVaryings=this._numUsedTextures=this._numUsedStreams=this._numUsedVertexConstants=0;var a;for(a=0;a<this._vertexAttributesOffset;++a)this.getFreeVertexAttribute();for(a=0;a<this._vertexConstantOffset;++a)this.getFreeVertexConstant();for(a=0;a<this._varyingsOffset;++a)this.getFreeVarying();
for(a=0;a<this._fragmentConstantOffset;++a)this.getFreeFragmentConstant()};d.prototype.dispose=function(){this._fragmentTempCache.dispose();this._vertexTempCache.dispose();this._varyingCache.dispose();this._fragmentConstantsCache.dispose();this._vertexAttributesCache.dispose();this._vertexOutputRegister=this._fragmentOutputRegister=this._vertexAttributesCache=this._fragmentConstantsCache=this._varyingCache=this._vertexTempCache=this._fragmentTempCache=null};d.prototype.addFragmentTempUsages=function(a,
c){this._fragmentTempCache.addUsage(a,c)};d.prototype.removeFragmentTempUsage=function(a){this._fragmentTempCache.removeUsage(a)};d.prototype.addVertexTempUsages=function(a,c){this._vertexTempCache.addUsage(a,c)};d.prototype.removeVertexTempUsage=function(a){this._vertexTempCache.removeUsage(a)};d.prototype.getFreeFragmentVectorTemp=function(){return this._fragmentTempCache.requestFreeVectorReg()};d.prototype.getFreeFragmentSingleTemp=function(){return this._fragmentTempCache.requestFreeRegComponent()};
d.prototype.getFreeVarying=function(){++this._numUsedVaryings;return this._varyingCache.requestFreeVectorReg()};d.prototype.getFreeFragmentConstant=function(){++this._numUsedFragmentConstants;return this._fragmentConstantsCache.requestFreeVectorReg()};d.prototype.getFreeVertexConstant=function(){++this._numUsedVertexConstants;return this._vertexConstantsCache.requestFreeVectorReg()};d.prototype.getFreeVertexVectorTemp=function(){return this._vertexTempCache.requestFreeVectorReg()};d.prototype.getFreeVertexSingleTemp=
function(){return this._vertexTempCache.requestFreeRegComponent()};d.prototype.getFreeVertexAttribute=function(){++this._numUsedStreams;return this._vertexAttributesCache.requestFreeVectorReg()};d.prototype.getFreeTextureReg=function(){++this._numUsedTextures;return this._textureCache.requestFreeVectorReg()};Object.defineProperty(d.prototype,"vertexConstantOffset",{get:function(){return this._vertexConstantOffset},set:function(a){this._vertexConstantOffset=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"vertexAttributesOffset",{get:function(){return this._vertexAttributesOffset},set:function(a){this._vertexAttributesOffset=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"varyingsOffset",{get:function(){return this._varyingsOffset},set:function(a){this._varyingsOffset=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"fragmentConstantOffset",{get:function(){return this._fragmentConstantOffset},set:function(a){this._fragmentConstantOffset=a},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"fragmentOutputRegister",{get:function(){return this._fragmentOutputRegister},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"numUsedVertexConstants",{get:function(){return this._numUsedVertexConstants},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"numUsedFragmentConstants",{get:function(){return this._numUsedFragmentConstants},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"numUsedStreams",{get:function(){return this._numUsedStreams},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"numUsedTextures",{get:function(){return this._numUsedTextures},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"numUsedVaryings",{get:function(){return this._numUsedVaryings},enumerable:!0,configurable:!0});return d}();b.ShaderRegisterCache=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(a,c,e){"undefined"===typeof e&&(e=-1);this._component=e;this._regName=a;this._index=c;this._toStr=this._regName;0<=this._index&&(this._toStr+=this._index);-1<e&&(this._toStr+="."+b.COMPONENTS[e])}b.prototype.toString=function(){return this._toStr};Object.defineProperty(b.prototype,"regName",{get:function(){return this._regName},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"index",{get:function(){return this._index},enumerable:!0,
configurable:!0});b.COMPONENTS=["x","y","z","w"];return b}();b.ShaderRegisterElement=e})(b.materials||(b.materials={}))})(away||(away={}));(function(b){(function(b){var e=function(){return function(){}}();b.ShaderRegisterData=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(){this._usesGlobalPosFragment=!1}d.prototype.reset=function(){this._tangentDependencies=this._globalPosDependencies=this._secondaryUVDependencies=this._uvDependencies=this._viewDirDependencies=this._normalDependencies=this._projectionDependencies=0;this._usesGlobalPosFragment=!1};d.prototype.setPositionedLights=function(a,c){this._numPointLights=a;this._lightSourceMask=c};d.prototype.includeMethodVO=function(a){a.needsProjection&&++this._projectionDependencies;
a.needsGlobalVertexPos?(++this._globalPosDependencies,a.needsGlobalFragmentPos&&(this._usesGlobalPosFragment=!0)):a.needsGlobalFragmentPos&&(++this._globalPosDependencies,this._usesGlobalPosFragment=!0);a.needsNormals&&++this._normalDependencies;a.needsTangents&&++this._tangentDependencies;a.needsView&&++this._viewDirDependencies;a.needsUV&&++this._uvDependencies;a.needsSecondaryUV&&++this._secondaryUVDependencies};Object.defineProperty(d.prototype,"tangentDependencies",{get:function(){return this._tangentDependencies},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"usesGlobalPosFragment",{get:function(){return this._usesGlobalPosFragment},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"projectionDependencies",{get:function(){return this._projectionDependencies},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"normalDependencies",{get:function(){return this._normalDependencies},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"viewDirDependencies",
{get:function(){return this._viewDirDependencies},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"uvDependencies",{get:function(){return this._uvDependencies},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"secondaryUVDependencies",{get:function(){return this._secondaryUVDependencies},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"globalPosDependencies",{get:function(){return this._globalPosDependencies},enumerable:!0,configurable:!0});d.prototype.addWorldSpaceDependencies=
function(a){0<this._viewDirDependencies&&++this._globalPosDependencies;0<this._numPointLights&&this._lightSourceMask&b.materials.LightSources.LIGHTS&&(++this._globalPosDependencies,a&&(this._usesGlobalPosFragment=!0))};return d}();g.MethodDependencyCounter=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(a,c,b){"undefined"===typeof b&&(b=!0);this._regName=a;this._regCount=c;this._persistent=b;this.initRegisters(a,c)}d.prototype.requestFreeVectorReg=function(){for(var a=0;a<this._regCount;++a)if(!this.isRegisterUsed(a))return this._persistent&&this._usedVectorCount[a]++,this._vectorRegisters[a];throw Error("Register overflow!");};d.prototype.requestFreeRegComponent=function(){for(var a=0;a<this._regCount;++a)if(!(0<this._usedVectorCount[a]))for(var c=
0;4>c;++c)if(0==this._usedSingleCount[c][a])return this._persistent&&this._usedSingleCount[c][a]++,this._registerComponents[c][a];throw Error("Register overflow!");};d.prototype.addUsage=function(a,c){-1<a._component?this._usedSingleCount[a._component][a.index]+=c:this._usedVectorCount[a.index]+=c};d.prototype.removeUsage=function(a){if(-1<a._component){if(0>--this._usedSingleCount[a._component][a.index])throw Error("More usages removed than exist!");}else if(0>--this._usedVectorCount[a.index])throw Error("More usages removed than exist!");
};d.prototype.dispose=function(){this._usedVectorCount=this._usedSingleCount=this._registerComponents=this._vectorRegisters=null};d.prototype.hasRegisteredRegs=function(){for(var a=0;a<this._regCount;++a)if(this.isRegisterUsed(a))return!0;return!1};d.prototype.initRegisters=function(a,c){var b=d._initPool(a,c);this._vectorRegisters=d._regPool[b];this._registerComponents=d._regCompsPool[b];this._usedVectorCount=this._initArray(Array(c),0);this._usedSingleCount=Array(4);this._usedSingleCount[0]=this._initArray(Array(c),
0);this._usedSingleCount[1]=this._initArray(Array(c),0);this._usedSingleCount[2]=this._initArray(Array(c),0);this._usedSingleCount[3]=this._initArray(Array(c),0)};d._initPool=function(a,c){var e=a+c;if(void 0!=d._regPool[e])return e;var g=Array(c);d._regPool[e]=g;var h=[[],[],[],[]];d._regCompsPool[e]=h;for(var f=0;f<c;++f){g[f]=new b.materials.ShaderRegisterElement(a,f);for(var l=0;4>l;++l)h[l][f]=new b.materials.ShaderRegisterElement(a,f,l)}return e};d.prototype.isRegisterUsed=function(a){if(0<
this._usedVectorCount[a])return!0;for(var c=0;4>c;++c)if(0<this._usedSingleCount[c][a])return!0;return!1};d.prototype._initArray=function(a,c){for(var b=a.length,d=0;d<b;d++)a[d]=c;return a};d._regPool={};d._regCompsPool={};return d}();g.RegisterPool=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(a){this._preserveAlpha=!0;this._pFragmentCode=this._pVertexCode="";this._pProbeWeightsIndex=this._pCameraPositionIndex=this._pSceneNormalMatrixIndex=this._sceneMatrixIndex=this._pLightFragmentConstantIndex=this._pTangentBufferIndex=this._pNormalBufferIndex=this._secondaryUVBufferIndex=this._uvTransformIndex=this._uvBufferIndex=this._commonsDataIndex=-1;this._pSharedRegisters=new b.materials.ShaderRegisterData;this._pDependencyCounter=new b.materials.MethodDependencyCounter;
this._pProfile=a;this.initRegisterCache(a)}Object.defineProperty(d.prototype,"enableLightFallOff",{get:function(){return this._pEnableLightFallOff},set:function(a){this._pEnableLightFallOff=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"needUVAnimation",{get:function(){return this._needUVAnimation},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"UVTarget",{get:function(){return this._UVTarget},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"UVSource",{get:function(){return this._UVSource},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"forceSeperateMVP",{get:function(){return this._forceSeperateMVP},set:function(a){this._forceSeperateMVP=a},enumerable:!0,configurable:!0});d.prototype.initRegisterCache=function(a){this._pRegisterCache=new b.materials.ShaderRegisterCache(a);this._pRegisterCache.vertexAttributesOffset=1;this._pRegisterCache.reset()};Object.defineProperty(d.prototype,"animateUVs",{get:function(){return this._animateUVs},
set:function(a){this._animateUVs=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"alphaPremultiplied",{get:function(){return this._pAlphaPremultiplied},set:function(a){this._pAlphaPremultiplied=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"preserveAlpha",{get:function(){return this._preserveAlpha},set:function(a){this._preserveAlpha=a},enumerable:!0,configurable:!0});d.prototype.setTextureSampling=function(a,c,b){this._smooth=a;this._repeat=c;this._mipmap=
b};d.prototype.setConstantDataBuffers=function(a,c){this._vertexConstantData=a;this._fragmentConstantData=c};Object.defineProperty(d.prototype,"methodSetup",{get:function(){return this._pMethodSetup},set:function(a){this._pMethodSetup=a},enumerable:!0,configurable:!0});d.prototype.compile=function(){this.pInitRegisterIndices();this.pInitLightData();this._pAnimatableAttributes=["va0"];this._pAnimationTargetRegisters=["vt0"];this._pFragmentCode=this._pVertexCode="";this._pSharedRegisters.localPosition=
this._pRegisterCache.getFreeVertexVectorTemp();this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.localPosition,1);this.createCommons();this.pCalculateDependencies();this.updateMethodRegisters();for(var a=0;4>a;++a)this._pRegisterCache.getFreeVertexConstant();this.pCreateNormalRegisters();(0<this._pDependencyCounter.globalPosDependencies||this._forceSeperateMVP)&&this.pCompileGlobalPositionCode();this.compileProjectionCode();this.pCompileMethodsCode();this.compileFragmentOutput();this._fragmentPostLightCode=
this.fragmentCode};d.prototype.pCreateNormalRegisters=function(){};d.prototype.pCompileMethodsCode=function(){0<this._pDependencyCounter.uvDependencies&&this.compileUVCode();0<this._pDependencyCounter.secondaryUVDependencies&&this.compileSecondaryUVCode();0<this._pDependencyCounter.normalDependencies&&this.pCompileNormalCode();0<this._pDependencyCounter.viewDirDependencies&&this.pCompileViewDirCode();this.pCompileLightingCode();this._fragmentLightCode=this._pFragmentCode;this._pFragmentCode="";this.pCompileMethods()};
d.prototype.pCompileLightingCode=function(){};d.prototype.pCompileViewDirCode=function(){};d.prototype.pCompileNormalCode=function(){};d.prototype.compileUVCode=function(){var a=this._pRegisterCache.getFreeVertexAttribute();this._uvBufferIndex=a.index;var c=this._pRegisterCache.getFreeVarying();this._pSharedRegisters.uvVarying=c;if(this.animateUVs){var b=this._pRegisterCache.getFreeVertexConstant(),d=this._pRegisterCache.getFreeVertexConstant();this._uvTransformIndex=4*b.index;this._pVertexCode+=
"dp4 "+c.toString()+".x, "+a.toString()+", "+b.toString()+"\ndp4 "+c.toString()+".y, "+a.toString()+", "+d.toString()+"\nmov "+c.toString()+".zw, "+a.toString()+".zw \n"}else this._uvTransformIndex=-1,this._needUVAnimation=!0,this._UVTarget=c.toString(),this._UVSource=a.toString()};d.prototype.compileSecondaryUVCode=function(){var a=this._pRegisterCache.getFreeVertexAttribute();this._secondaryUVBufferIndex=a.index;this._pSharedRegisters.secondaryUVVarying=this._pRegisterCache.getFreeVarying();this._pVertexCode+=
"mov "+this._pSharedRegisters.secondaryUVVarying.toString()+", "+a.toString()+"\n"};d.prototype.pCompileGlobalPositionCode=function(){this._pSharedRegisters.globalPositionVertex=this._pRegisterCache.getFreeVertexVectorTemp();this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.globalPositionVertex,this._pDependencyCounter.globalPosDependencies);var a=this._pRegisterCache.getFreeVertexConstant();this._pRegisterCache.getFreeVertexConstant();this._pRegisterCache.getFreeVertexConstant();this._pRegisterCache.getFreeVertexConstant();
this._sceneMatrixIndex=4*a.index;this._pVertexCode+="m44 "+this._pSharedRegisters.globalPositionVertex.toString()+", "+this._pSharedRegisters.localPosition.toString()+", "+a.toString()+"\n";this._pDependencyCounter.usesGlobalPosFragment&&(this._pSharedRegisters.globalPositionVarying=this._pRegisterCache.getFreeVarying(),this._pVertexCode+="mov "+this._pSharedRegisters.globalPositionVarying.toString()+", "+this._pSharedRegisters.globalPositionVertex.toString()+"\n")};d.prototype.compileProjectionCode=
function(){var a=0<this._pDependencyCounter.globalPosDependencies||this._forceSeperateMVP?this._pSharedRegisters.globalPositionVertex.toString():this._pAnimationTargetRegisters[0];0<this._pDependencyCounter.projectionDependencies?(this._pSharedRegisters.projectionFragment=this._pRegisterCache.getFreeVarying(),a="m44 vt5, "+a+", vc0\t\t\nmov "+this._pSharedRegisters.projectionFragment.toString()+", vt5\nmov op, vt5\n"):a="m44 op, "+a+", vc0\t\t\n";this._pVertexCode+=a};d.prototype.compileFragmentOutput=
function(){this._pFragmentCode+="mov "+this._pRegisterCache.fragmentOutputRegister.toString()+", "+this._pSharedRegisters.shadedTarget.toString()+"\n";this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.shadedTarget)};d.prototype.pInitRegisterIndices=function(){this._pProbeWeightsIndex=this._pSceneNormalMatrixIndex=this._sceneMatrixIndex=this._pLightFragmentConstantIndex=this._pTangentBufferIndex=this._pNormalBufferIndex=this._secondaryUVBufferIndex=this._uvTransformIndex=this._uvBufferIndex=
this._pCameraPositionIndex=this._commonsDataIndex=-1};d.prototype.pInitLightData=function(){this._pNumLights=this._pNumPointLights+this._pNumDirectionalLights;this._pNumProbeRegisters=Math.ceil(this._pNumLightProbes/4);this._combinedLightSources=this._pMethodSetup._iSpecularMethod?this._specularLightSources|this._diffuseLightSources:this._diffuseLightSources;this._usingSpecularMethod=Boolean(this._pMethodSetup._iSpecularMethod&&(this.pUsesLightsForSpecular()||this.pUsesProbesForSpecular()))};d.prototype.createCommons=
function(){this._pSharedRegisters.commons=this._pRegisterCache.getFreeFragmentConstant();this._commonsDataIndex=4*this._pSharedRegisters.commons.index};d.prototype.pCalculateDependencies=function(){this._pDependencyCounter.reset();var a=this._pMethodSetup._iMethods,c;this.setupAndCountMethodDependencies(this._pMethodSetup._iDiffuseMethod,this._pMethodSetup._iDiffuseMethodVO);this._pMethodSetup._iShadowMethod&&this.setupAndCountMethodDependencies(this._pMethodSetup._iShadowMethod,this._pMethodSetup._iShadowMethodVO);
this.setupAndCountMethodDependencies(this._pMethodSetup._iAmbientMethod,this._pMethodSetup._iAmbientMethodVO);this._usingSpecularMethod&&this.setupAndCountMethodDependencies(this._pMethodSetup._iSpecularMethod,this._pMethodSetup._iSpecularMethodVO);this._pMethodSetup._iColorTransformMethod&&this.setupAndCountMethodDependencies(this._pMethodSetup._iColorTransformMethod,this._pMethodSetup._iColorTransformMethodVO);c=a.length;for(var b=0;b<c;++b)this.setupAndCountMethodDependencies(a[b].method,a[b].data);
this.usesNormals&&this.setupAndCountMethodDependencies(this._pMethodSetup._iNormalMethod,this._pMethodSetup._iNormalMethodVO);this._pDependencyCounter.setPositionedLights(this._pNumPointLights,this._combinedLightSources)};d.prototype.setupAndCountMethodDependencies=function(a,c){this.setupMethod(a,c);this._pDependencyCounter.includeMethodVO(c)};d.prototype.setupMethod=function(a,c){a.iReset();c.reset();c.vertexData=this._vertexConstantData;c.fragmentData=this._fragmentConstantData;c.useSmoothTextures=
this._smooth;c.repeatTextures=this._repeat;c.useMipmapping=this._mipmap;c.useLightFallOff=this._pEnableLightFallOff&&"baselineConstrained"!=this._pProfile;c.numLights=this._pNumLights+this._pNumLightProbes;a.iInitVO(c)};Object.defineProperty(d.prototype,"commonsDataIndex",{get:function(){return this._commonsDataIndex},enumerable:!0,configurable:!0});d.prototype.updateMethodRegisters=function(){this._pMethodSetup._iNormalMethod.iSharedRegisters=this._pSharedRegisters;this._pMethodSetup._iDiffuseMethod.iSharedRegisters=
this._pSharedRegisters;this._pMethodSetup._iShadowMethod&&(this._pMethodSetup._iShadowMethod.iSharedRegisters=this._pSharedRegisters);this._pMethodSetup._iAmbientMethod.iSharedRegisters=this._pSharedRegisters;this._pMethodSetup._iSpecularMethod&&(this._pMethodSetup._iSpecularMethod.iSharedRegisters=this._pSharedRegisters);this._pMethodSetup._iColorTransformMethod&&(this._pMethodSetup._iColorTransformMethod.iSharedRegisters=this._pSharedRegisters);for(var a=this._pMethodSetup._iMethods,c=a.length,
b=0;b<c;++b)a[b].method.iSharedRegisters=this._pSharedRegisters};Object.defineProperty(d.prototype,"numUsedVertexConstants",{get:function(){return this._pRegisterCache.numUsedVertexConstants},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"numUsedFragmentConstants",{get:function(){return this._pRegisterCache.numUsedFragmentConstants},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"numUsedStreams",{get:function(){return this._pRegisterCache.numUsedStreams},enumerable:!0,
configurable:!0});Object.defineProperty(d.prototype,"numUsedTextures",{get:function(){return this._pRegisterCache.numUsedTextures},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"numUsedVaryings",{get:function(){return this._pRegisterCache.numUsedVaryings},enumerable:!0,configurable:!0});d.prototype.pUsesLightsForSpecular=function(){return 0<this._pNumLights&&0!=(this._specularLightSources&b.materials.LightSources.LIGHTS)};d.prototype.pUsesLightsForDiffuse=function(){return 0<this._pNumLights&&
0!=(this._diffuseLightSources&b.materials.LightSources.LIGHTS)};d.prototype.dispose=function(){this.cleanUpMethods();this._pRegisterCache.dispose();this._pSharedRegisters=this._pRegisterCache=null};d.prototype.cleanUpMethods=function(){this._pMethodSetup._iNormalMethod&&this._pMethodSetup._iNormalMethod.iCleanCompilationData();this._pMethodSetup._iDiffuseMethod&&this._pMethodSetup._iDiffuseMethod.iCleanCompilationData();this._pMethodSetup._iAmbientMethod&&this._pMethodSetup._iAmbientMethod.iCleanCompilationData();
this._pMethodSetup._iSpecularMethod&&this._pMethodSetup._iSpecularMethod.iCleanCompilationData();this._pMethodSetup._iShadowMethod&&this._pMethodSetup._iShadowMethod.iCleanCompilationData();this._pMethodSetup._iColorTransformMethod&&this._pMethodSetup._iColorTransformMethod.iCleanCompilationData();for(var a=this._pMethodSetup._iMethods,c=a.length,b=0;b<c;++b)a[b].method.iCleanCompilationData()};Object.defineProperty(d.prototype,"specularLightSources",{get:function(){return this._specularLightSources},
set:function(a){this._specularLightSources=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"diffuseLightSources",{get:function(){return this._diffuseLightSources},set:function(a){this._diffuseLightSources=a},enumerable:!0,configurable:!0});d.prototype.pUsesProbesForSpecular=function(){return 0<this._pNumLightProbes&&0!=(this._specularLightSources&b.materials.LightSources.PROBES)};d.prototype.pUsesProbesForDiffuse=function(){return 0<this._pNumLightProbes&&0!=(this._diffuseLightSources&
b.materials.LightSources.PROBES)};d.prototype.pUsesProbes=function(){return 0<this._pNumLightProbes&&0!=((this._diffuseLightSources|this._specularLightSources)&b.materials.LightSources.PROBES)};Object.defineProperty(d.prototype,"uvBufferIndex",{get:function(){return this._uvBufferIndex},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"uvTransformIndex",{get:function(){return this._uvTransformIndex},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"secondaryUVBufferIndex",
{get:function(){return this._secondaryUVBufferIndex},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"normalBufferIndex",{get:function(){return this._pNormalBufferIndex},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"tangentBufferIndex",{get:function(){return this._pTangentBufferIndex},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"lightFragmentConstantIndex",{get:function(){return this._pLightFragmentConstantIndex},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"cameraPositionIndex",{get:function(){return this._pCameraPositionIndex},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"sceneMatrixIndex",{get:function(){return this._sceneMatrixIndex},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"sceneNormalMatrixIndex",{get:function(){return this._pSceneNormalMatrixIndex},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"probeWeightsIndex",{get:function(){return this._pProbeWeightsIndex},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"vertexCode",{get:function(){return this._pVertexCode},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"fragmentCode",{get:function(){return this._pFragmentCode},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"fragmentLightCode",{get:function(){return this._fragmentLightCode},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"fragmentPostLightCode",{get:function(){return this._fragmentPostLightCode},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"shadedTarget",{get:function(){return this._pSharedRegisters.shadedTarget.toString()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"numPointLights",{get:function(){return this._pNumPointLights},set:function(a){this._pNumPointLights=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"numDirectionalLights",{get:function(){return this._pNumDirectionalLights},set:function(a){this._pNumDirectionalLights=
a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"numLightProbes",{get:function(){return this._pNumLightProbes},set:function(a){this._pNumLightProbes=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"usingSpecularMethod",{get:function(){return this._usingSpecularMethod},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"animatableAttributes",{get:function(){return this._pAnimatableAttributes},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"animationTargetRegisters",{get:function(){return this._pAnimationTargetRegisters},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"usesNormals",{get:function(){return 0<this._pDependencyCounter.normalDependencies&&this._pMethodSetup._iNormalMethod.iHasOutput},enumerable:!0,configurable:!0});d.prototype.pUsesLights=function(){return 0<this._pNumLights&&0!=(this._combinedLightSources&b.materials.LightSources.LIGHTS)};d.prototype.pCompileMethods=function(){var a=this._pMethodSetup._iMethods,
c=a.length,b,d,e;this._preserveAlpha&&(e=this._pRegisterCache.getFreeFragmentSingleTemp(),this._pRegisterCache.addFragmentTempUsages(e,1),this._pFragmentCode+="mov "+e.toString()+", "+this._pSharedRegisters.shadedTarget.toString()+".w\n");for(var f=0;f<c;++f)b=a[f].method,d=a[f].data,this._pVertexCode+=b.iGetVertexCode(d,this._pRegisterCache),(d.needsGlobalVertexPos||d.needsGlobalFragmentPos)&&this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.globalPositionVertex),this._pFragmentCode+=
b.iGetFragmentCode(d,this._pRegisterCache,this._pSharedRegisters.shadedTarget),d.needsNormals&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.normalFragment),d.needsView&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.viewDirFragment);this._preserveAlpha&&(this._pFragmentCode+="mov "+this._pSharedRegisters.shadedTarget.toString()+".w, "+e.toString()+"\n",this._pRegisterCache.removeFragmentTempUsage(e));this._pMethodSetup._iColorTransformMethod&&(this._pVertexCode+=
this._pMethodSetup._iColorTransformMethod.iGetVertexCode(this._pMethodSetup._iColorTransformMethodVO,this._pRegisterCache),this._pFragmentCode+=this._pMethodSetup._iColorTransformMethod.iGetFragmentCode(this._pMethodSetup._iColorTransformMethodVO,this._pRegisterCache,this._pSharedRegisters.shadedTarget))};Object.defineProperty(d.prototype,"lightProbeDiffuseIndices",{get:function(){return this._pLightProbeDiffuseIndices},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"lightProbeSpecularIndices",
{get:function(){return this._pLightProbeSpecularIndices},enumerable:!0,configurable:!0});return d}();g.ShaderCompiler=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(a){b.call(this,a)}__extends(a,b);a.prototype.pInitLightData=function(){b.prototype.pInitLightData.call(this);this._pointLightRegisters=Array(3*this._pNumPointLights);this._dirLightRegisters=Array(3*this._pNumDirectionalLights)};a.prototype.pCalculateDependencies=function(){b.prototype.pCalculateDependencies.call(this);this._pDependencyCounter.addWorldSpaceDependencies(!0)};a.prototype.pCompileNormalCode=function(){var a=Array(3);this._pSharedRegisters.normalFragment=
this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.normalFragment,this._pDependencyCounter.normalDependencies);this._pMethodSetup._iNormalMethod.iHasOutput&&!this._pMethodSetup._iNormalMethod.iTangentSpace?(this._pVertexCode+=this._pMethodSetup._iNormalMethod.iGetVertexCode(this._pMethodSetup._iNormalMethodVO,this._pRegisterCache),this._pFragmentCode+=this._pMethodSetup._iNormalMethod.iGetFragmentCode(this._pMethodSetup._iNormalMethodVO,
this._pRegisterCache,this._pSharedRegisters.normalFragment)):(this._pSharedRegisters.normalVarying=this._pRegisterCache.getFreeVarying(),a[0]=this._pRegisterCache.getFreeVertexConstant(),a[1]=this._pRegisterCache.getFreeVertexConstant(),a[2]=this._pRegisterCache.getFreeVertexConstant(),this._pRegisterCache.getFreeVertexConstant(),this._pSceneNormalMatrixIndex=4*a[0].index,this._pMethodSetup._iNormalMethod.iHasOutput?(this.compileTangentVertexCode(a),this.compileTangentNormalMapFragmentCode()):(this._pVertexCode+=
"m33 "+this._pSharedRegisters.normalVarying.toString()+".xyz, "+this._pSharedRegisters.animatedNormal.toString()+", "+a[0].toString()+"\nmov "+this._pSharedRegisters.normalVarying.toString()+".w, "+this._pSharedRegisters.animatedNormal.toString()+".w\t\n",this._pFragmentCode+="nrm "+this._pSharedRegisters.normalFragment.toString()+".xyz, "+this._pSharedRegisters.normalVarying.toString()+"\nmov "+this._pSharedRegisters.normalFragment.toString()+".w, "+this._pSharedRegisters.normalVarying.toString()+
".w\t\t\n",0<this._pDependencyCounter.tangentDependencies&&(this._pSharedRegisters.tangentInput=this._pRegisterCache.getFreeVertexAttribute(),this._pTangentBufferIndex=this._pSharedRegisters.tangentInput.index,this._pSharedRegisters.tangentVarying=this._pRegisterCache.getFreeVarying(),this._pVertexCode+="mov "+this._pSharedRegisters.tangentVarying.toString()+", "+this._pSharedRegisters.tangentInput.toString()+"\n")),this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.animatedNormal))};
a.prototype.pCreateNormalRegisters=function(){0<this._pDependencyCounter.normalDependencies&&(this._pSharedRegisters.normalInput=this._pRegisterCache.getFreeVertexAttribute(),this._pNormalBufferIndex=this._pSharedRegisters.normalInput.index,this._pSharedRegisters.animatedNormal=this._pRegisterCache.getFreeVertexVectorTemp(),this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedNormal,1),this._pAnimatableAttributes.push(this._pSharedRegisters.normalInput.toString()),this._pAnimationTargetRegisters.push(this._pSharedRegisters.animatedNormal.toString()));
this._pMethodSetup._iNormalMethod.iHasOutput&&(this._pSharedRegisters.tangentInput=this._pRegisterCache.getFreeVertexAttribute(),this._pTangentBufferIndex=this._pSharedRegisters.tangentInput.index,this._pSharedRegisters.animatedTangent=this._pRegisterCache.getFreeVertexVectorTemp(),this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedTangent,1),this._pAnimatableAttributes.push(this._pSharedRegisters.tangentInput.toString()),this._pAnimationTargetRegisters.push(this._pSharedRegisters.animatedTangent.toString()))};
a.prototype.compileTangentVertexCode=function(a){this._pSharedRegisters.tangentVarying=this._pRegisterCache.getFreeVarying();this._pSharedRegisters.bitangentVarying=this._pRegisterCache.getFreeVarying();this._pVertexCode+="m33 "+this._pSharedRegisters.animatedNormal.toString()+".xyz, "+this._pSharedRegisters.animatedNormal.toString()+", "+a[0].toString()+"\nnrm "+this._pSharedRegisters.animatedNormal.toString()+".xyz, "+this._pSharedRegisters.animatedNormal.toString()+"\n";this._pVertexCode+="m33 "+
this._pSharedRegisters.animatedTangent.toString()+".xyz, "+this._pSharedRegisters.animatedTangent.toString()+", "+a[0].toString()+"\nnrm "+this._pSharedRegisters.animatedTangent.toString()+".xyz, "+this._pSharedRegisters.animatedTangent.toString()+"\n";a=this._pRegisterCache.getFreeVertexVectorTemp();this._pVertexCode+="mov "+this._pSharedRegisters.tangentVarying.toString()+".x, "+this._pSharedRegisters.animatedTangent.toString()+".x  \nmov "+this._pSharedRegisters.tangentVarying.toString()+".z, "+
this._pSharedRegisters.animatedNormal.toString()+".x  \nmov "+this._pSharedRegisters.tangentVarying.toString()+".w, "+this._pSharedRegisters.normalInput.toString()+".w  \nmov "+this._pSharedRegisters.bitangentVarying.toString()+".x, "+this._pSharedRegisters.animatedTangent.toString()+".y  \nmov "+this._pSharedRegisters.bitangentVarying.toString()+".z, "+this._pSharedRegisters.animatedNormal.toString()+".y  \nmov "+this._pSharedRegisters.bitangentVarying.toString()+".w, "+this._pSharedRegisters.normalInput.toString()+
".w  \nmov "+this._pSharedRegisters.normalVarying.toString()+".x, "+this._pSharedRegisters.animatedTangent.toString()+".z  \nmov "+this._pSharedRegisters.normalVarying.toString()+".z, "+this._pSharedRegisters.animatedNormal.toString()+".z  \nmov "+this._pSharedRegisters.normalVarying.toString()+".w, "+this._pSharedRegisters.normalInput.toString()+".w  \ncrs "+a.toString()+".xyz, "+this._pSharedRegisters.animatedNormal.toString()+", "+this._pSharedRegisters.animatedTangent.toString()+"\nmov "+this._pSharedRegisters.tangentVarying.toString()+
".y, "+a.toString()+".x    \nmov "+this._pSharedRegisters.bitangentVarying.toString()+".y, "+a.toString()+".y  \nmov "+this._pSharedRegisters.normalVarying.toString()+".y, "+a.toString()+".z    \n";this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.animatedTangent)};a.prototype.compileTangentNormalMapFragmentCode=function(){var a,b,d;a=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(a,1);b=this._pRegisterCache.getFreeFragmentVectorTemp();
this._pRegisterCache.addFragmentTempUsages(b,1);d=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(d,1);this._pFragmentCode+="nrm "+a.toString()+".xyz, "+this._pSharedRegisters.tangentVarying.toString()+"\nmov "+a.toString()+".w, "+this._pSharedRegisters.tangentVarying.toString()+".w\t\nnrm "+b.toString()+".xyz, "+this._pSharedRegisters.bitangentVarying.toString()+"\nnrm "+d.toString()+".xyz, "+this._pSharedRegisters.normalVarying.toString()+"\n";var e=this._pRegisterCache.getFreeFragmentVectorTemp();
this._pRegisterCache.addFragmentTempUsages(e,1);this._pFragmentCode+=this._pMethodSetup._iNormalMethod.iGetFragmentCode(this._pMethodSetup._iNormalMethodVO,this._pRegisterCache,e)+"m33 "+this._pSharedRegisters.normalFragment.toString()+".xyz, "+e.toString()+", "+a.toString()+"\t\nmov "+this._pSharedRegisters.normalFragment.toString()+".w,   "+this._pSharedRegisters.normalVarying.toString()+".w\t\t\t\n";this._pRegisterCache.removeFragmentTempUsage(e);this._pMethodSetup._iNormalMethodVO.needsView&&
this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.viewDirFragment);(this._pMethodSetup._iNormalMethodVO.needsGlobalVertexPos||this._pMethodSetup._iNormalMethodVO.needsGlobalFragmentPos)&&this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.globalPositionVertex);this._pRegisterCache.removeFragmentTempUsage(b);this._pRegisterCache.removeFragmentTempUsage(a);this._pRegisterCache.removeFragmentTempUsage(d)};a.prototype.pCompileViewDirCode=function(){var a=this._pRegisterCache.getFreeVertexConstant();
this._pSharedRegisters.viewDirVarying=this._pRegisterCache.getFreeVarying();this._pSharedRegisters.viewDirFragment=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.viewDirFragment,this._pDependencyCounter.viewDirDependencies);this._pCameraPositionIndex=4*a.index;this._pVertexCode+="sub "+this._pSharedRegisters.viewDirVarying.toString()+", "+a.toString()+", "+this._pSharedRegisters.globalPositionVertex.toString()+"\n";this._pFragmentCode+=
"nrm "+this._pSharedRegisters.viewDirFragment.toString()+".xyz, "+this._pSharedRegisters.viewDirVarying.toString()+"\nmov "+this._pSharedRegisters.viewDirFragment.toString()+".w,   "+this._pSharedRegisters.viewDirVarying.toString()+".w \t\t\n";this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.globalPositionVertex)};a.prototype.pCompileLightingCode=function(){var a;this._pSharedRegisters.shadedTarget=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.shadedTarget,
1);this._pVertexCode+=this._pMethodSetup._iDiffuseMethod.iGetVertexCode(this._pMethodSetup._iDiffuseMethodVO,this._pRegisterCache);this._pFragmentCode+=this._pMethodSetup._iDiffuseMethod.iGetFragmentPreLightingCode(this._pMethodSetup._iDiffuseMethodVO,this._pRegisterCache);this._usingSpecularMethod&&(this._pVertexCode+=this._pMethodSetup._iSpecularMethod.iGetVertexCode(this._pMethodSetup._iSpecularMethodVO,this._pRegisterCache),this._pFragmentCode+=this._pMethodSetup._iSpecularMethod.iGetFragmentPreLightingCode(this._pMethodSetup._iSpecularMethodVO,
this._pRegisterCache));this.pUsesLights()&&(this.initLightRegisters(),this.compileDirectionalLightCode(),this.compilePointLightCode());this.pUsesProbes()&&this.compileLightProbeCode();this._pVertexCode+=this._pMethodSetup._iAmbientMethod.iGetVertexCode(this._pMethodSetup._iAmbientMethodVO,this._pRegisterCache);this._pFragmentCode+=this._pMethodSetup._iAmbientMethod.iGetFragmentCode(this._pMethodSetup._iAmbientMethodVO,this._pRegisterCache,this._pSharedRegisters.shadedTarget);this._pMethodSetup._iAmbientMethodVO.needsNormals&&
this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.normalFragment);this._pMethodSetup._iAmbientMethodVO.needsView&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.viewDirFragment);this._pMethodSetup._iShadowMethod&&(this._pVertexCode+=this._pMethodSetup._iShadowMethod.iGetVertexCode(this._pMethodSetup._iShadowMethodVO,this._pRegisterCache),0==this._pDependencyCounter.normalDependencies?(a=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(a,
1)):a=this._pSharedRegisters.normalFragment,this._pMethodSetup._iDiffuseMethod.iShadowRegister=a,this._pFragmentCode+=this._pMethodSetup._iShadowMethod.iGetFragmentCode(this._pMethodSetup._iShadowMethodVO,this._pRegisterCache,a));this._pFragmentCode+=this._pMethodSetup._iDiffuseMethod.iGetFragmentPostLightingCode(this._pMethodSetup._iDiffuseMethodVO,this._pRegisterCache,this._pSharedRegisters.shadedTarget);this._pAlphaPremultiplied&&(this._pFragmentCode+="add "+this._pSharedRegisters.shadedTarget.toString()+
".w, "+this._pSharedRegisters.shadedTarget.toString()+".w, "+this._pSharedRegisters.commons.toString()+".z\ndiv "+this._pSharedRegisters.shadedTarget.toString()+".xyz, "+this._pSharedRegisters.shadedTarget.toString()+", "+this._pSharedRegisters.shadedTarget.toString()+".w\nsub "+this._pSharedRegisters.shadedTarget.toString()+".w, "+this._pSharedRegisters.shadedTarget.toString()+".w, "+this._pSharedRegisters.commons.toString()+".z\nsat "+this._pSharedRegisters.shadedTarget.toString()+".xyz, "+this._pSharedRegisters.shadedTarget.toString()+
"\n");this._pMethodSetup._iDiffuseMethodVO.needsNormals&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.normalFragment);this._pMethodSetup._iDiffuseMethodVO.needsView&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.viewDirFragment);this._usingSpecularMethod&&(this._pMethodSetup._iSpecularMethod.iShadowRegister=a,this._pFragmentCode+=this._pMethodSetup._iSpecularMethod.iGetFragmentPostLightingCode(this._pMethodSetup._iSpecularMethodVO,this._pRegisterCache,
this._pSharedRegisters.shadedTarget),this._pMethodSetup._iSpecularMethodVO.needsNormals&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.normalFragment),this._pMethodSetup._iSpecularMethodVO.needsView&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.viewDirFragment))};a.prototype.initLightRegisters=function(){var a,b;b=this._dirLightRegisters.length;for(a=0;a<b;++a)this._dirLightRegisters[a]=this._pRegisterCache.getFreeFragmentConstant(),-1==this._pLightFragmentConstantIndex&&
(this._pLightFragmentConstantIndex=4*this._dirLightRegisters[a].index);b=this._pointLightRegisters.length;for(a=0;a<b;++a)this._pointLightRegisters[a]=this._pRegisterCache.getFreeFragmentConstant(),-1==this._pLightFragmentConstantIndex&&(this._pLightFragmentConstantIndex=4*this._pointLightRegisters[a].index)};a.prototype.compileDirectionalLightCode=function(){var a,b,d,e=0,f=this._usingSpecularMethod&&this.pUsesLightsForSpecular(),g=this.pUsesLightsForDiffuse();if(f||g)for(var w=0;w<this._pNumDirectionalLights;++w)d=
this._dirLightRegisters[e++],a=this._dirLightRegisters[e++],b=this._dirLightRegisters[e++],g&&(this._pFragmentCode+=this._pMethodSetup._iDiffuseMethod.iGetFragmentCodePerLight(this._pMethodSetup._iDiffuseMethodVO,d,a,this._pRegisterCache)),f&&(this._pFragmentCode+=this._pMethodSetup._iSpecularMethod.iGetFragmentCodePerLight(this._pMethodSetup._iSpecularMethodVO,d,b,this._pRegisterCache))};a.prototype.compilePointLightCode=function(){var a,b,d,e,f=0,g=this._usingSpecularMethod&&this.pUsesLightsForSpecular(),
w=this.pUsesLightsForDiffuse();if(g||w)for(var s=0;s<this._pNumPointLights;++s)d=this._pointLightRegisters[f++],a=this._pointLightRegisters[f++],b=this._pointLightRegisters[f++],e=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(e,1),this._pFragmentCode+="sub "+e.toString()+", "+d.toString()+", "+this._pSharedRegisters.globalPositionVarying.toString()+"\ndp3 "+e.toString()+".w, "+e.toString()+", "+e.toString()+"\nsub "+e.toString()+".w, "+e.toString()+".w, "+
a.toString()+".w\nmul "+e.toString()+".w, "+e.toString()+".w, "+b.toString()+".w\nsat "+e.toString()+".w, "+e.toString()+".w\nsub "+e.toString()+".w, "+d.toString()+".w, "+e.toString()+".w\nnrm "+e.toString()+".xyz, "+e.toString()+"\n",-1==this._pLightFragmentConstantIndex&&(this._pLightFragmentConstantIndex=4*d.index),w&&(this._pFragmentCode+=this._pMethodSetup._iDiffuseMethod.iGetFragmentCodePerLight(this._pMethodSetup._iDiffuseMethodVO,e,a,this._pRegisterCache)),g&&(this._pFragmentCode+=this._pMethodSetup._iSpecularMethod.iGetFragmentCodePerLight(this._pMethodSetup._iSpecularMethodVO,
e,b,this._pRegisterCache)),this._pRegisterCache.removeFragmentTempUsage(e)};a.prototype.compileLightProbeCode=function(){var a,b=[".x",".y",".z",".w"],d=[],e,f,g=this._usingSpecularMethod&&this.pUsesProbesForSpecular(),w=this.pUsesProbesForDiffuse();if(g||w){w&&(this._pLightProbeDiffuseIndices=[]);g&&(this._pLightProbeSpecularIndices=[]);for(e=0;e<this._pNumProbeRegisters;++e)d[e]=this._pRegisterCache.getFreeFragmentConstant(),0==e&&(this._pProbeWeightsIndex=4*d[e].index);for(e=0;e<this._pNumLightProbes;++e)a=
d[Math.floor(e/4)].toString()+b[e%4],w&&(f=this._pRegisterCache.getFreeTextureReg(),this._pLightProbeDiffuseIndices[e]=f.index,this._pFragmentCode+=this._pMethodSetup._iDiffuseMethod.iGetFragmentCodePerProbe(this._pMethodSetup._iDiffuseMethodVO,f,a,this._pRegisterCache)),g&&(f=this._pRegisterCache.getFreeTextureReg(),this._pLightProbeSpecularIndices[e]=f.index,this._pFragmentCode+=this._pMethodSetup._iSpecularMethod.iGetFragmentCodePerProbe(this._pMethodSetup._iSpecularMethodVO,f,a,this._pRegisterCache))}};
return a}(b.materials.ShaderCompiler);g.SuperShaderCompiler=e})(b.materials||(b.materials={}))})(away||(away={}));(function(b){(function(b){var e=function(){function b(){}b.LIGHTS=1;b.PROBES=2;b.ALL=3;return b}();b.LightSources=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._useTexture=!1;this._ambientColor=16777215;this._ambientB=this._ambientG=this._ambientR=0;this._ambient=1;this._iLightAmbientB=this._iLightAmbientG=this._iLightAmbientR=0}__extends(a,d);a.prototype.iInitVO=function(a){a.needsUV=this._useTexture};a.prototype.iInitConstants=function(a){a.fragmentData[a.fragmentConstantsIndex+3]=1};Object.defineProperty(a.prototype,"ambient",{get:function(){return this._ambient},set:function(a){this._ambient=
a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"ambientColor",{get:function(){return this._ambientColor},set:function(a){this._ambientColor=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"texture",{get:function(){return this._texture},set:function(a){var b=null!=a;(b!=this._useTexture||a&&this._texture&&(a.hasMipMaps!=this._texture.hasMipMaps||a.format!=this._texture.format))&&this.iInvalidateShaderProgram();this._useTexture=b;this._texture=a},enumerable:!0,
configurable:!0});a.prototype.copyFrom=function(a){this.ambient=a.ambient;this.ambientColor=a.ambientColor};a.prototype.iCleanCompilationData=function(){d.prototype.iCleanCompilationData.call(this);this._ambientInputRegister=null};a.prototype.iGetFragmentCode=function(a,b,d){var e="";this._useTexture?(this._ambientInputRegister=b.getFreeTextureReg(),a.texturesIndex=this._ambientInputRegister.index,e+=this.pGetTex2DSampleCode(a,d,this._ambientInputRegister,this._texture)+"div "+d.toString()+".xyz, "+
d.toString()+".xyz, "+d.toString()+".w\n"):(this._ambientInputRegister=b.getFreeFragmentConstant(),a.fragmentConstantsIndex=4*this._ambientInputRegister.index,e+="mov "+d.toString()+", "+this._ambientInputRegister.toString()+"\n");return e};a.prototype.iActivate=function(a,d){this._useTexture&&(d._iContext3D.setSamplerStateAt(a.texturesIndex,a.repeatTextures?b.display3D.Context3DWrapMode.REPEAT:b.display3D.Context3DWrapMode.CLAMP,a.useSmoothTextures?b.display3D.Context3DTextureFilter.LINEAR:b.display3D.Context3DTextureFilter.NEAREST,
a.useMipmapping?b.display3D.Context3DMipFilter.MIPLINEAR:b.display3D.Context3DMipFilter.MIPNONE),d._iContext3D.setTextureAt(a.texturesIndex,this._texture.getTextureForStage3D(d)))};a.prototype.updateAmbient=function(){this._ambientR=(this._ambientColor>>16&255)/255*this._ambient*this._iLightAmbientR;this._ambientG=(this._ambientColor>>8&255)/255*this._ambient*this._iLightAmbientG;this._ambientB=(this.ambientColor&255)/255*this._ambient*this._iLightAmbientB};a.prototype.iSetRenderState=function(a,
b,d,e){this.updateAmbient();this._useTexture||(b=a.fragmentConstantsIndex,a=a.fragmentData,a[b]=this._ambientR,a[b+1]=this._ambientG,a[b+2]=this._ambientB)};return a}(b.materials.ShadingMethodBase);g.BasicAmbientMethod=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._diffuseColor=16777215;this._diffuseA=this._diffuseB=this._diffuseG=this._diffuseR=1;this._alphaThreshold=0}__extends(a,d);Object.defineProperty(a.prototype,"iUseAmbientTexture",{get:function(){return this._useAmbientTexture},set:function(a){this._useAmbientTexture!=a&&(this._useAmbientTexture=a,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0});a.prototype.iInitVO=function(a){a.needsUV=this._useTexture;a.needsNormals=
0<a.numLights};a.prototype.generateMip=function(a){this._useTexture&&this._texture.getTextureForStage3D(a)};Object.defineProperty(a.prototype,"diffuseAlpha",{get:function(){return this._diffuseA},set:function(a){this._diffuseA=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"diffuseColor",{get:function(){return this._diffuseColor},set:function(a){this._diffuseColor=a;this.updateDiffuse()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"texture",{get:function(){return this._texture},
set:function(a){var b=null!=a;(b!=this._useTexture||a&&this._texture&&(a.hasMipMaps!=this._texture.hasMipMaps||a.format!=this._texture.format))&&this.iInvalidateShaderProgram();this._useTexture=b;this._texture=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"alphaThreshold",{get:function(){return this._alphaThreshold},set:function(a){0>a?a=0:1<a&&(a=1);a!=this._alphaThreshold&&(0!=a&&0!=this._alphaThreshold||this.iInvalidateShaderProgram(),this._alphaThreshold=a)},enumerable:!0,
configurable:!0});a.prototype.dispose=function(){this._texture=null};a.prototype.copyFrom=function(a){this.alphaThreshold=a.alphaThreshold;this.texture=a.texture;this.iUseAmbientTexture=a.iUseAmbientTexture;this.diffuseAlpha=a.diffuseAlpha;this.diffuseColor=a.diffuseColor};a.prototype.iCleanCompilationData=function(){d.prototype.iCleanCompilationData.call(this);this._diffuseInputRegister=this.pTotalLightColorReg=this._shadowRegister=null};a.prototype.iGetFragmentPreLightingCode=function(a,b){this._isFirstLight=
!0;0<a.numLights&&(this.pTotalLightColorReg=b.getFreeFragmentVectorTemp(),b.addFragmentTempUsages(this.pTotalLightColorReg,1));return""};a.prototype.iGetFragmentCodePerLight=function(a,b,d,e){var f="",g;this._isFirstLight?g=this.pTotalLightColorReg:(g=e.getFreeFragmentVectorTemp(),e.addFragmentTempUsages(g,1));f+="dp3 "+g+".x, "+b.toString()+", "+this._sharedRegisters.normalFragment.toString()+"\nmax "+g.toString()+".w, "+g.toString()+".x, "+this._sharedRegisters.commons.toString()+".y\n";a.useLightFallOff&&
(f+="mul "+g.toString()+".w, "+g.toString()+".w, "+b.toString()+".w\n");null!=this._iModulateMethod&&(f+=this._iModulateMethod(a,g,e,this._sharedRegisters));f+="mul "+g.toString()+", "+g.toString()+".w, "+d.toString()+"\n";this._isFirstLight||(f+="add "+this.pTotalLightColorReg.toString()+".xyz, "+this.pTotalLightColorReg.toString()+", "+g.toString()+"\n",e.removeFragmentTempUsage(g));this._isFirstLight=!1;return f};a.prototype.iGetFragmentCodePerProbe=function(a,b,d,e){var f="",g;this._isFirstLight?
g=this.pTotalLightColorReg:(g=e.getFreeFragmentVectorTemp(),e.addFragmentTempUsages(g,1));f+="tex "+g.toString()+", "+this._sharedRegisters.normalFragment.toString()+", "+b.toString()+" <cube,linear,miplinear>\nmul "+g.toString()+".xyz, "+g.toString()+".xyz, "+d+"\n";null!=this._iModulateMethod&&(f+=this._iModulateMethod(a,g,e,this._sharedRegisters));this._isFirstLight||(f+="add "+this.pTotalLightColorReg+".xyz, "+this.pTotalLightColorReg+", "+g.toString()+"\n",e.removeFragmentTempUsage(g));this._isFirstLight=
!1;return f};a.prototype.iGetFragmentPostLightingCode=function(a,b,d){var e="",f,g;0<a.numLights?(this._shadowRegister&&(e+=this.pApplyShadow(a,b)),f=b.getFreeFragmentVectorTemp(),b.addFragmentTempUsages(f,1)):f=d;this._useTexture?(this._diffuseInputRegister=b.getFreeTextureReg(),a.texturesIndex=this._diffuseInputRegister.index,e+=this.pGetTex2DSampleCode(a,f,this._diffuseInputRegister,this._texture),0<this._alphaThreshold&&(g=b.getFreeFragmentConstant(),a.fragmentConstantsIndex=4*g.index,e+="sub "+
f.toString()+".w, "+f.toString()+".w, "+g.toString()+".x\nkil "+f.toString()+".w\nadd "+f.toString()+".w, "+f.toString()+".w, "+g.toString()+".x\n")):(this._diffuseInputRegister=b.getFreeFragmentConstant(),a.fragmentConstantsIndex=4*this._diffuseInputRegister.index,e+="mov "+f.toString()+", "+this._diffuseInputRegister.toString()+"\n");if(0==a.numLights)return e;e+="sat "+this.pTotalLightColorReg.toString()+", "+this.pTotalLightColorReg.toString()+"\n";this._useAmbientTexture?e+="mul "+f.toString()+
".xyz, "+f.toString()+", "+this.pTotalLightColorReg.toString()+"\nmul "+this.pTotalLightColorReg.toString()+".xyz, "+d.toString()+", "+this.pTotalLightColorReg.toString()+"\nsub "+d.toString()+".xyz, "+d.toString()+", "+this.pTotalLightColorReg.toString()+"\nadd "+d.toString()+".xyz, "+f.toString()+", "+d.toString()+"\n":(e+="add "+d.toString()+".xyz, "+this.pTotalLightColorReg.toString()+", "+d.toString()+"\n",e=this._useTexture?e+("mul "+d.toString()+".xyz, "+f.toString()+", "+d.toString()+"\nmov "+
d+".w, "+f+".w\n"):e+("mul "+d.toString()+".xyz, "+this._diffuseInputRegister.toString()+", "+d.toString()+"\nmov "+d.toString()+".w, "+this._diffuseInputRegister.toString()+".w\n"));b.removeFragmentTempUsage(this.pTotalLightColorReg);b.removeFragmentTempUsage(f);return e};a.prototype.pApplyShadow=function(a,b){return"mul "+this.pTotalLightColorReg.toString()+".xyz, "+this.pTotalLightColorReg.toString()+", "+this._shadowRegister.toString()+".w\n"};a.prototype.iActivate=function(a,d){if(this._useTexture)d._iContext3D.setSamplerStateAt(a.texturesIndex,
a.repeatTextures?b.display3D.Context3DWrapMode.REPEAT:b.display3D.Context3DWrapMode.CLAMP,a.useSmoothTextures?b.display3D.Context3DTextureFilter.LINEAR:b.display3D.Context3DTextureFilter.NEAREST,a.useMipmapping?b.display3D.Context3DMipFilter.MIPLINEAR:b.display3D.Context3DMipFilter.MIPNONE),d._iContext3D.setTextureAt(a.texturesIndex,this._texture.getTextureForStage3D(d)),0<this._alphaThreshold&&(a.fragmentData[a.fragmentConstantsIndex]=this._alphaThreshold);else{var e=a.fragmentConstantsIndex,g=a.fragmentData;
g[e]=this._diffuseR;g[e+1]=this._diffuseG;g[e+2]=this._diffuseB;g[e+3]=this._diffuseA}};a.prototype.updateDiffuse=function(){this._diffuseR=(this._diffuseColor>>16&255)/255;this._diffuseG=(this._diffuseColor>>8&255)/255;this._diffuseB=(this._diffuseColor&255)/255};Object.defineProperty(a.prototype,"iShadowRegister",{set:function(a){this._shadowRegister=a},enumerable:!0,configurable:!0});a.prototype.setIShadowRegister=function(a){this._shadowRegister=a};return a}(b.materials.LightingMethodBase);g.BasicDiffuseMethod=
e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this)}__extends(a,d);a.prototype.iInitVO=function(a){a.needsUV=this._texture?!0:!1};Object.defineProperty(a.prototype,"iTangentSpace",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"iHasOutput",{get:function(){return this._useTexture},enumerable:!0,configurable:!0});a.prototype.copyFrom=function(a){this.normalMap=a.normalMap};Object.defineProperty(a.prototype,"normalMap",{get:function(){return this._texture},
set:function(a){this.setNormalMap(a)},enumerable:!0,configurable:!0});a.prototype.setNormalMap=function(a){(null!=a!=this._useTexture||a&&this._texture&&(a.hasMipMaps!=this._texture.hasMipMaps||a.format!=this._texture.format))&&this.iInvalidateShaderProgram();this._useTexture=Boolean(a);this._texture=a};a.prototype.iCleanCompilationData=function(){d.prototype.iCleanCompilationData.call(this);this._pNormalTextureRegister=null};a.prototype.dispose=function(){this._texture&&(this._texture=null)};a.prototype.iActivate=
function(a,d){0<=a.texturesIndex&&(d._iContext3D.setSamplerStateAt(a.texturesIndex,a.repeatTextures?b.display3D.Context3DWrapMode.REPEAT:b.display3D.Context3DWrapMode.CLAMP,a.useSmoothTextures?b.display3D.Context3DTextureFilter.LINEAR:b.display3D.Context3DTextureFilter.NEAREST,a.useMipmapping?b.display3D.Context3DMipFilter.MIPLINEAR:b.display3D.Context3DMipFilter.MIPNONE),d._iContext3D.setTextureAt(a.texturesIndex,this._texture.getTextureForStage3D(d)))};a.prototype.iGetFragmentCode=function(a,b,
d){this._pNormalTextureRegister=b.getFreeTextureReg();a.texturesIndex=this._pNormalTextureRegister.index;return this.pGetTex2DSampleCode(a,d,this._pNormalTextureRegister,this._texture)+"sub "+d.toString()+".xyz, "+d.toString()+".xyz, "+this._sharedRegisters.commons.toString()+".xxx\t\nnrm "+d.toString()+".xyz, "+d.toString()+".xyz\t\t\t\t\t\t\t\n"};return a}(b.materials.ShadingMethodBase);g.BasicNormalMethod=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._gloss=50;this._specular=1;this._specularColor=16777215;this._iSpecularB=this._iSpecularG=this._iSpecularR=1}__extends(a,d);a.prototype.iInitVO=function(a){a.needsUV=this._useTexture;a.needsNormals=0<a.numLights;a.needsView=0<a.numLights};Object.defineProperty(a.prototype,"gloss",{get:function(){return this._gloss},set:function(a){this._gloss=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"specular",{get:function(){return this._specular},
set:function(a){a!=this._specular&&(this._specular=a,this.updateSpecular())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"specularColor",{get:function(){return this._specularColor},set:function(a){this._specularColor!=a&&(0!=this._specularColor&&0!=a||this.iInvalidateShaderProgram(),this._specularColor=a,this.updateSpecular())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"texture",{get:function(){return this._texture},set:function(a){var b=null!=a;(b!=this._useTexture||
a&&this._texture&&(a.hasMipMaps!=this._texture.hasMipMaps||a.format!=this._texture.format))&&this.iInvalidateShaderProgram();this._useTexture=b;this._texture=a},enumerable:!0,configurable:!0});a.prototype.copyFrom=function(a){this.texture=a.texture;this.specular=a.specular;this.specularColor=a.specularColor;this.gloss=a.gloss};a.prototype.iCleanCompilationData=function(){d.prototype.iCleanCompilationData.call(this);this._specularDataRegister=this._specularTexData=this._specularTextureRegister=this._totalLightColorReg=
this._shadowRegister=null};a.prototype.iGetFragmentPreLightingCode=function(a,b){var d="";this._isFirstLight=!0;0<a.numLights&&(this._specularDataRegister=b.getFreeFragmentConstant(),a.fragmentConstantsIndex=4*this._specularDataRegister.index,this._useTexture?(this._specularTexData=b.getFreeFragmentVectorTemp(),b.addFragmentTempUsages(this._specularTexData,1),this._specularTextureRegister=b.getFreeTextureReg(),a.texturesIndex=this._specularTextureRegister.index,d=this.pGetTex2DSampleCode(a,this._specularTexData,
this._specularTextureRegister,this._texture)):this._specularTextureRegister=null,this._totalLightColorReg=b.getFreeFragmentVectorTemp(),b.addFragmentTempUsages(this._totalLightColorReg,1));return d};a.prototype.iGetFragmentCodePerLight=function(a,b,d,e){var f="",g;this._isFirstLight?g=this._totalLightColorReg:(g=e.getFreeFragmentVectorTemp(),e.addFragmentTempUsages(g,1));f+="add "+g.toString()+", "+b.toString()+", "+this._sharedRegisters.viewDirFragment.toString()+"\nnrm "+g.toString()+".xyz, "+g.toString()+
"\ndp3 "+g.toString()+".w, "+this._sharedRegisters.normalFragment.toString()+", "+g.toString()+"\nsat "+g.toString()+".w, "+g.toString()+".w\n";f=this._useTexture?f+("mul "+this._specularTexData.toString()+".w, "+this._specularTexData.toString()+".y, "+this._specularDataRegister.toString()+".w\npow "+g+".w, "+g+".w, "+this._specularTexData.toString()+".w\n"):f+("pow "+g.toString()+".w, "+g.toString()+".w, "+this._specularDataRegister.toString()+".w\n");a.useLightFallOff&&(f+="mul "+g.toString()+".w, "+
g.toString()+".w, "+b.toString()+".w\n");if(null!=this._iModulateMethod)if(null!=this._iModulateMethodScope)f+=this._iModulateMethod.apply(this._iModulateMethodScope,[a,g,e,this._sharedRegisters]);else throw"Modulated methods needs a scope";f+="mul "+g.toString()+".xyz, "+d.toString()+", "+g.toString()+".w\n";this._isFirstLight||(f+="add "+this._totalLightColorReg.toString()+".xyz, "+this._totalLightColorReg.toString()+", "+g.toString()+"\n",e.removeFragmentTempUsage(g));this._isFirstLight=!1;return f};
a.prototype.iGetFragmentCodePerProbe=function(a,b,d,e){var f="",g;this._isFirstLight?g=this._totalLightColorReg:(g=e.getFreeFragmentVectorTemp(),e.addFragmentTempUsages(g,1));var w=this._sharedRegisters.normalFragment,s=this._sharedRegisters.viewDirFragment,f=f+("dp3 "+g.toString()+".w, "+w.toString()+", "+s.toString()+"\nadd "+g.toString()+".w, "+g.toString()+".w, "+g.toString()+".w\nmul "+g.toString()+", "+g.toString()+".w, "+w.toString()+"\nsub "+g.toString()+", "+g.toString()+", "+s.toString()+
"\ntex "+g.toString()+", "+g.toString()+", "+b.toString()+" <cube,"+(a.useSmoothTextures?"linear":"nearest")+",miplinear>\nmul "+g.toString()+".xyz, "+g.toString()+", "+d.toString()+"\n");if(null!=this._iModulateMethod)if(null!=this._iModulateMethodScope)f+=this._iModulateMethod.apply(this._iModulateMethodScope,[a,g,e,this._sharedRegisters]);else throw"Modulated methods needs a scope";this._isFirstLight||(f+="add "+this._totalLightColorReg.toString()+".xyz, "+this._totalLightColorReg.toString()+", "+
g.toString()+"\n",e.removeFragmentTempUsage(g));this._isFirstLight=!1;return f};a.prototype.iGetFragmentPostLightingCode=function(a,b,d){var e="";if(0==a.numLights)return e;this._shadowRegister&&(e+="mul "+this._totalLightColorReg.toString()+".xyz, "+this._totalLightColorReg.toString()+", "+this._shadowRegister.toString()+".w\n");this._useTexture&&(e+="mul "+this._totalLightColorReg.toString()+".xyz, "+this._totalLightColorReg.toString()+", "+this._specularTexData.toString()+".x\n",b.removeFragmentTempUsage(this._specularTexData));
e+="mul "+this._totalLightColorReg.toString()+".xyz, "+this._totalLightColorReg.toString()+", "+this._specularDataRegister.toString()+"\nadd "+d.toString()+".xyz, "+d.toString()+", "+this._totalLightColorReg.toString()+"\n";b.removeFragmentTempUsage(this._totalLightColorReg);return e};a.prototype.iActivate=function(a,d){if(0!=a.numLights){this._useTexture&&(d._iContext3D.setSamplerStateAt(a.texturesIndex,a.repeatTextures?b.display3D.Context3DWrapMode.REPEAT:b.display3D.Context3DWrapMode.CLAMP,a.useSmoothTextures?
b.display3D.Context3DTextureFilter.LINEAR:b.display3D.Context3DTextureFilter.NEAREST,a.useMipmapping?b.display3D.Context3DMipFilter.MIPLINEAR:b.display3D.Context3DMipFilter.MIPNONE),d._iContext3D.setTextureAt(a.texturesIndex,this._texture.getTextureForStage3D(d)));var e=a.fragmentConstantsIndex,g=a.fragmentData;g[e]=this._iSpecularR;g[e+1]=this._iSpecularG;g[e+2]=this._iSpecularB;g[e+3]=this._gloss}};a.prototype.updateSpecular=function(){this._iSpecularR=(this._specularColor>>16&255)/255*this._specular;
this._iSpecularG=(this._specularColor>>8&255)/255*this._specular;this._iSpecularB=(this._specularColor&255)/255*this._specular};Object.defineProperty(a.prototype,"iShadowRegister",{set:function(a){this._shadowRegister=a},enumerable:!0,configurable:!0});a.prototype.setIShadowRegister=function(a){this._shadowRegister=a};return a}(b.materials.LightingMethodBase);g.BasicSpecularMethod=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(){b.call(this)}__extends(a,b);Object.defineProperty(a.prototype,"colorTransform",{get:function(){return this._colorTransform},set:function(a){this._colorTransform=a},enumerable:!0,configurable:!0});a.prototype.iGetFragmentCode=function(a,b,d){var e="",f=b.getFreeFragmentConstant();b=b.getFreeFragmentConstant();a.fragmentConstantsIndex=4*f.index;return e+="mul "+d.toString()+", "+d.toString()+", "+f.toString()+"\nadd "+d.toString()+", "+d.toString()+
", "+b.toString()+"\n"};a.prototype.iActivate=function(a,b){var d=1/255,e=a.fragmentConstantsIndex,f=a.fragmentData;f[e]=this._colorTransform.redMultiplier;f[e+1]=this._colorTransform.greenMultiplier;f[e+2]=this._colorTransform.blueMultiplier;f[e+3]=this._colorTransform.alphaMultiplier;f[e+4]=this._colorTransform.redOffset*d;f[e+5]=this._colorTransform.greenOffset*d;f[e+6]=this._colorTransform.blueOffset*d;f[e+7]=this._colorTransform.alphaOffset*d};return a}(b.materials.EffectMethodBase);g.ColorTransformMethod=
e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(a,e){"undefined"===typeof a&&(a=null);"undefined"===typeof e&&(e=null);d.call(this);this.pBaseMethod=e||new b.materials.BasicDiffuseMethod;this.pBaseMethod._iModulateMethod=a;this.pBaseMethod.addEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,this.onShaderInvalidated,this)}__extends(a,d);Object.defineProperty(a.prototype,"baseMethod",{get:function(){return this.pBaseMethod},set:function(a){this.pBaseMethod!=a&&(this.pBaseMethod.removeEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,
this.onShaderInvalidated,this),this.pBaseMethod=a,this.pBaseMethod.addEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,this.onShaderInvalidated,this),this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0});a.prototype.iInitVO=function(a){this.pBaseMethod.iInitVO(a)};a.prototype.iInitConstants=function(a){this.pBaseMethod.iInitConstants(a)};a.prototype.dispose=function(){this.pBaseMethod.removeEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,this.onShaderInvalidated,
this);this.pBaseMethod.dispose()};Object.defineProperty(a.prototype,"alphaThreshold",{get:function(){return this.pBaseMethod.alphaThreshold},set:function(a){this.pBaseMethod.alphaThreshold=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"texture",{get:function(){return this.pBaseMethod.texture},set:function(a){this.pBaseMethod.texture=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"diffuseAlpha",{get:function(){return this.pBaseMethod.diffuseAlpha},set:function(a){this.pBaseMethod.diffuseAlpha=
a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"diffuseColor",{get:function(){return this.pBaseMethod.diffuseColor},set:function(a){this.pBaseMethod.diffuseColor=a},enumerable:!0,configurable:!0});a.prototype.iGetFragmentPreLightingCode=function(a,b){return this.pBaseMethod.iGetFragmentPreLightingCode(a,b)};a.prototype.iGetFragmentCodePerLight=function(a,b,d,e){a=this.pBaseMethod.iGetFragmentCodePerLight(a,b,d,e);this.pTotalLightColorReg=this.pBaseMethod.pTotalLightColorReg;
return a};a.prototype.iGetFragmentCodePerProbe=function(a,b,d,e){a=this.pBaseMethod.iGetFragmentCodePerProbe(a,b,d,e);this.pTotalLightColorReg=this.pBaseMethod.pTotalLightColorReg;return a};a.prototype.iActivate=function(a,b){this.pBaseMethod.iActivate(a,b)};a.prototype.iDeactivate=function(a,b){this.pBaseMethod.iDeactivate(a,b)};a.prototype.iGetVertexCode=function(a,b){return this.pBaseMethod.iGetVertexCode(a,b)};a.prototype.iGetFragmentPostLightingCode=function(a,b,d){return this.pBaseMethod.iGetFragmentPostLightingCode(a,
b,d)};a.prototype.iReset=function(){this.pBaseMethod.iReset()};a.prototype.iCleanCompilationData=function(){d.prototype.iCleanCompilationData.call(this);this.pBaseMethod.iCleanCompilationData()};Object.defineProperty(a.prototype,"iSharedRegisters",{set:function(a){this.pBaseMethod.setISharedRegisters(a);d.prototype.setISharedRegisters.call(this,a)},enumerable:!0,configurable:!0});a.prototype.setISharedRegisters=function(a){this.pBaseMethod.setISharedRegisters(a);d.prototype.setISharedRegisters.call(this,
a)};Object.defineProperty(a.prototype,"iShadowRegister",{set:function(a){d.prototype.setIShadowRegister.call(this,a);this.pBaseMethod.setIShadowRegister(a)},enumerable:!0,configurable:!0});a.prototype.onShaderInvalidated=function(a){this.iInvalidateShaderProgram()};return a}(b.materials.BasicDiffuseMethod);g.CompositeDiffuseMethod=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this)}__extends(a,d);a.prototype.initCompositeSpecularMethod=function(a,d,e){"undefined"===typeof e&&(e=null);this._baseMethod=e||new b.materials.BasicSpecularMethod;this._baseMethod._iModulateMethod=d;this._baseMethod._iModulateMethodScope=a;this._baseMethod.addEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,this.onShaderInvalidated,this)};a.prototype.iInitVO=function(a){this._baseMethod.iInitVO(a)};a.prototype.iInitConstants=
function(a){this._baseMethod.iInitConstants(a)};Object.defineProperty(a.prototype,"baseMethod",{get:function(){return this._baseMethod},set:function(a){this._baseMethod!=a&&(this._baseMethod.removeEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,this.onShaderInvalidated,this),this._baseMethod=a,this._baseMethod.addEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,this.onShaderInvalidated,this),this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"gloss",{get:function(){return this._baseMethod.gloss},set:function(a){this._baseMethod.gloss=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"specular",{get:function(){return this._baseMethod.specular},set:function(a){this._baseMethod.specular=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"passes",{get:function(){return this._baseMethod.passes},enumerable:!0,configurable:!0});a.prototype.dispose=function(){this._baseMethod.removeEventListener(b.events.ShadingMethodEvent.SHADER_INVALIDATED,
this.onShaderInvalidated,this);this._baseMethod.dispose()};Object.defineProperty(a.prototype,"texture",{get:function(){return this._baseMethod.texture},set:function(a){this._baseMethod.texture=a},enumerable:!0,configurable:!0});a.prototype.iActivate=function(a,b){this._baseMethod.iActivate(a,b)};a.prototype.iDeactivate=function(a,b){this._baseMethod.iDeactivate(a,b)};Object.defineProperty(a.prototype,"iSharedRegisters",{set:function(a){d.prototype.setISharedRegisters.call(this,a);this._baseMethod.setISharedRegisters(a)},
enumerable:!0,configurable:!0});a.prototype.setISharedRegisters=function(a){d.prototype.setISharedRegisters.call(this,a);this._baseMethod.setISharedRegisters(a)};a.prototype.iGetVertexCode=function(a,b){return this._baseMethod.iGetVertexCode(a,b)};a.prototype.iGetFragmentPreLightingCode=function(a,b){return this._baseMethod.iGetFragmentPreLightingCode(a,b)};a.prototype.iGetFragmentCodePerLight=function(a,b,d,e){return this._baseMethod.iGetFragmentCodePerLight(a,b,d,e)};a.prototype.iGetFragmentCodePerProbe=
function(a,b,d,e){return this._baseMethod.iGetFragmentCodePerProbe(a,b,d,e)};a.prototype.iGetFragmentPostLightingCode=function(a,b,d){return this._baseMethod.iGetFragmentPostLightingCode(a,b,d)};a.prototype.iReset=function(){this._baseMethod.iReset()};a.prototype.iCleanCompilationData=function(){d.prototype.iCleanCompilationData.call(this);this._baseMethod.iCleanCompilationData()};Object.defineProperty(a.prototype,"iShadowRegister",{set:function(a){this.setIShadowRegister(a);this._baseMethod.setIShadowRegister(a)},
enumerable:!0,configurable:!0});a.prototype.onShaderInvalidated=function(a){this.iInvalidateShaderProgram()};return a}(b.materials.BasicSpecularMethod);g.CompositeSpecularMethod=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(a,e){"undefined"===typeof e&&(e=1);b.call(this);this._cubeTexture=a;this._alpha=e}__extends(a,b);Object.defineProperty(a.prototype,"mask",{get:function(){return this._mask},set:function(a){(a!=this._mask||a&&this._mask&&(a.hasMipMaps!=this._mask.hasMipMaps||a.format!=this._mask.format))&&this.iInvalidateShaderProgram();this._mask=a},enumerable:!0,configurable:!0});a.prototype.iInitVO=function(a){a.needsNormals=!0;a.needsView=!0;a.needsUV=null!=
this._mask};Object.defineProperty(a.prototype,"envMap",{get:function(){return this._cubeTexture},set:function(a){this._cubeTexture=a},enumerable:!0,configurable:!0});a.prototype.dispose=function(){};Object.defineProperty(a.prototype,"alpha",{get:function(){return this._alpha},set:function(a){this._alpha=a},enumerable:!0,configurable:!0});a.prototype.iActivate=function(a,b){var d=b._iContext3D;a.fragmentData[a.fragmentConstantsIndex]=this._alpha;d.setTextureAt(a.texturesIndex,this._cubeTexture.getTextureForStage3D(b));
this._mask&&d.setTextureAt(a.texturesIndex+1,this._mask.getTextureForStage3D(b))};a.prototype.iGetFragmentCode=function(a,b,d){var e=b.getFreeFragmentConstant(),f=b.getFreeFragmentVectorTemp(),g="",w=b.getFreeTextureReg();a.texturesIndex=w.index;a.fragmentConstantsIndex=4*e.index;b.addFragmentTempUsages(f,1);var s=b.getFreeFragmentVectorTemp(),g=g+("dp3 "+f+".w, "+this._sharedRegisters.viewDirFragment+".xyz, "+this._sharedRegisters.normalFragment+".xyz\t\t\nadd "+f+".w, "+f+".w, "+f+".w\t\t\t\t\t\t\t\t\t\t\t\nmul "+
f+".xyz, "+this._sharedRegisters.normalFragment+".xyz, "+f+".w\t\t\t\t\t\t\nsub "+f+".xyz, "+f+".xyz, "+this._sharedRegisters.viewDirFragment+".xyz\t\t\t\t\t\n"+this.pGetTexCubeSampleCode(a,f,w,this._cubeTexture,f)+"sub "+s+".w, "+f+".w, fc0.x\t\t\t\t\t\t\t\t\t\nkil "+s+".w\nsub "+f+", "+f+", "+d+"\t\t\t\t\t\t\t\t\t\t\t\n");this._mask&&(w=b.getFreeTextureReg(),g+=this.pGetTex2DSampleCode(a,s,w,this._mask,this._sharedRegisters.uvVarying)+"mul "+f+", "+s+", "+f+"\n");g+="mul "+f+", "+f+", "+e+".x\t\t\t\t\t\t\t\t\t\t\nadd "+
d+", "+d+", "+f+"\t\t\t\t\t\t\t\t\t\t\n";b.removeFragmentTempUsage(f);return g};return a}(b.materials.EffectMethodBase);g.EnvMapMethod=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(a,e){"undefined"===typeof a&&(a=!0);"undefined"===typeof e&&(e=null);b.call(this);this._fresnelPower=5;this._normalReflectance=0.028;this.initCompositeSpecularMethod(this,this.modulateSpecular,e);this._incidentLight=!a}__extends(a,b);a.prototype.iInitConstants=function(a){var b=a.secondaryFragmentConstantsIndex;a.fragmentData[b+2]=1;a.fragmentData[b+3]=0};Object.defineProperty(a.prototype,"basedOnSurface",{get:function(){return!this._incidentLight},
set:function(a){this._incidentLight==a&&(this._incidentLight=!a,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"fresnelPower",{get:function(){return this._fresnelPower},set:function(a){this._fresnelPower=a},enumerable:!0,configurable:!0});a.prototype.iCleanCompilationData=function(){b.prototype.iCleanCompilationData.call(this);this._dataReg=null};Object.defineProperty(a.prototype,"normalReflectance",{get:function(){return this._normalReflectance},
set:function(a){this._normalReflectance=a},enumerable:!0,configurable:!0});a.prototype.iActivate=function(a,e){b.prototype.iActivate.call(this,a,e);var g=a.fragmentData,h=a.secondaryFragmentConstantsIndex;g[h]=this._normalReflectance;g[h+1]=this._fresnelPower};a.prototype.iGetFragmentPreLightingCode=function(a,e){this._dataReg=e.getFreeFragmentConstant();console.log("FresnelSpecularMethod","iGetFragmentPreLightingCode",this._dataReg);a.secondaryFragmentConstantsIndex=4*this._dataReg.index;return b.prototype.iGetFragmentPreLightingCode.call(this,
a,e)};a.prototype.modulateSpecular=function(a,b,d,e){a="dp3 "+b+".y, "+e.viewDirFragment+".xyz, "+(this._incidentLight?b+".xyz\n":e.normalFragment+".xyz\n")+"sub "+b+".y, "+this._dataReg+".z, "+b+".y\npow "+b+".x, "+b+".y, "+this._dataReg+".y\nsub "+b+".y, "+this._dataReg+".z, "+b+".y\nmul "+b+".y, "+this._dataReg+".x, "+b+".y\nadd "+b+".y, "+b+".x, "+b+".y\nmul "+b+".w, "+b+".w, "+b+".y\n";console.log("FresnelSpecularMethod","modulateSpecular",a);return a};return a}(b.materials.CompositeSpecularMethod);
g.FresnelSpecularMethod=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(a,e){b.call(this);this._useSecondNormalMap=!1;this._water2OffsetY=this._water2OffsetX=this._water1OffsetY=this._water1OffsetX=0;this.normalMap=a;this.secondaryNormalMap=e}__extends(a,b);a.prototype.iInitConstants=function(a){var b=a.fragmentConstantsIndex;a.fragmentData[b]=0.5;a.fragmentData[b+1]=0;a.fragmentData[b+2]=0;a.fragmentData[b+3]=1};a.prototype.iInitVO=function(a){b.prototype.iInitVO.call(this,a);this._useSecondNormalMap=this.normalMap!=
this.secondaryNormalMap};Object.defineProperty(a.prototype,"water1OffsetX",{get:function(){return this._water1OffsetX},set:function(a){this._water1OffsetX=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"water1OffsetY",{get:function(){return this._water1OffsetY},set:function(a){this._water1OffsetY=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"water2OffsetX",{get:function(){return this._water2OffsetX},set:function(a){this._water2OffsetX=a},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"water2OffsetY",{get:function(){return this._water2OffsetY},set:function(a){this._water2OffsetY=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"normalMap",{set:function(a){a&&this.setNormalMap(a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"secondaryNormalMap",{get:function(){return this._texture2},set:function(a){this._texture2=a},enumerable:!0,configurable:!0});a.prototype.iCleanCompilationData=function(){b.prototype.iCleanCompilationData.call(this);
this._normalTextureRegister2=null};a.prototype.dispose=function(){b.prototype.dispose.call(this);this._texture2=null};a.prototype.iActivate=function(a,e){b.prototype.iActivate.call(this,a,e);var g=a.fragmentData,h=a.fragmentConstantsIndex;g[h+4]=this._water1OffsetX;g[h+5]=this._water1OffsetY;g[h+6]=this._water2OffsetX;g[h+7]=this._water2OffsetY;this._useSecondNormalMap&&e._iContext3D.setTextureAt(a.texturesIndex+1,this._texture2.getTextureForStage3D(e))};a.prototype.getFragmentCode=function(a,b,d){var e=
b.getFreeFragmentVectorTemp(),f=b.getFreeFragmentConstant(),g=b.getFreeFragmentConstant();this._pNormalTextureRegister=b.getFreeTextureReg();this._normalTextureRegister2=this._useSecondNormalMap?b.getFreeTextureReg():this._pNormalTextureRegister;a.texturesIndex=this._pNormalTextureRegister.index;a.fragmentConstantsIndex=4*f.index;return"add "+e+", "+this._sharedRegisters.uvVarying+", "+g+".xyxy\n"+this.pGetTex2DSampleCode(a,d,this._pNormalTextureRegister,this.normalMap,e)+"add "+e+", "+this._sharedRegisters.uvVarying+
", "+g+".zwzw\n"+this.pGetTex2DSampleCode(a,e,this._normalTextureRegister2,this._texture2,e)+"add "+d+", "+d+", "+e+"\t\t\nmul "+d+", "+d+", "+f+".x\t\nsub "+d+".xyz, "+d+".xyz, "+this._sharedRegisters.commons+".xxx\t\nnrm "+d+".xyz, "+d+".xyz\t\t\t\t\t\t\t\n"};return a}(b.materials.BasicNormalMethod);g.SimpleWaterNormalMethod=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(a,b){"undefined"===typeof a&&(a=13421772);"undefined"===typeof b&&(b=1);d.call(this);this._diffuseAlpha=1;this.color=a;this.alpha=b}__extends(a,d);Object.defineProperty(a.prototype,"alpha",{get:function(){return this._pScreenPass.diffuseMethod.diffuseAlpha},set:function(a){1<a?a=1:0>a&&(a=0);this._pScreenPass.diffuseMethod.diffuseAlpha=this._diffuseAlpha=a;this._pScreenPass.preserveAlpha=this.requiresBlending;this._pScreenPass.setBlendMode(this.getBlendMode()==
b.display.BlendMode.NORMAL&&this.requiresBlending?b.display.BlendMode.LAYER:this.getBlendMode())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"color",{get:function(){return this._pScreenPass.diffuseMethod.diffuseColor},set:function(a){this._pScreenPass.diffuseMethod.diffuseColor=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"requiresBlending",{get:function(){return this.getRequiresBlending()||1>this._diffuseAlpha},enumerable:!0,configurable:!0});return a}(b.materials.SinglePassMaterialBase);
g.ColorMaterial=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(){}d.getDefaultMaterial=function(a){d._defaultTexture||d.createDefaultTexture();d._defaultMaterial||d.createDefaultMaterial();return d._defaultMaterial};d.getDefaultTexture=function(a){d._defaultTexture||d.createDefaultTexture();return d._defaultTexture};d.createDefaultTexture=function(){d._defaultTextureBitmapData=d.createCheckeredBitmapData();d._defaultTexture=new b.textures.BitmapTexture(d._defaultTextureBitmapData,!1);d._defaultTexture.name=
"defaultTexture"};d.createCheckeredBitmapData=function(){var a=new b.display.BitmapData(8,8,!1,0),c,d;for(c=0;8>c;c++)for(d=0;8>d;d++)d&1^c&1&&a.setPixel(c,d,16777215);return a};d.createDefaultMaterial=function(){d._defaultMaterial=new b.materials.TextureMaterial(d._defaultTexture);d._defaultMaterial.mipmap=!1;d._defaultMaterial.smooth=!1;d._defaultMaterial.name="defaultMaterial"};return d}();g.DefaultMaterialManager=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(b){function a(a){b.call(this,a)}__extends(a,b);Object.defineProperty(a.prototype,"lightVertexConstantIndex",{get:function(){return this._lightVertexConstantIndex},enumerable:!0,configurable:!0});a.prototype.pInitRegisterIndices=function(){b.prototype.pInitRegisterIndices.call(this);this._lightVertexConstantIndex=-1};a.prototype.pCreateNormalRegisters=function(){this.tangentSpace&&(this._pSharedRegisters.animatedTangent=this._pRegisterCache.getFreeVertexVectorTemp(),
this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedTangent,1),this._pSharedRegisters.bitangent=this._pRegisterCache.getFreeVertexVectorTemp(),this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.bitangent,1),this._pSharedRegisters.tangentInput=this._pRegisterCache.getFreeVertexAttribute(),this._pTangentBufferIndex=this._pSharedRegisters.tangentInput.index,this._pAnimatableAttributes.push(this._pSharedRegisters.tangentInput.toString()),this._pAnimationTargetRegisters.push(this._pSharedRegisters.animatedTangent.toString()));
this._pSharedRegisters.normalInput=this._pRegisterCache.getFreeVertexAttribute();this._pNormalBufferIndex=this._pSharedRegisters.normalInput.index;this._pSharedRegisters.animatedNormal=this._pRegisterCache.getFreeVertexVectorTemp();this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedNormal,1);this._pAnimatableAttributes.push(this._pSharedRegisters.normalInput.toString());this._pAnimationTargetRegisters.push(this._pSharedRegisters.animatedNormal.toString())};Object.defineProperty(a.prototype,
"tangentSpace",{get:function(){return 0==this._pNumLightProbes&&this._pMethodSetup._iNormalMethod.iHasOutput&&this._pMethodSetup._iNormalMethod.iTangentSpace},enumerable:!0,configurable:!0});a.prototype.pInitLightData=function(){b.prototype.pInitLightData.call(this);this._pointLightVertexConstants=Array(this._pNumPointLights);this._pointLightFragmentConstants=Array(2*this._pNumPointLights);this.tangentSpace?(this._dirLightVertexConstants=Array(this._pNumDirectionalLights),this._dirLightFragmentConstants=
Array(2*this._pNumDirectionalLights)):this._dirLightFragmentConstants=Array(3*this._pNumDirectionalLights)};a.prototype.pCalculateDependencies=function(){b.prototype.pCalculateDependencies.call(this);this.tangentSpace||this._pDependencyCounter.addWorldSpaceDependencies(!1)};a.prototype.pCompileNormalCode=function(){this._pSharedRegisters.normalFragment=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.normalFragment,this._pDependencyCounter.normalDependencies);
if(this._pMethodSetup._iNormalMethod.iHasOutput&&!this._pMethodSetup._iNormalMethod.iTangentSpace)this._pVertexCode+=this._pMethodSetup._iNormalMethod.iGetVertexCode(this._pMethodSetup._iNormalMethodVO,this._pRegisterCache),this._pFragmentCode+=this._pMethodSetup._iNormalMethod.iGetFragmentCode(this._pMethodSetup._iNormalMethodVO,this._pRegisterCache,this._pSharedRegisters.normalFragment);else{if(this.tangentSpace)this.compileTangentSpaceNormalMapCode();else{var a=Array(3);a[0]=this._pRegisterCache.getFreeVertexConstant();
a[1]=this._pRegisterCache.getFreeVertexConstant();a[2]=this._pRegisterCache.getFreeVertexConstant();this._pRegisterCache.getFreeVertexConstant();this._pSceneNormalMatrixIndex=4*a[0].index;this._pSharedRegisters.normalVarying=this._pRegisterCache.getFreeVarying();this._pVertexCode+="m33 "+this._pSharedRegisters.normalVarying+".xyz, "+this._pSharedRegisters.animatedNormal+", "+a[0]+"\nmov "+this._pSharedRegisters.normalVarying+".w, "+this._pSharedRegisters.animatedNormal+".w\t\n";this._pFragmentCode+=
"nrm "+this._pSharedRegisters.normalFragment+".xyz, "+this._pSharedRegisters.normalVarying+"\nmov "+this._pSharedRegisters.normalFragment+".w, "+this._pSharedRegisters.normalVarying+".w\t\t\n"}0<this._pDependencyCounter.tangentDependencies&&(this._pSharedRegisters.tangentInput=this._pRegisterCache.getFreeVertexAttribute(),this._pTangentBufferIndex=this._pSharedRegisters.tangentInput.index,this._pSharedRegisters.tangentVarying=this._pRegisterCache.getFreeVarying())}};a.prototype.compileTangentSpaceNormalMapCode=
function(){this._pVertexCode+="nrm "+this._pSharedRegisters.animatedNormal+".xyz, "+this._pSharedRegisters.animatedNormal+"\nnrm "+this._pSharedRegisters.animatedTangent+".xyz, "+this._pSharedRegisters.animatedTangent+"\n";this._pVertexCode+="crs "+this._pSharedRegisters.bitangent+".xyz, "+this._pSharedRegisters.animatedNormal+", "+this._pSharedRegisters.animatedTangent+"\n";this._pFragmentCode+=this._pMethodSetup._iNormalMethod.iGetFragmentCode(this._pMethodSetup._iNormalMethodVO,this._pRegisterCache,
this._pSharedRegisters.normalFragment);this._pMethodSetup._iNormalMethodVO.needsView&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.viewDirFragment);(this._pMethodSetup._iNormalMethodVO.needsGlobalFragmentPos||this._pMethodSetup._iNormalMethodVO.needsGlobalVertexPos)&&this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.globalPositionVertex)};a.prototype.pCompileViewDirCode=function(){var a=this._pRegisterCache.getFreeVertexConstant();this._pSharedRegisters.viewDirVarying=
this._pRegisterCache.getFreeVarying();this._pSharedRegisters.viewDirFragment=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.viewDirFragment,this._pDependencyCounter.viewDirDependencies);this._pCameraPositionIndex=4*a.index;if(this.tangentSpace){var b=this._pRegisterCache.getFreeVertexVectorTemp();this._pVertexCode+="sub "+b+", "+a+", "+this._pSharedRegisters.localPosition+"\nm33 "+this._pSharedRegisters.viewDirVarying+".xyz, "+b+
", "+this._pSharedRegisters.animatedTangent+"\nmov "+this._pSharedRegisters.viewDirVarying+".w, "+this._pSharedRegisters.localPosition+".w\n"}else this._pVertexCode+="sub "+this._pSharedRegisters.viewDirVarying+", "+a+", "+this._pSharedRegisters.globalPositionVertex+"\n",this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.globalPositionVertex);this._pFragmentCode+="nrm "+this._pSharedRegisters.viewDirFragment+".xyz, "+this._pSharedRegisters.viewDirVarying+"\nmov "+this._pSharedRegisters.viewDirFragment+
".w,   "+this._pSharedRegisters.viewDirVarying+".w \t\t\n"};a.prototype.pCompileLightingCode=function(){this._pMethodSetup._iShadowMethod&&this.compileShadowCode();this._pMethodSetup._iDiffuseMethod.iShadowRegister=this._shadowRegister;this._pSharedRegisters.shadedTarget=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.shadedTarget,1);this._pVertexCode+=this._pMethodSetup._iDiffuseMethod.iGetVertexCode(this._pMethodSetup._iDiffuseMethodVO,
this._pRegisterCache);this._pFragmentCode+=this._pMethodSetup._iDiffuseMethod.iGetFragmentPreLightingCode(this._pMethodSetup._iDiffuseMethodVO,this._pRegisterCache);this._usingSpecularMethod&&(this._pVertexCode+=this._pMethodSetup._iSpecularMethod.iGetVertexCode(this._pMethodSetup._iSpecularMethodVO,this._pRegisterCache),this._pFragmentCode+=this._pMethodSetup._iSpecularMethod.iGetFragmentPreLightingCode(this._pMethodSetup._iSpecularMethodVO,this._pRegisterCache));this.pUsesLights()&&(this.initLightRegisters(),
this.compileDirectionalLightCode(),this.compilePointLightCode());this.pUsesProbes()&&this.compileLightProbeCode();this._pVertexCode+=this._pMethodSetup._iAmbientMethod.iGetVertexCode(this._pMethodSetup._iAmbientMethodVO,this._pRegisterCache);this._pFragmentCode+=this._pMethodSetup._iAmbientMethod.iGetFragmentCode(this._pMethodSetup._iAmbientMethodVO,this._pRegisterCache,this._pSharedRegisters.shadedTarget);this._pMethodSetup._iAmbientMethodVO.needsNormals&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.normalFragment);
this._pMethodSetup._iAmbientMethodVO.needsView&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.viewDirFragment);this._pFragmentCode+=this._pMethodSetup._iDiffuseMethod.iGetFragmentPostLightingCode(this._pMethodSetup._iDiffuseMethodVO,this._pRegisterCache,this._pSharedRegisters.shadedTarget);this._pAlphaPremultiplied&&(this._pFragmentCode+="add "+this._pSharedRegisters.shadedTarget+".w, "+this._pSharedRegisters.shadedTarget+".w, "+this._pSharedRegisters.commons+".z\ndiv "+this._pSharedRegisters.shadedTarget+
".xyz, "+this._pSharedRegisters.shadedTarget+", "+this._pSharedRegisters.shadedTarget+".w\nsub "+this._pSharedRegisters.shadedTarget+".w, "+this._pSharedRegisters.shadedTarget+".w, "+this._pSharedRegisters.commons+".z\nsat "+this._pSharedRegisters.shadedTarget+".xyz, "+this._pSharedRegisters.shadedTarget+"\n");this._pMethodSetup._iDiffuseMethodVO.needsNormals&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.normalFragment);this._pMethodSetup._iDiffuseMethodVO.needsView&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.viewDirFragment);
this._usingSpecularMethod&&(this._pMethodSetup._iSpecularMethod.iShadowRegister=this._shadowRegister,this._pFragmentCode+=this._pMethodSetup._iSpecularMethod.iGetFragmentPostLightingCode(this._pMethodSetup._iSpecularMethodVO,this._pRegisterCache,this._pSharedRegisters.shadedTarget),this._pMethodSetup._iSpecularMethodVO.needsNormals&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.normalFragment),this._pMethodSetup._iSpecularMethodVO.needsView&&this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.viewDirFragment));
this._pMethodSetup._iShadowMethod&&this._pRegisterCache.removeFragmentTempUsage(this._shadowRegister)};a.prototype.compileShadowCode=function(){this._shadowRegister=this._pSharedRegisters.normalFragment?this._pSharedRegisters.normalFragment:this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(this._shadowRegister,1);this._pVertexCode+=this._pMethodSetup._iShadowMethod.iGetVertexCode(this._pMethodSetup._iShadowMethodVO,this._pRegisterCache);this._pFragmentCode+=
this._pMethodSetup._iShadowMethod.iGetFragmentCode(this._pMethodSetup._iShadowMethodVO,this._pRegisterCache,this._shadowRegister)};a.prototype.initLightRegisters=function(){var a,b;if(this._dirLightVertexConstants)for(b=this._dirLightVertexConstants.length,a=0;a<b;++a)this._dirLightVertexConstants[a]=this._pRegisterCache.getFreeVertexConstant(),-1==this._lightVertexConstantIndex&&(this._lightVertexConstantIndex=4*this._dirLightVertexConstants[a].index);b=this._pointLightVertexConstants.length;for(a=
0;a<b;++a)this._pointLightVertexConstants[a]=this._pRegisterCache.getFreeVertexConstant(),-1==this._lightVertexConstantIndex&&(this._lightVertexConstantIndex=4*this._pointLightVertexConstants[a].index);b=this._dirLightFragmentConstants.length;for(a=0;a<b;++a)this._dirLightFragmentConstants[a]=this._pRegisterCache.getFreeFragmentConstant(),-1==this._pLightFragmentConstantIndex&&(this._pLightFragmentConstantIndex=4*this._dirLightFragmentConstants[a].index);b=this._pointLightFragmentConstants.length;
for(a=0;a<b;++a)this._pointLightFragmentConstants[a]=this._pRegisterCache.getFreeFragmentConstant(),-1==this._pLightFragmentConstantIndex&&(this._pLightFragmentConstantIndex=4*this._pointLightFragmentConstants[a].index)};a.prototype.compileDirectionalLightCode=function(){var a,b,d,e=0,f=0,g=this._usingSpecularMethod&&this.pUsesLightsForSpecular(),w=this.pUsesLightsForDiffuse();if(g||w)for(var s=0;s<this._pNumDirectionalLights;++s)this.tangentSpace?(d=this._dirLightVertexConstants[e++],a=this._pRegisterCache.getFreeVarying(),
this._pVertexCode+="m33 "+a+".xyz, "+d+", "+this._pSharedRegisters.animatedTangent+"\nmov "+a+".w, "+d+".w\n",d=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addVertexTempUsages(d,1),this._pFragmentCode+="nrm "+d+".xyz, "+a+"\n",this._pFragmentCode+="mov "+d+".w, "+a+".w\n"):d=this._dirLightFragmentConstants[f++],a=this._dirLightFragmentConstants[f++],b=this._dirLightFragmentConstants[f++],w&&(this._pFragmentCode+=this._pMethodSetup._iDiffuseMethod.iGetFragmentCodePerLight(this._pMethodSetup._iDiffuseMethodVO,
d,a,this._pRegisterCache)),g&&(this._pFragmentCode+=this._pMethodSetup._iSpecularMethod.iGetFragmentCodePerLight(this._pMethodSetup._iSpecularMethodVO,d,b,this._pRegisterCache)),this.tangentSpace&&this._pRegisterCache.removeVertexTempUsage(d)};a.prototype.compilePointLightCode=function(){var a,b,d,e,f=0,g=0,w=this._usingSpecularMethod&&this.pUsesLightsForSpecular(),s=this.pUsesLightsForDiffuse();if(w||s)for(var m=0;m<this._pNumPointLights;++m){d=this._pointLightVertexConstants[f++];a=this._pointLightFragmentConstants[g++];
b=this._pointLightFragmentConstants[g++];e=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(e,1);var n=this._pRegisterCache.getFreeVarying();if(this.tangentSpace){var p=this._pRegisterCache.getFreeVertexVectorTemp();this._pVertexCode+="sub "+p+", "+d+", "+this._pSharedRegisters.localPosition+"\nm33 "+n+".xyz, "+p+", "+this._pSharedRegisters.animatedTangent+"\nmov "+n+".w, "+this._pSharedRegisters.localPosition+".w\n"}else this._pVertexCode+="sub "+n+", "+
d+", "+this._pSharedRegisters.globalPositionVertex+"\n";this._pFragmentCode=this._pEnableLightFallOff&&"baselineConstrained"!=this._pProfile?this._pFragmentCode+("dp3 "+e+".w, "+n+", "+n+"\nsub "+e+".w, "+e+".w, "+a+".w\nmul "+e+".w, "+e+".w, "+b+".w\nsat "+e+".w, "+e+".w\nsub "+e+".w, "+this._pSharedRegisters.commons+".w, "+e+".w\nnrm "+e+".xyz, "+n+"\n"):this._pFragmentCode+("nrm "+e+".xyz, "+n+"\nmov "+e+".w, "+n+".w\n");-1==this._pLightFragmentConstantIndex&&(this._pLightFragmentConstantIndex=
4*d.index);s&&(this._pFragmentCode+=this._pMethodSetup._iDiffuseMethod.iGetFragmentCodePerLight(this._pMethodSetup._iDiffuseMethodVO,e,a,this._pRegisterCache));w&&(this._pFragmentCode+=this._pMethodSetup._iSpecularMethod.iGetFragmentCodePerLight(this._pMethodSetup._iSpecularMethodVO,e,b,this._pRegisterCache));this._pRegisterCache.removeFragmentTempUsage(e)}};a.prototype.compileLightProbeCode=function(){var a,b=[".x",".y",".z",".w"],d=[],e,f,g=this._usingSpecularMethod&&this.pUsesProbesForSpecular(),
w=this.pUsesProbesForDiffuse();if(g||w){w&&(this._pLightProbeDiffuseIndices=[]);g&&(this._pLightProbeSpecularIndices=[]);for(e=0;e<this._pNumProbeRegisters;++e)d[e]=this._pRegisterCache.getFreeFragmentConstant(),0==e&&(this._pProbeWeightsIndex=4*d[e].index);for(e=0;e<this._pNumLightProbes;++e)a=d[Math.floor(e/4)].toString()+b[e%4],w&&(f=this._pRegisterCache.getFreeTextureReg(),this._pLightProbeDiffuseIndices[e]=f.index,this._pFragmentCode+=this._pMethodSetup._iDiffuseMethod.iGetFragmentCodePerProbe(this._pMethodSetup._iDiffuseMethodVO,
f,a,this._pRegisterCache)),g&&(f=this._pRegisterCache.getFreeTextureReg(),this._pLightProbeSpecularIndices[e]=f.index,this._pFragmentCode+=this._pMethodSetup._iSpecularMethod.iGetFragmentCodePerProbe(this._pMethodSetup._iSpecularMethodVO,f,a,this._pRegisterCache))}};return a}(b.materials.ShaderCompiler);g.LightingShaderCompiler=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(a){"undefined"===typeof a&&(a=1.25);d.call(this);this.bothSides=!0;this.pAddPass(this._screenPass=new b.materials.SegmentPass(a));this._screenPass.material=this}__extends(a,d);return a}(b.materials.MaterialBase);g.SegmentMaterial=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(a){d.call(this);this._cubeMap=a;this.pAddPass(this._skyboxPass=new b.materials.SkyBoxPass);this._skyboxPass.cubeTexture=this._cubeMap}__extends(a,d);Object.defineProperty(a.prototype,"cubeMap",{get:function(){return this._cubeMap},set:function(a){a&&(this._cubeMap&&(a.hasMipMaps!=this._cubeMap.hasMipMaps||a.format!=this._cubeMap.format))&&this.iInvalidatePasses(null);this._cubeMap=a;this._skyboxPass.cubeTexture=this._cubeMap},enumerable:!0,configurable:!0});
return a}(b.materials.MaterialBase);g.SkyBoxMaterial=e})(b.materials||(b.materials={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(a){"undefined"===typeof a&&(a=!1);this._pBackgroundB=this._pBackgroundG=this._pBackgroundR=0;this._pBackgroundAlpha=1;this._pShareContext=!1;this._pTextureRatioY=this._pTextureRatioX=1;this._clearOnRender=!0;this._pRttViewProjectionMatrix=new b.geom.Matrix3D;this._pRenderableSorter=new b.sort.RenderableMergeSort;this._pRenderToTexture=a}d.prototype.iCreateEntityCollector=function(){return new b.traverse.EntityCollector};Object.defineProperty(d.prototype,
"iViewWidth",{get:function(){return this._pViewWidth},set:function(a){this._pViewWidth=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"iViewHeight",{get:function(){return this._pViewHeight},set:function(a){this._pViewHeight=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"iRenderToTexture",{get:function(){return this._pRenderToTexture},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"renderableSorter",{get:function(){return this._pRenderableSorter},
set:function(a){this._pRenderableSorter=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"iClearOnRender",{get:function(){return this._clearOnRender},set:function(a){this._clearOnRender=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"iBackgroundR",{get:function(){return this._pBackgroundR},set:function(a){this._pBackgroundR=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"iBackgroundG",{get:function(){return this._pBackgroundG},set:function(a){this._pBackgroundG=
a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"iBackgroundB",{get:function(){return this._pBackgroundB},set:function(a){this._pBackgroundB=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"iStage3DProxy",{get:function(){return this._pStage3DProxy},set:function(a){a!=this._pStage3DProxy&&(a?(this._pStage3DProxy=a,this._pStage3DProxy.addEventListener(b.events.Stage3DEvent.CONTEXT3D_CREATED,this.onContextUpdate,this),this._pStage3DProxy.addEventListener(b.events.Stage3DEvent.CONTEXT3D_RECREATED,
this.onContextUpdate,this),a.context3D&&(this._pContext=a.context3D)):(this._pStage3DProxy&&(this._pStage3DProxy.removeEventListener(b.events.Stage3DEvent.CONTEXT3D_CREATED,this.onContextUpdate,this),this._pStage3DProxy.removeEventListener(b.events.Stage3DEvent.CONTEXT3D_RECREATED,this.onContextUpdate,this)),this._pContext=this._pStage3DProxy=null))},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"iShareContext",{get:function(){return this._pShareContext},set:function(a){this._pShareContext=
a},enumerable:!0,configurable:!0});d.prototype.iDispose=function(){this._pStage3DProxy=null};d.prototype.iRender=function(a,c,b,d){"undefined"===typeof c&&(c=null);"undefined"===typeof b&&(b=null);"undefined"===typeof d&&(d=0);if(this._pStage3DProxy&&this._pContext)for(this._pRttViewProjectionMatrix.copyFrom(a.camera.viewProjection),this._pRttViewProjectionMatrix.appendScale(this._pTextureRatioX,this._pTextureRatioY,1),this.pExecuteRender(a,c,b,d),a=0;8>a;++a)this._pContext.setVertexBufferAt(a,null),
this._pContext.setTextureAt(a,null)};d.prototype.pExecuteRender=function(a,c,d,e){"undefined"===typeof c&&(c=null);"undefined"===typeof d&&(d=null);"undefined"===typeof e&&(e=0);this._pRenderTarget=c;this._pRenderTargetSurface=e;this._pRenderableSorter&&this._pRenderableSorter.sort(a);this._pRenderToTexture&&this.pExecuteRenderToTexturePass(a);this._pStage3DProxy.setRenderTarget(c,!0,e);!c&&this._pShareContext||!this._clearOnRender||this._pContext.clear(this._pBackgroundR,this._pBackgroundG,this._pBackgroundB,
this._pBackgroundAlpha,1,0);this._pContext.setDepthTest(!1,b.display3D.Context3DCompareMode.ALWAYS);this._pStage3DProxy.scissorRect=d;this.pDraw(a,c);this._pContext.setDepthTest(!1,b.display3D.Context3DCompareMode.LESS_EQUAL);!this._pShareContext&&(this._snapshotRequired&&this._snapshotBitmapData)&&(this._pContext.drawToBitmapData(this._snapshotBitmapData),this._snapshotRequired=!1);this._pStage3DProxy.scissorRect=null};d.prototype.queueSnapshot=function(a){this._snapshotRequired=!0;this._snapshotBitmapData=
a};d.prototype.pExecuteRenderToTexturePass=function(a){throw new b.errors.AbstractMethodError;};d.prototype.pDraw=function(a,c){throw new b.errors.AbstractMethodError;};d.prototype.onContextUpdate=function(a){this._pContext=this._pStage3DProxy.context3D};Object.defineProperty(d.prototype,"iBackgroundAlpha",{get:function(){return this._pBackgroundAlpha},set:function(a){this._pBackgroundAlpha=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"iBackground",{get:function(){return this._background},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"antiAlias",{get:function(){return this._pAntiAlias},enumerable:!0,configurable:!0});return d}();g.RenderBase=e})(b.render||(b.render={}))})(away||(away={}));
(function(b){(function(b){var e=function(){function b(){}b.prototype.sort=function(a){a.opaqueRenderableHead=this.mergeSortByMaterial(a.opaqueRenderableHead);a.blendedRenderableHead=this.mergeSortByDepth(a.blendedRenderableHead)};b.prototype.mergeSortByDepth=function(a){var b,d;if(!a||!a.next)return a;d=a;for(b=a.next;b;)if(b=b.next)d=d.next,b=b.next;b=d.next;d.next=null;a=this.mergeSortByDepth(a);b=this.mergeSortByDepth(b);var e,g;if(!a)return b;if(!b)return a;for(;a&&b;)a.zIndex<b.zIndex?(d=a,a=
a.next):(d=b,b=b.next),e?g.next=d:e=d,g=d;a?g.next=a:b&&(g.next=b);return e};b.prototype.mergeSortByMaterial=function(a){var b,d;if(!a||!a.next)return a;d=a;for(b=a.next;b;)if(b=b.next)d=d.next,b=b.next;b=d.next;d.next=null;a=this.mergeSortByMaterial(a);b=this.mergeSortByMaterial(b);var e,g;d=0;if(!a)return b;if(!b)return a;for(;a&&b&&null!=a&&null!=b;){d=a.renderOrderId;var f=b.renderOrderId;d==f?(d=a.materialId,f=b.materialId,d=d==f?a.zIndex<b.zIndex?1:-1:d>f?1:-1):d=d>f?1:-1;0>d?(d=a,a=a.next):
(d=b,b=b.next);e?g.next=d:e=d;g=d}a?g.next=a:b&&(g.next=b);return e};return b}();b.RenderableMergeSort=e})(b.sort||(b.sort={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(a){"undefined"===typeof a&&(a=!1);this._backgroundB=this._backgroundG=this._backgroundR=0;this._backgroundAlpha=1;this._shareContext=!1;this._textureRatioY=this._textureRatioX=1;this._clearOnRender=!0;this._pRttViewProjectionMatrix=new b.geom.Matrix3D;this._pRenderableSorter=new b.sort.RenderableMergeSort;this._renderToTexture=a}d.prototype.iCreateEntityCollector=function(){return new b.traverse.EntityCollector};Object.defineProperty(d.prototype,
"iViewWidth",{get:function(){return this._viewWidth},set:function(a){this._viewWidth=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"iViewHeight",{get:function(){return this._viewHeight},set:function(a){this._viewHeight=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"iRenderToTexture",{get:function(){return this._renderToTexture},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"renderableSorter",{get:function(){return this._pRenderableSorter},
set:function(a){this._pRenderableSorter=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"iClearOnRender",{get:function(){return this._clearOnRender},set:function(a){this._clearOnRender=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"iBackgroundR",{get:function(){return this._backgroundR},set:function(a){this._backgroundR=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"iBackgroundG",{get:function(){return this._backgroundG},set:function(a){this._backgroundG=
a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"iBackgroundB",{get:function(){return this._backgroundB},set:function(a){this._backgroundB=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"iStage3DProxy",{get:function(){return this._pStage3DProxy},set:function(a){this.iSetStage3DProxy(a)},enumerable:!0,configurable:!0});d.prototype.iSetStage3DProxy=function(a){a!=this._pStage3DProxy&&(a?(this._pStage3DProxy=a,this._pStage3DProxy.addEventListener(b.events.Stage3DEvent.CONTEXT3D_CREATED,
this.onContextUpdate,this),this._pStage3DProxy.addEventListener(b.events.Stage3DEvent.CONTEXT3D_RECREATED,this.onContextUpdate,this),a.context3D&&(this._pContext=a.context3D)):(this._pStage3DProxy&&(this._pStage3DProxy.removeEventListener(b.events.Stage3DEvent.CONTEXT3D_CREATED,this.onContextUpdate,this),this._pStage3DProxy.removeEventListener(b.events.Stage3DEvent.CONTEXT3D_RECREATED,this.onContextUpdate,this)),this._pContext=this._pStage3DProxy=null))};Object.defineProperty(d.prototype,"iShareContext",
{get:function(){return this._shareContext},set:function(a){this._shareContext=a},enumerable:!0,configurable:!0});d.prototype.iDispose=function(){this._pStage3DProxy=null};d.prototype.iRender=function(a,b,d,e){"undefined"===typeof b&&(b=null);"undefined"===typeof d&&(d=null);"undefined"===typeof e&&(e=0);if(this._pStage3DProxy&&this._pContext)for(this._pRttViewProjectionMatrix.copyFrom(a.camera.viewProjection),this._pRttViewProjectionMatrix.appendScale(this._textureRatioX,this._textureRatioY,1),this.pExecuteRender(a,
b,d,e),a=0;8>a;++a)this._pContext.setVertexBufferAt(a,null),this._pContext.setTextureAt(a,null)};d.prototype.pExecuteRender=function(a,c,d,e){"undefined"===typeof c&&(c=null);"undefined"===typeof d&&(d=null);"undefined"===typeof e&&(e=0);this._pRenderTarget=c;this._pRenderTargetSurface=e;this._pRenderableSorter&&this._pRenderableSorter.sort(a);this._renderToTexture&&this.pExecuteRenderToTexturePass(a);this._pStage3DProxy.setRenderTarget(c,!0,e);!c&&this._shareContext||!this._clearOnRender||this._pContext.clear(this._backgroundR,
this._backgroundG,this._backgroundB,this._backgroundAlpha,1,0);this._pContext.setDepthTest(!1,b.display3D.Context3DCompareMode.ALWAYS);this._pStage3DProxy.scissorRect=d;this.pDraw(a,c);this._pContext.setDepthTest(!1,b.display3D.Context3DCompareMode.LESS_EQUAL);!this._shareContext&&(this._snapshotRequired&&this._snapshotBitmapData)&&(this._pContext.drawToBitmapData(this._snapshotBitmapData),this._snapshotRequired=!1);this._pStage3DProxy.scissorRect=null};d.prototype.queueSnapshot=function(a){this._snapshotRequired=
!0;this._snapshotBitmapData=a};d.prototype.pExecuteRenderToTexturePass=function(a){throw new b.errors.AbstractMethodError;};d.prototype.pDraw=function(a,c){throw new b.errors.AbstractMethodError;};d.prototype.onContextUpdate=function(a){this._pContext=this._pStage3DProxy.context3D};Object.defineProperty(d.prototype,"iBackgroundAlpha",{get:function(){return this._backgroundAlpha},set:function(a){this._backgroundAlpha=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"antiAlias",
{get:function(){return this._antiAlias},set:function(a){this._antiAlias=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"iTextureRatioX",{get:function(){return this._textureRatioX},set:function(a){this._textureRatioX=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"iTextureRatioY",{get:function(){return this._textureRatioY},set:function(a){this._textureRatioY=a},enumerable:!0,configurable:!0});return d}();g.RendererBase=e})(b.render||(b.render={}))})(away||
(away={}));
(function(b){(function(g){var e=function(d){function a(a,b){"undefined"===typeof a&&(a=!1);"undefined"===typeof b&&(b=!1);d.call(this);this._renderBlended=a;this._distanceBased=b;this.iBackgroundB=this.iBackgroundG=this.iBackgroundR=1}__extends(a,d);Object.defineProperty(a.prototype,"disableColor",{get:function(){return this._disableColor},set:function(a){this._disableColor=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"iBackgroundR",{set:function(a){},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"iBackgroundG",{set:function(a){},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"iBackgroundB",{set:function(a){},enumerable:!0,configurable:!0});a.prototype.iRenderCascades=function(a,d,e,g,f){this._pRenderTarget=d;this._pRenderTargetSurface=0;this._pRenderableSorter.sort(a);this._pStage3DProxy.setRenderTarget(d,!0,0);this._pContext.clear(1,1,1,1,1,0);this._pContext.setBlendFactors(b.display3D.Context3DBlendFactor.ONE,b.display3D.Context3DBlendFactor.ZERO);
this._pContext.setDepthTest(!0,b.display3D.Context3DCompareMode.LESS);a=a.opaqueRenderableHead;d=!0;for(e-=1;0<=e;--e)this._pStage3DProxy.scissorRect=g[e],this.drawCascadeRenderables(a,f[e],d?null:f[e].frustumPlanes),d=!1;this._activeMaterial&&this._activeMaterial.iDeactivateForDepth(this._pStage3DProxy);this._activeMaterial=null;this._pContext.setDepthTest(!1,b.display3D.Context3DCompareMode.LESS_EQUAL);this._pStage3DProxy.scissorRect=null};a.prototype.drawCascadeRenderables=function(a,b,d){for(var e;a;){if(!a.cascaded){var f=
a.renderable;e=f.sourceEntity;!d||e.worldBounds.isInFrustum(d,4)?(e=f.material,this._activeMaterial!=e&&(this._activeMaterial&&this._activeMaterial.iDeactivateForDepth(this._pStage3DProxy),this._activeMaterial=e,this._activeMaterial.iActivateForDepth(this._pStage3DProxy,b,!1)),this._activeMaterial.iRenderDepth(f,this._pStage3DProxy,b,b.viewProjection)):a.cascaded=!0}a=a.next}};a.prototype.pDraw=function(a,d){this._pContext.setBlendFactors(b.display3D.Context3DBlendFactor.ONE,b.display3D.Context3DBlendFactor.ZERO);
this._pContext.setDepthTest(!0,b.display3D.Context3DCompareMode.LESS);this.drawRenderables(a.opaqueRenderableHead,a);this._disableColor&&this._pContext.setColorMask(!1,!1,!1,!1);this._renderBlended&&this.drawRenderables(a.blendedRenderableHead,a);this._activeMaterial&&this._activeMaterial.iDeactivateForDepth(this._pStage3DProxy);this._disableColor&&this._pContext.setColorMask(!0,!0,!0,!0);this._activeMaterial=null};a.prototype.drawRenderables=function(a,b){for(var d=b.camera,e;a;){this._activeMaterial=
a.renderable.material;if(this._disableColor&&this._activeMaterial.iHasDepthAlphaThreshold()){e=a;do e=e.next;while(e&&e.renderable.material==this._activeMaterial)}else{this._activeMaterial.iActivateForDepth(this._pStage3DProxy,d,this._distanceBased);e=a;do this._activeMaterial.iRenderDepth(e.renderable,this._pStage3DProxy,d,this._pRttViewProjectionMatrix),e=e.next;while(e&&e.renderable.material==this._activeMaterial);this._activeMaterial.iDeactivateForDepth(this._pStage3DProxy)}a=e}};return a}(b.render.RendererBase);
g.DepthRenderer=e})(b.render||(b.render={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(){d.call(this);this._skyboxProjection=new b.geom.Matrix3D;this._pDepthRenderer=new b.render.DepthRenderer;this._pDistanceRenderer=new b.render.DepthRenderer(!1,!0)}__extends(a,d);Object.defineProperty(a.prototype,"iStage3DProxy",{set:function(a){d.prototype.iSetStage3DProxy.call(this,a);this._pDistanceRenderer.iStage3DProxy=this._pDepthRenderer.iStage3DProxy=a},enumerable:!0,configurable:!0});a.prototype.pExecuteRender=function(b,e,g,h){"undefined"===
typeof e&&(e=null);"undefined"===typeof g&&(g=null);"undefined"===typeof h&&(h=0);this.updateLights(b);e&&(this.drawRenderables(b.opaqueRenderableHead,b,a.RTT_PASSES),this.drawRenderables(b.blendedRenderableHead,b,a.RTT_PASSES));d.prototype.pExecuteRender.call(this,b,e,g,h)};a.prototype.updateLights=function(a){var b=a.directionalLights,d=a.pointLights,e,f,g,w;e=b.length;for(f=0;f<e;++f)g=b[f],w=g.shadowMapper,g.castsShadows&&(w.autoUpdateShadows||w._iShadowsInvalid)&&w.iRenderDepthMap(this._pStage3DProxy,
a,this._pDepthRenderer);e=d.length;for(f=0;f<e;++f)g=d[f],w=g.shadowMapper,g.castsShadows&&(w.autoUpdateShadows||w._iShadowsInvalid)&&w.iRenderDepthMap(this._pStage3DProxy,a,this._pDistanceRenderer)};a.prototype.pDraw=function(c,d){this._pContext.setBlendFactors(b.display3D.Context3DBlendFactor.ONE,b.display3D.Context3DBlendFactor.ZERO);c.skyBox&&(this._activeMaterial&&this._activeMaterial.iDeactivate(this._pStage3DProxy),this._activeMaterial=null,this._pContext.setDepthTest(!1,b.display3D.Context3DCompareMode.ALWAYS),
this.drawSkyBox(c));this._pContext.setDepthTest(!0,b.display3D.Context3DCompareMode.LESS_EQUAL);var e=d?a.SCREEN_PASSES:a.ALL_PASSES;this.drawRenderables(c.opaqueRenderableHead,c,e);this.drawRenderables(c.blendedRenderableHead,c,e);this._pContext.setDepthTest(!1,b.display3D.Context3DCompareMode.LESS_EQUAL);this._activeMaterial&&this._activeMaterial.iDeactivate(this._pStage3DProxy);this._activeMaterial=null};a.prototype.drawSkyBox=function(a){var b=a.skyBox,d=b.material,e=a.camera;this.updateSkyBoxProjection(e);
d.iActivatePass(0,this._pStage3DProxy,e);d.iRenderPass(0,b,this._pStage3DProxy,a,this._skyboxProjection);d.iDeactivatePass(0,this._pStage3DProxy)};a.prototype.updateSkyBoxProjection=function(a){var d=new b.geom.Vector3D;this._skyboxProjection.copyFrom(this._pRttViewProjectionMatrix);this._skyboxProjection.copyRowTo(2,d);var e=a.scenePosition;a=d.x;var g=d.y,f=d.z,d=-(d.x*e.x+d.y*e.y+d.z*e.z+Math.sqrt(a*a+g*g+f*f)),e=new b.geom.Vector3D(0<=a?1:-1,0<=g?1:-1,1,1),l=this._skyboxProjection.clone();l.invert();
l=l.transformVector(e);this._skyboxProjection.copyRowTo(3,e);e=(l.x*e.x+l.y*e.y+l.z*e.z+l.w*e.w)/(a*l.x+g*l.y+f*l.z+d*l.w);this._skyboxProjection.copyRowFrom(2,new b.geom.Vector3D(a*e,g*e,f*e,d*e))};a.prototype.drawRenderables=function(a,b,d){for(var e,f,g=b.camera,w;a;){this._activeMaterial=a.renderable.material;this._activeMaterial.iUpdateMaterial(this._pContext);e=this._activeMaterial._iNumPasses;f=0;do if(w=a,0!=((this._activeMaterial.iPassRendersToTexture(f)?1:2)&d)){this._activeMaterial.iActivatePass(f,
this._pStage3DProxy,g);do this._activeMaterial.iRenderPass(f,w.renderable,this._pStage3DProxy,b,this._pRttViewProjectionMatrix),w=w.next;while(w&&w.renderable.material==this._activeMaterial);this._activeMaterial.iDeactivatePass(f,this._pStage3DProxy)}else{do w=w.next;while(w&&w.renderable.material==this._activeMaterial)}while(++f<e);a=w}};a.prototype.iDispose=function(){d.prototype.iDispose.call(this);this._pDepthRenderer.iDispose();this._pDistanceRenderer.iDispose();this._pDistanceRenderer=this._pDepthRenderer=
null};a.RTT_PASSES=1;a.SCREEN_PASSES=2;a.ALL_PASSES=3;return a}(b.render.RendererBase);g.DefaultRenderer=e})(b.render||(b.render={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(a){"undefined"===typeof a&&(a=!1);this._textureHeight=this._textureWidth=this._scaledTextureHeight=this._scaledTextureWidth=-1;this._program3DInvalid=this._textureDimensionsInvalid=!0;this._textureScale=0;this._requireDepthRender=a}Object.defineProperty(d.prototype,"textureScale",{get:function(){return this._textureScale},set:function(a){this._textureScale!=a&&(this._textureScale=a,this._scaledTextureWidth=this._textureWidth>>this._textureScale,
this._scaledTextureHeight=this._textureHeight>>this._textureScale,this._textureDimensionsInvalid=!0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"target",{get:function(){return this._target},set:function(a){this._target=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"textureWidth",{get:function(){return this._textureWidth},set:function(a){this._textureWidth!=a&&(this._textureWidth=a,this._scaledTextureWidth=this._textureWidth>>this._textureScale,this._textureDimensionsInvalid=
!0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"textureHeight",{get:function(){return this._textureHeight},set:function(a){this._textureHeight!=a&&(this._textureHeight=a,this._scaledTextureHeight=this._textureHeight>>this._textureScale,this._textureDimensionsInvalid=!0)},enumerable:!0,configurable:!0});d.prototype.getMainInputTexture=function(a){this._textureDimensionsInvalid&&this.pUpdateTextures(a);return this._mainInputTexture};d.prototype.dispose=function(){this._mainInputTexture&&
this._mainInputTexture.dispose();this._program3D&&this._program3D.dispose()};d.prototype.pInvalidateProgram3D=function(){this._program3DInvalid=!0};d.prototype.pUpdateProgram3D=function(a){this._program3D&&this._program3D.dispose();this._program3D=a._iContext3D.createProgram();var c=new aglsl.AGLSLCompiler;a=new aglsl.AGLSLCompiler;c=c.compile(b.display3D.Context3DProgramType.VERTEX,this.pGetVertexCode());a=a.compile(b.display3D.Context3DProgramType.FRAGMENT,this.pGetFragmentCode());this._program3D.upload(c,
a);this._program3DInvalid=!1};d.prototype.pGetVertexCode=function(){return"mov op, va0\nmov v0, va1\n"};d.prototype.pGetFragmentCode=function(){throw new b.errors.AbstractMethodError;};d.prototype.pUpdateTextures=function(a){this._mainInputTexture&&this._mainInputTexture.dispose();this._mainInputTexture=a._iContext3D.createTexture(this._scaledTextureWidth,this._scaledTextureHeight,b.display3D.Context3DTextureFormat.BGRA,!0);this._textureDimensionsInvalid=!1};d.prototype.getProgram3D=function(a){this._program3DInvalid&&
this.pUpdateProgram3D(a);return this._program3D};d.prototype.activate=function(a,b,d){};d.prototype.deactivate=function(a){};Object.defineProperty(d.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:!0,configurable:!0});return d}();g.Filter3DTaskBase=e})(b.filters||(b.filters={}))})(away||(away={}));
(function(b){(function(g){var e=function(d){function a(a,e){d.call(this);this._textureHeight=this._textureWidth=this._viewHeight=this._viewWidth=-1;this._buffersInvalid=!0;if(!a)throw Error("No cheating the multiton!");this._renderToTextureRect=new b.geom.Rectangle;this._stage3DProxy=e}__extends(a,d);a.getInstance=function(c){if(!c)throw Error("stage3DProxy key cannot be null!");null==a._instances&&(a._instances=[]);var d=a.getRTTBufferManagerFromStage3DProxy(c);if(null==d){var d=new b.managers.RTTBufferManager(new SingletonEnforcer,
c),e=new RTTBufferManagerVO;e.stage3dProxy=c;e.rttbfm=d;a._instances.push(e)}return d};a.getRTTBufferManagerFromStage3DProxy=function(b){for(var d=a._instances.length,e,g=0;g<d;g++)if(e=a._instances[g],e.stage3dProxy===b)return e.rttbfm;return null};a.deleteRTTBufferManager=function(b){for(var d=a._instances.length,e,g=0;g<d;g++)if(e=a._instances[g],e.stage3dProxy===b){a._instances.splice(g,1);break}};Object.defineProperty(a.prototype,"textureRatioX",{get:function(){this._buffersInvalid&&this.updateRTTBuffers();
return this._textureRatioX},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"textureRatioY",{get:function(){this._buffersInvalid&&this.updateRTTBuffers();return this._textureRatioY},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"viewWidth",{get:function(){return this._viewWidth},set:function(a){a!=this._viewWidth&&(this._viewWidth=a,this._buffersInvalid=!0,this._textureWidth=b.utils.TextureUtils.getBestPowerOf2(this._viewWidth),this._textureWidth>this._viewWidth?
(this._renderToTextureRect.x=Math.floor(0.5*(this._textureWidth-this._viewWidth)),this._renderToTextureRect.width=this._viewWidth):(this._renderToTextureRect.x=0,this._renderToTextureRect.width=this._textureWidth),this.dispatchEvent(new b.events.Event(b.events.Event.RESIZE)))},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"viewHeight",{get:function(){return this._viewHeight},set:function(a){a!=this._viewHeight&&(this._viewHeight=a,this._buffersInvalid=!0,this._textureHeight=b.utils.TextureUtils.getBestPowerOf2(this._viewHeight),
this._textureHeight>this._viewHeight?(this._renderToTextureRect.y=Math.floor(0.5*(this._textureHeight-this._viewHeight)),this._renderToTextureRect.height=this._viewHeight):(this._renderToTextureRect.y=0,this._renderToTextureRect.height=this._textureHeight),this.dispatchEvent(new b.events.Event(b.events.Event.RESIZE)))},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"renderToTextureVertexBuffer",{get:function(){this._buffersInvalid&&this.updateRTTBuffers();return this._renderToTextureVertexBuffer},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"renderToScreenVertexBuffer",{get:function(){this._buffersInvalid&&this.updateRTTBuffers();return this._renderToScreenVertexBuffer},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"renderToTextureRect",{get:function(){this._buffersInvalid&&this.updateRTTBuffers();return this._renderToTextureRect},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"textureWidth",{get:function(){return this._textureWidth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"textureHeight",{get:function(){return this._textureHeight},enumerable:!0,configurable:!0});a.prototype.dispose=function(){a.deleteRTTBufferManager(this._stage3DProxy);this._indexBuffer&&(this._indexBuffer.dispose(),this._renderToScreenVertexBuffer.dispose(),this._renderToTextureVertexBuffer.dispose(),this._indexBuffer=
this._renderToTextureVertexBuffer=this._renderToScreenVertexBuffer=null)};a.prototype.updateRTTBuffers=function(){var a=this._stage3DProxy._iContext3D,b,d;null==this._renderToTextureVertexBuffer&&(this._renderToTextureVertexBuffer=a.createVertexBuffer(4,5));null==this._renderToScreenVertexBuffer&&(this._renderToScreenVertexBuffer=a.createVertexBuffer(4,5));this._indexBuffer||(this._indexBuffer=a.createIndexBuffer(6),this._indexBuffer.uploadFromArray([2,1,0,3,2,0],0,6));this._textureRatioX=b=Math.min(this._viewWidth/
this._textureWidth,1);this._textureRatioY=d=Math.min(this._viewHeight/this._textureHeight,1);var a=0.5*(1-b),e=0.5*(b+1),f=0.5*(d+1),g=0.5*(1-d);b=[-b,-d,a,f,0,b,-d,e,f,1,b,d,e,g,2,-b,d,a,g,3];a=[-1,-1,a,f,0,1,-1,e,f,1,1,1,e,g,2,-1,1,a,g,3];this._renderToTextureVertexBuffer.uploadFromArray(b,0,4);this._renderToScreenVertexBuffer.uploadFromArray(a,0,4);this._buffersInvalid=!1};return a}(b.events.EventDispatcher);g.RTTBufferManager=e})(b.managers||(b.managers={}))})(away||(away={}));
var RTTBufferManagerVO=function(){return function(){}}(),SingletonEnforcer=function(){return function(){}}();
(function(b){(function(b){var e=function(){function b(){this._tasks=[]}Object.defineProperty(b.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:!0,configurable:!0});b.prototype.pAddTask=function(a){this._tasks.push(a);null==this._requireDepthRender&&(this._requireDepthRender=a.requireDepthRender)};Object.defineProperty(b.prototype,"tasks",{get:function(){return this._tasks},enumerable:!0,configurable:!0});b.prototype.getMainInputTexture=function(a){return this._tasks[0].getMainInputTexture(a)};
Object.defineProperty(b.prototype,"textureWidth",{get:function(){return this._textureWidth},set:function(a){this._textureWidth=a;for(var b=0;b<this._tasks.length;++b)this._tasks[b].textureWidth=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"textureHeight",{get:function(){return this._textureHeight},set:function(a){this._textureHeight=a;for(var b=0;b<this._tasks.length;++b)this._tasks[b].textureHeight=a},enumerable:!0,configurable:!0});b.prototype.setRenderTargets=function(a,
b){this._tasks[this._tasks.length-1].target=a};b.prototype.dispose=function(){for(var a=0;a<this._tasks.length;++a)this._tasks[a].dispose()};b.prototype.update=function(a,b){};return b}();b.Filter3DBase=e})(b.filters||(b.filters={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(a){this._filterSizesInvalid=!0;this._stage3DProxy=a;this._rttManager=b.managers.RTTBufferManager.getInstance(a);this._rttManager.addEventListener(b.events.Event.RESIZE,this.onRTTResize,this)}d.prototype.onRTTResize=function(a){this._filterSizesInvalid=!0};Object.defineProperty(d.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:!0,configurable:!0});d.prototype.getMainInputTexture=function(a){this._filterTasksInvalid&&
this.updateFilterTasks(a);return this._mainInputTexture};Object.defineProperty(d.prototype,"filters",{get:function(){return this._filters},set:function(a){this._filters=a;this._filterTasksInvalid=!0;this._requireDepthRender=!1;if(this._filters){for(a=0;a<this._filters.length;++a){var b=this._filters[a],b=null==b.requireDepthRender?!1:b.requireDepthRender;this._requireDepthRender=this._requireDepthRender||b}this._filterSizesInvalid=!0}},enumerable:!0,configurable:!0});d.prototype.updateFilterTasks=
function(a){var b;this._filterSizesInvalid&&this.updateFilterSizes();if(this._filters){this._tasks=[];b=this._filters.length-1;for(var d,e=0;e<=b;++e)d=this._filters[e],d.setRenderTargets(e==b?null:this._filters[e+1].getMainInputTexture(a),a),this._tasks=this._tasks.concat(d.tasks);this._mainInputTexture=this._filters[0].getMainInputTexture(a)}else this._tasks=null};d.prototype.render=function(a,c,d){var e,g,f,l=a._iContext3D,w=this._rttManager.indexBuffer,s=this._rttManager.renderToTextureVertexBuffer;
if(this._filters){this._filterSizesInvalid&&this.updateFilterSizes();this._filterTasksInvalid&&this.updateFilterTasks(a);e=this._filters.length;for(g=0;g<e;++g)this._filters[g].update(a,c);e=this._tasks.length;1<e&&(l.setVertexBufferAt(0,s,0,b.display3D.Context3DVertexBufferFormat.FLOAT_2),l.setVertexBufferAt(1,s,2,b.display3D.Context3DVertexBufferFormat.FLOAT_2));for(g=0;g<e;++g)f=this._tasks[g],a.setRenderTarget(f.target),f.target||(a.scissorRect=null,s=this._rttManager.renderToScreenVertexBuffer,
l.setVertexBufferAt(0,s,0,b.display3D.Context3DVertexBufferFormat.FLOAT_2),l.setVertexBufferAt(1,s,2,b.display3D.Context3DVertexBufferFormat.FLOAT_2)),l.setTextureAt(0,f.getMainInputTexture(a)),l.setProgram(f.getProgram3D(a)),l.clear(0,0,0,0),f.activate(a,c,d),l.setBlendFactors(b.display3D.Context3DBlendFactor.ONE,b.display3D.Context3DBlendFactor.ZERO),l.drawTriangles(w,0,2),f.deactivate(a);l.setTextureAt(0,null);l.setVertexBufferAt(0,null);l.setVertexBufferAt(1,null)}};d.prototype.updateFilterSizes=
function(){for(var a=0;a<this._filters.length;++a)this._filters[a].textureWidth=this._rttManager.textureWidth,this._filters[a].textureHeight=this._rttManager.textureHeight;this._filterSizesInvalid=!0};d.prototype.dispose=function(){this._rttManager.removeEventListener(b.events.Event.RESIZE,this.onRTTResize,this);this._stage3DProxy=this._rttManager=null};return d}();g.Filter3DRenderer=e})(b.render||(b.render={}))})(away||(away={}));
(function(b){(function(g){var e=function(){function d(){this.length=this.position=0;this._mode="";this.Base64Key="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}d.prototype.writeByte=function(a){throw"Virtual method";};d.prototype.readByte=function(){throw"Virtual method";};d.prototype.writeUnsignedByte=function(a){throw"Virtual method";};d.prototype.readUnsignedByte=function(){throw"Virtual method";};d.prototype.writeUnsignedShort=function(a){throw"Virtual method";};d.prototype.readUnsignedShort=
function(){throw"Virtual method";};d.prototype.writeUnsignedInt=function(a){throw"Virtual method";};d.prototype.readUnsignedInt=function(){throw"Virtual method";};d.prototype.writeFloat=function(a){throw"Virtual method";};d.prototype.toFloatBits=function(a){throw"Virtual method";};d.prototype.readFloat=function(a){throw"Virtual method";};d.prototype.fromFloatBits=function(a){throw"Virtual method";};d.prototype.getBytesAvailable=function(){throw new b.errors.AbstractMethodError("ByteArrayBase, getBytesAvailable() not implemented ");
};d.prototype.toString=function(){return"[ByteArray] ( "+this._mode+" ) position="+this.position+" length="+this.length};d.prototype.compareEqual=function(a,b){if(void 0==b||b>this.length-this.position)b=this.length-this.position;b>a.length-a.position&&(b=a.length-a.position);for(var d=!0;d&&4<=b;)b-=4,this.readUnsignedInt()!=a.readUnsignedInt()&&(d=!1);for(;d&&1<=b;)b--,this.readUnsignedByte()!=a.readUnsignedByte()&&(d=!1);this.position-=NaN-b;a.position-=NaN-b;return d};d.prototype.writeBase64String=
function(a){for(var b=0;b<a.length;b++)a.charAt(b)};d.prototype.dumpToConsole=function(){function a(a,b){for(var c="0123456789abcdef".split(""),d="",e=0;e<b;e++)d=c[a>>(e<<2)&15]+d;return d}for(var b=this.position,d=this.position=0;d<this.length;d+=8){for(var e=a(d,4)+":",g=0;8>g&&d+g<this.length;g++)e+=" "+a(this.readUnsignedByte(),2);console.log(e)}this.position=b};d.prototype.internalGetBase64String=function(a,b,d){for(var e="",g,f,l,w,s,m=this.Base64Key;3<=a;)g=b.apply(d),f=b.apply(d),l=b.apply(d),
w=g>>2,s=(g&3)<<4|f>>4,f=(f&15)<<2|l>>6,g=l&63,e+=m.charAt(w)+m.charAt(s)+m.charAt(f)+m.charAt(g),a-=3;2==a?(g=b.apply(d),f=b.apply(d),s=(g&3)<<4|f>>4,f=(f&15)<<2,e+=m.charAt(g>>2)+m.charAt(s)+m.charAt(f)+"="):1==a&&(g=b.apply(d),s=(g&3)<<4,e+=m.charAt(g>>2)+m.charAt(s)+"==");return e};return d}();g.ByteArrayBase=e})(b.utils||(b.utils={}))})(away||(away={}));
(function(b){(function(b){var e=function(b){function a(){b.call(this);this.maxlength=0;this._mode="Typed array";this.maxlength=4;this.arraybytes=new ArrayBuffer(this.maxlength);this.unalignedarraybytestemp=new ArrayBuffer(16)}__extends(a,b);a.prototype.ensureWriteableSpace=function(a){this.ensureSpace(a+this.position)};a.prototype.setArrayBuffer=function(a){this.ensureSpace(a.byteLength);this.length=a.byteLength;a=new Int8Array(a);(new Int8Array(this.arraybytes,0,this.length)).set(a);this.position=
0};a.prototype.getBytesAvailable=function(){return this.length-this.position};a.prototype.ensureSpace=function(a){if(a>this.maxlength){a=a+255&-256;var b=new ArrayBuffer(a),d=new Uint8Array(this.arraybytes,0,this.length);(new Uint8Array(b,0,this.length)).set(d);this.arraybytes=b;this.maxlength=a}};a.prototype.writeByte=function(a){this.ensureWriteableSpace(1);(new Int8Array(this.arraybytes))[this.position++]=~~a;this.position>this.length&&(this.length=this.position)};a.prototype.readByte=function(){if(this.position>=
this.length)throw"ByteArray out of bounds read. Positon="+this.position+", Length="+this.length;return(new Int8Array(this.arraybytes))[this.position++]};a.prototype.readBytes=function(a,b,d){"undefined"===typeof b&&(b=0);"undefined"===typeof d&&(d=0);null==d&&(d=a.length);a.ensureWriteableSpace(b+d);var e=new Int8Array(a.arraybytes),f=new Int8Array(this.arraybytes);e.set(f.subarray(this.position,this.position+d),b);this.position+=d;d+b>a.length&&(a.length+=d+b-a.length)};a.prototype.writeUnsignedByte=
function(a){this.ensureWriteableSpace(1);(new Uint8Array(this.arraybytes))[this.position++]=~~a&255;this.position>this.length&&(this.length=this.position)};a.prototype.readUnsignedByte=function(){if(this.position>=this.length)throw"ByteArray out of bounds read. Positon="+this.position+", Length="+this.length;return(new Uint8Array(this.arraybytes))[this.position++]};a.prototype.writeUnsignedShort=function(a){this.ensureWriteableSpace(2);if(0==(this.position&1)){var b=new Uint16Array(this.arraybytes);
b[this.position>>1]=~~a&65535}else b=new Uint16Array(this.unalignedarraybytestemp,0,1),b[0]=~~a&65535,a=new Uint8Array(this.arraybytes,this.position,2),b=new Uint8Array(this.unalignedarraybytestemp,0,2),a.set(b);this.position+=2;this.position>this.length&&(this.length=this.position)};a.prototype.readUTFBytes=function(a){var b="";a=this.position+a;for(var d=new DataView(this.arraybytes);this.position<a;){var e=d.getUint8(this.position++);if(128>e){if(0==e)break;b+=String.fromCharCode(e)}else if(224>
e)b+=String.fromCharCode((e&63)<<6|d.getUint8(this.position++)&127);else if(240>e)var f=d.getUint8(this.position++),b=b+String.fromCharCode((e&31)<<12|(f&127)<<6|d.getUint8(this.position++)&127);else var f=d.getUint8(this.position++),g=d.getUint8(this.position++),b=b+String.fromCharCode((e&15)<<18|(f&127)<<12|g<<6&127|d.getUint8(this.position++)&127)}return b};a.prototype.readInt=function(){var a=(new DataView(this.arraybytes)).getInt32(this.position);this.position+=4;return a};a.prototype.readShort=
function(){var a=(new DataView(this.arraybytes)).getInt16(this.position);this.position+=2;return a};a.prototype.readDouble=function(){var a=(new DataView(this.arraybytes)).getFloat64(this.position);this.position+=8;return a};a.prototype.readUnsignedShort=function(){if(this.position>this.length+2)throw"ByteArray out of bounds read. Position="+this.position+", Length="+this.length;if(0==(this.position&1)){var a=new Uint16Array(this.arraybytes),b=this.position>>1;this.position+=2;return a[b]}a=new Uint16Array(this.unalignedarraybytestemp,
0,1);b=new Uint8Array(this.arraybytes,this.position,2);(new Uint8Array(this.unalignedarraybytestemp,0,2)).set(b);this.position+=2;return a[0]};a.prototype.writeUnsignedInt=function(a){this.ensureWriteableSpace(4);if(0==(this.position&3)){var b=new Uint32Array(this.arraybytes);b[this.position>>2]=~~a&4294967295}else b=new Uint32Array(this.unalignedarraybytestemp,0,1),b[0]=~~a&4294967295,a=new Uint8Array(this.arraybytes,this.position,4),b=new Uint8Array(this.unalignedarraybytestemp,0,4),a.set(b);this.position+=
4;this.position>this.length&&(this.length=this.position)};a.prototype.readUnsignedInt=function(){if(this.position>this.length+4)throw"ByteArray out of bounds read. Position="+this.position+", Length="+this.length;if(0==(this.position&3)){var a=new Uint32Array(this.arraybytes),b=this.position>>2;this.position+=4;return a[b]}a=new Uint32Array(this.unalignedarraybytestemp,0,1);b=new Uint8Array(this.arraybytes,this.position,4);(new Uint8Array(this.unalignedarraybytestemp,0,4)).set(b);this.position+=4;
return a[0]};a.prototype.writeFloat=function(a){this.ensureWriteableSpace(4);if(0==(this.position&3)){var b=new Float32Array(this.arraybytes);b[this.position>>2]=a}else b=new Float32Array(this.unalignedarraybytestemp,0,1),b[0]=a,a=new Uint8Array(this.arraybytes,this.position,4),b=new Uint8Array(this.unalignedarraybytestemp,0,4),a.set(b);this.position+=4;this.position>this.length&&(this.length=this.position)};a.prototype.readFloat=function(){if(this.position>this.length+4)throw"ByteArray out of bounds read. Positon="+
this.position+", Length="+this.length;if(0==(this.position&3)){var a=new Float32Array(this.arraybytes),b=this.position>>2;this.position+=4;return a[b]}a=new Float32Array(this.unalignedarraybytestemp,0,1);b=new Uint8Array(this.arraybytes,this.position,4);(new Uint8Array(this.unalignedarraybytestemp,0,4)).set(b);this.position+=4;return a[0]};return a}(b.ByteArrayBase);b.ByteArray=e})(b.utils||(b.utils={}))})(away||(away={}));
(function(b){(function(b){var e=function(b){function a(){b.call(this);this._bytes=[];this._mode="Array"}__extends(a,b);a.prototype.writeByte=function(a){this._bytes[this.position++]=~~a;this.position>this.length&&(this.length=this.position)};a.prototype.readByte=function(){if(this.position>=this.length)throw"ByteArray out of bounds read. Position="+this.position+", Length="+this.length;return this._bytes[this.position++]};a.prototype.writeUnsignedByte=function(a){this._bytes[this.position++]=~~a&
255;this.position>this.length&&(this.length=this.position)};a.prototype.readUnsignedByte=function(){if(this.position>=this.length)throw"ByteArray out of bounds read. Position="+this.position+", Length="+this.length;return this._bytes[this.position++]};a.prototype.writeUnsignedShort=function(a){a=~~a;this._bytes[this.position++]=a&255;this._bytes[this.position++]=a>>8&255;this.position>this.length&&(this.length=this.position)};a.prototype.readUnsignedShort=function(){if(this.position+2>this.length)throw"ByteArray out of bounds read. Position="+
this.position+", Length="+this.length;var a=this._bytes[this.position]|this._bytes[this.position+1]<<8;this.position+=2;return a};a.prototype.writeUnsignedInt=function(a){a=~~a;this._bytes[this.position++]=a&255;this._bytes[this.position++]=a>>>8&255;this._bytes[this.position++]=a>>>16&255;this._bytes[this.position++]=a>>>24&255;this.position>this.length&&(this.length=this.position)};a.prototype.readUnsignedInt=function(){if(this.position+4>this.length)throw"ByteArray out of bounds read. Position="+
this.position+", Length="+this.length;var a=this._bytes[this.position]|this._bytes[this.position+1]<<8|this._bytes[this.position+2]<<16|this._bytes[this.position+3]<<24;this.position+=4;return a>>>0};a.prototype.writeFloat=function(a){this.writeUnsignedInt(this.toFloatBits(Number(a)))};a.prototype.toFloatBits=function(a){if(0==a)return 0;var b=0;0>a?(a=-a,b=1):b=0;var d=Math.log(a)/Math.log(2),d=Math.floor(d);a*=Math.pow(2,23-d);a=Math.floor(a)-8388608;return b<<31>>>0|d+127<<23|a};a.prototype.readFloat=
function(a){return this.fromFloatBits(this.readUnsignedInt())};a.prototype.fromFloatBits=function(a){if(0==a)return 0;var b=a&8388607|8388608,b=Math.pow(2,(a>>>23&255)-127-23)*b;0!=a>>>31&&(b=-b);return b};return a}(b.ByteArrayBase);b.ByteArrayBuffer=e})(b.utils||(b.utils={}))})(away||(away={}));var aglsl;(function(b){var g=function(){return function(){this.filter=this.mipmap=this.wrap=this.special=this.readmode=this.dim=this.lodbias=0}}();b.Sampler=g})(aglsl||(aglsl={}));
(function(b){var g=function(){return function(){this.dest=new b.Destination;this.opcode=0;this.a=new b.Destination;this.b=new b.Destination}}();b.Token=g})(aglsl||(aglsl={}));(function(b){var g=function(){return function(){this.version=this.progid=0;this.type=""}}();b.Header=g})(aglsl||(aglsl={}));
(function(b){var g=function(){return function(b,d,a,c,g,q,h,f,l,w,s){this.s=b;this.flags=d;this.dest=a;this.a=c;this.b=g;this.matrixwidth=q;this.matrixheight=h;this.ndwm=f;this.scalar=l;this.dm=w;this.lod=s}}();b.OpLUT=g})(aglsl||(aglsl={}));
(function(b){var g=function(){return function(){this.regread=[[],[],[],[],[],[],[]];this.regwrite=[[],[],[],[],[],[],[]];this.hasmatrix=this.writedepth=this.hasindirect=!1;this.samplers=[];this.tokens=[];this.header=new b.Header}}();b.Description=g})(aglsl||(aglsl={}));(function(b){var g=function(){return function(){this.dim=this.regtype=this.regnum=this.mask=0}}();b.Destination=g})(aglsl||(aglsl={}));
(function(b){var g=function(){function e(){this.enableErrorChecking=!1;this.resources=[];this.driverInfo="Call getter function instead"}e.maxvertexconstants=128;e.maxfragconstants=28;e.maxtemp=8;e.maxstreams=8;e.maxtextures=8;e.defaultsampler=new b.Sampler;return e}();b.Context3D=g})(aglsl||(aglsl={}));
(function(b){var g=function(){function e(){}e.agal2glsllut=[new b.OpLUT("%dest = %cast(%a);\n",0,!0,!0,!1,null,null,null,null,null,null),new b.OpLUT("%dest = %cast(%a + %b);\n",0,!0,!0,!0,null,null,null,null,null,null),new b.OpLUT("%dest = %cast(%a - %b);\n",0,!0,!0,!0,null,null,null,null,null,null),new b.OpLUT("%dest = %cast(%a * %b);\n",0,!0,!0,!0,null,null,null,null,null,null),new b.OpLUT("%dest = %cast(%a / %b);\n",0,!0,!0,!0,null,null,null,null,null,null),new b.OpLUT("%dest = %cast(1.0) / %a;\n",
0,!0,!0,!1,null,null,null,null,null,null),new b.OpLUT("%dest = %cast(min(%a,%b));\n",0,!0,!0,!0,null,null,null,null,null,null),new b.OpLUT("%dest = %cast(max(%a,%b));\n",0,!0,!0,!0,null,null,null,null,null,null),new b.OpLUT("%dest = %cast(fract(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new b.OpLUT("%dest = %cast(sqrt(abs(%a)));\n",0,!0,!0,!1,null,null,null,null,null,null),new b.OpLUT("%dest = %cast(inversesqrt(abs(%a)));\n",0,!0,!0,!1,null,null,null,null,null,null),new b.OpLUT("%dest = %cast(pow(abs(%a),%b));\n",
0,!0,!0,!0,null,null,null,null,null,null),new b.OpLUT("%dest = %cast(log2(abs(%a)));\n",0,!0,!0,!1,null,null,null,null,null,null),new b.OpLUT("%dest = %cast(exp2(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new b.OpLUT("%dest = %cast(normalize(vec3( %a ) ));\n",0,!0,!0,!1,null,null,!0,null,null,null),new b.OpLUT("%dest = %cast(sin(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new b.OpLUT("%dest = %cast(cos(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new b.OpLUT("%dest = %cast(cross(vec3(%a),vec3(%b)));\n",
0,!0,!0,!0,null,null,!0,null,null,null),new b.OpLUT("%dest = %cast(dot(vec3(%a),vec3(%b)));\n",0,!0,!0,!0,null,null,!0,null,null,null),new b.OpLUT("%dest = %cast(dot(vec4(%a),vec4(%b)));\n",0,!0,!0,!0,null,null,!0,null,null,null),new b.OpLUT("%dest = %cast(abs(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new b.OpLUT("%dest = %cast(%a * -1.0);\n",0,!0,!0,!1,null,null,null,null,null,null),new b.OpLUT("%dest = %cast(clamp(%a,0.0,1.0));\n",0,!0,!0,!1,null,null,null,null,null,null),new b.OpLUT("%dest = %cast(dot(vec3(%a),vec3(%b)));\n",
null,!0,!0,!0,3,3,!0,null,null,null),new b.OpLUT("%dest = %cast(dot(vec4(%a),vec4(%b)));\n",null,!0,!0,!0,4,4,!0,null,null,null),new b.OpLUT("%dest = %cast(dot(vec4(%a),vec4(%b)));\n",null,!0,!0,!0,4,3,!0,null,null,null),new b.OpLUT("%dest = %cast(dFdx(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new b.OpLUT("%dest = %cast(dFdx(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new b.OpLUT("if (float(%a)==float(%b)) {;\n",0,!1,!0,!0,null,null,null,!0,null,null),new b.OpLUT("if (float(%a)!=float(%b)) {;\n",
0,!1,!0,!0,null,null,null,!0,null,null),new b.OpLUT("if (float(%a)>=float(%b)) {;\n",0,!1,!0,!0,null,null,null,!0,null,null),new b.OpLUT("if (float(%a)<float(%b)) {;\n",0,!1,!0,!0,null,null,null,!0,null,null),new b.OpLUT("} else {;\n",0,!1,!1,!1,null,null,null,null,null,null),new b.OpLUT("};\n",0,!1,!1,!1,null,null,null,null,null,null),new b.OpLUT(null,null,null,null,!1,null,null,null,null,null,null),new b.OpLUT(null,null,null,null,!1,null,null,null,null,null,null),new b.OpLUT(null,null,null,null,
!1,null,null,null,null,null,null),new b.OpLUT(null,null,null,null,!1,null,null,null,null,null,null),new b.OpLUT("%dest = %cast(texture%texdimLod(%b,%texsize(%a)).%dm);\n",null,!0,!0,!0,null,null,null,null,!0,null),new b.OpLUT("if ( float(%a)<0.0 ) discard;\n",null,!1,!0,!1,null,null,null,!0,null,null),new b.OpLUT("%dest = %cast(texture%texdim(%b,%texsize(%a)%lod).%dm);\n",null,!0,!0,!0,null,null,!0,null,!0,!0),new b.OpLUT("%dest = %cast(greaterThanEqual(%a,%b).%dm);\n",0,!0,!0,!0,null,null,!0,null,
!0,null),new b.OpLUT("%dest = %cast(lessThan(%a,%b).%dm);\n",0,!0,!0,!0,null,null,!0,null,!0,null),new b.OpLUT("%dest = %cast(sign(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new b.OpLUT("%dest = %cast(equal(%a,%b).%dm);\n",0,!0,!0,!0,null,null,!0,null,!0,null),new b.OpLUT("%dest = %cast(notEqual(%a,%b).%dm);\n",0,!0,!0,!0,null,null,!0,null,!0,null)];return e}();b.Mapping=g})(aglsl||(aglsl={}));
(function(b){(function(g){var e=function(){return function(d,a,c,e,g,h,f,l,w,s){this.a=new b.assembler.FS;this.b=new b.assembler.FS;this.flags=new b.assembler.Flags;this.dest=d;this.a.format=a;this.a.size=c;this.b.format=e;this.b.size=g;this.opcode=h;this.flags.simple=f;this.flags.horizontal=l;this.flags.fragonly=w;this.flags.matrix=s}}();g.Opcode=e;e=function(){return function(){}}();g.FS=e;e=function(){return function(){}}();g.Flags=e})(b.assembler||(b.assembler={}))})(aglsl||(aglsl={}));
(function(b){(function(g){var e=function(){function d(){}Object.defineProperty(d,"map",{get:function(){d._map||(d._map=[],d._map.mov=new b.assembler.Opcode("vector","vector",4,"none",0,0,!0,null,null,null),d._map.add=new b.assembler.Opcode("vector","vector",4,"vector",4,1,!0,null,null,null),d._map.sub=new b.assembler.Opcode("vector","vector",4,"vector",4,2,!0,null,null,null),d._map.mul=new b.assembler.Opcode("vector","vector",4,"vector",4,3,!0,null,null,null),d._map.div=new b.assembler.Opcode("vector",
"vector",4,"vector",4,4,!0,null,null,null),d._map.rcp=new b.assembler.Opcode("vector","vector",4,"none",0,5,!0,null,null,null),d._map.min=new b.assembler.Opcode("vector","vector",4,"vector",4,6,!0,null,null,null),d._map.max=new b.assembler.Opcode("vector","vector",4,"vector",4,7,!0,null,null,null),d._map.frc=new b.assembler.Opcode("vector","vector",4,"none",0,8,!0,null,null,null),d._map.sqt=new b.assembler.Opcode("vector","vector",4,"none",0,9,!0,null,null,null),d._map.rsq=new b.assembler.Opcode("vector",
"vector",4,"none",0,10,!0,null,null,null),d._map.pow=new b.assembler.Opcode("vector","vector",4,"vector",4,11,!0,null,null,null),d._map.log=new b.assembler.Opcode("vector","vector",4,"none",0,12,!0,null,null,null),d._map.exp=new b.assembler.Opcode("vector","vector",4,"none",0,13,!0,null,null,null),d._map.nrm=new b.assembler.Opcode("vector","vector",4,"none",0,14,!0,null,null,null),d._map.sin=new b.assembler.Opcode("vector","vector",4,"none",0,15,!0,null,null,null),d._map.cos=new b.assembler.Opcode("vector",
"vector",4,"none",0,16,!0,null,null,null),d._map.crs=new b.assembler.Opcode("vector","vector",4,"vector",4,17,!0,!0,null,null),d._map.dp3=new b.assembler.Opcode("vector","vector",4,"vector",4,18,!0,!0,null,null),d._map.dp4=new b.assembler.Opcode("vector","vector",4,"vector",4,19,!0,!0,null,null),d._map.abs=new b.assembler.Opcode("vector","vector",4,"none",0,20,!0,null,null,null),d._map.neg=new b.assembler.Opcode("vector","vector",4,"none",0,21,!0,null,null,null),d._map.sat=new b.assembler.Opcode("vector",
"vector",4,"none",0,22,!0,null,null,null),d._map.ted=new b.assembler.Opcode("vector","vector",4,"sampler",1,38,!0,null,!0,null),d._map.kil=new b.assembler.Opcode("none","scalar",1,"none",0,39,!0,null,!0,null),d._map.tex=new b.assembler.Opcode("vector","vector",4,"sampler",1,40,!0,null,!0,null),d._map.m33=new b.assembler.Opcode("vector","matrix",3,"vector",3,23,!0,null,null,!0),d._map.m44=new b.assembler.Opcode("vector","matrix",4,"vector",4,24,!0,null,null,!0),d._map.m43=new b.assembler.Opcode("vector",
"matrix",3,"vector",4,25,!0,null,null,!0),d._map.sge=new b.assembler.Opcode("vector","vector",4,"vector",4,41,!0,null,null,null),d._map.slt=new b.assembler.Opcode("vector","vector",4,"vector",4,42,!0,null,null,null),d._map.sgn=new b.assembler.Opcode("vector","vector",4,"vector",4,43,!0,null,null,null),d._map.seq=new b.assembler.Opcode("vector","vector",4,"vector",4,44,!0,null,null,null),d._map.sne=new b.assembler.Opcode("vector","vector",4,"vector",4,45,!0,null,null,null));return d._map},enumerable:!0,
configurable:!0});return d}();g.OpcodeMap=e})(b.assembler||(b.assembler={}))})(aglsl||(aglsl={}));(function(b){(function(b){var e=function(){return function(b,a){"undefined"===typeof b&&(b=null);"undefined"===typeof a&&(a=null);this.name="";this.version=0;this.name=b;this.version=a;this.data=new away.utils.ByteArray}}();b.Part=e})(b.assembler||(b.assembler={}))})(aglsl||(aglsl={}));
(function(b){(function(g){var e=function(){return function(b,a){this.code=b;this.desc=a}}();g.Reg=e;e=function(){function d(){}Object.defineProperty(d,"map",{get:function(){d._map||(d._map=[],d._map.va=new b.assembler.Reg(0,"vertex attribute"),d._map.fc=new b.assembler.Reg(1,"fragment constant"),d._map.vc=new b.assembler.Reg(1,"vertex constant"),d._map.ft=new b.assembler.Reg(2,"fragment temporary"),d._map.vt=new b.assembler.Reg(2,"vertex temporary"),d._map.vo=new b.assembler.Reg(3,"vertex output"),
d._map.op=new b.assembler.Reg(3,"vertex output"),d._map.fd=new b.assembler.Reg(3,"fragment depth output"),d._map.fo=new b.assembler.Reg(3,"fragment output"),d._map.oc=new b.assembler.Reg(3,"fragment output"),d._map.v=new b.assembler.Reg(4,"varying"),d._map.vi=new b.assembler.Reg(4,"varying output"),d._map.fi=new b.assembler.Reg(4,"varying input"),d._map.fs=new b.assembler.Reg(5,"sampler"));return d._map},enumerable:!0,configurable:!0});return d}();g.RegMap=e})(b.assembler||(b.assembler={}))})(aglsl||
(aglsl={}));
(function(b){(function(g){var e=function(){return function(b,a,c){this.shift=b;this.mask=a;this.value=c}}();g.Sampler=e;e=function(){function d(){}Object.defineProperty(d,"map",{get:function(){d._map||(d._map=[],d._map.rgba=new b.assembler.Sampler(8,15,0),d._map.rg=new b.assembler.Sampler(8,15,5),d._map.r=new b.assembler.Sampler(8,15,4),d._map.compressed=new b.assembler.Sampler(8,15,1),d._map.compressed_alpha=new b.assembler.Sampler(8,15,2),d._map.dxt1=new b.assembler.Sampler(8,15,1),d._map.dxt5=
new b.assembler.Sampler(8,15,2),d._map["2d"]=new b.assembler.Sampler(12,15,0),d._map.cube=new b.assembler.Sampler(12,15,1),d._map["3d"]=new b.assembler.Sampler(12,15,2),d._map.centroid=new b.assembler.Sampler(16,1,1),d._map.ignoresampler=new b.assembler.Sampler(16,4,4),d._map.clamp=new b.assembler.Sampler(20,15,0),d._map.repeat=new b.assembler.Sampler(20,15,1),d._map.wrap=new b.assembler.Sampler(20,15,1),d._map.nomip=new b.assembler.Sampler(24,15,0),d._map.mipnone=new b.assembler.Sampler(24,15,0),
d._map.mipnearest=new b.assembler.Sampler(24,15,1),d._map.miplinear=new b.assembler.Sampler(24,15,2),d._map.nearest=new b.assembler.Sampler(28,15,0),d._map.linear=new b.assembler.Sampler(28,15,1));return d._map},enumerable:!0,configurable:!0});return d}();g.SamplerMap=e})(b.assembler||(b.assembler={}))})(aglsl||(aglsl={}));
(function(b){(function(g){var e=function(){function d(){this.r={};this.cur=new b.assembler.Part}d.prototype.assemble=function(a,b,d){"undefined"===typeof b&&(b=null);"undefined"===typeof d&&(d=null);d||(d=1);b&&this.addHeader(b,d);a=a.replace(/[\f\n\r\v]+/g,"\n").split("\n");for(var e in a)this.processLine(a[e],e);return this.r};d.prototype.processLine=function(a,b){var d=a.search("//");-1!=d&&(a=a.slice(0,d));a=a.replace(/^\s+|\s+$/g,"");if(0<a.length){var e=a.search(/<.*>/g),d=null;-1!=e&&(d=a.slice(e).match(/([\w\.\-\+]+)/gi),
a=a.slice(0,e));e=a.match(/([\w\.\+\[\]]+)/gi);if(!e||1>e.length)3<=a.length&&console.log("Warning: bad line "+b+": "+a);else switch(e[0]){case "part":this.addHeader(e[1],Number(e[2]));break;case "endpart":if(!this.cur)throw"Unexpected endpart";this.cur.data.position=0;this.cur=null;break;default:if(!this.cur){console.log("Warning: bad line "+b+": "+a+" (Outside of any part definition)");break}if("comment"==this.cur.name)break;var h=g.OpcodeMap.map[e[0]];if(!h)throw"Bad opcode "+e[0]+" "+b+": "+a;
this.emitOpcode(this.cur,h.opcode);var f=1;if(h.dest&&"none"!=h.dest){if(!this.emitDest(this.cur,e[f++],h.dest))throw"Bad destination register "+e[f-1]+" "+b+": "+a;}else this.emitZeroDword(this.cur);if(h.a&&"none"!=h.a.format){if(!this.emitSource(this.cur,e[f++],h.a))throw"Bad source register "+e[f-1]+" "+b+": "+a;}else this.emitZeroQword(this.cur);if(h.b&&"none"!=h.b.format)if("sampler"==h.b.format){if(!this.emitSampler(this.cur,e[f++],h.b,d))throw"Bad sampler register "+e[f-1]+" "+b+": "+a;}else{if(!this.emitSource(this.cur,
e[f++],h.b))throw"Bad source register "+e[f-1]+" "+b+": "+a;}else this.emitZeroQword(this.cur)}}};d.prototype.emitHeader=function(a){a.data.writeUnsignedByte(160);a.data.writeUnsignedInt(a.version);16<=a.version&&a.data.writeUnsignedByte(0);a.data.writeUnsignedByte(161);switch(a.name){case "fragment":a.data.writeUnsignedByte(1);break;case "vertex":a.data.writeUnsignedByte(0);break;case "cpu":a.data.writeUnsignedByte(2);break;default:a.data.writeUnsignedByte(255)}};d.prototype.emitOpcode=function(a,
b){a.data.writeUnsignedInt(b)};d.prototype.emitZeroDword=function(a){a.data.writeUnsignedInt(0)};d.prototype.emitZeroQword=function(a){a.data.writeUnsignedInt(0);a.data.writeUnsignedInt(0)};d.prototype.emitDest=function(a,b,d){var e=b.match(/([fov]?[tpocidavs])(\d*)(\.[xyzw]{1,4})?/i);if(!g.RegMap.map[e[1]])return!1;b=e[2]?e[2]:0;d=g.RegMap.map[e[1]].code;e=this.stringToMask(e[3]);a.data.writeUnsignedShort(b);a.data.writeUnsignedByte(e);a.data.writeUnsignedByte(d);return!0};d.prototype.stringToMask=
function(a){if(!a)return 15;var b=0;-1!=a.indexOf("x")&&(b|=1);-1!=a.indexOf("y")&&(b|=2);-1!=a.indexOf("z")&&(b|=4);-1!=a.indexOf("w")&&(b|=8);return b};d.prototype.stringToSwizzle=function(a){if(!a)return 228;var b={x:0,y:1,z:2,w:3},d=0;if("."!=a.charAt(0))throw"Missing . for swizzle";1<a.length&&(d|=b[a.charAt(1)]);d=2<a.length?d|b[a.charAt(2)]<<2:d|(d&3)<<2;d=3<a.length?d|b[a.charAt(3)]<<4:d|(d&12)<<2;return d=4<a.length?d|b[a.charAt(4)]<<6:d|(d&48)<<2};d.prototype.emitSampler=function(a,b,d,
e){b=b.match(/fs(\d*)/i);if(!b||!b[1])return!1;a.data.writeUnsignedShort(b[1]);a.data.writeUnsignedByte(0);a.data.writeUnsignedByte(0);b=5;for(var h=d=0;h<e.length;h++){var f=g.SamplerMap.map[e[h].toLowerCase()];f?(0!=(d>>f.shift&f.mask)&&console.log("Warning, duplicate sampler option"),d|=f.mask<<f.shift,b&=~(f.mask<<f.shift),b|=f.value<<f.shift):console.log("Warning, unknown sampler option: ",e[h])}a.data.writeUnsignedInt(b);return!0};d.prototype.emitSource=function(a,b,d){var e,h,f;if(f=b.match(/vc\[(v[tcai])(\d+)\.([xyzw])([\+\-]\d+)?\](\.[xyzw]{1,4})?/i)){if(!g.RegMap.map[f[1]])return!1;
b=f[2]|0;d=g.RegMap.map[f[1]].code;e=this.stringToSwizzle(f[5]);h={x:0,y:1,z:2,w:3}[f[3]];f=f[4]|0;a.data.writeUnsignedShort(b);a.data.writeByte(f);a.data.writeUnsignedByte(e);a.data.writeUnsignedByte(1);a.data.writeUnsignedByte(d);a.data.writeUnsignedByte(h);a.data.writeUnsignedByte(128)}else{e=b.match(/([fov]?[tpocidavs])(\d*)(\.[xyzw]{1,4})?/i);if(!g.RegMap.map[e[1]])return!1;b=e[2]|0;d=g.RegMap.map[e[1]].code;e=this.stringToSwizzle(e[3]);a.data.writeUnsignedShort(b);a.data.writeUnsignedByte(0);
a.data.writeUnsignedByte(e);a.data.writeUnsignedByte(d);a.data.writeUnsignedByte(0);a.data.writeUnsignedByte(0);a.data.writeUnsignedByte(0)}return!0};d.prototype.addHeader=function(a,c){c||(c=1);if(void 0==this.r[a])this.r[a]=new b.assembler.Part(a,c),this.emitHeader(this.r[a]);else if(this.r[a].version!=c)throw"Multiple versions for part "+a;this.cur=this.r[a]};return d}();g.AGALMiniAssembler=e})(b.assembler||(b.assembler={}))})(aglsl||(aglsl={}));
(function(b){var g=function(){function e(){}e.prototype.decribeAGALByteArray=function(d){var a=new b.Header;if(160!=d.readUnsignedByte())throw"Bad AGAL: Missing 0xa0 magic byte.";a.version=d.readUnsignedInt();16<=a.version&&(d.readUnsignedByte(),a.version>>=1);if(161!=d.readUnsignedByte())throw"Bad AGAL: Missing 0xa1 magic byte.";a.progid=d.readUnsignedByte();switch(a.progid){case 1:a.type="fragment";break;case 0:a.type="vertex";break;case 2:a.type="cpu";break;default:a.type=""}for(var c=new b.Description,
e=[];d.position<d.length;){var g=new b.Token;g.opcode=d.readUnsignedInt();var h=b.Mapping.agal2glsllut[g.opcode];if(!h)throw"Opcode not valid or not implemented yet: "+g.opcode;h.matrixheight&&(c.hasmatrix=!0);h.dest?(g.dest.regnum=d.readUnsignedShort(),g.dest.mask=d.readUnsignedByte(),g.dest.regtype=d.readUnsignedByte(),c.regwrite[g.dest.regtype][g.dest.regnum]|=g.dest.mask):(g.dest=null,d.readUnsignedInt());h.a?this.readReg(g.a,1,c,d):(g.a=null,d.readUnsignedInt(),d.readUnsignedInt());h.b?this.readReg(g.b,
h.matrixheight|0,c,d):(g.b=null,d.readUnsignedInt(),d.readUnsignedInt());e.push(g)}c.header=a;c.tokens=e;return c};e.prototype.readReg=function(b,a,c,e){b.regnum=e.readUnsignedShort();b.indexoffset=e.readByte();b.swizzle=e.readUnsignedByte();b.regtype=e.readUnsignedByte();c.regread[b.regtype][b.regnum]=15;5==b.regtype?(b.lodbiad=b.indexoffset,b.indexoffset=void 0,b.swizzle=void 0,b.readmode=e.readUnsignedByte(),b.dim=b.readmode>>4,b.readmode&=15,b.special=e.readUnsignedByte(),b.wrap=b.special>>4,
b.special&=15,b.mipmap=e.readUnsignedByte(),b.filter=b.mipmap>>4,b.mipmap&=15,c.samplers[b.regnum]=b):(b.indexregtype=e.readUnsignedByte(),b.indexselect=e.readUnsignedByte(),b.indirectflag=e.readUnsignedByte());b.indirectflag&&(c.hasindirect=!0);if(!b.indirectflag&&a)for(e=0;e<a;e++)c.regread[b.regtype][b.regnum+e]=c.regread[b.regtype][b.regnum]};return e}();b.AGALTokenizer=g})(aglsl||(aglsl={}));
(function(b){var g=function(){function e(){}e.prototype.parse=function(d){var a,c;a="precision mediump float;\n";var e=d.header.type[0];"vertex"==d.header.type&&(a+="uniform float yflip;\n");if(d.hasindirect)a+="uniform vec4 "+e+"carrr["+b.Context3D.maxvertexconstants+"];\n";else for(var g=0;g<d.regread[1].length;g++)d.regread[1][g]&&(a+="uniform vec4 "+e+"c"+g+";\n");for(g=0;g<d.regread[2].length||g<d.regwrite[2].length;g++)if(d.regread[2][g]||d.regwrite[2][g])a+="vec4 "+e+"t"+g+";\n";for(g=0;g<
d.regread[0].length;g++)d.regread[0][g]&&(a+="attribute vec4 va"+g+";\n");for(g=0;g<d.regread[4].length||g<d.regwrite[4].length;g++)if(d.regread[4][g]||d.regwrite[4][g])a+="varying vec4 vi"+g+";\n";c=["2D","Cube","3D",""];for(g=0;g<d.samplers.length;g++)d.samplers[g]&&(a+="uniform sampler"+c[d.samplers[g].dim&3]+" fs"+g+";\n");"vertex"==d.header.type&&(a+="vec4 outpos;\n");d.writedepth&&(a+="vec4 tmp_FragDepth;\n");c="void main() {\n";for(g=0;g<d.tokens.length;g++){var h=b.Mapping.agal2glsllut[d.tokens[g].opcode];
if(!h)throw"Opcode not valid or not implemented yet: ";for(var f=h.matrixheight||1,l=0;l<f;l++){var w="  "+h.s;if(d.tokens[g].dest){if(h.matrixheight){if(1!=(d.tokens[g].dest.mask>>l&1))continue;var s=this.regtostring(d.tokens[g].dest.regtype,d.tokens[g].dest.regnum,d,e),m="float",n=["x","y","z","w"][l],s=s+("."+n)}else if(s=this.regtostring(d.tokens[g].dest.regtype,d.tokens[g].dest.regnum,d,e),15!=d.tokens[g].dest.mask)switch(m=0,n="",d.tokens[g].dest.mask&1&&(m++,n+="x"),d.tokens[g].dest.mask&2&&
(m++,n+="y"),d.tokens[g].dest.mask&4&&(m++,n+="z"),d.tokens[g].dest.mask&8&&(m++,n+="w"),s+="."+n,m){case 1:m="float";break;case 2:m="vec2";break;case 3:m="vec3";break;default:throw"Unexpected destination mask";}else m="vec4",n="xyzw";w=w.replace("%dest",s);w=w.replace("%cast",m);w=w.replace("%dm",n)}s=15;!h.ndwm&&(h.dest&&d.tokens[g].dest)&&(s=d.tokens[g].dest.mask);d.tokens[g].a&&(w=w.replace("%a",this.sourcetostring(d.tokens[g].a,0,s,h.scalar,d,e)));d.tokens[g].b&&(w=w.replace("%b",this.sourcetostring(d.tokens[g].b,
l,s,h.scalar,d,e)),5==d.tokens[g].b.regtype&&(s=["vec2","vec3","vec3"][d.tokens[g].b.dim],w=w.replace("%texdim",["2D","Cube","3D"][d.tokens[g].b.dim]),w=w.replace("%texsize",s),w=w.replace("%lod","")));c+=w}}"vertex"==d.header.type&&(c+="  gl_Position = vec4(outpos.x, yflip*outpos.y, outpos.z*2.0 - outpos.w, outpos.w);\n");d.writedepth&&(c+="  gl_FragDepth = clamp(tmp_FragDepth,0.0,1.0);\n");return a+(c+"}\n")};e.prototype.regtostring=function(b,a,c,e){switch(b){case 0:return"va"+a;case 1:return c.hasindirect&&
"vertex"==c.header.type?"vcarrr["+a+"]":e+"c"+a;case 2:return e+"t"+a;case 3:return"vertex"==c.header.type?"outpos":"gl_FragColor";case 4:return"vi"+a;case 5:return"fs"+a;case 6:return"tmp_FragDepth";default:throw"Unknown register type";}};e.prototype.sourcetostring=function(b,a,c,e,g,h){var f=["x","y","z","w"];b.indirectflag?(g="vcarrr[int("+this.regtostring(b.indexregtype,b.regnum,g,h)+"."+f[b.indexselect]+")",a+=b.indexoffset,0>a&&(g+=a.toString()),0<a&&(g+="+"+a.toString()),g+="]"):g=this.regtostring(b.regtype,
b.regnum+a,g,h);if(5==b.regtype)return g;if(e)return g+"."+f[b.swizzle>>0&3];if(228==b.swizzle&&15==c)return g;g+=".";c&1&&(g+=f[b.swizzle>>0&3]);c&2&&(g+=f[b.swizzle>>2&3]);c&4&&(g+=f[b.swizzle>>4&3]);c&8&&(g+=f[b.swizzle>>6&3]);return g};return e}();b.AGLSLParser=g})(aglsl||(aglsl={}));
(function(b){var g=function(){function e(){}e.prototype.compile=function(d,a){var c=new b.assembler.AGALMiniAssembler,e=new b.AGALTokenizer;switch(d){case "vertex":c.assemble("part vertex 1\n"+a+"endpart");c=c.r.vertex.data;break;case "fragment":c.assemble("part fragment 1\n"+a+"endpart");c=c.r.fragment.data;break;default:throw"Unknown Context3DProgramType";}e=e.decribeAGALByteArray(c);return this.glsl=(new b.AGLSLParser).parse(e)};return e}();b.AGLSLCompiler=g})(aglsl||(aglsl={}));
away.Debug.THROW_ERRORS=!1;away.Debug.LOG_PI_ERRORS=!1;(function(b){var g=function(b){function d(){b.call(this)}__extends(d,b);return d}(b.events.EventDispatcher);b.Away3D=g})(away||(away={}));
